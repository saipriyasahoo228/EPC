import{r as a,j as e}from"./main-DTv03d8r.js";import{C as se}from"./Close-BAEP8ymL.js";import{A as N,a as O,g as te,f as re,e as ie,p as le,h as ae}from"./ArrowForwardIos-BR1LDHVw.js";import{T as x,H as M,v as L,w as U,x as h,y as t,z as H,I as o,D as ne,r as oe,t as ce,q as Y}from"./TableRow-DyRCyY9b.js";import{G as r}from"./Grid-C5mdLuvI.js";import{B as m}from"./Box-CyTnG5kx.js";import{A as de}from"./AddCircle-Br8tjFgv.js";import{T as pe}from"./TableContainer-DOhr4ZW5.js";import{E as xe,D as he}from"./Edit-DGVU-IuU.js";import{D as ue}from"./DialogActions-CMm5oWDU.js";import"./api-Dv6wi5j0.js";import"./auth-4s9nFscl.js";import"./Transition-ChWAEdMD.js";const we=()=>{const[$,G]=a.useState([]),[S,Q]=a.useState(""),[T,q]=a.useState(""),[z,u]=a.useState(!1),[F,I]=a.useState(""),[i,c]=a.useState({}),[_,J]=a.useState([]),[w,D]=a.useState("create"),j=4,[d,y]=a.useState(1),f=a.useRef(null),[p,P]=a.useState(1),g=5,R=$.filter(s=>s.project_id.toLowerCase().includes(S.toLowerCase())),k=Math.ceil(R.length/j),A=R.slice((d-1)*j,d*j);a.useEffect(()=>{(async()=>{try{const l=await te();G(l)}catch(l){console.error("Error fetching projects:",l)}})()},[]);const b=async()=>{try{const s=await re();J(s)}catch(s){console.error("Fetch failed:",s)}};a.useEffect(()=>{b()},[]);const W=s=>{D("edit"),I(s.project),c({feasibilityStudyId:s.feasibility_study_id,studyTitle:s.study_title,preparedBy:s.prepared_by,studyType:s.study_type,reports:null,riskAssessment:s.risk_assessment,regulatoryCompliance:s.regulatory_compliance,projectedROI:s.projected_roi,estimatedCompletionTime:s.estimated_completion_time,recommendations:s.recommendations,approvalStatus:s.approval_status,approvalDate:s.approval_date,status:s.status}),u(!0)},K=async()=>{const s=new FormData;s.append("project",F),s.append("study_title",i.studyTitle),s.append("prepared_by",i.preparedBy),s.append("study_type",i.studyType),i.reports&&s.append("reports",i.reports),s.append("risk_assessment",i.riskAssessment),s.append("regulatory_compliance",i.regulatoryCompliance),s.append("projected_roi",i.projectedROI),s.append("estimated_completion_time",i.estimatedCompletionTime),s.append("recommendations",i.recommendations),s.append("approval_status",i.approvalStatus),s.append("approval_date",i.approvalDate),s.append("status",i.status);try{w==="edit"?(await le(i.feasibilityStudyId,s),alert("Feasibility study updated successfully!")):(await ae(s),alert("Feasibility study submitted successfully!")),await b(),u(!1),D("create"),c({studyTitle:"",preparedBy:"",studyType:"",reports:null,riskAssessment:"",regulatoryCompliance:"",projectedROI:"",estimatedCompletionTime:"",recommendations:"",approvalStatus:"Pending",approvalDate:"",status:"Draft"}),f.current&&(f.current.value=null)}catch(l){console.error("Submission failed:",l),alert("Failed to submit/update feasibility study.")}},V=s=>{I(s);const l=new Date().getFullYear(),v=String(_.length+1).padStart(4,"0");c({feasibilityStudyId:`FS-${l}-${v}`}),u(!0)},X=async s=>{if(window.confirm(`Are you sure you want to delete ${s}?`))try{await ie(s),alert(`✅ Feasibility study ${s} deleted successfully!`),await b()}catch{alert("❌ Failed to delete. See console for details.")}},C=()=>u(!1),n=s=>{const{name:l,value:v}=s.target;c(ee=>({...ee,[l]:v}))},B=_.filter(s=>Object.values(s).some(l=>l&&l.toString().toLowerCase().includes(T.toLowerCase()))),E=Math.ceil(B.length/g),Z=B.slice((p-1)*g,p*g);return e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Feasibility Study Management"}),e.jsx(r,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(r,{item:!0,xs:12,children:e.jsxs(M,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(x,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(m,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:S,onChange:s=>{Q(s.target.value),y(1)},className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(L,{children:[e.jsx(U,{children:e.jsxs(h,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(H,{children:A.length>0?A.map((s,l)=>e.jsxs(h,{children:[e.jsx(t,{children:s.project_id}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(o,{onClick:()=>V(s.project_id),color:"primary",children:e.jsx(de,{sx:{color:"#7267ef"}})})})]},l)):e.jsx(h,{children:e.jsx(t,{colSpan:2,align:"center",children:"No records found"})})})]}),e.jsxs(m,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(o,{disabled:d===1,onClick:()=>y(s=>s-1),children:e.jsx(N,{})}),e.jsxs(x,{variant:"body2",sx:{mx:2},children:["Page ",d," of ",k||1]}),e.jsx(o,{disabled:d>=k,onClick:()=>y(s=>s+1),children:e.jsx(O,{})})]})]})})}),e.jsx(r,{container:!0,spacing:2,children:e.jsx(r,{item:!0,xs:12,children:e.jsxs(M,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(x,{variant:"h6",gutterBottom:!0,children:"SUBMITTED FEASIBILITY STUDIES"}),e.jsx("input",{type:"text",placeholder:"Search Feasibility Studies",value:T,onChange:s=>q(s.target.value),className:"input"}),e.jsx(pe,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(L,{stickyHeader:!0,children:[e.jsx(U,{children:e.jsxs(h,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Feasibility Study ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Study Title"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Study Type"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Prepared By"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Risk Assessment"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Regulatory Compliance"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Projected ROI (%)"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Est. Completion Time"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Recommendations"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Status"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Date"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Status"})}),e.jsx(t,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(H,{children:Z.map((s,l)=>e.jsxs(h,{children:[e.jsx(t,{children:s.project}),e.jsx(t,{children:s.feasibility_study_id}),e.jsx(t,{children:s.study_title}),e.jsx(t,{children:s.study_type}),e.jsx(t,{children:s.prepared_by}),e.jsx(t,{children:s.risk_assessment}),e.jsx(t,{children:s.regulatory_compliance}),e.jsx(t,{children:s.projected_roi}),e.jsx(t,{children:s.estimated_completion_time}),e.jsx(t,{children:s.recommendations}),e.jsx(t,{children:s.approval_status}),e.jsx(t,{children:s.approval_date}),e.jsx(t,{children:s.status}),e.jsxs(t,{children:[e.jsx(o,{color:"warning",onClick:()=>W(s),children:e.jsx(xe,{sx:{color:"orange"}})}),e.jsx(o,{color:"error",onClick:()=>X(s.feasibility_study_id),children:e.jsx(he,{sx:{color:"red"}})})]})]},l))})]})}),e.jsxs(m,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(o,{disabled:p===1,onClick:()=>P(s=>s-1),children:e.jsx(N,{})}),e.jsxs(x,{variant:"body2",sx:{mx:2},children:["Page ",p," of ",E||1]}),e.jsx(o,{disabled:p>=E,onClick:()=>P(s=>s+1),children:e.jsx(O,{})})]})]})})}),e.jsxs(ne,{open:z,onClose:C,fullWidth:!0,children:[e.jsx(oe,{children:"Enter Feasibility Study Details"}),e.jsxs(ce,{sx:{position:"relative"},children:[e.jsx(o,{"aria-label":"close",onClick:C,sx:{position:"absolute",right:8,top:8,color:s=>s.palette.grey[500]},children:e.jsx(se,{})}),e.jsx(m,{component:"form",sx:{mt:2},children:e.jsxs(r,{container:!0,spacing:3,direction:"column",children:[e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Feasibility Study Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",name:"projectId",className:"input",value:F,disabled:!0})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"feasibilityStudyId",children:"Feasibility Study ID"}),e.jsx("input",{id:"feasibilityStudyId",name:"feasibilityStudyId",className:"input",value:i.feasibilityStudyId||"",disabled:!0})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"studyTitle",children:"Study Title"}),e.jsx("input",{id:"studyTitle",name:"studyTitle",className:"input",value:i.studyTitle||"",onChange:n})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"preparedBy",children:"Prepared By"}),e.jsx("input",{id:"preparedBy",name:"preparedBy",className:"input",value:i.preparedBy||"",onChange:n})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"studyType",children:"Study Type"}),e.jsxs("select",{id:"studyType",name:"studyType",className:"input",value:i.studyType||"",onChange:n,children:[e.jsx("option",{value:"",children:"Select Type"}),["Technical","Financial","Environmental","Operational"].map(s=>e.jsx("option",{value:s,children:s},s))]})]})]})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Reports and Documents"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsx("input",{type:"file",className:"input",ref:f,onChange:s=>{c(l=>({...l,reports:s.target.files[0]}))}})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Risk and Compliance"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"riskAssessment",children:"Risk Assessment"}),e.jsx("textarea",{id:"riskAssessment",name:"riskAssessment",className:"input",rows:3,value:i.riskAssessment||"",onChange:n})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"regulatoryCompliance",children:"Regulatory Compliance"}),e.jsx("input",{id:"regulatoryCompliance",name:"regulatoryCompliance",className:"input",value:i.regulatoryCompliance||"",onChange:n})]})]})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Financial Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectedROI",children:"Projected ROI (%)"}),e.jsx("input",{type:"number",id:"projectedROI",name:"projectedROI",className:"input",value:i.projectedROI||"",onChange:n})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"estimatedCompletionTime",children:"Estimated Completion Time (Months/Years)"}),e.jsx("input",{type:"number",id:"estimatedCompletionTime",name:"estimatedCompletionTime",className:"input",value:i.estimatedCompletionTime||"",onChange:n})]})]})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Recommendations"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsx(r,{container:!0,spacing:2,children:e.jsxs(r,{item:!0,xs:12,children:[e.jsx("label",{htmlFor:"recommendations",children:"Recommendations"}),e.jsx("textarea",{id:"recommendations",name:"recommendations",className:"input",rows:3,value:i.recommendations||"",onChange:n})]})})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Approval Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:i.approvalStatus||"",onChange:n,children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalDate",children:"Approval Date"}),e.jsx("input",{type:"date",id:"approvalDate",name:"approvalDate",className:"input",value:i.approvalDate||"",onChange:n})]})]})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Study Status"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsx(r,{container:!0,spacing:2,children:e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",className:"input",value:i.status||"",onChange:n,children:[e.jsx("option",{value:"Draft",children:"Draft"}),e.jsx("option",{value:"Under Review",children:"Under Review"}),e.jsx("option",{value:"Completed",children:"Completed"})]})]})})]})]})})]}),e.jsxs(ue,{children:[e.jsx(Y,{onClick:C,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(Y,{variant:"outlined",onClick:K,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:w==="edit"?"Update":"Submit"})]})]})]})};export{we as default};
