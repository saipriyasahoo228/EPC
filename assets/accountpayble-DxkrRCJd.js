import{r as i,j as e,T as _,J as S,S as C,I as p,K as A}from"./main-Skim5IJC.js";import{C as H}from"./Close-BKZ7QrSY.js";import{D as J}from"./Download-C4sxsXoP.js";import{E as K,a as q}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{g as Q}from"./procurement-BWIn9uW6.js";import{a as X,e as Z,f as ee,h as te}from"./account-CQ2dqr_G.js";import{f as m}from"./date-DdrLtg20.js";import{G as o}from"./Grid-fY_ATwTx.js";import{T as w,a as E,b as j,c as n,d as T}from"./TableRow-B6k_bSOs.js";import{A as ae}from"./AddCircle-CJp4DZj3.js";import{B as I,D as ne,a as se,b as oe,c as le}from"./DialogTitle-CvDFHAwp.js";import{T as re}from"./TableContainer-gCCy6yK7.js";import{E as ie}from"./Edit-6vcT2Cu4.js";import{D as de}from"./Delete-Be1vvbhC.js";const Se=()=>{const h="account_ledger",[F,c]=i.useState(!1),[ce,M]=i.useState(""),[s,v]=i.useState({}),[f,N]=i.useState([]),[x,y]=i.useState(!1),[ue,V]=i.useState(null),[g,k]=i.useState(""),[B,O]=i.useState([]),[b,P]=i.useState(null);i.useEffect(()=>{(async()=>{try{const a=await Q();O(a)}catch(a){console.error("❌ Error fetching vendors:",a)}})()},[]);const D=async()=>{try{const t=await X();N(t)}catch(t){console.error("❌ Error fetching payables:",t)}};i.useEffect(()=>{D()},[]);const R=t=>{const r=`INV-${new Date().getFullYear()}-${(f.length+1).toString().padStart(3,"0")}`;M(t),v({invoiceId:r,vendorId:t,invoiceDate:"",dueDate:"",totalAmount:"",amountPaid:"",paymentStatus:"Pending",paymentMethod:"",approvalStatus:"",outstandingBalance:""}),y(!1),V(null),c(!0)},Y=t=>{v({invoiceId:t.invoice_id,vendorId:t.vendor,invoiceDate:t.invoice_date,dueDate:t.due_date,totalAmount:t.total_amount,amountPaid:t.amount_paid,outstandingBalance:t.outstanding_balance,paymentStatus:t.payment_status,paymentMethod:t.payment_method,approvalStatus:t.approval_status}),P(t.invoice_id),y(!0),c(!0)},L=async t=>{if(window.confirm(`Are you sure you want to delete invoice ${t}?`))try{await Z(t),alert(`✅ Invoice ${t} deleted successfully!`),D()}catch(r){console.error("❌ Error deleting payable:",r),alert("❌ Failed to delete invoice. Please try again.")}},d=t=>{const{name:a,value:r}=t.target,u={...s,[a]:r};if(a==="totalAmount"||a==="amountPaid"){const l=parseFloat(u.totalAmount||0),z=parseFloat(u.amountPaid||0);u.outstandingBalance=(l-z).toFixed(2)}v(u)},$=(t,a)=>!t||a==="Paid"?!1:new Date(t)<new Date,G=async()=>{var t;try{const a={vendor:s.vendorId,invoice_date:s.invoiceDate,due_date:s.dueDate,total_amount:parseFloat(s.totalAmount||0),amount_paid:parseFloat(s.amountPaid||0),payment_status:s.paymentStatus,payment_method:s.paymentMethod,approval_status:s.approvalStatus};if(x&&b){const r=await ee(b,a);alert(`✅ Invoice ${r.invoice_id} updated successfully!`)}else{const r=await te(a);alert(`✅ Payable created successfully! Invoice ID: ${r.invoice_id}`)}c(!1),y(!1),P(null),D()}catch(a){console.error("❌ Error saving payable:",((t=a.response)==null?void 0:t.data)||a),alert("❌ Failed to save payable. Please try again.")}},U=f.filter(t=>Object.values(t).some(a=>a==null?void 0:a.toString().toLowerCase().includes(g.toLowerCase()))),W=t=>{const a=new K("l","mm","a4");a.setFontSize(16),a.text("All Accounts Payable Report",14,15);const r=["Invoice ID","Vendor ID","Invoice Date","Due Date","Total Amount","Amount Paid","Outstanding Balance","Payment Status","Payment Method","Approval Status"],u=t.map(l=>[l.invoice_id,l.vendor,m(l.invoice_date),m(l.due_date),l.total_amount,l.amount_paid,l.outstanding_balance,l.payment_status,l.payment_method,l.approval_status]);q(a,{head:[r],body:u,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),a.save("all_accounts_payable_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(_,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Accounts Payable"}),e.jsxs(o,{container:!0,spacing:2,direction:"column",children:[e.jsx(o,{item:!0,xs:12,children:e.jsxs(S,{sx:{p:2},children:[e.jsx(_,{variant:"h6",children:"Vendor List"}),e.jsx("input",{type:"text",placeholder:"Search Vendor ID",value:g,onChange:t=>k(t.target.value),className:"input",style:{width:"100%",margin:"10px 0",padding:"8px",borderRadius:4}}),e.jsxs(w,{children:[e.jsx(E,{children:e.jsxs(j,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Vendor ID"})}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(T,{children:B.filter(t=>{var a;return(a=t.vendor_id)==null?void 0:a.toLowerCase().includes(g.toLowerCase())}).map((t,a)=>e.jsxs(j,{children:[e.jsx(n,{children:t.vendor_id}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(C,{slug:h,action:"can_create",children:e.jsx(p,{onClick:()=>R(t.vendor_id),color:"primary",children:e.jsx(ae,{sx:{color:"#7267ef"}})})})})]},a))})]})]})}),e.jsx(o,{item:!0,xs:12,children:e.jsxs(S,{sx:{p:2,mt:2},children:[e.jsx(I,{startIcon:e.jsx(J,{}),onClick:()=>W(f),children:"Download PDF"}),e.jsx(_,{variant:"h6",children:"Payable Records"}),e.jsx(re,{children:e.jsxs(w,{stickyHeader:!0,children:[e.jsx(E,{children:e.jsxs(j,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:"Invoice ID"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Vendor ID"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Invoice Date"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Due Date"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Total Amount"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Amount Paid"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Outstanding"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Status"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Method"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Approval"}),e.jsx(n,{sx:{color:"#660000"},children:"Actions"})]})}),e.jsx(T,{children:U.map((t,a)=>e.jsxs(j,{sx:{backgroundColor:$(t.due_date,t.payment_status)?"#ffe6e6":"inherit"},children:[e.jsx(n,{children:t.invoice_id}),e.jsx(n,{children:t.vendor}),e.jsx(n,{children:m(t.invoice_date)}),e.jsx(n,{children:m(t.due_date)}),e.jsx(n,{children:t.total_amount}),e.jsx(n,{children:t.amount_paid}),e.jsx(n,{children:t.outstanding_balance}),e.jsx(n,{children:t.payment_status}),e.jsx(n,{children:t.payment_method}),e.jsx(n,{children:t.approval_status}),e.jsxs(n,{children:[e.jsx(A,{slug:h,action:"can_update",children:e.jsx(p,{onClick:()=>Y(t),color:"warning",children:e.jsx(ie,{sx:{color:"orange"}})})}),e.jsx(C,{slug:h,action:"can_delete",children:e.jsx(p,{onClick:()=>L(t.invoice_id),color:"error",children:e.jsx(de,{sx:{color:"red"}})})})]})]},a))})]})})]})})]}),e.jsxs(ne,{open:F,onClose:()=>c(!1),fullWidth:!0,children:[e.jsxs(se,{children:[x?"Edit Invoice Details":"New Invoice Entry",e.jsx(p,{"aria-label":"close",onClick:()=>c(!1),sx:{position:"absolute",right:8,top:8},children:e.jsx(H,{})})]}),e.jsx(oe,{children:e.jsxs(o,{container:!0,spacing:2,mt:1,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Invoice ID"}),e.jsx("input",{className:"input",value:s.invoiceId||"",disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Vendor ID"}),e.jsx("input",{className:"input",value:s.vendorId||"",disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Invoice Date"}),e.jsx("input",{name:"invoiceDate",type:"date",className:"input",value:s.invoiceDate||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{name:"dueDate",type:"date",className:"input",value:s.dueDate||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Total Amount"}),e.jsx("input",{name:"totalAmount",type:"number",className:"input",value:s.totalAmount||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Amount Paid"}),e.jsx("input",{name:"amountPaid",type:"number",className:"input",value:s.amountPaid||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Outstanding"}),e.jsx("input",{className:"input",value:s.outstandingBalance||"",disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Payment Status"}),e.jsxs("select",{name:"paymentStatus",className:"input",value:s.paymentStatus||"Pending",onChange:d,disabled:x,children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Paid",children:"Paid"}),e.jsx("option",{value:"Overdue",children:"Overdue"})]})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Payment Method"}),e.jsx("input",{name:"paymentMethod",className:"input",value:s.paymentMethod||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Approval Status"}),e.jsxs("select",{name:"approvalStatus",className:"input",value:s.approvalStatus||"Pending",onChange:d,children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]})]})}),e.jsxs(le,{children:[e.jsx(I,{onClick:()=>c(!1),sx:{outline:"2px solid #800000",color:"#800000"},children:"Cancel"}),e.jsx(A,{slug:h,action:x&&b?"can_update":"can_create",children:e.jsx(I,{onClick:G,variant:"outlined",sx:{color:"#7267ef",borderColor:"#7267ef"},children:x?"Update":"Submit"})})]})]})]})};export{Se as default};
