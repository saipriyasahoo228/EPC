import{r as c,j as e,T as D,J as S,E,S as M,I as x,K as P}from"./main-Skim5IJC.js";import{C as Z}from"./Close-BKZ7QrSY.js";import{D as ee}from"./Download-C4sxsXoP.js";import{E as se,a as re}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{i as te}from"./procurement-BWIn9uW6.js";import{g as T,d as ne,u as ae,c as ie}from"./maintenance-DLF_HkF3.js";import{f as j}from"./date-DdrLtg20.js";import{G as i}from"./Grid-fY_ATwTx.js";import{T as F,a as L,b as f,c as r,d as R}from"./TableRow-B6k_bSOs.js";import{A as le}from"./AddCircle-CJp4DZj3.js";import{B as I,D as oe,a as ce,b as de,c as ue}from"./DialogTitle-CvDFHAwp.js";import{T as me}from"./TableContainer-gCCy6yK7.js";import{E as xe}from"./Edit-6vcT2Cu4.js";import{D as he}from"./Delete-Be1vvbhC.js";import{M as pe,a as je}from"./minimize-2-RCuvNn0X.js";const Fe=()=>{const h="maintenance",[u,N]=c.useState(null),[g,q]=c.useState(!1),[y,O]=c.useState(""),[v,k]=c.useState(""),[B,b]=c.useState(!1),[fe,z]=c.useState(""),[n,m]=c.useState({}),[_,C]=c.useState([]),[Y,w]=c.useState(!1),[ge,A]=c.useState(null),[$,W]=c.useState([]),U=()=>{q(!g)};c.useEffect(()=>{(async()=>{try{const d=(await te()).map(l=>({poId:l.po_number,procurementId:l.procurement}));W(d)}catch(t){console.error("❌ Error fetching purchase orders:",t)}})()},[]),c.useEffect(()=>{(async()=>{try{const t=await T();C(t)}catch(t){console.error("❌ Failed to load assets:",t)}})()},[]);const G=(s,t)=>{z(s,t);const d=new Date().getFullYear(),a=(_.length+1).toString().padStart(3,"0");m({assetId:`AST-${d}-${a}`,poId:s,procurementId:t}),w(!1),A(null),b(!0)},H=s=>{m({assetId:s.asset_id||"",assetName:s.asset_name||"",assetType:s.asset_type||"",modelNumber:s.model_number||"",serialNumber:s.serial_number||"",location:s.location||"",purchaseDate:s.purchase_date||"",warrantyExpiryDate:s.warranty_expiry_date||"",procurementId:s.procurement_id||"",maintenanceRequirement:s.maintenance_requirement||"",currentCondition:s.current_condition||"",usefullLife:s.useful_life_years||"",poId:s.purchase_order||""}),N(s.asset_id),b(!0)},J=async s=>{if(window.confirm(`Are you sure you want to delete asset ${s}?`))try{await ne(s),alert(`✅ Asset ${s} deleted successfully`),C(t=>t.filter(d=>d.asset_id!==s))}catch{alert(`❌ Failed to delete asset ${s}`)}},p=()=>{b(!1),m({}),w(!1),A(null)},o=s=>{const{name:t,value:d}=s.target;m(l=>({...l,[t]:d}))},Q=async()=>{var s,t,d;try{const l={asset_name:n.assetName||"",asset_type:n.assetType||"",model_number:n.modelNumber||"",serial_number:n.serialNumber||"",location:n.location||"",purchase_date:n.purchaseDate||"",warranty_expiry_date:n.warrantyExpiryDate||"",procurement_id:n.procurementId||"",maintenance_requirement:n.maintenanceRequirement||"",current_condition:n.currentCondition||"",useful_life_years:n.usefullLife||5,purchase_order:n.poId||""};let a;u?(a=await ae(u,l),alert(`✏️ Asset updated successfully! (${u})`)):(a=await ie(l),alert(`✅ Asset created successfully!
Generated Asset ID: ${a.asset_id}`));const X=await T();C(X),m({}),N(null),p()}catch(l){const a=((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.detail)||((d=l.response)==null?void 0:d.data)||l.message;alert(`❌ Failed to submit asset:
${JSON.stringify(a,null,2)}`),console.error("❌ Error submitting asset:",l)}},V=_.filter(s=>Object.values(s).some(t=>t&&t.toString().toLowerCase().includes(v.toLowerCase()))),K=s=>{const t=new se("l","mm","a4");t.setFontSize(16),t.text("All Assets Management Report",14,15);const d=["Purchase Order","Procurement ID","Asset ID","Asset Name","Asset Type","Model Number","Serial Number","Location","Purchase Date","Warranty Expiry Date","Maintenance Requirement","Current Condition","Useful Life","Depreciation Value"],l=s.map(a=>[a.purchase_order,a.procurement_id,a.asset_id,a.asset_name,a.asset_type,a.model_number,a.serial_number,a.location,j(a.purchase_date),j(a.warranty_expiry_date),a.maintenance_requirement,a.current_condition,a.useful_life_years,a.depreciation_value]);re(t,{head:[d],body:l,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),t.save("all_assets_management_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(D,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Assets Management"}),e.jsx(i,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(S,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(D,{variant:"h6",gutterBottom:!0,children:"Purchase & Procurement Details"}),e.jsx(E,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Purchase & Procurement",value:y,onChange:s=>O(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(F,{children:[e.jsx(L,{children:e.jsxs(f,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"PurchaseOrder ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Procurement ID"})}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(R,{children:$.filter(s=>s.poId.toLowerCase().includes(y.toLowerCase())||s.procurementId.toLowerCase().includes(y.toLowerCase())).map((s,t)=>e.jsxs(f,{children:[e.jsx(r,{children:s.poId}),e.jsx(r,{children:s.procurementId}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(M,{slug:h,action:"can_create",children:e.jsx(x,{onClick:()=>G(s.poId,s.procurementId),color:"primary",children:e.jsx(le,{sx:{color:"#7267ef"}})})})})]},t))})]})]})})}),e.jsx(i,{container:!0,spacing:2,children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(S,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(I,{startIcon:e.jsx(ee,{}),onClick:()=>K(_),children:"Download PDF"}),e.jsx(D,{variant:"h6",gutterBottom:!0,children:"Assets Details"}),e.jsx("input",{type:"text",placeholder:"Search Assets Management Details",value:v,onChange:s=>k(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(me,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(F,{stickyHeader:!0,children:[e.jsx(L,{children:e.jsxs(f,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Purchase Order"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"ProcurementId"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset Name"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset Type"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Model Number"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Serial Number"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Location"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Purchase Date"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Warranty Expiry Date"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Maintenance Requirment"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Current Condition"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Usefull Life"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Depreciation Value"})}),e.jsx(r,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(R,{children:V.map((s,t)=>e.jsxs(f,{children:[e.jsx(r,{children:s.purchase_order}),e.jsx(r,{children:s.procurement_id}),e.jsx(r,{children:s.asset_id}),e.jsx(r,{children:s.asset_name}),e.jsx(r,{children:s.asset_type}),e.jsx(r,{children:s.model_number}),e.jsx(r,{children:s.serial_number}),e.jsx(r,{children:s.location}),e.jsx(r,{children:j(s.purchase_date)}),e.jsx(r,{children:j(s.warranty_expiry_date)}),e.jsx(r,{children:s.maintenance_requirement}),e.jsx(r,{children:s.current_condition}),e.jsx(r,{children:s.useful_life_years}),e.jsx(r,{children:s.depreciation_value}),e.jsxs(r,{children:[e.jsx(P,{slug:h,action:"can_update",children:e.jsx(x,{onClick:()=>H(s),color:"warning",children:e.jsx(xe,{sx:{color:"orange"}})})}),e.jsx(M,{slug:h,action:"can_delete",children:e.jsx(x,{onClick:()=>J(s.asset_id),color:"error",children:e.jsx(he,{sx:{color:"red"}})})})]})]},t))})]})})]})})}),e.jsxs(oe,{open:B,onClose:p,fullWidth:!0,maxWidth:"xl",PaperProps:{style:g?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(ce,{children:Y?"Edit Asset Management Details":"Enter Assets Management Details"}),e.jsxs(de,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(x,{"aria-label":"toggle-size",onClick:U,sx:{position:"absolute",right:40,top:8,color:s=>s.palette.grey[600]},children:g?e.jsx(pe,{}):e.jsx(je,{})}),e.jsx(x,{"aria-label":"close",onClick:p,sx:{position:"absolute",right:8,top:8,color:s=>s.palette.grey[500]},children:e.jsx(Z,{})}),e.jsx(E,{component:"form",sx:{mt:2},children:e.jsx(i,{container:!0,spacing:3,direction:"column",children:e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Asset Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"assetId",children:"Asset ID"}),e.jsx("input",{id:"assetId",name:"assetId",className:"input",value:n.assetId||"",onChange:o,disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"procurementId",children:"procurement ID"}),e.jsx("input",{id:"procurementId",name:"procurementId",className:"input",value:n.procurementId||"",onChange:o,disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"poId",children:"PurchaseOrder ID"}),e.jsx("input",{id:"poId",name:"poId",className:"input",value:n.poId||"",onChange:o,disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"assetName",children:"Asset Name"}),e.jsx("input",{id:"assetName",name:"assetName",className:"input",value:n.assetName||"",onChange:o})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"assetType",children:"Asset Type"}),e.jsx("input",{id:"assetType",name:"assetType",className:"input",value:n.assetType||"",onChange:o})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"modelNumber",children:"Model Number"}),e.jsx("input",{id:"modelNumber",name:"modelNumber",className:"input",value:n.modelNumber||"",onChange:o})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"serialNumber",children:"Serial Number"}),e.jsx("input",{id:"serialNumber",name:"serialNumber",className:"input",value:n.serialNumber||"",onChange:o})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"location",children:"Location"}),e.jsx("input",{id:"location",name:"location",className:"input",value:n.location||"",onChange:o})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"purchaseDate",children:"Purchase Date"}),e.jsx("input",{type:"date",id:"purchaseDate",name:"purchaseDate",className:"input",value:n.purchaseDate||"",onChange:o})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"warrantyExpiryDate",children:"Warranty Expiry Date"}),e.jsx("input",{type:"date",id:"warrantyExpiryDate",name:"warrantyExpiryDate",className:"input",value:n.warrantyExpiryDate||"",onChange:o})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"maintenanceRequirement",children:"Maintenance Requirement"}),e.jsxs("select",{id:"maintenanceRequirement",name:"maintenanceRequirement",className:"input",value:n.maintenanceRequirement||"",onChange:o,children:[e.jsx("option",{value:"",children:"-- Select Maintenance Requirement --"}),e.jsx("option",{value:"Regular",children:"Regular"}),e.jsx("option",{value:"Preventive",children:"Preventive"}),e.jsx("option",{value:"Emergency",children:"Emergency"})]})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"currentCondition",children:"Current Condition"}),e.jsxs("select",{id:"currentCondition",name:"currentCondition",className:"input",value:n.currentCondition||"",onChange:o,children:[e.jsx("option",{value:"",children:"-- Select Current Condition --"}),e.jsx("option",{value:"Operational",children:"Operational"}),e.jsx("option",{value:"Needs Repair",children:"Needs Repair"}),e.jsx("option",{value:"Decommissioned",children:"Decommissioned"})]})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"usefullLife",children:"Usefull Life"}),e.jsx("input",{type:"number",id:"usefullLife",name:"usefullLife",className:"input",value:n.usefullLife||"",onChange:o})]})]})]})})})]}),e.jsxs(ue,{children:[e.jsx(I,{onClick:p,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(P,{slug:h,action:u?"can_update":"can_create",children:e.jsx(I,{variant:"outlined",onClick:Q,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:u?"Update":"Submit"})})]})]})]})};export{Fe as default};
