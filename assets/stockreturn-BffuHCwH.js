import{r as a,j as e,T as m,J as E,E as D,S as F,I as c,K as M}from"./main-Skim5IJC.js";import{C as re}from"./Close-BKZ7QrSY.js";import{g as se,h as ne,i as oe,j as ae,k as le}from"./inventory-BCILrqmV.js";import{f as Q}from"./date-DdrLtg20.js";import{D as ie}from"./Download-C4sxsXoP.js";import{E as ce,a as de}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{G as s}from"./Grid-fY_ATwTx.js";import{T as N,a as P,b as p,c as n,d as z}from"./TableRow-B6k_bSOs.js";import{A as ue}from"./AddCircle-CJp4DZj3.js";import{A as xe,a as he}from"./ArrowForwardIos-D05tyAMF.js";import{T as je}from"./TableContainer-gCCy6yK7.js";import{E as me}from"./Edit-6vcT2Cu4.js";import{D as pe}from"./Delete-Be1vvbhC.js";import{D as ge,a as ye,b as fe,c as Ie,B as Y}from"./DialogTitle-CvDFHAwp.js";import{M as Re,a as be}from"./minimize-2-RCuvNn0X.js";const ze=()=>{const j="inventory",[g,L]=a.useState(""),[w,W]=a.useState(""),[$,y]=a.useState(!1),[ke,O]=a.useState(""),[U,q]=a.useState([]),[_,C]=a.useState([]),[u,v]=a.useState(null),f=2,[x,I]=a.useState(1),[R,G]=a.useState(!1),[o,h]=a.useState({itemId:"",returnQuantity:"",returnReason:"",returnBy:"",returnDate:"",stockAdjustmentID:"",adjustmentType:"",wastageReason:""}),H=()=>{G(!R)},T=U.filter(t=>{var r;return(r=t.item_id)==null?void 0:r.toString().toLowerCase().includes(g.toLowerCase())}),A=Math.ceil(T.length/f)||1,K=T.slice((x-1)*f,x*f);a.useEffect(()=>{I(1)},[g]),a.useEffect(()=>{(async()=>{try{const r=await se();q(r)}catch(r){console.error("Failed to fetch inventory items:",r)}})()},[]);const b=async()=>{try{const t=await ne();C(t)}catch(t){console.error("Failed to load stock returns:",t)}};a.useEffect(()=>{b()},[]);const J=async t=>{if(window.confirm(`Are you sure you want to delete Return ID: ${t}?`))try{await oe(t),alert(`✅ Return ${t} deleted successfully.`),b()}catch(l){console.error("❌ Error deleting return:",l),alert(`❌ Failed to delete return: ${l.message}`)}},B=_.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(w.toLowerCase()))),V=t=>{const r=new ce("l","mm","a4");r.setFontSize(16),r.text("Stock Returns Report",14,15);const l=["Item ID","Return ID","Quantity","Reason","Returned By","Return Date","Adjustment ID","Adjustment Type","Wastage Reason"],S=t.map(i=>[i.item||"",i.return_id||"",i.return_quantity||"0",i.return_reason||"",i.returned_by||"",i.return_date?Q(i.return_date):"",i.stock_adjustment_id||"",i.adjustment_type||"",i.wastage_reason||""]);de(r,{head:[l],body:S,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),r.save("stock_returns_report.pdf")},X=t=>{const r=new Date().getFullYear(),l=String(_.length+1).padStart(4,"0");O(t),h({itemId:t,stockReturnId:`RET-${r}-${l}`}),y(!0)},k=()=>{h({}),y(!1)},d=t=>{const{name:r,value:l}=t.target;h(S=>({...S,[r]:l}))},Z=()=>{h({itemId:"",returnQuantity:"",returnReason:"",returnBy:"",returnDate:"",stockAdjustmentID:"",adjustmentType:"",wastageReason:""}),v(null)},ee=t=>{v(t.return_id),h({itemId:t.item,returnQuantity:t.return_quantity,returnReason:t.return_reason,returnBy:t.returned_by,returnDate:t.return_date,stockAdjustmentID:t.stock_adjustment_id,adjustmentType:t.adjustment_type,wastageReason:t.wastage_reason||""})},te=async()=>{const t={item:o.itemId,return_quantity:o.returnQuantity,return_reason:o.returnReason,returned_by:o.returnBy,return_date:o.returnDate,stock_adjustment_id:o.stockAdjustmentID,adjustment_type:o.adjustmentType.toLowerCase(),wastage_reason:o.wastageReason||""};try{if(u)await ae(u,t),C(r=>r.map(l=>l.return_id===u?{...l,...t}:l)),alert(`✅ Stock return ${u} updated successfully!`);else{const r=await le(t);b(),alert(`✅ Stock return ${r.return_id} created successfully!`)}y(!1),Z()}catch(r){console.error("❌ Error submitting stock return:",r)}};return e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Stock Returns"}),e.jsx(s,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(s,{item:!0,xs:12,children:e.jsxs(E,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(m,{variant:"h6",gutterBottom:!0,children:"ITEM RECORDS"}),e.jsx(D,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Item ID",value:g,onChange:t=>L(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(N,{children:[e.jsx(P,{children:e.jsxs(p,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Item ID"})}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(z,{children:K.map((t,r)=>e.jsxs(p,{children:[e.jsx(n,{children:t.item_id}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(F,{slug:j,action:"can_create",children:e.jsx(c,{onClick:()=>X(t.item_id),color:"primary",children:e.jsx(ue,{sx:{color:"#7267ef"}})})})})]},r))})]}),e.jsxs(D,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(c,{disabled:x===1,onClick:()=>I(t=>t-1),children:e.jsx(xe,{})}),e.jsxs(m,{variant:"body2",sx:{mx:2},children:["Page ",x," of ",A]}),e.jsx(c,{disabled:x>=A,onClick:()=>I(t=>t+1),children:e.jsx(he,{})})]})]})})}),e.jsx(s,{container:!0,spacing:2,children:e.jsx(s,{item:!0,xs:12,children:e.jsxs(E,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsxs(s,{container:!0,justifyContent:"space-between",alignItems:"center",children:[e.jsx(s,{item:!0,children:e.jsx(m,{variant:"h6",gutterBottom:!0,sx:{color:"#7267ef"},children:"SUBMITTED STOCK RETURNS"})}),e.jsx(s,{item:!0,children:e.jsx(c,{onClick:()=>V(B),sx:{color:"#7267ef"},title:"Download Report",children:e.jsx(ie,{})})})]}),e.jsx("input",{type:"text",placeholder:"Search Stock Returns",value:w,onChange:t=>W(t.target.value),className:"input",style:{width:"100%",padding:"8px",marginBottom:"1rem",border:"1px solid #ccc",borderRadius:4}}),e.jsx(je,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(N,{stickyHeader:!0,children:[e.jsx(P,{children:e.jsxs(p,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Item ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock Return ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Returned Quantity"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Return Reason"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Returned By"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Returned Date"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock Adjustment ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Adjustment Type"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Wastage Reason"})}),e.jsx(n,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(z,{children:B.map((t,r)=>e.jsxs(p,{children:[e.jsx(n,{children:t.item}),e.jsx(n,{children:t.return_id}),e.jsx(n,{children:t.return_quantity}),e.jsx(n,{children:t.return_reason}),e.jsx(n,{children:t.returned_by}),e.jsx(n,{children:Q(t.return_date)}),e.jsx(n,{children:t.stock_adjustment_id}),e.jsx(n,{children:t.adjustment_type}),e.jsx(n,{children:t.wastage_reason}),e.jsxs(n,{children:[e.jsx(M,{slug:j,action:"can_update",children:e.jsx(c,{color:"warning",onClick:()=>ee(t),children:e.jsx(me,{sx:{color:"orange"}})})}),e.jsx(F,{slug:j,action:"can_delete",children:e.jsx(c,{color:"error",onClick:()=>J(t.return_id),children:e.jsx(pe,{sx:{color:"red"}})})})]})]},r))})]})})]})})}),e.jsxs(ge,{open:$,onClose:k,fullWidth:!0,maxWidth:"xl",PaperProps:{style:R?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(ye,{children:"Enter Stock Management Details"}),e.jsxs(fe,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(c,{"aria-label":"toggle-size",onClick:H,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:R?e.jsx(Re,{}):e.jsx(be,{})}),e.jsx(c,{"aria-label":"close",onClick:k,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(re,{})}),e.jsx(D,{component:"form",sx:{mt:2},children:e.jsxs(s,{container:!0,spacing:3,direction:"column",children:[e.jsxs(s,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Stock Returns Id's "}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"itemId",children:"Item ID"}),e.jsx("input",{id:"itemId",name:"itemId",className:"input",value:o.itemId||"",disabled:!0})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockReturnId",children:"Stock Return Id"}),e.jsx("input",{id:"stockReturnId",name:"stockReturnId",className:"input",value:o.stockReturnId||"",disabled:!0})]})]})]}),e.jsxs(s,{item:!0,xs:10,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Stock Return Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"returnQuantity",children:"Return Quantity"}),e.jsx("input",{id:"returnQuantity",name:"returnQuantity",className:"input",value:o.returnQuantity||"",onChange:d,type:"number"})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"returnReason",children:"Return Reason"}),e.jsx("textarea",{id:"returnReason",name:"returnReason",className:"input",rows:3,value:o.returnReason||"",onChange:d})]})]}),e.jsxs(s,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"returnBy",children:"Return By"}),e.jsx("input",{id:"returnBy",name:"returnBy",className:"input",value:o.returnBy||"",onChange:d})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"returnDate",children:"Return Date"}),e.jsx("input",{type:"date",id:"returnDate",name:"returnDate",className:"input",value:o.returnDate||"",onChange:d})]})]})]}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Stock Adjustment Info"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockAdjustmentID",children:"Stock Adjustment ID"}),e.jsx("input",{id:"stockAdjustmentID",name:"stockAdjustmentID",className:"input",value:o.stockAdjustmentID||"",onChange:d})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"adjustmentType",children:"Adjustment Type"}),e.jsxs("select",{id:"adjustmentType",name:"adjustmentType",className:"input",value:o.adjustmentType||"",onChange:d,children:[e.jsx("option",{value:"",children:"-- Select Adjustment Type --"}),e.jsx("option",{value:"Addition",children:"Addition"}),e.jsx("option",{value:"Deduction",children:"Deduction"}),e.jsx("option",{value:"Scrap",children:"Scrap"})]})]})]}),e.jsx(s,{container:!0,spacing:2,sx:{mt:1},children:e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"wastageReason",children:"Wastage Reason"}),e.jsx("input",{id:"wastageReason",name:"wastageReason",className:"input",value:o.wastageReason||"",onChange:d})]})})]})]})})]}),e.jsxs(Ie,{children:[e.jsx(Y,{onClick:k,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(M,{slug:j,action:u?"can_update":"can_create",children:e.jsx(Y,{variant:"outlined",onClick:te,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:u?"Update Return":"Submit Return"})})]})]})]})};export{ze as default};
