import{O as p,j as e,y as Ue,r as a,E as u,T as i,J as ke,G as K,I as j,ag as X,H as Y}from"./main-Skim5IJC.js";import{C as Z}from"./Close-BKZ7QrSY.js";import{g as _,a as Me,b as Ee,c as We,u as _e}from"./user-h3xj2oLf.js";import{u as Ge}from"./index-CV0T-gUl.js";import{G as l}from"./Grid-fY_ATwTx.js";import{B as f,D as ee,a as se,b as re,c as te}from"./DialogTitle-CvDFHAwp.js";import{T as x,F as G,I as O}from"./TextField-D43kg6c3.js";import{T as Oe}from"./TableContainer-gCCy6yK7.js";import{T as Te,a as He,b as ae,c as n,d as De}from"./TableRow-B6k_bSOs.js";import{C as T}from"./Chip-DTcaVcsg.js";import{E as Re}from"./Edit-6vcT2Cu4.js";import{T as Ve}from"./TablePagination-_dHW1U1A.js";import{D as I}from"./Divider-mutym74u.js";import{I as c}from"./InputAdornment-DEk4gwZf.js";import{S as H,O as le}from"./Select-BThNtn2k.js";import{M as D}from"./MenuItem-Cm5ZuES4.js";import{V as ne}from"./Visibility-CWvGRW87.js";import"./useFormControl-C6hS7-Rn.js";import"./index-Pp9EW3wT.js";import"./KeyboardArrowRight-BzCb_W4p.js";import"./Toolbar-Dufg8Txv.js";import"./useSlotProps-CCL6Y0ZK.js";import"./useControlled-CHkDrNg3.js";const Be=p(e.jsx("path",{d:"M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2zm-2 0-8 5-8-5zm0 12H4V8l8 5 8-5z"})),oe=p(e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2M9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9zm9 14H6V10h12zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2"})),Fe=p(e.jsx("path",{d:"M13 8c0-2.21-1.79-4-4-4S5 5.79 5 8s1.79 4 4 4 4-1.79 4-4m2 2v2h3v3h2v-3h3v-2h-3V7h-2v3zM1 18v2h16v-2c0-2.66-5.33-4-8-4s-8 1.34-8 4"})),qe=p(e.jsx("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"})),Le=p(e.jsx("path",{d:"M15.5 1h-8C6.12 1 5 2.12 5 3.5v17C5 21.88 6.12 23 7.5 23h8c1.38 0 2.5-1.12 2.5-2.5v-17C18 2.12 16.88 1 15.5 1m-4 21c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m4.5-4H7V4h9z"})),ie=p(e.jsx("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"})),R=[{value:"project manager",label:"Project Manager"},{value:"engineer",label:"Engineer"},{value:"accountant",label:"Accountant"},{value:"procurement officer",label:"Procurement Officer"},{value:"inventory manager",label:"Inventory Manager"},{value:"site supervisor",label:"Site Supervisor"},{value:"maintenance staff",label:"Maintenance Staff"}],ms=()=>{const de=Ue(),g=Ge(de.breakpoints.down("sm")),[A,z]=a.useState([]),[V,ce]=a.useState([]),[ue,b]=a.useState(!1),[h,v]=a.useState(!1),[B,d]=a.useState(""),[F,w]=a.useState(""),[U,xe]=a.useState(""),[k,q]=a.useState(0),[C,pe]=a.useState(10),[he,L]=a.useState(!1),[me,N]=a.useState(!1),[t,y]=a.useState({full_name:"",email:"",mobile_number:"",role:"",groups:[],password:"",password2:""}),[M,je]=a.useState(!1),[E,fe]=a.useState(!1),[Q,ge]=a.useState(null),[$,W]=a.useState([]);a.useEffect(()=>{(async()=>{b(!0);try{const[r,o]=await Promise.all([_(),Me()]);z(r||[]),ce(o||[])}catch{d("Failed to load users or groups.")}finally{b(!1)}})()},[]);const be=(s,r)=>q(r),ve=s=>{pe(parseInt(s.target.value,10)),q(0)},J=a.useMemo(()=>{const s=U.trim().toLowerCase();return s?A.filter(r=>[r.user_id,r.full_name,r.email,r.mobile_number,r.role,...Array.isArray(r.groups)?r.groups:[]].filter(Boolean).join(" ").toLowerCase().includes(s)):A},[A,U]),we=s=>{var r;return((r=R.find(o=>o.value===s))==null?void 0:r.label)||s||"-"},Ce=()=>{y({full_name:"",email:"",mobile_number:"",role:"",groups:[],password:"",password2:""}),L(!0)},ye=async s=>{ge(s.user_id),N(!0);try{b(!0);const r=await Ee(s.user_id),o=Array.isArray(r==null?void 0:r.groups)?r.groups:[];W(o)}catch{d("Failed to load user details."),W([])}finally{b(!1)}},S=()=>L(!1),P=()=>N(!1),m=s=>{const{name:r,value:o}=s.target;y(ze=>({...ze,[r]:o}))},Se=s=>{const r=s.target.value;y(o=>({...o,groups:typeof r=="string"?r.split(","):r}))},Pe=async()=>{if(!t.full_name||!t.password||!t.password2){d("Please fill all required fields.");return}if(t.password!==t.password2){d("Passwords do not match.");return}v(!0);try{await We(t),w("User created successfully."),S();const s=await _();z(s||[])}catch{d("Failed to create user.")}finally{v(!1)}},Ie=s=>{const r=s.target.value;W(typeof r=="string"?r.split(","):r)},Ae=async()=>{if(Q){v(!0);try{await _e(Q,{groups:$}),w("User groups updated."),P();const s=await _();z(s||[])}catch{d("Failed to update user groups.")}finally{v(!1)}}};return e.jsxs(u,{children:[e.jsxs(l,{container:!0,alignItems:"center",justifyContent:"space-between",sx:{mt:2,mb:2},children:[e.jsx(l,{item:!0,children:e.jsx(i,{variant:"h6",sx:{color:"#7267ef"},children:"Users & Roles"})}),e.jsx(l,{item:!0,children:e.jsx(f,{variant:"contained",onClick:Ce,sx:{backgroundColor:"#7267ef"},children:"Add User"})})]}),e.jsxs(ke,{sx:{p:2},children:[e.jsx(l,{container:!0,spacing:2,alignItems:"center",sx:{mb:1},children:e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(x,{fullWidth:!0,size:"small",label:"Search Users",value:U,onChange:s=>xe(s.target.value)})})}),ue?e.jsx(u,{display:"flex",justifyContent:"center",alignItems:"center",sx:{minHeight:200},children:e.jsx(K,{})}):e.jsx(Oe,{children:e.jsxs(Te,{size:"small",children:[e.jsx(He,{children:e.jsxs(ae,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"User ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Name"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Email"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Mobile"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Role"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Groups"})}),e.jsx(n,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(De,{children:J.slice(k*C,k*C+C).map(s=>e.jsxs(ae,{hover:!0,children:[e.jsx(n,{children:s.user_id}),e.jsx(n,{children:s.full_name||"-"}),e.jsx(n,{children:s.email||"-"}),e.jsx(n,{children:s.mobile_number||"-"}),e.jsx(n,{children:we(s.role)}),e.jsx(n,{children:e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:(Array.isArray(s.groups)?s.groups:[]).map(r=>e.jsx(T,{label:r,size:"small"},`${s.user_id}-${r}`))})}),e.jsx(n,{children:e.jsx(j,{color:"warning",onClick:()=>ye(s),"aria-label":"Edit groups",children:e.jsx(Re,{sx:{color:"orange"}})})})]},s.user_id))})]})}),e.jsx(Ve,{rowsPerPageOptions:[5,10,25],component:"div",count:J.length,rowsPerPage:C,page:k,onPageChange:be,onRowsPerPageChange:ve})]}),e.jsxs(ee,{open:he,onClose:S,maxWidth:"xl",fullWidth:!0,fullScreen:g,PaperProps:{sx:{borderRadius:g?0:3,boxShadow:6,width:g?"100vw":"min(1100px, 94vw)"}},children:[e.jsxs(se,{sx:{backgroundColor:"#f7f7fb",color:"#2f2a8d",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(u,{children:[e.jsx(i,{variant:"h6",sx:{fontWeight:700},children:"Create User"}),e.jsx(i,{variant:"body2",sx:{color:"text.secondary"},children:"Add a new team member and assign access"})]}),e.jsx(j,{onClick:S,sx:{color:"#7267ef"},"aria-label":"Close dialog",children:e.jsx(Z,{})})]}),e.jsx(re,{dividers:!0,sx:{backgroundColor:"#fff"},children:e.jsxs(l,{container:!0,spacing:4,sx:{mt:0},children:[e.jsxs(l,{item:!0,xs:12,children:[e.jsx(i,{variant:"overline",sx:{color:"text.secondary"},children:"Basic Information"}),e.jsx(I,{sx:{mt:1,mb:2}})]}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Full Name",name:"full_name",value:t.full_name,onChange:m,required:!0,InputProps:{startAdornment:e.jsx(c,{position:"start",children:e.jsx(qe,{fontSize:"small"})})}})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Email",name:"email",type:"email",value:t.email,onChange:m,required:!0,InputProps:{startAdornment:e.jsx(c,{position:"start",children:e.jsx(Be,{fontSize:"small"})})}})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Mobile Number",name:"mobile_number",value:t.mobile_number,onChange:m,required:!0,InputProps:{startAdornment:e.jsx(c,{position:"start",children:e.jsx(Le,{fontSize:"small"})})}})}),e.jsxs(l,{item:!0,xs:12,children:[e.jsx(i,{variant:"overline",sx:{color:"text.secondary"},children:"Roles"}),e.jsx(I,{sx:{mt:1,mb:2}})]}),e.jsx(l,{item:!0,xs:12,children:e.jsxs(G,{fullWidth:!0,required:!0,variant:"outlined",sx:{minWidth:"100%",display:"block"},children:[e.jsx(O,{id:"role-label",shrink:!0,children:"Role"}),e.jsx(H,{fullWidth:!0,sx:{width:"100%","& .MuiSelect-select":{py:1.75}},size:"medium",displayEmpty:!0,labelId:"role-label",id:"role-select",label:"Role",name:"role",value:t.role,onChange:s=>y(r=>({...r,role:s.target.value})),input:e.jsx(le,{label:"Role"}),renderValue:s=>{var r;return s?((r=R.find(o=>o.value===s))==null?void 0:r.label)||s:e.jsx(i,{sx:{color:"text.disabled"},children:"Select a role"})},children:R.map(s=>e.jsx(D,{value:s.value,children:s.label},s.value))})]})}),e.jsxs(l,{item:!0,xs:12,children:[e.jsx(i,{variant:"overline",sx:{color:"text.secondary"},children:"Groups"}),e.jsx(I,{sx:{mt:1,mb:2}})]}),e.jsx(l,{item:!0,xs:12,children:e.jsxs(G,{fullWidth:!0,required:!0,variant:"outlined",sx:{minWidth:"100%",display:"block"},children:[e.jsx(O,{id:"add-groups-label",shrink:!0,children:"Groups"}),e.jsx(H,{fullWidth:!0,sx:{width:"100%","& .MuiSelect-select":{py:1.75}},size:"medium",displayEmpty:!0,labelId:"add-groups-label",id:"groups-select",multiple:!0,value:t.groups,onChange:Se,label:"Groups",input:e.jsx(le,{label:"Groups"}),renderValue:s=>!s||s.length===0?e.jsx(i,{sx:{color:"text.disabled"},children:"Select groups"}):e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s.map(r=>e.jsx(T,{label:r,size:"small"},r))}),children:V.map(s=>e.jsx(D,{value:s.name,children:s.name},s.id))})]})}),e.jsxs(l,{item:!0,xs:12,children:[e.jsx(i,{variant:"overline",sx:{color:"text.secondary"},children:"Security"}),e.jsx(I,{sx:{mt:1,mb:2}})]}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Password",name:"password",type:M?"text":"password",value:t.password,onChange:m,required:!0,InputProps:{startAdornment:e.jsx(c,{position:"start",children:e.jsx(oe,{fontSize:"small"})}),endAdornment:e.jsx(c,{position:"end",children:e.jsx(j,{"aria-label":M?"Hide password":"Show password",onClick:()=>je(s=>!s),edge:"end",children:M?e.jsx(ie,{}):e.jsx(ne,{})})})}})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Confirm Password",name:"password2",type:E?"text":"password",value:t.password2,onChange:m,helperText:t.password&&t.password2&&t.password!==t.password2?"Passwords do not match":" ",error:!!(t.password&&t.password2&&t.password!==t.password2),required:!0,InputProps:{startAdornment:e.jsx(c,{position:"start",children:e.jsx(oe,{fontSize:"small"})}),endAdornment:e.jsx(c,{position:"end",children:e.jsx(j,{"aria-label":E?"Hide confirm password":"Show confirm password",onClick:()=>fe(s=>!s),edge:"end",children:E?e.jsx(ie,{}):e.jsx(ne,{})})})}})})]})}),e.jsxs(te,{sx:{pr:3,pb:2},children:[e.jsx(f,{onClick:S,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(f,{variant:"contained",onClick:Pe,disabled:h,sx:{backgroundColor:"#7267ef"},startIcon:h?e.jsx(K,{size:18,color:"inherit"}):e.jsx(Fe,{}),children:h?"Creating...":"Create User"})]})]}),e.jsxs(ee,{open:me,onClose:P,maxWidth:"sm",fullWidth:!0,fullScreen:g,children:[e.jsxs(se,{sx:{backgroundColor:"#f3f3f3",color:"#7267ef",display:"flex",justifyContent:"space-between"},children:["Update User Groups",e.jsx(j,{onClick:P,sx:{color:"#7267ef"},children:e.jsx(Z,{})})]}),e.jsxs(re,{dividers:!0,children:[e.jsx(i,{variant:"body2",sx:{mb:1,color:"text.secondary"},children:"Only groups can be modified for an existing user."}),e.jsxs(G,{fullWidth:!0,children:[e.jsx(O,{id:"edit-groups-label",children:"Groups"}),e.jsx(H,{labelId:"edit-groups-label",multiple:!0,value:$,onChange:Ie,label:"Groups",renderValue:s=>e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s.map(r=>e.jsx(T,{label:r,size:"small"},r))}),children:V.map(s=>e.jsx(D,{value:s.name,children:s.name},s.id))})]})]}),e.jsxs(te,{sx:{pr:3,pb:2},children:[e.jsx(f,{onClick:P,sx:{color:"#800000"},children:"Cancel"}),e.jsx(f,{variant:"contained",onClick:Ae,disabled:h,sx:{backgroundColor:"#7267ef"},children:h?"Saving...":"Update"})]})]}),e.jsx(X,{open:!!B,autoHideDuration:4e3,onClose:()=>d(""),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Y,{onClose:()=>d(""),severity:"error",variant:"filled",children:B})}),e.jsx(X,{open:!!F,autoHideDuration:3e3,onClose:()=>w(""),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Y,{onClose:()=>w(""),severity:"success",variant:"filled",children:F})})]})};export{ms as default};
