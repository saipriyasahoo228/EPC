import{r as o,j as e,T as D,x as k,S,D as R}from"./main-BIxdd69i.js";import{C as J}from"./Close-D340Gps3.js";import{g as K,f as v,h as V,i as X,j as Z}from"./maintenance-B4U_mUx1.js";import{G as a}from"./Grid-BnZNKmae.js";import{P as M,I as d,D as ee,f as te,g as se,h as re,e as F}from"./DialogTitle-D59uELMl.js";import{T as W,a as T,b as u,c as s,d as E}from"./TableRow-D8X36zJO.js";import{A as ne}from"./AddCircle-Bn9h5MaP.js";import{T as ae}from"./TableContainer-1Xqyy-f8.js";import{E as oe}from"./Edit-BJV-h6Li.js";import{D as ie}from"./Delete-BHKbKfZ2.js";import{M as le,a as ce}from"./minimize-2-Dl_U24Qm.js";const be=()=>{const x="maintenance",[_,N]=o.useState(""),[C,A]=o.useState(""),[B,j]=o.useState(!1),[de,O]=o.useState(""),[n,c]=o.useState({}),[I,m]=o.useState([]),[p,b]=o.useState(null),[xe,y]=o.useState(null),[P,z]=o.useState([]),[g,L]=o.useState(!1),[$,w]=o.useState(!1),G=()=>{L(!g)};o.useEffect(()=>{(async()=>{try{const r=await K();z(r)}catch(r){console.error("❌ Error loading assets:",r)}})()},[]),o.useEffect(()=>{(async()=>{try{const r=await v();m(r)}catch(r){console.error("❌ Failed to load work orders:",r)}})()},[]);const H=t=>{O(t);const r=new Date().getFullYear(),f=(I.length+1).toString().padStart(4,"0");c({workOrderID:`WO-${r}-${f}`,assetId:t}),w(!1),y(null),j(!0)},U=t=>{c({workOrderID:t.work_order_id,assetId:t.asset,reportedIssue:t.reported_issue,issueReportedBy:t.issue_reported_by,reportDate:t.report_date,inspectionDate:t.inspection_date,technicianId:t.technician_id,repairWorkDone:t.repair_work_done,partsReplaced:t.parts_replaced,totalMaintenanceCost:t.total_maintenance_cost,completionDate:t.completion_date,finalStatus:t.final_status}),b(t.work_order_id),j(!0)},Y=async t=>{if(window.confirm(`Are you sure you want to delete this work order?  ${t}`))try{await V(t),alert(`🗑️ Work order ${t} deleted successfully`),m(r=>r.filter(l=>l.work_order_id!==t))}catch(r){alert("❌ Failed to delete work order"),console.error(r)}},h=()=>{j(!1),c({}),w(!1),y(null)},i=t=>{const{name:r,value:l}=t.target;c(f=>({...f,[r]:l}))},Q=async()=>{try{const t={asset:n.assetId,reported_issue:n.reportedIssue,issue_reported_by:n.issueReportedBy,report_date:n.reportDate,inspection_date:n.inspectionDate||null,technician_id:n.technicianId,repair_work_done:n.repairWorkDone,parts_replaced:n.partsReplaced||null,total_maintenance_cost:parseFloat(n.totalMaintenanceCost||0),completion_date:n.completionDate||null,final_status:n.finalStatus};if(p){const l=await X(p,t);alert(`✏️ Work order updated: ${l.work_order_id}`)}else{const l=await Z(t);alert(`✅ Work order created: ${l.work_order_id}`)}const r=await v();m(r),h(),b(null),c({})}catch(t){alert("❌ Failed to save work order"),console.error(t)}},q=I.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(C.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(D,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Maintenance Management Report"}),e.jsx(a,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(M,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(D,{variant:"h6",gutterBottom:!0,children:"ASSETS RECORDS"}),e.jsx(k,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Asset ID",value:_,onChange:t=>N(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(W,{children:[e.jsx(T,{children:e.jsxs(u,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(E,{children:P.filter(t=>t.asset_id.toLowerCase().includes(_.toLowerCase())).map((t,r)=>e.jsxs(u,{children:[e.jsx(s,{children:t.asset_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(S,{slug:x,action:"can_create",children:e.jsx(d,{onClick:()=>H(t.asset_id),color:"primary",children:e.jsx(ne,{sx:{color:"#7267ef"}})})})})]},r))})]})]})})}),e.jsx(a,{container:!0,spacing:2,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(M,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(D,{variant:"h6",gutterBottom:!0,children:"Maintenance Management Report"}),e.jsx("input",{type:"text",placeholder:"Search Maintenance Details",value:C,onChange:t=>A(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(ae,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(W,{stickyHeader:!0,children:[e.jsx(T,{children:e.jsxs(u,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"WorkOrder ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Reported Issuees"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Issuees ReportedBy"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Report Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Technician ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Repair WorkDone"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Parts Replaced"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Total Maintenance Cost"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Completion Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Final Status"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(E,{children:q.map((t,r)=>e.jsxs(u,{children:[e.jsx(s,{children:t.asset}),e.jsx(s,{children:t.work_order_id}),e.jsx(s,{children:t.reported_issue}),e.jsx(s,{children:t.issue_reported_by}),e.jsx(s,{children:t.report_date}),e.jsx(s,{children:t.inspection_date}),e.jsx(s,{children:t.technician_id}),e.jsx(s,{children:t.repair_work_done}),e.jsx(s,{children:t.parts_replaced}),e.jsx(s,{children:t.total_maintenance_cost}),e.jsx(s,{children:t.completion_date}),e.jsx(s,{children:t.final_status}),e.jsxs(s,{children:[e.jsx(R,{slug:x,action:"can_update",children:e.jsx(d,{onClick:()=>U(t),color:"warning",children:e.jsx(oe,{sx:{color:"orange"}})})}),e.jsx(S,{slug:x,action:"can_delete",children:e.jsx(d,{onClick:()=>Y(t.work_order_id),color:"error",children:e.jsx(ie,{sx:{color:"red"}})})})]})]},r))})]})})]})})}),e.jsxs(ee,{open:B,onClose:h,fullWidth:!0,maxWidth:"xl",PaperProps:{style:g?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(te,{children:$?"Edit Maintenance Report":"Enter Maintenance Report"}),e.jsxs(se,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(d,{"aria-label":"toggle-size",onClick:G,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:g?e.jsx(le,{}):e.jsx(ce,{})}),e.jsx(d,{"aria-label":"close",onClick:h,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(J,{})}),e.jsx(k,{component:"form",sx:{mt:2},children:e.jsx(a,{container:!0,spacing:3,direction:"column",children:e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Maintenance Report"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Asset ID"}),e.jsx("input",{id:"projectId",name:"projectId",className:"input",value:n.assetId||"",onChange:i,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"workOrderID",children:"Work Order ID"}),e.jsx("input",{id:"workOrderID",name:"workOrderID",className:"input",value:n.workOrderID||"",onChange:i,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"reportedIssue",children:"Reported Issue"}),e.jsx("textarea",{id:"reportedIssue",name:"reportedIssue",className:"input",rows:"3",value:n.reportedIssue||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"issueReportedBy",children:"Issue Reported By"}),e.jsx("input",{id:"issueReportedBy",name:"issueReportedBy",className:"input",value:n.issueReportedBy||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"reportDate",children:"Report Date"}),e.jsx("input",{type:"date",id:"reportDate",name:"reportDate",className:"input",value:n.reportDate||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionDate",children:"Inspection Date"}),e.jsx("input",{type:"date",id:"inspectionDate",name:"inspectionDate",className:"input",value:n.inspectionDate||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"technicianId",children:"Technician ID"}),e.jsx("input",{id:"technicianId",name:"technicianId",className:"input",value:n.technicianId||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"repairWorkDone",children:"Repair Work Done"}),e.jsx("textarea",{id:"repairWorkDone",name:"repairWorkDone",className:"input",rows:"3",value:n.repairWorkDone||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"partsReplaced",children:"Parts Replaced"}),e.jsx("textarea",{id:"partsReplaced",name:"partsReplaced",className:"input",rows:"2",value:n.partsReplaced||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"totalMaintenanceCost",children:"Total Maintenance Cost"}),e.jsx("input",{type:"number",step:"0.01",id:"totalMaintenanceCost",name:"totalMaintenanceCost",className:"input",value:n.totalMaintenanceCost||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"completionDate",children:"Completion Date"}),e.jsx("input",{type:"date",id:"completionDate",name:"completionDate",className:"input",value:n.completionDate||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"finalStatus",children:"Final Status"}),e.jsxs("select",{id:"finalStatus",name:"finalStatus",className:"input",value:n.finalStatus||"",onChange:i,children:[e.jsx("option",{value:"",children:"-- Select Status --"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Pending",children:"Pending Approval"})]})]})]})]})})})]}),e.jsxs(re,{children:[e.jsx(F,{onClick:h,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(R,{slug:x,action:p?"can_update":"can_create",children:e.jsx(F,{variant:"outlined",onClick:Q,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:p?"Update":"Create"})})]})]})]})};export{be as default};
