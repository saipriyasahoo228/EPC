import{r,j as e,T as f}from"./main-IxGEKZMA.js";import{C as Y}from"./Close-DoqWsXz3.js";import{g as G}from"./procurement-DNGl8bgG.js";import{a as H,b as U,e as W,f as q}from"./account-bCc6eR-k.js";import{G as o}from"./Grid-C72N-tAO.js";import{t as D,T as P,h as _,i as x,j as n,k as I,I as h,D as z,f as J,g as K,e as C}from"./TableRow-CRAT5KT_.js";import{A as Q}from"./AddCircle-DWIRGPUh.js";import{T as X}from"./TableContainer-BaU58JEj.js";import{E as Z}from"./Edit-g2hjeeYC.js";import{D as ee}from"./Delete-cHl_EB0l.js";import{D as te}from"./DialogActions-D5wP0Mt-.js";import"./Transition-C29ZPDdz.js";const je=()=>{const[S,d]=r.useState(!1),[ae,A]=r.useState(""),[s,p]=r.useState({}),[y,w]=r.useState([]),[c,m]=r.useState(!1),[ne,E]=r.useState(null),[j,T]=r.useState(""),[N,F]=r.useState([]),[g,b]=r.useState(null);r.useEffect(()=>{(async()=>{try{const a=await G();F(a)}catch(a){console.error("❌ Error fetching vendors:",a)}})()},[]);const v=async()=>{try{const t=await H();w(t)}catch(t){console.error("❌ Error fetching payables:",t)}};r.useEffect(()=>{v()},[]);const V=t=>{const l=`INV-${new Date().getFullYear()}-${(y.length+1).toString().padStart(3,"0")}`;A(t),p({invoiceId:l,vendorId:t,invoiceDate:"",dueDate:"",totalAmount:"",amountPaid:"",paymentStatus:"Pending",paymentMethod:"",approvalStatus:"",outstandingBalance:""}),m(!1),E(null),d(!0)},k=t=>{p({invoiceId:t.invoice_id,vendorId:t.vendor,invoiceDate:t.invoice_date,dueDate:t.due_date,totalAmount:t.total_amount,amountPaid:t.amount_paid,outstandingBalance:t.outstanding_balance,paymentStatus:t.payment_status,paymentMethod:t.payment_method,approvalStatus:t.approval_status}),b(t.invoice_id),m(!0),d(!0)},M=async t=>{if(window.confirm(`Are you sure you want to delete invoice ${t}?`))try{await U(t),alert(`✅ Invoice ${t} deleted successfully!`),v()}catch(l){console.error("❌ Error deleting payable:",l),alert("❌ Failed to delete invoice. Please try again.")}},i=t=>{const{name:a,value:l}=t.target,u={...s,[a]:l};if(a==="totalAmount"||a==="amountPaid"){const $=parseFloat(u.totalAmount||0),L=parseFloat(u.amountPaid||0);u.outstandingBalance=($-L).toFixed(2)}p(u)},B=(t,a)=>!t||a==="Paid"?!1:new Date(t)<new Date,O=async()=>{var t;try{const a={vendor:s.vendorId,invoice_date:s.invoiceDate,due_date:s.dueDate,total_amount:parseFloat(s.totalAmount||0),amount_paid:parseFloat(s.amountPaid||0),payment_status:s.paymentStatus,payment_method:s.paymentMethod,approval_status:s.approvalStatus};if(c&&g){const l=await W(g,a);alert(`✅ Invoice ${l.invoice_id} updated successfully!`)}else{const l=await q(a);alert(`✅ Payable created successfully! Invoice ID: ${l.invoice_id}`)}d(!1),m(!1),b(null),v()}catch(a){console.error("❌ Error saving payable:",((t=a.response)==null?void 0:t.data)||a),alert("❌ Failed to save payable. Please try again.")}},R=y.filter(t=>Object.values(t).some(a=>a==null?void 0:a.toString().toLowerCase().includes(j.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Accounts Payable"}),e.jsxs(o,{container:!0,spacing:2,direction:"column",children:[e.jsx(o,{item:!0,xs:12,children:e.jsxs(D,{sx:{p:2},children:[e.jsx(f,{variant:"h6",children:"Vendor List"}),e.jsx("input",{type:"text",placeholder:"Search Vendor ID",value:j,onChange:t=>T(t.target.value),className:"input",style:{width:"100%",margin:"10px 0",padding:"8px",borderRadius:4}}),e.jsxs(P,{children:[e.jsx(_,{children:e.jsxs(x,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Vendor ID"})}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(I,{children:N.filter(t=>{var a;return(a=t.vendor_id)==null?void 0:a.toLowerCase().includes(j.toLowerCase())}).map((t,a)=>e.jsxs(x,{children:[e.jsx(n,{children:t.vendor_id}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(h,{onClick:()=>V(t.vendor_id),color:"primary",children:e.jsx(Q,{sx:{color:"#7267ef"}})})})]},a))})]})]})}),e.jsx(o,{item:!0,xs:12,children:e.jsxs(D,{sx:{p:2,mt:2},children:[e.jsx(f,{variant:"h6",children:"Payable Records"}),e.jsx(X,{children:e.jsxs(P,{stickyHeader:!0,children:[e.jsx(_,{children:e.jsxs(x,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:"Invoice ID"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Vendor ID"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Invoice Date"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Due Date"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Total Amount"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Amount Paid"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Outstanding"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Status"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Method"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Approval"}),e.jsx(n,{sx:{color:"#660000"},children:"Actions"})]})}),e.jsx(I,{children:R.map((t,a)=>e.jsxs(x,{sx:{backgroundColor:B(t.due_date,t.payment_status)?"#ffe6e6":"inherit"},children:[e.jsx(n,{children:t.invoice_id}),e.jsx(n,{children:t.vendor}),e.jsx(n,{children:t.invoice_date}),e.jsx(n,{children:t.due_date}),e.jsx(n,{children:t.total_amount}),e.jsx(n,{children:t.amount_paid}),e.jsx(n,{children:t.outstanding_balance}),e.jsx(n,{children:t.payment_status}),e.jsx(n,{children:t.payment_method}),e.jsx(n,{children:t.approval_status}),e.jsxs(n,{children:[e.jsx(h,{onClick:()=>k(t),color:"warning",children:e.jsx(Z,{sx:{color:"orange"}})}),e.jsx(h,{onClick:()=>M(t.invoice_id),color:"error",children:e.jsx(ee,{sx:{color:"red"}})})]})]},a))})]})})]})})]}),e.jsxs(z,{open:S,onClose:()=>d(!1),fullWidth:!0,children:[e.jsxs(J,{children:[c?"Edit Invoice Details":"New Invoice Entry",e.jsx(h,{"aria-label":"close",onClick:()=>d(!1),sx:{position:"absolute",right:8,top:8},children:e.jsx(Y,{})})]}),e.jsx(K,{children:e.jsxs(o,{container:!0,spacing:2,mt:1,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Invoice ID"}),e.jsx("input",{className:"input",value:s.invoiceId||"",disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Vendor ID"}),e.jsx("input",{className:"input",value:s.vendorId||"",disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Invoice Date"}),e.jsx("input",{name:"invoiceDate",type:"date",className:"input",value:s.invoiceDate||"",onChange:i})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{name:"dueDate",type:"date",className:"input",value:s.dueDate||"",onChange:i})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Total Amount"}),e.jsx("input",{name:"totalAmount",type:"number",className:"input",value:s.totalAmount||"",onChange:i})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Amount Paid"}),e.jsx("input",{name:"amountPaid",type:"number",className:"input",value:s.amountPaid||"",onChange:i})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Outstanding"}),e.jsx("input",{className:"input",value:s.outstandingBalance||"",disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Payment Status"}),e.jsxs("select",{name:"paymentStatus",className:"input",value:s.paymentStatus||"Pending",onChange:i,disabled:c,children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Paid",children:"Paid"}),e.jsx("option",{value:"Overdue",children:"Overdue"})]})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Payment Method"}),e.jsx("input",{name:"paymentMethod",className:"input",value:s.paymentMethod||"",onChange:i})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Approval Status"}),e.jsxs("select",{name:"approvalStatus",className:"input",value:s.approvalStatus||"Pending",onChange:i,children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]})]})}),e.jsxs(te,{children:[e.jsx(C,{onClick:()=>d(!1),sx:{outline:"2px solid #800000",color:"#800000"},children:"Cancel"}),e.jsx(C,{onClick:O,variant:"outlined",sx:{color:"#7267ef",borderColor:"#7267ef"},children:c?"Update":"Submit"})]})]})]})};export{je as default};
