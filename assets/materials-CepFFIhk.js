import{r as l,j as e,T as j,x as C,S as O,y as ce,D as $}from"./main-BIxdd69i.js";import{C as de}from"./Close-D340Gps3.js";import{g as ue}from"./engineering-4VzvUWDc.js";import{a as xe,b as me,e as pe,f as he}from"./procurement-Dxzq-DH5.js";import{E as je,a as ye}from"./jspdf.plugin.autotable-y_YJgUzU.js";import{D as fe}from"./Download-D_b47uoU.js";import{G as o}from"./Grid-BnZNKmae.js";import{P as X,I as u,e as v,D as _e,f as ge,g as Pe,h as Ce}from"./DialogTitle-D59uELMl.js";import{T as U,a as Y,b as y,c as s,d as Q}from"./TableRow-D8X36zJO.js";import{A as ve}from"./AddCircle-Bn9h5MaP.js";import{A as H,a as W}from"./ArrowForwardIos-DapvvZ-0.js";import{T as be}from"./TableContainer-1Xqyy-f8.js";import{E as Se}from"./Edit-BJV-h6Li.js";import{D as De}from"./Delete-BHKbKfZ2.js";import{M as qe,a as Ie}from"./minimize-2-Dl_U24Qm.js";const He=()=>{const f="procurement",[b,G]=l.useState(""),[J,K]=l.useState([]),[S,T]=l.useState([]),[A,V]=l.useState(""),[Z,_]=l.useState(!1),[we,ee]=l.useState(""),[Fe,Me]=l.useState(!1),[D,q]=l.useState("create"),I=1,[m,R]=l.useState(1),[p,B]=l.useState(1),w=5,[F,te]=l.useState(!1),[n,g]=l.useState({projectId:"",procurementId:"",materialName:"",materialCode:"",quantity:"",unitPrice:"",totalCost:"",requestedBy:"",requestDate:"",approvalStatus:"Pending",poId:"",expectedDeliveryDate:"",paymentStatus:""}),re=()=>{te(!F)},se=t=>{const r=new je("p","mm","a4");r.setFontSize(14),r.text("Your Company Name",14,20),r.setFontSize(10),r.text("Address Line 1, City, Country",14,26),r.text("Phone: +91-XXXXXXXXXX",14,32),r.setLineWidth(.5),r.line(140,10,140,40),r.setFontSize(12),r.text(`Date: ${t.procurements[0].request_date}`,145,26),r.text(`Project: ${t.project_id}`,145,32);const a=["Material Name","Material Code","Qty","Unit Price","Total Cost"],c=t.procurements.map(x=>[x.material_name,x.material_code,x.quantity_requested,x.unit_price,x.total_cost]);ye(r,{head:[a],body:c,startY:50,styles:{fontSize:10},headStyles:{fillColor:[114,103,239]},theme:"plain"});const i=r.lastAutoTable.finalY+10;r.setFontSize(12),r.text(`Total Cost: Rs ${t.total_cost.toFixed(2)} `,14,i),r.setFontSize(10),r.text("Prepared By: ________________",14,i+15),r.text("Reviewed By: ________________",80,i+15),r.text("Authorized Signatory: ________________",140,i+15),r.save(`Purchase_Order_${t.project_id}.pdf`)},E=J.filter(t=>t.project_id.toLowerCase().includes(b.toLowerCase())),k=Math.ceil(E.length/I),ae=E.slice((m-1)*I,m*I);l.useEffect(()=>{(async()=>{try{const r=await ue();K(r)}catch(r){console.error("Failed to load accepted projects:",r)}})()},[]);const P=async()=>{try{const t=await xe();console.log(t),T(t)}catch(t){console.error("❌ Error loading procurements:",t)}};l.useEffect(()=>{P()},[]);const d=t=>{const{name:r,value:a}=t.target;g(c=>{const i={...c,[r]:a};if(r==="quantity"||r==="unitPrice"){const x=parseFloat(i.quantity)||0,N=parseFloat(i.unitPrice)||0,h=(x*N).toFixed(2);i.totalCost=h}return i})},oe=t=>{const r=new Date().getFullYear(),c=(S.length+1).toString().padStart(3,"0"),i=`${r}-PRC-${c}`;g({projectId:t,procurementId:i,materialName:"",materialCode:"",quantity:"",unitPrice:"",totalCost:"",requestedBy:"",requestDate:"",approvalStatus:"Pending",paymentStatus:"Pending",expectedDeliveryDate:""}),q("create"),_(!0)},M=()=>_(!1),ne=async()=>{var r;const t=new FormData;t.append("project",n.projectId),t.append("material_name",n.materialName),t.append("material_code",n.materialCode),t.append("quantity_requested",n.quantity),t.append("unit_price",n.unitPrice),t.append("requested_by",n.requestedBy),t.append("request_date",n.requestDate),t.append("approval_status",n.approvalStatus||"Pending"),t.append("payment_status",n.paymentStatus||"Pending"),n.expectedDeliveryDate&&t.append("expected_delivery_date",n.expectedDeliveryDate);try{D==="update"?(await pe(n.procurementId,t),alert("✅ Material Procurement updated successfully!")):(await he(t),alert("✅ Material Procurement submitted successfully!")),g({projectId:"",procurementId:"",materialName:"",materialCode:"",quantity:"",unitPrice:"",totalCost:"",requestedBy:"",requestDate:"",approvalStatus:"",paymentStatus:"",expectedDeliveryDate:""}),ee(null),_(!1),q("create"),typeof P=="function"&&await P()}catch(a){const c=(r=a.response)==null?void 0:r.data;console.error("❌ Submission failed:",c||a.message);let i="Submission failed. Please check form values.";c&&typeof c=="object"&&(i=Object.entries(c).map(([N,h])=>`${N}: ${Array.isArray(h)?h.join(", "):h}`).join(`
`)),alert(`❌ ${i}`)}},ie=t=>{g({projectId:t.project,procurementId:t.procurement_id,materialName:t.material_name,materialCode:t.material_code,quantity:t.quantity_requested,unitPrice:t.unit_price,totalCost:t.total_cost,requestedBy:t.requested_by,requestDate:t.request_date,approvalStatus:t.approval_status,paymentStatus:t.payment_status,expectedDeliveryDate:t.expected_delivery_date}),q("update"),_(!0)},le=async t=>{if(window.confirm(`Delete ${t}?`))try{await me(t),alert(`Deleted ${t} successfully`),P(),T(a=>a.filter(c=>c.procurementId!==t))}catch{alert("Failed to delete. Check console for details.")}},z=S.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(A.toLowerCase()))),L=Math.ceil(z.length/w);return z.slice((p-1)*w,p*w),e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Material Procurement"}),e.jsx(o,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(o,{item:!0,xs:12,children:e.jsxs(X,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(j,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(C,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:b,onChange:t=>G(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(U,{children:[e.jsx(Y,{children:e.jsxs(y,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(Q,{children:ae.filter(t=>{var r;return(r=t.project_id)==null?void 0:r.toLowerCase().includes(b.toLowerCase())}).map((t,r)=>e.jsxs(y,{children:[e.jsx(s,{children:t.project_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(O,{slug:f,action:"can_create",children:e.jsx(u,{onClick:()=>oe(t.project_id),color:"primary",children:e.jsx(ve,{sx:{color:"#7267ef"}})})})})]},r))})]}),e.jsxs(C,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(u,{disabled:m===1,onClick:()=>R(t=>t-1),children:e.jsx(H,{})}),e.jsxs(j,{variant:"body2",sx:{mx:2},children:["Page ",m," of ",k||1]}),e.jsx(u,{disabled:m>=k,onClick:()=>R(t=>t+1),children:e.jsx(W,{})})]})]})})}),e.jsx(o,{container:!0,spacing:2,children:e.jsx(o,{item:!0,xs:12,children:e.jsxs(X,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(v,{startIcon:e.jsx(fe,{})}),e.jsx(j,{variant:"h6",gutterBottom:!0,children:"SUBMITTED MATERIALS PROCUREMENT RECORDS"}),e.jsx("input",{type:"text",placeholder:"Search Materials Procurements Here....",value:A,onChange:t=>V(t.target.value),className:"input"}),e.jsx(be,{sx:{maxHeight:500,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(U,{stickyHeader:!0,size:"small",children:[e.jsx(Y,{children:e.jsxs(y,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:"Procurement ID"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Purchase Order ID"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Material Name"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Material Code"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Quantity"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Unit Price"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Total Cost"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Requested By"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Request Date"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Approval Status"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Payment Status"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Expected Delivery"}),e.jsx(s,{sx:{color:"#660000"},children:"Actions"})]})}),e.jsx(Q,{children:S.map(t=>{var r;return e.jsxs(ce.Fragment,{children:[e.jsxs(y,{sx:{backgroundColor:"#f0f0f0"},children:[e.jsxs(s,{colSpan:10,sx:{fontWeight:"bold"},children:["Project: ",t.project_id," | Total Cost: ₹",t.total_cost," | Status: ",t.project_status]}),e.jsx(s,{colSpan:3,align:"right",children:e.jsx(v,{variant:"contained",color:"primary",size:"small",onClick:()=>se(t),children:"Download Project PDF"})})]}),(r=t.procurements)==null?void 0:r.map(a=>e.jsxs(y,{children:[e.jsx(s,{children:a.procurement_id}),e.jsx(s,{children:a.purchase_order||"-"}),e.jsx(s,{children:a.material_name}),e.jsx(s,{children:a.material_code}),e.jsx(s,{children:a.quantity_requested}),e.jsx(s,{children:a.unit_price}),e.jsx(s,{children:a.total_cost}),e.jsx(s,{children:a.requested_by}),e.jsx(s,{children:a.request_date}),e.jsx(s,{children:a.approval_status}),e.jsx(s,{children:a.payment_status}),e.jsx(s,{children:a.expected_delivery_date||"N/A"}),e.jsxs(s,{children:[e.jsx($,{slug:f,action:"can_update",children:e.jsx(u,{color:"warning",onClick:()=>ie(a),children:e.jsx(Se,{sx:{color:"orange"}})})}),e.jsx(O,{slug:f,action:"can_delete",children:e.jsx(u,{color:"error",onClick:()=>le(a.procurement_id),children:e.jsx(De,{sx:{color:"red"}})})})]})]},a.procurement_id))]},t.project_id)})})]})}),e.jsxs(C,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(u,{disabled:p===1,onClick:()=>B(t=>t-1),children:e.jsx(H,{})}),e.jsxs(j,{variant:"body2",sx:{mx:2},children:["Page ",p," of ",L||1]}),e.jsx(u,{disabled:p>=L,onClick:()=>B(t=>t+1),children:e.jsx(W,{})})]})]})})}),e.jsxs(_e,{open:Z,onClose:M,fullWidth:!0,maxWidth:"xl",PaperProps:{style:F?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(ge,{children:"Enter Procurement Details"}),e.jsxs(Pe,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(u,{"aria-label":"toggle-size",onClick:re,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:F?e.jsx(qe,{}):e.jsx(Ie,{})}),e.jsx(u,{"aria-label":"close",onClick:M,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(de,{})}),e.jsx(C,{component:"form",sx:{mt:2},children:e.jsxs(o,{container:!0,spacing:3,direction:"column",children:[e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project & Procurement Info"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",name:"projectId",className:"input",value:n.projectId||"",disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"procurementId",children:"Procurement ID"}),e.jsx("input",{id:"procurementId",name:"procurementId",className:"input",value:n.procurementId||"",disabled:!0})]})]})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Material Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"materialName",children:"Material Name"}),e.jsx("input",{id:"materialName",name:"materialName",className:"input",value:n.materialName||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"materialCode",children:"Material Code"}),e.jsx("input",{id:"materialCode",name:"materialCode",className:"input",value:n.materialCode||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"quantity",children:"Quantity"}),e.jsx("input",{id:"quantity",name:"quantity",className:"input",value:n.quantity||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"unitPrice",children:"Unit Price"}),e.jsx("input",{id:"unitPrice",name:"unitPrice",className:"input",value:n.unitPrice||"",onChange:d})]})]})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Cost & Info"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"totalCost",children:"Total Cost"}),e.jsx("input",{id:"totalCost",name:"totalCost",className:"input",value:n.totalCost||"",disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"requestedBy",children:"Requested By"}),e.jsx("input",{id:"requestedBy",name:"requestedBy",className:"input",value:n.requestedBy||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"requestDate",children:"Request Date"}),e.jsx("input",{type:"date",id:"requestDate",name:"requestDate",className:"input",value:n.requestDate||"",onChange:d})]})]})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Approval & Payment"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:n.approvalStatus||"",onChange:d,children:[e.jsx("option",{value:"",children:"Select Approval Status"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"expectedDeliveryDate",children:"Expected Delivery Date"}),e.jsx("input",{type:"date",id:"expectedDeliveryDate",name:"expectedDeliveryDate",className:"input",value:n.expectedDeliveryDate||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"paymentStatus",children:"Payment Status"}),e.jsxs("select",{id:"paymentStatus",name:"paymentStatus",className:"input",value:n.paymentStatus||"",onChange:d,children:[e.jsx("option",{value:"",children:"Select Payment Status"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Partially Paid",children:"Partially Paid"})]})]})]})]})]})})]}),e.jsxs(Ce,{children:[e.jsx(v,{onClick:M,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx($,{slug:f,action:D==="update"?"can_update":"can_create",children:e.jsx(v,{variant:"outlined",onClick:ne,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:D==="update"?"Update Procurement":"Submit Procurement"})})]})]})]})};export{He as default};
