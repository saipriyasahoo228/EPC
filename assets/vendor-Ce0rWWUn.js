import{r as a,j as e}from"./main-DTv03d8r.js";import{C as se}from"./Close-BAEP8ymL.js";import{A as B,a as O,g as te}from"./ArrowForwardIos-BR1LDHVw.js";import{g as ne,d as oe,u as ae,c as le}from"./procurement-DdbtAVRG.js";import{T as h,H as M,v as $,w as H,x as u,y as s,z as L,I as d,D as ie,r as ce,t as de,q as J}from"./TableRow-DyRCyY9b.js";import{G as t}from"./Grid-C5mdLuvI.js";import{B as f}from"./Box-CyTnG5kx.js";import{A as pe}from"./AddCircle-Br8tjFgv.js";import{T as xe}from"./TableContainer-DOhr4ZW5.js";import{E as me,D as he}from"./Edit-DGVU-IuU.js";import{D as ue}from"./DialogActions-CMm5oWDU.js";import"./api-Dv6wi5j0.js";import"./auth-4s9nFscl.js";import"./Transition-ChWAEdMD.js";const Ee=()=>{const[D,Y]=a.useState(""),[_,G]=a.useState(""),[Q,j]=a.useState(!1),[w,y]=a.useState(""),[I,U]=a.useState([]),[q,z]=a.useState([]),[b,T]=a.useState(null),[je,W]=a.useState("create"),v=4,[x,C]=a.useState(1),[m,E]=a.useState(1),S=5,[n,g]=a.useState({vendorId:"",vendorName:"",contactPerson:"",phoneNumber:"",email:"",address:"",vendorRating:"",complianceStatus:"",approvedSupplier:"",paymentTerms:"",contractExpiryDate:""}),V=q.filter(r=>r.project_id.toLowerCase().includes(D.toLowerCase())),F=Math.ceil(V.length/v),R=V.slice((x-1)*v,x*v),K=r=>{y(r);const o=new Date().getFullYear(),i=(I.length+1).toString().padStart(3,"0"),P=`${o}-VND-${i}`;g({vendorId:P}),j(!0)},N=()=>j(!1),l=r=>{const{name:o,value:c}=r.target;g(i=>({...i,[o]:c}))};a.useEffect(()=>{(async()=>{try{const o=await te();console.log("Fetched projects:",o),z(o)}catch(o){console.error("Failed to fetch accepted projects:",o)}})()},[]);const X=async()=>{var o,c;const r=new FormData;r.append("project",w),r.append("vendor_name",n.vendorName),r.append("contact_person",n.contactPerson),r.append("phone_number",n.phoneNumber),r.append("email",n.email),r.append("address",n.address),r.append("vendor_rating",n.vendorRating),r.append("compliance_status",n.complianceStatus),n.approvedSupplier!==""&&r.append("approved_supplier",n.approvedSupplier==="true"),r.append("payment_terms",n.paymentTerms),r.append("contract_expiry_date",n.contractExpiryDate);try{b?(await ae(b,r),alert("✅ Vendor updated successfully!")):(await le(r),alert("✅ Vendor submitted successfully!")),g({vendorId:"",vendorName:"",contactPerson:"",phoneNumber:"",email:"",address:"",vendorRating:"",complianceStatus:"",approvedSupplier:"",paymentTerms:"",contractExpiryDate:""}),y(null),T(null),j(!1),await(p==null?void 0:p())}catch(i){console.error("❌ Submission failed:",((o=i.response)==null?void 0:o.data)||i.message),alert(`❌ Submission failed:
${JSON.stringify(((c=i.response)==null?void 0:c.data)||{},null,2)}`)}},Z=async r=>{var c;if(!r){alert("❌ Vendor ID is missing.");return}if(window.confirm(`Are you sure you want to delete ${r}?`))try{await oe(r),alert(`✅ Vendor ${r} deleted successfully!`),await(p==null?void 0:p())}catch(i){const P=((c=i.response)==null?void 0:c.data)||i.message;alert(`❌ Failed to delete vendor: ${JSON.stringify(P)}`)}},p=async()=>{try{const r=await ne();U(r)}catch(r){console.error("Failed to fetch vendors:",r)}};a.useEffect(()=>{p()},[]);const ee=r=>{if(!r||!r.vendor_id){console.error("Invalid vendor data:",r);return}T(r.vendor_id),y(r.project),g({vendorId:r.vendor_id,vendorName:r.vendor_name||"",contactPerson:r.contact_person||"",phoneNumber:r.phone_number||"",email:r.email||"",address:r.address||"",vendorRating:r.vendor_rating||"",complianceStatus:r.compliance_status||"",approvedSupplier:r.approved_supplier!==void 0?r.approved_supplier.toString():"",paymentTerms:r.payment_terms||"",contractExpiryDate:r.contract_expiry_date||""}),W("edit"),j(!0)},A=I.filter(r=>Object.values(r).some(o=>o&&o.toString().toLowerCase().includes(_.toLowerCase()))),k=Math.ceil(A.length/S),re=A.slice((m-1)*S,m*S);return e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Vendor Management"}),e.jsx(t,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(t,{item:!0,xs:12,children:e.jsxs(M,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(f,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:D,onChange:r=>{Y(r.target.value),C(1)},className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs($,{children:[e.jsx(H,{children:e.jsxs(u,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(L,{children:R.length>0?R.map((r,o)=>e.jsxs(u,{children:[e.jsx(s,{children:r.project_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(d,{onClick:()=>K(r.project_id),color:"primary",children:e.jsx(pe,{sx:{color:"#7267ef"}})})})]},o)):e.jsx(u,{children:e.jsx(s,{colSpan:2,align:"center",children:"No records found"})})})]}),e.jsxs(f,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(d,{disabled:x===1,onClick:()=>C(r=>r-1),children:e.jsx(B,{})}),e.jsxs(h,{variant:"body2",sx:{mx:2},children:["Page ",x," of ",F||1]}),e.jsx(d,{disabled:x>=F,onClick:()=>C(r=>r+1),children:e.jsx(O,{})})]})]})})}),e.jsx(t,{container:!0,spacing:2,children:e.jsx(t,{item:!0,xs:12,children:e.jsxs(M,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"SUBMITTED VENDOR RECORDS"}),e.jsx("input",{type:"text",placeholder:"Search Vendors",value:_,onChange:r=>G(r.target.value),className:"input"}),e.jsx(xe,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs($,{stickyHeader:!0,children:[e.jsx(H,{children:e.jsxs(u,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Vendor ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Vendor Name"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Contact Person"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Phone Number"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Email Address"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Address"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Rating"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance Status"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approved"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Payment Terms"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Contract Expiry"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(L,{children:re.map((r,o)=>e.jsxs(u,{children:[e.jsx(s,{children:r.project}),e.jsx(s,{children:r.vendor_id}),e.jsx(s,{children:r.vendor_name}),e.jsx(s,{children:r.contact_person}),e.jsx(s,{children:r.phone_number}),e.jsx(s,{children:r.email}),e.jsx(s,{children:r.address}),e.jsx(s,{children:r.vendor_rating}),e.jsx(s,{children:r.compliance_status}),e.jsx(s,{children:r.approvedSupplier?"Yes":"No"}),e.jsx(s,{children:r.payment_terms}),e.jsx(s,{children:r.contract_expiry_date}),e.jsxs(s,{children:[e.jsx(d,{color:"warning",onClick:()=>ee(r),children:e.jsx(me,{sx:{color:"orange"}})}),e.jsx(d,{color:"error",onClick:()=>Z(r.vendor_id),children:e.jsx(he,{sx:{color:"red"}})})]})]},o))})]})}),e.jsxs(f,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(d,{disabled:m===1,onClick:()=>E(r=>r-1),children:e.jsx(B,{})}),e.jsxs(h,{variant:"body2",sx:{mx:2},children:["Page ",m," of ",k||1]}),e.jsx(d,{disabled:m>=k,onClick:()=>E(r=>r+1),children:e.jsx(O,{})})]})]})})}),e.jsxs(ie,{open:Q,onClose:N,fullWidth:!0,children:[e.jsx(ce,{children:"Enter Vendor Details"}),e.jsxs(de,{sx:{position:"relative"},children:[e.jsx(d,{"aria-label":"close",onClick:N,sx:{position:"absolute",right:8,top:8,color:r=>r.palette.grey[500]},children:e.jsx(se,{})}),e.jsx(f,{component:"form",sx:{mt:2},children:e.jsxs(t,{container:!0,spacing:3,direction:"column",children:[e.jsxs(t,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Vendor Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(t,{container:!0,spacing:2,children:[e.jsxs(t,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"vendorId",children:"Vendor ID"}),e.jsx("input",{id:"vendorId",name:"vendorId",className:"input",value:n.vendorId||"",onChange:l,disabled:!0})]}),e.jsxs(t,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:w,disabled:!0})]}),e.jsxs(t,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"vendorName",children:"Vendor Name"}),e.jsx("input",{id:"vendorName",name:"vendorName",className:"input",value:n.vendorName||"",onChange:l})]}),e.jsxs(t,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"contactPerson",children:"Contact Person"}),e.jsx("input",{id:"contactPerson",name:"contactPerson",className:"input",value:n.contactPerson||"",onChange:l})]})]})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Compliance & Status"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(t,{container:!0,spacing:2,children:[e.jsxs(t,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"email",children:"Email Address"}),e.jsx("input",{id:"email",name:"email",type:"email",className:"input",value:n.email||"",onChange:l})]}),e.jsxs(t,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsx("input",{id:"phoneNumber",name:"phoneNumber",className:"input",value:n.phoneNumber||"",onChange:l})]}),e.jsxs(t,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"address",children:"Address"}),e.jsx("textarea",{id:"address",name:"address",className:"input",rows:3,value:n.address||"",onChange:l})]}),e.jsxs(t,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"vendorRating",children:"Vendor Rating"}),e.jsx("input",{type:"number",id:"vendorRating",name:"vendorRating",className:"input",value:n.vendorRating||"",onChange:l,min:0,max:5})]}),e.jsxs(t,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"complianceStatus",children:"Compliance Status"}),e.jsxs("select",{id:"complianceStatus",name:"complianceStatus",className:"input",value:n.complianceStatus,onChange:l,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Compliant",children:"Compliant"}),e.jsx("option",{value:"Non-Compliant",children:"Non-Compliant"})]})]})]})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Approval & Payment"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(t,{container:!0,spacing:2,children:[e.jsxs(t,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvedSupplier",children:"Approved Supplier"}),e.jsxs("select",{id:"approvedSupplier",name:"approvedSupplier",className:"input",value:n.approvedSupplier||"",onChange:l,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"true",children:"Yes"}),e.jsx("option",{value:"false",children:"No"})]})]}),e.jsxs(t,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"paymentTerms",children:"Payment Terms"}),e.jsx("input",{id:"paymentTerms",name:"paymentTerms",className:"input",value:n.paymentTerms||"",onChange:l})]}),e.jsxs(t,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"contractExpiryDate",children:"Contract Expiry Date"}),e.jsx("input",{type:"date",id:"contractExpiryDate",name:"contractExpiryDate",className:"input",value:n.contractExpiryDate||"",onChange:l})]})]})]})]})})]}),e.jsxs(ue,{children:[e.jsx(J,{onClick:N,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(J,{variant:"outlined",onClick:X,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:b?"Update Vendor":"Submit Vendor"})]})]})]})};export{Ee as default};
