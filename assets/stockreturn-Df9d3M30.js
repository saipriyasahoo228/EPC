import{r as a,j as e,T as m,x as S,S as T,D as A}from"./main-BIxdd69i.js";import{C as Z}from"./Close-D340Gps3.js";import{g as ee,h as te,i as re,j as se,k as ne}from"./inventory-Bcy74QM6.js";import{G as n}from"./Grid-BnZNKmae.js";import{P as B,I as c,D as oe,f as ae,g as ie,h as le,e as E}from"./DialogTitle-D59uELMl.js";import{T as F,a as M,b as p,c as s,d as N}from"./TableRow-D8X36zJO.js";import{A as ce}from"./AddCircle-Bn9h5MaP.js";import{A as de,a as ue}from"./ArrowForwardIos-DapvvZ-0.js";import{T as xe}from"./TableContainer-1Xqyy-f8.js";import{E as he}from"./Edit-BJV-h6Li.js";import{D as je}from"./Delete-BHKbKfZ2.js";import{M as me,a as pe}from"./minimize-2-Dl_U24Qm.js";const Te=()=>{const h="inventory",[g,Q]=a.useState(""),[b,P]=a.useState(""),[L,j]=a.useState(!1),[ge,$]=a.useState(""),[z,O]=a.useState([]),[C,D]=a.useState([]),[d,w]=a.useState(null),y=2,[u,f]=a.useState(1),[I,U]=a.useState(!1),[o,x]=a.useState({itemId:"",returnQuantity:"",returnReason:"",returnBy:"",returnDate:"",stockAdjustmentID:"",adjustmentType:"",wastageReason:""}),W=()=>{U(!I)},_=z.filter(t=>{var r;return(r=t.item_id)==null?void 0:r.toString().toLowerCase().includes(g.toLowerCase())}),v=Math.ceil(_.length/y)||1,q=_.slice((u-1)*y,u*y);a.useEffect(()=>{f(1)},[g]),a.useEffect(()=>{(async()=>{try{const r=await ee();O(r)}catch(r){console.error("Failed to fetch inventory items:",r)}})()},[]);const R=async()=>{try{const t=await te();D(t)}catch(t){console.error("Failed to load stock returns:",t)}};a.useEffect(()=>{R()},[]);const G=async t=>{if(window.confirm(`Are you sure you want to delete Return ID: ${t}?`))try{await re(t),alert(`✅ Return ${t} deleted successfully.`),R()}catch(i){console.error("❌ Error deleting return:",i),alert(`❌ Failed to delete return: ${i.message}`)}},H=C.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(b.toLowerCase()))),Y=t=>{const r=new Date().getFullYear(),i=String(C.length+1).padStart(4,"0");$(t),x({itemId:t,stockReturnId:`RET-${r}-${i}`}),j(!0)},k=()=>{x({}),j(!1)},l=t=>{const{name:r,value:i}=t.target;x(X=>({...X,[r]:i}))},K=()=>{x({itemId:"",returnQuantity:"",returnReason:"",returnBy:"",returnDate:"",stockAdjustmentID:"",adjustmentType:"",wastageReason:""}),w(null)},J=t=>{w(t.return_id),x({itemId:t.item,returnQuantity:t.return_quantity,returnReason:t.return_reason,returnBy:t.returned_by,returnDate:t.return_date,stockAdjustmentID:t.stock_adjustment_id,adjustmentType:t.adjustment_type,wastageReason:t.wastage_reason||""}),j(!0)},V=async()=>{const t={item:o.itemId,return_quantity:o.returnQuantity,return_reason:o.returnReason,returned_by:o.returnBy,return_date:o.returnDate,stock_adjustment_id:o.stockAdjustmentID,adjustment_type:o.adjustmentType.toLowerCase(),wastage_reason:o.wastageReason||""};try{if(d)await se(d,t),D(r=>r.map(i=>i.return_id===d?{...i,...t}:i)),alert(`✅ Stock return ${d} updated successfully!`);else{const r=await ne(t);R(),alert(`✅ Stock return ${r.return_id} created successfully!`)}j(!1),K()}catch(r){console.error("❌ Error submitting stock return:",r)}};return e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Stock Returns"}),e.jsx(n,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(B,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(m,{variant:"h6",gutterBottom:!0,children:"ITEM RECORDS"}),e.jsx(S,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Item ID",value:g,onChange:t=>Q(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(F,{children:[e.jsx(M,{children:e.jsxs(p,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Item ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(N,{children:q.map((t,r)=>e.jsxs(p,{children:[e.jsx(s,{children:t.item_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(T,{slug:h,action:"can_create",children:e.jsx(c,{onClick:()=>Y(t.item_id),color:"primary",children:e.jsx(ce,{sx:{color:"#7267ef"}})})})})]},r))})]}),e.jsxs(S,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(c,{disabled:u===1,onClick:()=>f(t=>t-1),children:e.jsx(de,{})}),e.jsxs(m,{variant:"body2",sx:{mx:2},children:["Page ",u," of ",v]}),e.jsx(c,{disabled:u>=v,onClick:()=>f(t=>t+1),children:e.jsx(ue,{})})]})]})})}),e.jsx(n,{container:!0,spacing:2,children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(B,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(m,{variant:"h6",gutterBottom:!0,children:"SUBMITTED STOCK RETURNS"}),e.jsx("input",{type:"text",placeholder:"Search Stock Returns",value:b,onChange:t=>P(t.target.value),className:"input",style:{width:"100%",padding:"8px",marginBottom:"1rem",border:"1px solid #ccc",borderRadius:4}}),e.jsx(xe,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(F,{stickyHeader:!0,children:[e.jsx(M,{children:e.jsxs(p,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Item ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock Return ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Returned Quantity"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Return Reason"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Returned By"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Returned Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock Adjustment ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Adjustment Type"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Wastage Reason"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(N,{children:H.map((t,r)=>e.jsxs(p,{children:[e.jsx(s,{children:t.item}),e.jsx(s,{children:t.return_id}),e.jsx(s,{children:t.return_quantity}),e.jsx(s,{children:t.return_reason}),e.jsx(s,{children:t.returned_by}),e.jsx(s,{children:t.return_date}),e.jsx(s,{children:t.stock_adjustment_id}),e.jsx(s,{children:t.adjustment_type}),e.jsx(s,{children:t.wastage_reason}),e.jsxs(s,{children:[e.jsx(A,{slug:h,action:"can_update",children:e.jsx(c,{color:"warning",onClick:()=>J(t),children:e.jsx(he,{sx:{color:"orange"}})})}),e.jsx(T,{slug:h,action:"can_delete",children:e.jsx(c,{color:"error",onClick:()=>G(t.return_id),children:e.jsx(je,{sx:{color:"red"}})})})]})]},r))})]})})]})})}),e.jsxs(oe,{open:L,onClose:k,fullWidth:!0,maxWidth:"xl",PaperProps:{style:I?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(ae,{children:"Enter Stock Management Details"}),e.jsxs(ie,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(c,{"aria-label":"toggle-size",onClick:W,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:I?e.jsx(me,{}):e.jsx(pe,{})}),e.jsx(c,{"aria-label":"close",onClick:k,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(Z,{})}),e.jsx(S,{component:"form",sx:{mt:2},children:e.jsxs(n,{container:!0,spacing:3,direction:"column",children:[e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Stock Returns Id's "}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"itemId",children:"Item ID"}),e.jsx("input",{id:"itemId",name:"itemId",className:"input",value:o.itemId||"",disabled:!0})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockReturnId",children:"Stock Return Id"}),e.jsx("input",{id:"stockReturnId",name:"stockReturnId",className:"input",value:o.stockReturnId||"",disabled:!0})]})]})]}),e.jsxs(n,{item:!0,xs:10,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Stock Return Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"returnQuantity",children:"Return Quantity"}),e.jsx("input",{id:"returnQuantity",name:"returnQuantity",className:"input",value:o.returnQuantity||"",onChange:l,type:"number"})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"returnReason",children:"Return Reason"}),e.jsx("textarea",{id:"returnReason",name:"returnReason",className:"input",rows:3,value:o.returnReason||"",onChange:l})]})]}),e.jsxs(n,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"returnBy",children:"Return By"}),e.jsx("input",{id:"returnBy",name:"returnBy",className:"input",value:o.returnBy||"",onChange:l})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"returnDate",children:"Return Date"}),e.jsx("input",{type:"date",id:"returnDate",name:"returnDate",className:"input",value:o.returnDate||"",onChange:l})]})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Stock Adjustment Info"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockAdjustmentID",children:"Stock Adjustment ID"}),e.jsx("input",{id:"stockAdjustmentID",name:"stockAdjustmentID",className:"input",value:o.stockAdjustmentID||"",onChange:l})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"adjustmentType",children:"Adjustment Type"}),e.jsxs("select",{id:"adjustmentType",name:"adjustmentType",className:"input",value:o.adjustmentType||"",onChange:l,children:[e.jsx("option",{value:"",children:"-- Select Adjustment Type --"}),e.jsx("option",{value:"Addition",children:"Addition"}),e.jsx("option",{value:"Deduction",children:"Deduction"}),e.jsx("option",{value:"Scrap",children:"Scrap"})]})]})]}),e.jsx(n,{container:!0,spacing:2,sx:{mt:1},children:e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"wastageReason",children:"Wastage Reason"}),e.jsx("input",{id:"wastageReason",name:"wastageReason",className:"input",value:o.wastageReason||"",onChange:l})]})})]})]})})]}),e.jsxs(le,{children:[e.jsx(E,{onClick:k,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(A,{slug:h,action:d?"can_update":"can_create",children:e.jsx(E,{variant:"outlined",onClick:V,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:d?"Update Return":"Submit Return"})})]})]})]})};export{Te as default};
