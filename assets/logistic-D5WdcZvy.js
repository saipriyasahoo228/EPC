import{r as o,j as e,T as I,z as A}from"./main-IxGEKZMA.js";import{C as W}from"./Close-DoqWsXz3.js";import{a as Y,l as z,m as J,n as K,o as X}from"./procurement-DNGl8bgG.js";import{G as a}from"./Grid-C72N-tAO.js";import{t as N,T,h as F,i as g,j as s,k as O,I as v,D as Z,f as ee,g as re,e as R}from"./TableRow-CRAT5KT_.js";import{A as te}from"./AddCircle-DWIRGPUh.js";import{T as se}from"./TableContainer-BaU58JEj.js";import{E as ie}from"./Edit-g2hjeeYC.js";import{D as ae}from"./Delete-cHl_EB0l.js";import{D as le}from"./DialogActions-D5wP0Mt-.js";import"./Transition-C29ZPDdz.js";const fe=()=>{const[y,w]=o.useState(""),[_,E]=o.useState(""),[d,b]=o.useState([]),[P,k]=o.useState([]),[p,B]=o.useState([]),[C,S]=o.useState(!1),[oe,L]=o.useState(null),[$,u]=o.useState(!1),[M,ce]=o.useState([]),[i,x]=o.useState({projectId:"",purchaseOrderId:"",logisticId:"",transportId:"",vehicleDetails:"",driverName:"",dispatchDate:"",expectedArrivalDate:"",actualArrivalDate:"",deliveryLocation:"",shippingStatus:"",damageReport:""});o.useEffect(()=>{(async()=>{try{const t=await Y();B(t),console.log("✅ Material procurements:",t)}catch(t){console.error("❌ Failed to fetch material procurements:",t)}})()},[]);const D=async()=>{try{const r=await z();b(r);const t=r.map(l=>({logisticId:l.logistics_id,transportId:l.transport_provider_id,vehicleDetails:l.vehicle_details,driverName:l.driver_name,dispatchDate:l.dispatch_date,expectedArrivalDate:l.expected_arrival_date,actualArrivalDate:l.actual_arrival_date,deliveryLocation:l.delivery_location,shippingStatus:l.shipping_status,damageReport:l.damage_report}));k(t)}catch(r){console.error("Failed to load logistics:",r)}};o.useEffect(()=>{D()},[]);const G=()=>{const r=new Date().getFullYear(),t=(d==null?void 0:d.reduce((c,h)=>{var m;if((m=h.logistics_id)!=null&&m.startsWith(`LOG-${r}-`)){const j=parseInt(h.logistics_id.split("-")[2],10);return j>c?j:c}return c},0))||0,l=String(t+1).padStart(3,"0");return`LOG-${r}-${l}`},H=r=>{const t=p==null?void 0:p[r];t&&(L(r),x({projectId:t.project,procurementId:t.procurement_id,purchaseOrderId:t.purchase_order,logisticId:G(),transportId:"",vehicleDetails:"",driverName:"",dispatchDate:"",expectedArrivalDate:"",actualArrivalDate:"",deliveryLocation:"",shippingStatus:"",damageReport:""}),u(!0))},f=()=>{u(!1)},n=r=>{const{name:t,value:l}=r.target;x(c=>{const h={...c,[t]:l};if(t==="quantity"||t==="unitPrice"){const m=parseFloat(h.quantity)||0,j=parseFloat(h.unitPrice)||0,Q=(m*j).toFixed(2);h.totalCost=Q}return h})},q=async()=>{try{const r={po_number:i.purchaseOrderId,transport_provider_id:i.transportId,vehicle_details:i.vehicleDetails,driver_name:i.driverName,dispatch_date:i.dispatchDate,expected_arrival_date:i.expectedArrivalDate,actual_arrival_date:i.actualArrivalDate||null,delivery_location:i.deliveryLocation,shipping_status:i.shippingStatus||"In Transit",damage_report:i.damageReport||""};C?(await K(i.logisticId,r),alert("Logistics details updated successfully!")):(await X({...r,logistics_id:i.logisticId}),alert("Logistics details submitted successfully!")),x({projectId:"",procurementId:"",purchaseOrderId:"",logisticId:"",transportId:"",vehicleDetails:"",driverName:"",dispatchDate:"",expectedArrivalDate:"",actualArrivalDate:"",deliveryLocation:"",shippingStatus:"In Transit",damageReport:""}),S(!1),u(!1),D()}catch(r){console.error("❌ Error submitting logistics:",r),alert(`Error: ${r.message}`)}},U=async(r,t)=>{if(window.confirm(`Are you sure you want to delete logistics ID: ${r}?`))try{await J(r);const c=[...d];c.splice(t,1),b(c),alert("✅ Logistics deleted successfully!"),D()}catch(c){console.error("❌ Error deleting logistics:",c),alert("❌ Failed to delete logistics.")}},V=r=>{const t=d==null?void 0:d[r];t&&(L(r),S(!0),x({purchaseOrderId:t.po_number||"",logisticId:t.logistics_id||"",transportId:t.transport_provider_id||"",vehicleDetails:t.vehicle_details||"",driverName:t.driver_name||"",dispatchDate:t.dispatch_date||"",expectedArrivalDate:t.expected_arrival_date||"",actualArrivalDate:t.actual_arrival_date||"",deliveryLocation:t.delivery_location||"",shippingStatus:t.shipping_status||"In Transit",damageReport:t.damage_report||""}),u(!0))};return M.filter(r=>Object.values(r).some(t=>t&&t.toString().toLowerCase().includes(_.toLowerCase()))),e.jsxs(e.Fragment,{children:[e.jsx(I,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Logistic Management"}),e.jsx(a,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(N,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(I,{variant:"h6",gutterBottom:!0,children:"PURCHASE ORDERS"}),e.jsx(A,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Purchase Orders",value:y,onChange:r=>w(r.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(g,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Procurement ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Purchase Order ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(O,{children:p.filter(r=>`${r.project_id} ${r.procurement_id} ${r.purchase_order_id}`.toLowerCase().includes(y.toLowerCase())).map((r,t)=>e.jsxs(g,{children:[e.jsx(s,{children:r.project}),e.jsx(s,{children:r.procurement_id}),e.jsx(s,{children:r.purchase_order}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(v,{onClick:()=>H(t),color:"primary",children:e.jsx(te,{sx:{color:"#7267ef"}})})})]},t))})]})]})})}),e.jsx(a,{container:!0,spacing:2,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(N,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(I,{variant:"h6",gutterBottom:!0,children:"SUBMITTED LOGISTIC RECORDS"}),e.jsx("input",{type:"text",placeholder:"Search Logistic Management Here..",value:_,onChange:r=>E(r.target.value),className:"input"}),e.jsx(se,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(T,{stickyHeader:!0,children:[e.jsx(F,{children:e.jsxs(g,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Logistic ID "})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Transport Provider Id "})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Vehicle Details"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Driver Name"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Dispatch Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Expected Arrival Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Actual Arrival Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Delivery Location"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Shipping Status"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Damage Report"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(O,{children:P.map((r,t)=>e.jsxs(g,{children:[e.jsx(s,{children:r.logisticId}),e.jsx(s,{children:r.transportId}),e.jsx(s,{children:r.vehicleDetails}),e.jsx(s,{children:r.driverName}),e.jsx(s,{children:r.dispatchDate}),e.jsx(s,{children:r.expectedArrivalDate}),e.jsx(s,{children:r.actualArrivalDate}),e.jsx(s,{children:r.deliveryLocation}),e.jsx(s,{children:r.shippingStatus}),e.jsx(s,{children:r.damageReport}),e.jsxs(s,{children:[e.jsx(v,{color:"warning",onClick:()=>V(t),children:e.jsx(ie,{sx:{color:"orange"}})}),e.jsx(v,{color:"error",onClick:()=>U(r.logisticId,t),children:e.jsx(ae,{sx:{color:"red"}})})]})]},t))})]})})]})})}),e.jsxs(Z,{open:$,onClose:f,fullWidth:!0,children:[e.jsx(ee,{children:"Enter Logistic Details"}),e.jsxs(re,{sx:{position:"relative"},children:[e.jsx(v,{"aria-label":"close",onClick:f,sx:{position:"absolute",right:8,top:8,color:r=>r.palette.grey[500]},children:e.jsx(W,{})}),e.jsx(A,{component:"form",sx:{mt:2},children:e.jsxs(a,{container:!0,spacing:3,direction:"column",children:[e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Purchase Order & Vendor info.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"purchaseOrderId",children:"Purchase Order ID"}),e.jsx("input",{id:"purchaseOrderId",name:"purchaseOrderId",className:"input",value:i.purchaseOrderId||"",disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",name:"projectId",className:"input",value:i.projectId||"",disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"procurementId",children:"Procurement ID"}),e.jsx("input",{id:"procurementId",name:"procurementId",className:"input",value:i.procurementId||"",disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"logisticId",children:"Logistic ID"}),e.jsx("input",{id:"logisticId",name:"logisticId",className:"input",value:i.logisticId||"",disabled:!0})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Transport Information.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"transportId",children:"Transport provider Id"}),e.jsx("input",{id:"transportId",name:"transportId",className:"input",value:i.transportId||"",onChange:n})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"vehicleDetails",children:"Vehicle Details"}),e.jsx("input",{id:"vehicleDetails",name:"vehicleDetails",className:"input",value:i.vehicleDetails||"",onChange:n})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"driverName",children:"Driver Name"}),e.jsx("input",{id:"driverName",name:"driverName",className:"input",value:i.driverName||"",onChange:n})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Shipping Status.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"dispatchDate",children:"Dispatch Date"}),e.jsx("input",{type:"date",id:"dispatchDate",name:"dispatchDate",className:"input",value:i.dispatchDate||"",onChange:n})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"expectedArrivalDate",children:"Expected Arrival Date"}),e.jsx("input",{type:"date",id:"expectedArrivalDate",name:"expectedArrivalDate",className:"input",value:i.expectedArrivalDate||"",onChange:n})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"actualArrivalDate",children:"Actual Arrival Date"}),e.jsx("input",{type:"date",id:"actualArrivalDate",name:"actualArrivalDate",className:"input",value:i.actualArrivalDate||"",onChange:n})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"deliveryLocation",children:"Delivery Location"}),e.jsx("input",{id:"deliveryLocation",name:"deliveryLocation",className:"input",value:i.deliveryLocation||"",onChange:n})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"shippingStatus",children:"Shipping Status"}),e.jsxs("select",{id:"shippingStatus",name:"shippingStatus",className:"input",value:i.shippingStatus||"",onChange:n,children:[e.jsx("option",{value:"",children:"Select Status"})," ",e.jsx("option",{value:"In Transit",children:"In Transit"}),e.jsx("option",{value:"Delivered",children:"Delivered "}),e.jsx("option",{value:"Delayed",children:"Delayed"}),e.jsx("option",{value:"Canceled",children:"Canceled"})]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"damageReport",children:"Damage Report"}),e.jsx("input",{id:"damageReport",name:"damageReport",className:"input",value:i.damageReport||"",onChange:n})]})]})]})]})})]}),e.jsxs(le,{children:[e.jsx(R,{onClick:f,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(R,{variant:"outlined",onClick:q,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:C?"Update Logistic Details":"Submit Logistic Details"})]})]})]})};export{fe as default};
