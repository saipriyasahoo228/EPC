import{r as l,j as e,S as b,D,T as O}from"./main-BIxdd69i.js";import{E as G}from"./jspdf.plugin.autotable-y_YJgUzU.js";import{C as L}from"./Close-D340Gps3.js";import{m as Q,n as U,o as W,p as z}from"./account-BvsCUQ6Q.js";import{e as h,D as H,f as M,I as y,g as Y,h as q,P as J}from"./DialogTitle-D59uELMl.js";import{G as o}from"./Grid-BnZNKmae.js";import{T as K}from"./Select-CcRDAcIa.js";import{T as V,a as X,b as R,c as a,d as Z}from"./TableRow-D8X36zJO.js";import{E as ee}from"./Edit-BJV-h6Li.js";import{D as te}from"./Delete-BHKbKfZ2.js";import{T as re}from"./TablePagination-B2UmV3Uz.js";import"./index-E3WhgaTq.js";import"./dividerClasses-BHbp2fTT.js";import"./KeyboardArrowRight-H8WcZOfv.js";import"./MenuItem-BSRQ3XbJ.js";import"./Toolbar-CZiWvmFk.js";const ye=()=>{const i="account_ledger",[v,w]=l.useState(""),[_,m]=l.useState(!1),[d,C]=l.useState(null),[S,T]=l.useState([]),[n,p]=l.useState({reportType:"",generatedDate:"",preparedBy:"",approvalStatus:"",comments:""}),[j,P]=l.useState(0),[u,I]=l.useState(5),g=async()=>{try{const t=await Q();T(t)}catch(t){console.error("Error fetching reports:",t)}};l.useEffect(()=>{g()},[]);const F=(t=null)=>{C(t),m(!0),p(t?{...t}:{reportType:"",generatedDate:"",preparedBy:"",approvalStatus:"",comments:""})},x=()=>m(!1),E=t=>{C(t),p({reportId:t.report_id||"",reportType:t.report_type||"",generatedDate:t.generated_date||"",preparedBy:t.prepared_by||"",approvalStatus:t.approval_status||"",comments:t.comments||""}),m(!0)},c=t=>{const{name:r,value:s}=t.target;p($=>({...$,[r]:s}))},B=()=>{const t=new Date().getFullYear(),r=S.length+1;return`REP-${t}-${String(r).padStart(4,"0")}`},k=async()=>{try{const t={report_type:n.reportType,generated_date:n.generatedDate,prepared_by:n.preparedBy,approval_status:n.approvalStatus,comments:n.comments};if(d){const r=await U(d.report_id,t);alert(`Report ${r.report_id} updated successfully`)}else{const r=await W(t);alert(`Report ${r.report_id} created successfully`)}x(),g()}catch(t){console.error("Error saving financial report:",t),alert("Something went wrong while saving the financial report")}},A=async t=>{if(window.confirm(`Are you sure you want to delete Financial Report: ${t}?`))try{await z(t),g(),alert(`Report ${t} deleted successfully`)}catch(s){console.error("Error deleting report:",s),alert("Failed to delete report")}},f=S.filter(t=>Object.values(t).some(r=>r.toString().toLowerCase().includes(v.toLowerCase()))),N=()=>{const t=new G,r=f.map(s=>[s.reportId,s.reportType,s.generatedDate,s.preparedBy,s.approvalStatus,s.comments]);t.autoTable({head:[["ID","Type","Date","Prepared By","Status","Comments"]],body:r}),t.save("financial_reports.pdf")};return e.jsxs("div",{children:[e.jsx(b,{slug:i,action:"can_create",children:e.jsx(h,{variant:"contained",sx:{mt:4,mb:2,backgroundColor:"#7267ef"},onClick:()=>F(),children:"Add Financial Report"})}),e.jsxs(H,{open:_,onClose:x,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(M,{sx:{backgroundColor:"#f3f3f3",color:"#7267ef",display:"flex",justifyContent:"space-between"},children:[d?"Edit Financial Report":"Add Financial Report",e.jsx(y,{onClick:x,sx:{color:"#7267ef"},children:e.jsx(L,{})})]}),e.jsx(Y,{children:e.jsxs(o,{container:!0,spacing:2,direction:"column",sx:{mt:1},children:[e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Report ID (Auto)"}),e.jsx("input",{className:"input",disabled:!0,value:n.reportId||B()})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Report Type"}),e.jsxs("select",{className:"input",name:"reportType",value:n.reportType,onChange:c,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Balance Sheet",children:"Balance Sheet"}),e.jsx("option",{value:"Income Statement",children:"Income Statement"}),e.jsx("option",{value:"Cash Flow Statement",children:"Cash Flow Statement"})]})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Generated Date"}),e.jsx("input",{type:"date",className:"input",name:"generatedDate",value:n.generatedDate,onChange:c})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Prepared By"}),e.jsx("input",{className:"input",name:"preparedBy",value:n.preparedBy,onChange:c})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Approval Status"}),e.jsxs("select",{className:"input",name:"approvalStatus",value:n.approvalStatus,onChange:c,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Comments"}),e.jsx(K,{name:"comments",value:n.comments,onChange:c,className:"input",minRows:3,placeholder:"Enter comments here..."})]})]})}),e.jsxs(q,{sx:{pr:3,pb:2},children:[e.jsx(h,{onClick:x,sx:{outline:"2px solid #800000",color:"#800000"},children:"Cancel"}),e.jsx(D,{slug:i,action:d?"can_update":"can_create",children:e.jsx(h,{variant:"outlined",onClick:k,sx:{borderColor:"#7267ef",color:"#7267ef"},children:"Submit"})})]})]}),e.jsxs(J,{sx:{mt:4,p:2,border:"1px solid #ccc"},children:[e.jsxs(o,{container:!0,justifyContent:"space-between",alignItems:"center",children:[e.jsx(o,{item:!0,children:e.jsx(O,{variant:"h6",gutterBottom:!0,sx:{color:"#7267ef"},children:"Financial Reports"})}),e.jsx(o,{item:!0,children:e.jsx(h,{onClick:N,sx:{backgroundColor:"#7267ef",color:"#fff",mt:2,mb:2},children:"Export PDF"})})]}),e.jsx("input",{type:"text",placeholder:"Search Reports...",value:v,onChange:t=>w(t.target.value),className:"input"}),e.jsxs(V,{children:[e.jsx(X,{children:e.jsxs(R,{children:[e.jsx(a,{sx:{color:"#7267ef"},children:"ID"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Type"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Date"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Prepared By"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Status"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Comments"}),e.jsx(a,{sx:{color:"#660000"},children:"Actions"})]})}),e.jsx(Z,{children:f.slice(j*u,j*u+u).map((t,r)=>e.jsxs(R,{children:[e.jsx(a,{children:t.report_id}),e.jsx(a,{children:t.report_type}),e.jsx(a,{children:t.generated_date}),e.jsx(a,{children:t.prepared_by}),e.jsx(a,{children:t.approval_status}),e.jsx(a,{children:t.comments}),e.jsxs(a,{children:[e.jsx(D,{slug:i,action:"can_update",children:e.jsx(y,{color:"warning",onClick:()=>E(t),children:e.jsx(ee,{sx:{color:"orange"}})})}),e.jsx(b,{slug:i,action:"can_delete",children:e.jsx(y,{color:"error",onClick:()=>A(t.report_id),children:e.jsx(te,{sx:{color:"red"}})})})]})]},r))})]}),e.jsx(re,{rowsPerPageOptions:[5,10,25],component:"div",count:f.length,rowsPerPage:u,page:j,onPageChange:(t,r)=>P(r),onRowsPerPageChange:t=>I(parseInt(t.target.value,10))})]})]})};export{ye as default};
