import{r as o,j as e,T as C,x as A,S as Q,D as R}from"./main-BIxdd69i.js";import{C as X}from"./Close-D340Gps3.js";import{g as Z}from"./engineering-4VzvUWDc.js";import{n as q,o as ee,p as te,q as se}from"./construction-TCh-rxln.js";import{G as n}from"./Grid-BnZNKmae.js";import{P as E,I as d,D as ne,f as re,g as ie,h as oe,e as F}from"./DialogTitle-D59uELMl.js";import{T as N,a as P,b as u,c as s,d as k}from"./TableRow-D8X36zJO.js";import{A as le}from"./AddCircle-Bn9h5MaP.js";import{T as ce}from"./TableContainer-1Xqyy-f8.js";import{E as ae}from"./Edit-BJV-h6Li.js";import{D as de}from"./Delete-BHKbKfZ2.js";import{M as xe,a as pe}from"./minimize-2-Dl_U24Qm.js";const _e=()=>{const x="construction",[D,M]=o.useState(""),[h,L]=o.useState(""),[B,j]=o.useState(!1),[v,S]=o.useState(""),[m,O]=o.useState([]),[b,_]=o.useState(!1),[ue,T]=o.useState(null),[z,U]=o.useState([]),[$,Y]=o.useState([]),[f,w]=o.useState(null),[g,G]=o.useState(!1),[i,a]=o.useState({qcId:"",projectId:"",inspectionDate:"",inspectionType:"",inspectorID:"",testResult:"",complianceStandards:"",defectIdentified:"",correctiveAction:"",approvalStatus:"",nextInspectionDate:""}),H=()=>{G(!g)};o.useEffect(()=>{(async()=>{try{const r=await Z();U(r)}catch(r){console.error("Error fetching accepted projects:",r)}})()},[]);const y=async()=>{try{const t=await q();O(t),console.log("✅ Quality Control records:",t)}catch(t){console.error("❌ Failed to fetch quality control records:",t)}};o.useEffect(()=>{y()},[]);const W=t=>{S(t);const r=new Date().getFullYear(),I=(m.length+1).toString().padStart(4,"0");a({qualitycontrolID:`QC-${r}-${I}`,projectId:t}),_(!1),T(null),j(!0)},J=t=>{a({qualitycontrolID:t.qc_id,projectId:t.project,inspectionDate:t.inspection_date,inspectionType:t.inspection_type,inspectorID:t.inspector_id,testResult:t.test_results,complianceStandards:t.compliance_standard,defectIdentified:t.defects_identified,correctiveAction:t.corrective_actions,approvalStatus:t.approval_status,nextInspectionDate:t.next_inspection_date}),S(t.project),w(t.qc_id),j(!0)},K=async t=>{if(window.confirm("Are you sure you want to delete this record?"))try{await ee(t),alert("✅ Record deleted successfully"),await y()}catch(l){console.error("❌ Failed to delete record:",l),alert("❌ Failed to delete record")}},p=()=>{j(!1),a({}),_(!1),T(null)},c=t=>{const{name:r,value:l}=t.target;a(I=>({...I,[r]:l}))},V=async()=>{var t;try{const r={project:v,inspection_date:i.inspectionDate,inspection_type:i.inspectionType,inspector_id:i.inspectorID,test_results:i.testResult,compliance_standard:i.complianceStandards,defects_identified:i.defectIdentified||"",corrective_actions:i.correctiveAction||"",approval_status:i.approvalStatus||"pending",next_inspection_date:i.nextInspectionDate||null};let l;f?(l=await te(f,r),alert(`✏️ Quality Control updated!
QC ID: ${l.qc_id}`)):(l=await se(r),alert(`✅ Quality Control saved!
QC ID: ${l.qc_id}`)),a({}),w(null),p(),y()}catch(r){console.error("❌ Failed to submit Quality Control:",r),alert(`❌ Failed to submit. ${((t=r.response)==null?void 0:t.data)||r.message}`)}};return o.useEffect(()=>{const t=m.filter(r=>Object.values(r).some(l=>l&&l.toString().toLowerCase().includes(h.toLowerCase())));Y(t)},[h,m]),e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Quality Control & Assurance"}),e.jsx(n,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(E,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(C,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(A,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:D,onChange:t=>M(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(N,{children:[e.jsx(P,{children:e.jsxs(u,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(k,{children:z.filter(t=>t.id.toString().toLowerCase().includes(D.toLowerCase())).map((t,r)=>e.jsxs(u,{children:[e.jsx(s,{children:t.project_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(Q,{slug:x,action:"can_create",children:e.jsx(d,{onClick:()=>W(t.project_id),color:"primary",children:e.jsx(le,{sx:{color:"#7267ef"}})})})})]},r))})]})]})})}),e.jsx(n,{container:!0,spacing:2,children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(E,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(C,{variant:"h6",gutterBottom:!0,children:"QUALITY CONTROL & ASSUARANCE DETAILS"}),e.jsx("input",{type:"text",placeholder:"Search Quality Control",value:h,onChange:t=>L(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(ce,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(N,{stickyHeader:!0,children:[e.jsx(P,{children:e.jsxs(u,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Quality Control ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Type"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspector ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Test Results"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance Standards"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Defects Identified"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Corrective Actions"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Status"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Next Inspection Date"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(k,{children:$.map((t,r)=>e.jsxs(u,{children:[e.jsx(s,{children:t.project}),e.jsx(s,{children:t.qc_id}),e.jsx(s,{children:t.inspection_date}),e.jsx(s,{children:t.inspection_type}),e.jsx(s,{children:t.inspector_id}),e.jsx(s,{children:t.test_results}),e.jsx(s,{children:t.compliance_standard}),e.jsx(s,{children:t.defects_identified}),e.jsx(s,{children:t.corrective_actions}),e.jsx(s,{children:t.approval_status}),e.jsx(s,{children:t.next_inspection_date}),e.jsxs(s,{children:[e.jsx(R,{slug:x,action:"can_update",children:e.jsx(d,{onClick:()=>J(t),color:"warning",children:e.jsx(ae,{sx:{color:"orange"}})})}),e.jsx(Q,{slug:x,action:"can_delete",children:e.jsx(d,{onClick:()=>K(t.qc_id),color:"error",children:e.jsx(de,{sx:{color:"red"}})})})]})]},r))})]})})]})})}),e.jsxs(ne,{open:B,onClose:p,fullWidth:!0,maxWidth:"xl",PaperProps:{style:g?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(re,{children:b?"Edit Quality Control & Assurance Details":"Enter Quality Control & Assurance Details"}),e.jsxs(ie,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(d,{"aria-label":"toggle-size",onClick:H,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:g?e.jsx(xe,{}):e.jsx(pe,{})}),e.jsx(d,{"aria-label":"close",onClick:p,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(X,{})}),e.jsx(A,{component:"form",sx:{mt:2},children:e.jsxs(n,{container:!0,spacing:3,direction:"column",children:[e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:v,disabled:!0})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"qualitycontrolID",children:"Quality Assurance ID"}),e.jsx("input",{id:"qualitycontrolID",className:"input",value:i.qualitycontrolID||"",disabled:!0})]})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Inspection Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionDate",children:"Inspection Date"}),e.jsx("input",{type:"date",id:"inspectionDate",name:"inspectionDate",className:"input",value:i.inspectionDate||"",onChange:c})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionType",children:"Inspection Type"}),e.jsx("input",{id:"inspectionType",name:"inspectionType",className:"input",value:i.inspectionType||"",onChange:c})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectorID",children:"Inspector ID"}),e.jsx("input",{id:"inspectorID",name:"inspectorID",className:"input",value:i.inspectorID||"",onChange:c})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"testResult",children:"Test Results"}),e.jsx("input",{id:"testResult",name:"testResult",className:"input",value:i.testResult||"",onChange:c})]})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Compliance Standards & Approval Status"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"complianceStandards",children:"Compliance Standards"}),e.jsx("input",{id:"complianceStandards",name:"complianceStandards",className:"input",value:i.complianceStandards||"",onChange:c})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"defectIdentified",children:"Defects Identified"}),e.jsx("input",{id:"defectIdentified",name:"defectIdentified",className:"input",value:i.defectIdentified||"",onChange:c})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"correctiveAction",children:"Corrective Actions"}),e.jsx("input",{id:"correctiveAction",name:"correctiveAction",className:"input",value:i.correctiveAction||"",onChange:c})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:i.approvalStatus||"",onChange:c,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"rework required",children:"Rework Required"})]})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"nextInspectionDate",children:"Next Inspection Date"}),e.jsx("input",{type:"date",id:"nextInspectionDate",name:"nextInspectionDate",className:"input",value:i.nextInspectionDate||"",onChange:c})]})]})]})]})})]}),e.jsxs(oe,{children:[e.jsx(F,{onClick:p,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(R,{slug:x,action:f?"can_update":"can_create",children:e.jsx(F,{variant:"outlined",onClick:V,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:b?"Update":"Submit"})})]})]})]})};export{_e as default};
