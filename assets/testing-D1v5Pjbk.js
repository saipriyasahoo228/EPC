import{r as c,j as e,T as _,J as M,E as F,S as R,I as m,K as B}from"./main-Skim5IJC.js";import{C as te}from"./Close-BKZ7QrSY.js";import{D as se}from"./Download-C4sxsXoP.js";import{E as re,a as ne}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{g as ie}from"./engineering-BJ3wTiKO.js";import{g as oe,d as ae,u as ce,c as le}from"./commision-Dp7iUYLu.js";import{f as j}from"./date-DdrLtg20.js";import{G as n}from"./Grid-fY_ATwTx.js";import{T as k,a as A,b as p,c as s,d as $}from"./TableRow-B6k_bSOs.js";import{A as de}from"./AddCircle-CJp4DZj3.js";import{B as T,D as xe,a as ue,b as me,c as he}from"./DialogTitle-CvDFHAwp.js";import{T as ge}from"./TableContainer-gCCy6yK7.js";import{E as je}from"./Edit-6vcT2Cu4.js";import{D as pe}from"./Delete-Be1vvbhC.js";import{M as fe,a as De}from"./minimize-2-RCuvNn0X.js";const ke=()=>{const h="commissioning",[f,q]=c.useState(!1),[b,G]=c.useState(""),[C,z]=c.useState(""),[Y,g]=c.useState(!1),[S,I]=c.useState(""),[o,x]=c.useState({}),[D,w]=c.useState([]),[L,v]=c.useState(!1),[ye,P]=c.useState(null),[O,U]=c.useState([]),[u,E]=c.useState(null),W=()=>{q(!f)};c.useEffect(()=>{(async()=>{try{const r=await ie();U(r)}catch(r){console.error("❌ Error fetching projects:",r)}})()},[]),c.useEffect(()=>{N()},[]);const N=async()=>{try{const t=await oe();w(t)}catch(t){console.error("❌ Error fetching testing records:",t)}},H=t=>{I(t);const r=new Date().getFullYear(),a=(D.length+1).toString().padStart(3,"0");x({testingmanagementID:`TST-${r}-${a}`,projectId:t}),v(!1),P(null),g(!0)},J=t=>{x({testingmanagementID:t.testing_id,systemName:t.system_equipment_name,testingDate:t.testing_date,testingBy:t.test_conducted_by,testProcedure:t.test_procedure,performance:t.performance_parameters,defect:t.defects_identified,correction:t.correction_measures,retestDate:t.retest_date,testingStatus:t.testing_status}),E(t.testing_id),I(t.project_id),g(!0)},Q=async t=>{var l,a;if(window.confirm(`Are you sure you want to delete the testing record with ID: ${t}?`))try{const i=await ae(t);i.MSG?alert(`✅ ${i.MSG}
Deleted Testing ID: ${t}`):alert(`✅ Record deleted successfully!
Deleted Testing ID: ${t}`),w(Z=>Z.filter(ee=>ee.testing_id!==t))}catch(i){console.error("❌ Delete failed:",i),alert(`❌ Failed to delete Testing ID: ${t}
${((a=(l=i.response)==null?void 0:l.data)==null?void 0:a.MSG)||i.message||"Unknown error"}`)}},y=()=>{g(!1),x({}),v(!1),P(null)},d=t=>{const{name:r,value:l}=t.target;x(a=>({...a,[r]:l}))},K=async t=>{var r,l;t.preventDefault();try{const a={project_id:S,system_equipment_name:o.systemName,testing_date:o.testingDate,test_conducted_by:o.testingBy,test_procedure:o.testProcedure,performance_parameters:o.performance,defects_identified:o.defect||null,correction_measures:o.correction||null,retest_date:o.retestDate||null,testing_status:o.testingStatus};if(u){const i=await ce(u,a);alert(`✅ Record updated successfully!
Updated Testing ID: ${u}`)}else{const i=await le(a);alert(`✅ Record created successfully!
Generated Testing ID: ${i.Data.testing_id}`)}N(),x({}),E(null),g(!1)}catch(a){console.error("❌ Error saving testing record:",a),alert(`❌ Error: ${((l=(r=a.response)==null?void 0:r.data)==null?void 0:l.MSG)||a.message||"Something went wrong"}`)}},V=D.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(C.toLowerCase()))),X=t=>{const r=new re("l","mm","a4");r.setFontSize(16),r.text("All Testing & Inspection Report",14,15);const l=["Project ID","Testing ID","Equipment Name","Testing Date","Conducted By","Test Procedure","Performance Parameters","Defects Identified","Correction Measures","Retest Date","Testing Status"],a=t.map(i=>[i.project_id,i.testing_id,i.system_equipment_name,j(i.testing_date),i.test_conducted_by,i.test_procedure,i.performance_parameters,i.defects_identified,i.correction_measures,j(i.retest_date)||"-",i.testing_status]);ne(r,{head:[l],body:a,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),r.save("all_testing_inspection_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(_,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Testing & Inspection"}),e.jsx(n,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(M,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(_,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(F,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:b,onChange:t=>G(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(k,{children:[e.jsx(A,{children:e.jsxs(p,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx($,{children:O.filter(t=>{var r;return(r=t.id)==null?void 0:r.toString().toLowerCase().includes(b.toLowerCase())}).map((t,r)=>e.jsxs(p,{children:[e.jsx(s,{children:t.project_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(R,{slug:h,action:"can_create",children:e.jsx(m,{onClick:()=>H(t.project_id),color:"primary",children:e.jsx(de,{sx:{color:"#7267ef"}})})})})]},r))})]})]})})}),e.jsx(n,{container:!0,spacing:2,children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(M,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(T,{startIcon:e.jsx(se,{}),onClick:()=>X(D),children:"Download PDF"}),e.jsx(_,{variant:"h6",gutterBottom:!0,children:"TESTING MANAGEMENT DETAILS"}),e.jsx("input",{type:"text",placeholder:"Search Testing Management",value:C,onChange:t=>z(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(ge,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(k,{stickyHeader:!0,children:[e.jsx(A,{children:e.jsxs(p,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Testing ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Equipment Name"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Testing Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Testing ConductedBy"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Test Procedure"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Performane Parameters"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Defects Identified"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Corrective Measures"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Retest Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Testing Date"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx($,{children:V.map((t,r)=>e.jsxs(p,{children:[e.jsx(s,{children:t.project_id}),e.jsx(s,{children:t.testing_id}),e.jsx(s,{children:t.system_equipment_name}),e.jsx(s,{children:j(t.testing_date)}),e.jsx(s,{children:t.test_conducted_by}),e.jsx(s,{children:t.test_procedure}),e.jsx(s,{children:t.performance_parameters}),e.jsx(s,{children:t.defects_identified}),e.jsx(s,{children:t.correction_measures}),e.jsx(s,{children:j(t.retest_date)||"-"}),e.jsx(s,{children:t.testing_status}),e.jsxs(s,{children:[e.jsx(B,{slug:h,action:"can_update",children:e.jsx(m,{onClick:()=>J(t),color:"warning",children:e.jsx(je,{sx:{color:"orange"}})})}),e.jsx(R,{slug:h,action:"can_delete",children:e.jsx(m,{onClick:()=>Q(t.testing_id),color:"error",children:e.jsx(pe,{sx:{color:"red"}})})})]})]},r))})]})})]})})}),e.jsxs(xe,{open:Y,onClose:y,fullWidth:!0,maxWidth:"xl",PaperProps:{style:f?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(ue,{children:L?"Edit Testing Management Details":"Enter Testing Management Details"}),e.jsxs(me,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(m,{"aria-label":"toggle-size",onClick:W,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:f?e.jsx(fe,{}):e.jsx(De,{})}),e.jsx(m,{"aria-label":"close",onClick:y,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(te,{})}),e.jsx(F,{component:"form",sx:{mt:2},children:e.jsxs(n,{container:!0,spacing:3,direction:"column",children:[e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:S,disabled:!0})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"testingmanagementID",children:"Testing ID"}),e.jsx("input",{id:"testingmanagementID",className:"input",value:o.testingmanagementID||"",disabled:!0})]})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Testing & Equipment Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"systemName",children:"System/Equipment Name"}),e.jsx("input",{id:"systemName",name:"systemName",className:"input",value:o.systemName||"",onChange:d})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"testingDate",children:"Testing Date"}),e.jsx("input",{type:"date",id:"testingDate",name:"testingDate",className:"input",value:o.testingDate||"",onChange:d})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"testingBy",children:"Testing CoductedBy"}),e.jsx("input",{id:"testingBy",name:"testingBy",className:"input",value:o.testingBy||"",onChange:d})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"testProcedure",children:"Test Procedure"}),e.jsx("input",{id:"testProcedure",name:"testProcedure",className:"input",value:o.testProcedure||"",onChange:d})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"performance",children:"Performance Parameters"}),e.jsx("input",{id:"performance",name:"performance",className:"input",value:o.performance||"",onChange:d})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"defect",children:"Defects Identified"}),e.jsx("input",{id:"defect",name:"defect",className:"input",value:o.defect||"",onChange:d})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Correction Measure & Testing Status"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"correction",children:"Correction Measure"}),e.jsx("input",{id:"correction",name:"correction",className:"input",value:o.correction||"",onChange:d})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"retestDate",children:"Retest Date"}),e.jsx("input",{type:"date",id:"retestDate",name:"retestDate",className:"input",value:o.retestDate||"",onChange:d})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"testingStatus",children:"Testing Status"}),e.jsxs("select",{id:"testingStatus",name:"testingStatus",className:"input",value:o.testingStatus||"",onChange:d,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Passed",children:"Passed"}),e.jsx("option",{value:"Failed",children:"Failed"}),e.jsx("option",{value:"Retest Required",children:"Retest Required"})]})]})]})]})]})]})})]}),e.jsxs(he,{children:[e.jsx(T,{onClick:y,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(B,{slug:h,action:u?"can_update":"can_create",children:e.jsx(T,{variant:"outlined",onClick:K,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:u?"Update":"Submit"})})]})]})]})};export{ke as default};
