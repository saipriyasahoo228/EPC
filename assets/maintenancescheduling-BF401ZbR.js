import{r,j as e,T as j,z as b}from"./main-IxGEKZMA.js";import{C as W}from"./Close-DoqWsXz3.js";import{g as J,a as _,b as Y,e as z}from"./maintenance-CWRDLbWQ.js";import{G as i}from"./Grid-C72N-tAO.js";import{t as I,T as w,h as T,i as u,j as t,k,I as x,D as U,f as K,g as V,e as A}from"./TableRow-CRAT5KT_.js";import{A as X}from"./AddCircle-DWIRGPUh.js";import{T as Z}from"./TableContainer-BaU58JEj.js";import{E as ee}from"./Edit-g2hjeeYC.js";import{D as se}from"./Delete-cHl_EB0l.js";import{D as te}from"./DialogActions-D5wP0Mt-.js";import"./Transition-C29ZPDdz.js";const je=()=>{const[g,E]=r.useState(""),[f,F]=r.useState(""),[M,p]=r.useState(!1),[ne,N]=r.useState(""),[n,d]=r.useState({}),[y,D]=r.useState([]),[P,v]=r.useState(!1),[ae,S]=r.useState(null),[q,B]=r.useState([]),[R,$]=r.useState(null);r.useEffect(()=>{(async()=>{try{const a=await J();B(a)}catch(a){console.error("❌ Failed to fetch assets:",a)}})()},[]);const C=async()=>{try{const s=await _();D(s)}catch(s){console.error("❌ Error loading schedules:",s)}};r.useEffect(()=>{C()},[]);const O=s=>{N(s);const a=new Date().getFullYear(),o=(y.length+1).toString().padStart(3,"0");d({maintenanceID:`MNT-${a}-${o}`,assetId:s}),v(!1),S(null),p(!0)},L=s=>{d({assetId:s.asset||"",maintenanceID:s.maintenance_id||"",maintenanceType:s.maintenance_type||"",scheduledDate:s.scheduled_date||"",frequency:s.frequency||"",technicianId:s.assigned_technician_id||"",taskDescription:s.task_description||"",sparePart:s.spare_parts_required||"",EstimatedDowntime:s.estimated_downtime||"",approvalStatus:s.approval_status||"Pending"}),$(s.maintenance_id),p(!0)},Q=async s=>{var a;if(window.confirm(`Are you sure you want to delete schedule ${s}?`))try{await Y(s),alert(`✅ Schedule ${s} deleted successfully!`);const c=await _();D(c)}catch(c){alert(`❌ Failed to delete schedule:
${JSON.stringify(((a=c.response)==null?void 0:a.data)||c.message,null,2)}`),console.error("❌ Delete error:",c)}},h=()=>{p(!1),d({}),v(!1),S(null)},l=s=>{const{name:a,value:c}=s.target;d(o=>({...o,[a]:c}))},G=async()=>{var s,a,c;try{const o={asset_id:n.assetId||"",maintenance_type:n.maintenanceType||"",scheduled_date:n.scheduledDate||"",frequency:n.frequency||"",assigned_technician_id:n.technicianId||"",task_description:n.taskDescription||"",spare_parts_required:n.sparePart||"",estimated_downtime:n.EstimatedDowntime||null,approval_status:n.approvalStatus||"Pending"},m=await z(o);alert(`✅ Maintenance Schedule created!
Generated ID: ${m.data.maintenance_id}`),C(),d({}),h()}catch(o){const m=((a=(s=o.response)==null?void 0:s.data)==null?void 0:a.detail)||((c=o.response)==null?void 0:c.data)||o.message;alert(`❌ Failed to create schedule:
${JSON.stringify(m,null,2)}`)}},H=y.filter(s=>Object.values(s).some(a=>a&&a.toString().toLowerCase().includes(f.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Maintenance Scheduling Details"}),e.jsx(i,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(I,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(j,{variant:"h6",gutterBottom:!0,children:"ASSETS RECORDS"}),e.jsx(b,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Asset ID",value:g,onChange:s=>E(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(w,{children:[e.jsx(T,{children:e.jsxs(u,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(k,{children:q.filter(s=>s.asset_id.toLowerCase().includes(g.toLowerCase())).map((s,a)=>e.jsxs(u,{children:[e.jsx(t,{children:s.asset_id}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(x,{onClick:()=>O(s.asset_id),color:"primary",children:e.jsx(X,{sx:{color:"#7267ef"}})})})]},a))})]})]})})}),e.jsx(i,{container:!0,spacing:2,children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(I,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(j,{variant:"h6",gutterBottom:!0,children:"Maintenance Scheduling Details"}),e.jsx("input",{type:"text",placeholder:"Search Maintenance Scheduling Details",value:f,onChange:s=>F(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(Z,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(w,{stickyHeader:!0,children:[e.jsx(T,{children:e.jsxs(u,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Maintenance ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Maintenance Type"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Scheduled Date"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Frequency"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Assigned TechnicianId"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Task Description"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Spare Parts Required"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Estimated Downtime"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Status"})}),e.jsx(t,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(k,{children:H.map((s,a)=>e.jsxs(u,{children:[e.jsx(t,{children:s.asset}),e.jsx(t,{children:s.maintenance_id}),e.jsx(t,{children:s.maintenance_type}),e.jsx(t,{children:s.scheduled_date}),e.jsx(t,{children:s.frequency}),e.jsx(t,{children:s.assigned_technician_id}),e.jsx(t,{children:s.task_description}),e.jsx(t,{children:s.spare_parts_required}),e.jsx(t,{children:s.estimated_downtime}),e.jsx(t,{children:s.approval_status}),e.jsxs(t,{children:[e.jsx(x,{onClick:()=>L(s),color:"warning",children:e.jsx(ee,{sx:{color:"orange"}})}),e.jsx(x,{onClick:()=>Q(s.maintenance_id),color:"error",children:e.jsx(se,{sx:{color:"red"}})})]})]},a))})]})})]})})}),e.jsxs(U,{open:M,onClose:h,fullWidth:!0,children:[e.jsx(K,{children:P?"Edit Maintenance Scheduling Details":"Enter Maintenance Scheduling Details"}),e.jsxs(V,{sx:{position:"relative"},children:[e.jsx(x,{"aria-label":"close",onClick:h,sx:{position:"absolute",right:8,top:8,color:s=>s.palette.grey[500]},children:e.jsx(W,{})}),e.jsx(b,{component:"form",sx:{mt:2},children:e.jsx(i,{container:!0,spacing:3,direction:"column",children:e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Maintenance Scheduling Info.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"assetId",children:"Asset ID"}),e.jsx("input",{id:"assetId",name:"assetId",className:"input",value:n.assetId||"",onChange:l,disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"maintenanceID",children:"Maintenance ID"}),e.jsx("input",{id:"maintenanceID",name:"maintenanceID",className:"input",value:n.maintenanceID||"",onChange:l,disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"maintenanceType",children:"Maintenance Type"}),e.jsxs("select",{id:"maintenanceType",name:"maintenanceType",className:"input",value:n.maintenanceType||"",onChange:l,children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"Preventive",children:"Preventive"}),e.jsx("option",{value:"Predictive",children:"Predictive"}),e.jsx("option",{value:"Corrective",children:"Corrective"}),e.jsx("option",{value:"Breakdown",children:"Breakdown"})]})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"scheduledDate",children:"Scheduled Date"}),e.jsx("input",{type:"date",id:"scheduledDate",name:"scheduledDate",className:"input",value:n.scheduledDate||"",onChange:l})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"frequency",children:"Frequency"}),e.jsxs("select",{id:"frequency",name:"frequency",className:"input",value:n.frequency||"",onChange:l,children:[e.jsx("option",{value:"",children:"-- Select Frequency --"}),e.jsx("option",{value:"Daily",children:"Daily"}),e.jsx("option",{value:"Weekly",children:"Weekly"}),e.jsx("option",{value:"Monthly",children:"Monthly"}),e.jsx("option",{value:"Quarterly",children:"Quarterly"}),e.jsx("option",{value:"Annually",children:"Annually"})]})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"technicianId",children:"Technician ID"}),e.jsx("input",{id:"technicianId",name:"technicianId",className:"input",value:n.technicianId||"",onChange:l})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"taskDescription",children:"Task Description"}),e.jsx("input",{id:"taskDescription",name:"taskDescription",className:"input",value:n.taskDescription||"",onChange:l})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"purchaseDate",children:"Purchase Date"}),e.jsx("input",{type:"date",id:"purchaseDate",name:"purchaseDate",className:"input",value:n.purchaseDate||"",onChange:l})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"sparePart",children:"Spare Parts Required"}),e.jsx("input",{id:"sparePart",name:"sparePart",className:"input",value:n.sparePart||"",onChange:l})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"EstimatedDowntime",children:"Estimated Downtime"}),e.jsx("input",{type:"number",id:"EstimatedDowntime",name:"EstimatedDowntime",className:"input",value:n.EstimatedDowntime||"",onChange:l})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:n.approvalStatus||"",onChange:l,children:[e.jsx("option",{value:"",children:"-- Select Status --"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Completed",children:"Completed"})]})]})]})]})})})]}),e.jsxs(te,{children:[e.jsx(A,{onClick:h,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(A,{variant:"outlined",onClick:G,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:R?"Update":"Submit"})]})]})]})};export{je as default};
