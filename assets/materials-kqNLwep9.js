import{r as l,j as e,T as h,z as g}from"./main-IxGEKZMA.js";import{C as se}from"./Close-DoqWsXz3.js";import{g as ae}from"./engineering-BuN6Pdrr.js";import{a as ne,b as le,e as ie,f as oe}from"./procurement-DNGl8bgG.js";import{G as s}from"./Grid-C72N-tAO.js";import{t as k,T as O,h as L,i as P,j as r,k as $,I as u,D as ce,f as de,g as ue,e as U}from"./TableRow-CRAT5KT_.js";import{A as xe}from"./AddCircle-DWIRGPUh.js";import{A as H,a as Q}from"./ArrowForwardIos-CgfNjsk_.js";import{T as me}from"./TableContainer-BaU58JEj.js";import{E as pe}from"./Edit-g2hjeeYC.js";import{D as he}from"./Delete-cHl_EB0l.js";import{D as je}from"./DialogActions-D5wP0Mt-.js";import"./Transition-C29ZPDdz.js";const Me=()=>{const[C,G]=l.useState(""),[z,J]=l.useState([]),[I,W]=l.useState(""),[Y,j]=l.useState(!1),[ye,K]=l.useState(""),[fe,ge]=l.useState(!1),[_,v]=l.useState("create"),D=1,[x,w]=l.useState(1),[m,N]=l.useState(1),b=5,[a,y]=l.useState({projectId:"",procurementId:"",materialName:"",materialCode:"",quantity:"",unitPrice:"",totalCost:"",requestedBy:"",requestDate:"",approvalStatus:"Pending",poId:"",expectedDeliveryDate:"",paymentStatus:""}),[F,T]=l.useState([]),M=z.filter(t=>t.project_id.toLowerCase().includes(C.toLowerCase())),B=Math.ceil(M.length/D),V=M.slice((x-1)*D,x*D);l.useEffect(()=>{(async()=>{try{const n=await ae();J(n)}catch(n){console.error("Failed to load accepted projects:",n)}})()},[]);const f=async()=>{try{const t=await ne();T(t)}catch(t){console.error("❌ Error loading procurements:",t)}};l.useEffect(()=>{f()},[]);const o=t=>{const{name:n,value:d}=t.target;y(i=>{const c={...i,[n]:d};if(n==="quantity"||n==="unitPrice"){const R=parseFloat(c.quantity)||0,q=parseFloat(c.unitPrice)||0,p=(R*q).toFixed(2);c.totalCost=p}return c})},X=t=>{const n=new Date().getFullYear(),i=(F.length+1).toString().padStart(3,"0"),c=`${n}-PRC-${i}`;y({projectId:t,procurementId:c,materialName:"",materialCode:"",quantity:"",unitPrice:"",totalCost:"",requestedBy:"",requestDate:"",approvalStatus:"Pending",paymentStatus:"Pending",expectedDeliveryDate:""}),v("create"),j(!0)},S=()=>j(!1),Z=async()=>{var n;const t=new FormData;t.append("project",a.projectId),t.append("material_name",a.materialName),t.append("material_code",a.materialCode),t.append("quantity_requested",a.quantity),t.append("unit_price",a.unitPrice),t.append("requested_by",a.requestedBy),t.append("request_date",a.requestDate),t.append("approval_status",a.approvalStatus||"Pending"),t.append("payment_status",a.paymentStatus||"Pending"),a.expectedDeliveryDate&&t.append("expected_delivery_date",a.expectedDeliveryDate);try{_==="update"?(await ie(a.procurementId,t),alert("✅ Material Procurement updated successfully!")):(await oe(t),alert("✅ Material Procurement submitted successfully!")),y({projectId:"",procurementId:"",materialName:"",materialCode:"",quantity:"",unitPrice:"",totalCost:"",requestedBy:"",requestDate:"",approvalStatus:"",paymentStatus:"",expectedDeliveryDate:""}),K(null),j(!1),v("create"),typeof f=="function"&&await f()}catch(d){const i=(n=d.response)==null?void 0:n.data;console.error("❌ Submission failed:",i||d.message);let c="Submission failed. Please check form values.";i&&typeof i=="object"&&(c=Object.entries(i).map(([q,p])=>`${q}: ${Array.isArray(p)?p.join(", "):p}`).join(`
`)),alert(`❌ ${c}`)}},ee=t=>{y({projectId:t.project,procurementId:t.procurement_id,materialName:t.material_name,materialCode:t.material_code,quantity:t.quantity_requested,unitPrice:t.unit_price,totalCost:t.total_cost,requestedBy:t.requested_by,requestDate:t.request_date,approvalStatus:t.approval_status,paymentStatus:t.payment_status,expectedDeliveryDate:t.expected_delivery_date}),v("update"),j(!0)},te=async t=>{if(window.confirm(`Delete ${t}?`))try{await le(t),alert(`Deleted ${t} successfully`),f(),T(d=>d.filter(i=>i.procurementId!==t))}catch{alert("Failed to delete. Check console for details.")}},E=F.filter(t=>Object.values(t).some(n=>n&&n.toString().toLowerCase().includes(I.toLowerCase()))),A=Math.ceil(E.length/b),re=E.slice((m-1)*b,m*b);return e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Material Procurement"}),e.jsx(s,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(s,{item:!0,xs:12,children:e.jsxs(k,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(g,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:C,onChange:t=>G(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(O,{children:[e.jsx(L,{children:e.jsxs(P,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx($,{children:V.filter(t=>{var n;return(n=t.project_id)==null?void 0:n.toLowerCase().includes(C.toLowerCase())}).map((t,n)=>e.jsxs(P,{children:[e.jsx(r,{children:t.project_id}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(u,{onClick:()=>X(t.project_id),color:"primary",children:e.jsx(xe,{sx:{color:"#7267ef"}})})})]},n))})]}),e.jsxs(g,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(u,{disabled:x===1,onClick:()=>w(t=>t-1),children:e.jsx(H,{})}),e.jsxs(h,{variant:"body2",sx:{mx:2},children:["Page ",x," of ",B||1]}),e.jsx(u,{disabled:x>=B,onClick:()=>w(t=>t+1),children:e.jsx(Q,{})})]})]})})}),e.jsx(s,{container:!0,spacing:2,children:e.jsx(s,{item:!0,xs:12,children:e.jsxs(k,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"SUBMITTED MATERIALS PROCUREMENT RECORDS"}),e.jsx("input",{type:"text",placeholder:"Search Materials Procurements Here....",value:I,onChange:t=>W(t.target.value),className:"input"}),e.jsx(me,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(O,{stickyHeader:!0,children:[e.jsx(L,{children:e.jsxs(P,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Procurement ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Purchase Order ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Material Name"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Material Code"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Quantity"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Unit Price"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Total Cost"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Requested By"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Request Date"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Status"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Payment Status"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Expected Delivery Date"})}),e.jsx(r,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx($,{children:re.map((t,n)=>e.jsxs(P,{children:[e.jsx(r,{children:t.project}),e.jsx(r,{children:t.procurement_id}),e.jsx(r,{children:t.purchase_order||"-"}),e.jsx(r,{children:t.material_name}),e.jsx(r,{children:t.material_code}),e.jsx(r,{children:t.quantity_requested}),e.jsx(r,{children:t.unit_price}),e.jsx(r,{children:t.total_cost}),e.jsx(r,{children:t.requested_by}),e.jsx(r,{children:t.request_date}),e.jsx(r,{children:t.approval_status}),e.jsx(r,{children:t.payment_status}),e.jsx(r,{children:t.expected_delivery_date}),e.jsxs(r,{children:[e.jsx(u,{color:"warning",onClick:()=>ee(t),children:e.jsx(pe,{sx:{color:"orange"}})}),e.jsx(u,{color:"error",onClick:()=>te(t.procurement_id),children:e.jsx(he,{sx:{color:"red"}})})]})]},n))})]})}),e.jsxs(g,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(u,{disabled:m===1,onClick:()=>N(t=>t-1),children:e.jsx(H,{})}),e.jsxs(h,{variant:"body2",sx:{mx:2},children:["Page ",m," of ",A||1]}),e.jsx(u,{disabled:m>=A,onClick:()=>N(t=>t+1),children:e.jsx(Q,{})})]})]})})}),e.jsxs(ce,{open:Y,onClose:S,fullWidth:!0,children:[e.jsx(de,{children:"Enter Procurement Details"}),e.jsxs(ue,{sx:{position:"relative"},children:[e.jsx(u,{"aria-label":"close",onClick:S,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(se,{})}),e.jsx(g,{component:"form",sx:{mt:2},children:e.jsxs(s,{container:!0,spacing:3,direction:"column",children:[e.jsxs(s,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project & Procurement Info"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",name:"projectId",className:"input",value:a.projectId||"",disabled:!0})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"procurementId",children:"Procurement ID"}),e.jsx("input",{id:"procurementId",name:"procurementId",className:"input",value:a.procurementId||"",disabled:!0})]})]})]}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Material Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"materialName",children:"Material Name"}),e.jsx("input",{id:"materialName",name:"materialName",className:"input",value:a.materialName||"",onChange:o})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"materialCode",children:"Material Code"}),e.jsx("input",{id:"materialCode",name:"materialCode",className:"input",value:a.materialCode||"",onChange:o})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"quantity",children:"Quantity"}),e.jsx("input",{id:"quantity",name:"quantity",className:"input",value:a.quantity||"",onChange:o})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"unitPrice",children:"Unit Price"}),e.jsx("input",{id:"unitPrice",name:"unitPrice",className:"input",value:a.unitPrice||"",onChange:o})]})]})]}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Cost & Info"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"totalCost",children:"Total Cost"}),e.jsx("input",{id:"totalCost",name:"totalCost",className:"input",value:a.totalCost||"",disabled:!0})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"requestedBy",children:"Requested By"}),e.jsx("input",{id:"requestedBy",name:"requestedBy",className:"input",value:a.requestedBy||"",onChange:o})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"requestDate",children:"Request Date"}),e.jsx("input",{type:"date",id:"requestDate",name:"requestDate",className:"input",value:a.requestDate||"",onChange:o})]})]})]}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Approval & Payment"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:a.approvalStatus||"",onChange:o,children:[e.jsx("option",{value:"",children:"Select Approval Status"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"expectedDeliveryDate",children:"Expected Delivery Date"}),e.jsx("input",{type:"date",id:"expectedDeliveryDate",name:"expectedDeliveryDate",className:"input",value:a.expectedDeliveryDate||"",onChange:o})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"paymentStatus",children:"Payment Status"}),e.jsxs("select",{id:"paymentStatus",name:"paymentStatus",className:"input",value:a.paymentStatus||"",onChange:o,children:[e.jsx("option",{value:"",children:"Select Payment Status"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Partially Paid",children:"Partially Paid"})]})]})]})]})]})})]}),e.jsxs(je,{children:[e.jsx(U,{onClick:S,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(U,{variant:"outlined",onClick:Z,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:_==="update"?"Update Procurement":"Submit Procurement"})]})]})]})};export{Me as default};
