import{r as o,j as e,S as D,D as N,T as M}from"./main-BIxdd69i.js";import{E as q}from"./jspdf.plugin.autotable-y_YJgUzU.js";import{C as Q}from"./Close-D340Gps3.js";import{b as U,u as W,c as Y,d as H}from"./account-BvsCUQ6Q.js";import{e as j,D as z,f as J,I as v,g as K,h as V,P as X}from"./DialogTitle-D59uELMl.js";import{G as c}from"./Grid-BnZNKmae.js";import{T as Z,a as ee,b as S,c as n,d as te}from"./TableRow-D8X36zJO.js";import{E as ne}from"./Edit-BJV-h6Li.js";import{D as ae}from"./Delete-BHKbKfZ2.js";import{T as re}from"./TablePagination-B2UmV3Uz.js";import"./index-E3WhgaTq.js";import"./KeyboardArrowRight-H8WcZOfv.js";import"./Select-CcRDAcIa.js";import"./dividerClasses-BHbp2fTT.js";import"./MenuItem-BSRQ3XbJ.js";import"./Toolbar-CZiWvmFk.js";const ve=()=>{const i="account_ledger",[d,L]=o.useState([]),[T,C]=o.useState(!1),[_,E]=o.useState(""),[I,g]=o.useState(!1),[u,b]=o.useState(null),[f,A]=o.useState(0),[p,P]=o.useState(5),[a,x]=o.useState({ledgerId:"",transactionDate:"",accountName:"",accountType:"",debitAmount:"",creditAmount:"",balance:0,description:"",referenceNumber:"",approvalStatus:""}),y=async()=>{try{const t=await U();L(t)}catch(t){console.error("❌ Failed to fetch ledgers",t)}};o.useEffect(()=>{y()},[]);const w=()=>{const t=new Date().getFullYear(),s=(d.length+1).toString().padStart(3,"0");x({ledgerId:`LED-${t}-${s}`,transactionDate:"",accountName:"",accountType:"",debitAmount:"",creditAmount:"",balance:0,description:"",referenceNumber:"",approvalStatus:"Pending"}),C(!1),b(null),g(!0)},m=()=>g(!1),R=t=>{x({ledgerId:t.ledger_id||"",transactionDate:t.transaction_date||"",accountName:t.account_name||"",accountType:t.account_type||"",debitAmount:t.debit_amount||"",creditAmount:t.credit_amount||"",balance:t.balance||0,description:t.description||"",referenceNumber:t.reference_number||"",approvalStatus:t.approval_status||"Pending"}),b(t.ledger_id),C(!0),g(!0)},l=t=>{const{name:r,value:s}=t.target;x(h=>({...h,[r]:s,balance:r==="debitAmount"||r==="creditAmount"?Number(h.debitAmount||0)-Number(h.creditAmount||0)+(r==="debitAmount"?Number(s):0)-(r==="creditAmount"?Number(s):0):h.balance}))},k=async()=>{try{const t={transaction_date:a.transactionDate,account_name:a.accountName,account_type:a.accountType,debit_amount:parseFloat(a.debitAmount)||0,credit_amount:parseFloat(a.creditAmount)||0,description:a.description,reference_number:a.referenceNumber,approval_status:a.approvalStatus};u?(await W(u,t),alert(`✅ Ledger ${u} updated successfully!`)):(await Y(t),alert("✅ Ledger entry created successfully!")),x({transactionDate:"",accountName:"",accountType:"",debitAmount:"",creditAmount:"",balance:0,description:"",referenceNumber:"",approvalStatus:"Pending"}),b(null),m(),y()}catch(t){console.error("❌ Error saving ledger:",t),alert("❌ Failed to save ledger entry")}},F=async t=>{if(window.confirm(`Are you sure you want to delete Ledger ID: ${t}?`))try{await H(t),alert(`✅ Ledger ${t} deleted`),y()}catch{alert(`❌ Failed to delete Ledger ${t}`)}},B=d.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(_.toLowerCase()))),O=(t,r)=>A(r),$=t=>{P(parseInt(t.target.value,10)),A(0)},G=()=>{const t=new q,r=B.map(s=>[s.ledger_id,s.transaction_date,s.account_name,s.account_type,s.debit_amount,s.credit_amount,s.balance,s.reference_number,s.approval_status]);t.autoTable({head:[["Ledger ID","Date","Account","Type","Debit","Credit","Balance","Ref No","Status"]],body:r}),t.save("ledger_report.pdf")};return e.jsxs("div",{children:[e.jsx(D,{slug:i,action:"can_create",children:e.jsx(j,{variant:"contained",sx:{mt:4,mb:2,backgroundColor:"#7267ef"},onClick:w,children:"Add Ledger Entry"})}),e.jsxs(z,{open:I,onClose:m,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(J,{sx:{backgroundColor:"#f3f3f3",color:"#7267ef",display:"flex",justifyContent:"space-between"},children:[T?"Edit Ledger Entry":"Add Ledger Entry",e.jsx(v,{onClick:m,sx:{color:"#7267ef"},children:e.jsx(Q,{})})]}),e.jsx(K,{children:e.jsxs(c,{container:!0,spacing:2,direction:"column",sx:{mt:1},children:[e.jsxs(c,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"ledgerId",children:"Ledger ID"}),e.jsx("input",{id:"ledgerId",name:"ledgerId",className:"input",value:a.ledgerId||"",readOnly:!0})]}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx("label",{children:"Transaction Date"}),e.jsx("input",{className:"input",type:"date",name:"transactionDate",value:a.transactionDate,onChange:l})]}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx("label",{children:"Account Name"}),e.jsx("input",{className:"input",name:"accountName",value:a.accountName,onChange:l,placeholder:"e.g., Revenue"})]}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx("label",{children:"Account Type"}),e.jsxs("select",{className:"input",name:"accountType",value:a.accountType,onChange:l,children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"Assets",children:"Assets"}),e.jsx("option",{value:"Liabilities",children:"Liabilities"}),e.jsx("option",{value:"Equity",children:"Equity"}),e.jsx("option",{value:"Revenue",children:"Revenue"}),e.jsx("option",{value:"Expenses",children:"Expenses"})]})]}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx("label",{children:"Debit Amount"}),e.jsx("input",{className:"input",name:"debitAmount",type:"number",value:a.debitAmount,onChange:l})]}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx("label",{children:"Credit Amount"}),e.jsx("input",{className:"input",name:"creditAmount",type:"number",value:a.creditAmount,onChange:l})]}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx("label",{children:"Description"}),e.jsx("input",{className:"input",name:"description",value:a.description,onChange:l,placeholder:"Transaction details..."})]}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx("label",{children:"Reference Number"}),e.jsx("input",{className:"input",name:"referenceNumber",value:a.referenceNumber,onChange:l})]}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx("label",{children:"Approval Status"}),e.jsxs("select",{className:"input",name:"approvalStatus",value:a.approvalStatus,onChange:l,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]})]})}),e.jsxs(V,{sx:{pr:3,pb:2},children:[e.jsx(j,{onClick:m,sx:{outline:"2px solid #800000",color:"#800000"},children:"Cancel"}),e.jsx(N,{slug:i,action:u?"can_update":"can_create",children:e.jsx(j,{variant:"outlined",onClick:k,sx:{borderColor:"#7267ef",color:"#7267ef"},children:"Submit"})})]})]}),e.jsxs(X,{sx:{mt:4,p:2,border:"1px solid #ccc"},children:[e.jsxs(c,{container:!0,justifyContent:"space-between",alignItems:"center",children:[e.jsx(c,{item:!0,children:e.jsx(M,{variant:"h6",gutterBottom:!0,sx:{color:"#7267ef"},children:"Account Ledger Report"})}),e.jsx(c,{item:!0,children:e.jsx(j,{onClick:G,sx:{backgroundColor:"#7267ef",color:"#fff",mt:2,mb:2},children:"Export PDF"})})]}),e.jsx("input",{type:"text",placeholder:"Search Ledger Entries...",value:_,onChange:t=>E(t.target.value),className:"input"}),e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(S,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:"Ledger ID"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Date"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Account"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Type"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Debit"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Credit"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Balance"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Ref No"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Status"}),e.jsx(n,{sx:{color:"#660000"},children:"Actions"})]})}),e.jsx(te,{children:d.slice(f*p,f*p+p).map((t,r)=>e.jsxs(S,{children:[e.jsx(n,{children:t.ledger_id}),e.jsx(n,{children:t.transaction_date}),e.jsx(n,{children:t.account_name}),e.jsx(n,{children:t.account_type}),e.jsx(n,{children:t.debit_amount}),e.jsx(n,{children:t.credit_amount}),e.jsx(n,{children:t.balance}),e.jsx(n,{children:t.reference_number}),e.jsx(n,{children:t.approval_status}),e.jsxs(n,{children:[e.jsx(N,{slug:i,action:"can_update",children:e.jsx(v,{onClick:()=>R(t),children:e.jsx(ne,{sx:{color:"orange"}})})}),e.jsx(D,{slug:i,action:"can_delete",children:e.jsx(v,{onClick:()=>F(t.ledger_id),children:e.jsx(ae,{sx:{color:"red"}})})})]})]},r))})]}),e.jsx(re,{rowsPerPageOptions:[5,10,25],component:"div",count:d.length,rowsPerPage:p,page:f,onPageChange:O,onRowsPerPageChange:$})]})]})};export{ve as default};
