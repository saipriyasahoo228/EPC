import{r as s,j as e,S as A,T as i,D as T,x as U}from"./main-BIxdd69i.js";import{a as P,l as V,s as $,m as H}from"./inventory-Bcy74QM6.js";import{e as v,D as Y,f as q,g as J,I as S,h as Q}from"./DialogTitle-D59uELMl.js";import{M as X,a as Z}from"./minimize-2-Dl_U24Qm.js";import{G as a}from"./Grid-BnZNKmae.js";import{T as ee,a as te,b as R,c as l,d as oe}from"./TableRow-D8X36zJO.js";import{E as se}from"./Edit-BJV-h6Li.js";import{D as ne}from"./Delete-BHKbKfZ2.js";const pe=()=>{const u="inventory",[E,h]=s.useState(!1),[b,I]=s.useState(null),[_,O]=s.useState([]),[m,F]=s.useState(!1),[n,f]=s.useState({valuationMethod:"",stockId:"",stockValue:"",stockTurnoverRatio:"",lowStockAlerts:!1,excessStockAlerts:!1,monthlyStockReport:""}),[p,k]=s.useState([]),K=s.useRef(null),j=s.useRef(null),g=s.useRef(null),D=s.useRef(null),w=s.useRef(null),C=s.useRef(null),W=()=>{F(!m)};s.useEffect(()=>{(async()=>{try{const o=await P();O(o.map(r=>r.stock_id))}catch(o){console.error("Error fetching stock IDs:",o)}})()},[]),s.useEffect(()=>{(async()=>{try{const o=await V();k(o)}catch(o){console.error("❌ Error fetching valuation reports:",o)}})()},[]);const c=t=>{const{name:o,type:r,value:x,checked:y,files:N}=t.target;f(G=>{var M;return{...G,[o]:r==="checkbox"?y:r==="file"?((M=N[0])==null?void 0:M.name)||"":x}})},d=(t,o)=>{t.key==="Enter"&&(t.preventDefault(),o&&o.current&&o.current.focus())},z=async()=>{var t;try{const o={stock:n.stockId,valuation_method:n.valuationMethod},r=await $(o),x=await V();k(x),f({valuationMethod:"",stockId:"",stockValue:"",stockTurnoverRatio:"",lowStockAlerts:!1,excessStockAlerts:!1,monthlyStockReport:""}),h(!1),alert("✅ Valuation report generated successfully!")}catch(o){alert(`⚠️ Failed to submit valuation: ${((t=o.response)==null?void 0:t.data)||o.message}`)}},B=t=>{f(p[t]),I(t),h(!0)},L=async t=>{const o=p[t].id;if(window.confirm("Are you sure you want to delete this report?"))try{await H(o),k(r=>r.filter((x,y)=>y!==t)),console.log(`✅ Report ${o} deleted`),alert("Report Delete Successfully!!")}catch(r){console.error("❌ Error deleting report:",r),alert("Something Went Wrong!!!")}};return e.jsxs(e.Fragment,{children:[e.jsx(A,{slug:u,action:"can_create",children:e.jsx(v,{variant:"contained",onClick:()=>h(!0),sx:{backgroundColor:"#7267ef",mt:4},children:"Add Inventory Valuation"})}),e.jsxs(Y,{open:E,fullWidth:!0,maxWidth:"xl",PaperProps:{style:m?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(q,{children:"Inventory Valuation & Reporting"}),e.jsxs(J,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(S,{"aria-label":"toggle-size",onClick:W,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:m?e.jsx(X,{}):e.jsx(Z,{})}),e.jsxs(a,{container:!0,spacing:2,direction:"column",children:[e.jsxs(a,{item:!0,children:[e.jsx(i,{variant:"subtitle2",children:"Valuation Method"}),e.jsxs("select",{name:"valuationMethod",className:"input",value:n.valuationMethod,onChange:c,onKeyDown:t=>d(t,j),ref:K,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"FIFO",children:"FIFO"}),e.jsx("option",{value:"LIFO",children:"LIFO"}),e.jsx("option",{value:"Weighted Average",children:"Weighted Average"})]})]}),e.jsxs(a,{item:!0,children:[e.jsx(i,{variant:"subtitle2",children:"Stock ID"}),e.jsx("input",{list:"stockIdOptions",name:"stockId",type:"text",value:n.stockId,onChange:c,className:"input",onKeyDown:t=>d(t,g),ref:j,placeholder:"Search Stock ID"}),e.jsx("datalist",{id:"stockIdOptions",children:_.map((t,o)=>e.jsx("option",{value:t},o))})]}),e.jsxs(a,{item:!0,children:[e.jsx(i,{variant:"subtitle2",children:"Stock Value"}),e.jsx("input",{name:"stockValue",type:"number",value:n.stockValue,onChange:c,className:"input",onKeyDown:t=>d(t,g),ref:j})]}),e.jsxs(a,{item:!0,children:[e.jsx(i,{variant:"subtitle2",children:"Stock Turnover Ratio"}),e.jsx("input",{name:"stockTurnoverRatio",type:"number",value:n.stockTurnoverRatio,onChange:c,className:"input",onKeyDown:t=>d(t,D),ref:g})]}),e.jsx(a,{item:!0,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"lowStockAlerts",checked:n.lowStockAlerts,onChange:c,onKeyDown:t=>d(t,w),ref:D,style:{marginRight:"8px"}}),"Low Stock Alerts"]})}),e.jsx(a,{item:!0,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"excessStockAlerts",checked:n.excessStockAlerts,onChange:c,onKeyDown:t=>d(t,C),ref:w,style:{marginRight:"8px"}}),"Excess Stock Alerts"]})}),e.jsxs(a,{item:!0,children:[e.jsx(i,{variant:"subtitle2",children:"Monthly Stock Report"}),e.jsx("input",{type:"file",name:"monthlyStockReport",onChange:c,onKeyDown:t=>{t.key==="Enter"&&t.preventDefault()},ref:C,style:{marginTop:"5px"}}),n.monthlyStockReport&&e.jsx(i,{variant:"caption",style:{marginTop:"4px",display:"block"},children:n.monthlyStockReport})]})]})]}),e.jsxs(Q,{children:[e.jsx(v,{onClick:()=>{h(!1),I(null)},sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(T,{slug:u,action:b!==null?"can_update":"can_create",children:e.jsx(v,{variant:"outlined",onClick:z,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:b!==null?"Update":"Submit"})})]})]}),e.jsxs(U,{mt:4,sx:{backgroundColor:"#fff",p:2,borderRadius:2,boxShadow:1},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Inventory Reports"}),e.jsxs(ee,{children:[e.jsx(te,{children:e.jsx(R,{children:["Stock ID","Valuation Method","Stock Value","Turnover Ratio","Monthly Report","Actions"].map((t,o)=>e.jsx(l,{sx:{color:"#7267ef",fontWeight:"bold"},children:t},o))})}),e.jsx(oe,{children:p.length>0?p.map((t,o)=>e.jsxs(R,{children:[e.jsx(l,{children:t.stock}),e.jsx(l,{children:t.valuation_method}),e.jsx(l,{children:t.stock_value}),e.jsx(l,{children:t.stock_turnover_ratio}),e.jsx(l,{children:t.monthly_stock_report||"—"}),e.jsxs(l,{children:[e.jsx(T,{slug:u,action:"can_update",children:e.jsx(S,{onClick:()=>B(o),sx:{color:"warning"},children:e.jsx(se,{sx:{color:"orange"}})})}),e.jsx(A,{slug:u,action:"can_delete",children:e.jsx(S,{onClick:()=>L(o),sx:{color:"error"},children:e.jsx(ne,{sx:{color:"red"}})})})]})]},o)):e.jsx(R,{children:e.jsx(l,{colSpan:5,align:"center",children:"No inventory reports added yet."})})})]})]})]})};export{pe as default};
