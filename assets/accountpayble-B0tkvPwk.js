import{r as l,j as e,T as y,S as _,D as I}from"./main-BIxdd69i.js";import{C as H}from"./Close-D340Gps3.js";import{g as W}from"./procurement-Dxzq-DH5.js";import{a as q,e as z,f as J,h as K}from"./account-BvsCUQ6Q.js";import{G as o}from"./Grid-BnZNKmae.js";import{P,I as h,D as Q,f as X,g as Z,h as ee,e as C}from"./DialogTitle-D59uELMl.js";import{T as S,a as A,b as p,c as n,d as w}from"./TableRow-D8X36zJO.js";import{A as te}from"./AddCircle-Bn9h5MaP.js";import{T as ae}from"./TableContainer-1Xqyy-f8.js";import{E as ne}from"./Edit-BJV-h6Li.js";import{D as se}from"./Delete-BHKbKfZ2.js";const fe=()=>{const u="account_ledger",[E,c]=l.useState(!1),[oe,T]=l.useState(""),[s,j]=l.useState({}),[b,N]=l.useState([]),[d,m]=l.useState(!1),[le,F]=l.useState(null),[v,M]=l.useState(""),[V,O]=l.useState([]),[f,D]=l.useState(null);l.useEffect(()=>{(async()=>{try{const a=await W();O(a)}catch(a){console.error("❌ Error fetching vendors:",a)}})()},[]);const g=async()=>{try{const t=await q();N(t)}catch(t){console.error("❌ Error fetching payables:",t)}};l.useEffect(()=>{g()},[]);const k=t=>{const r=`INV-${new Date().getFullYear()}-${(b.length+1).toString().padStart(3,"0")}`;T(t),j({invoiceId:r,vendorId:t,invoiceDate:"",dueDate:"",totalAmount:"",amountPaid:"",paymentStatus:"Pending",paymentMethod:"",approvalStatus:"",outstandingBalance:""}),m(!1),F(null),c(!0)},B=t=>{j({invoiceId:t.invoice_id,vendorId:t.vendor,invoiceDate:t.invoice_date,dueDate:t.due_date,totalAmount:t.total_amount,amountPaid:t.amount_paid,outstandingBalance:t.outstanding_balance,paymentStatus:t.payment_status,paymentMethod:t.payment_method,approvalStatus:t.approval_status}),D(t.invoice_id),m(!0),c(!0)},R=async t=>{if(window.confirm(`Are you sure you want to delete invoice ${t}?`))try{await z(t),alert(`✅ Invoice ${t} deleted successfully!`),g()}catch(r){console.error("❌ Error deleting payable:",r),alert("❌ Failed to delete invoice. Please try again.")}},i=t=>{const{name:a,value:r}=t.target,x={...s,[a]:r};if(a==="totalAmount"||a==="amountPaid"){const U=parseFloat(x.totalAmount||0),Y=parseFloat(x.amountPaid||0);x.outstandingBalance=(U-Y).toFixed(2)}j(x)},L=(t,a)=>!t||a==="Paid"?!1:new Date(t)<new Date,$=async()=>{var t;try{const a={vendor:s.vendorId,invoice_date:s.invoiceDate,due_date:s.dueDate,total_amount:parseFloat(s.totalAmount||0),amount_paid:parseFloat(s.amountPaid||0),payment_status:s.paymentStatus,payment_method:s.paymentMethod,approval_status:s.approvalStatus};if(d&&f){const r=await J(f,a);alert(`✅ Invoice ${r.invoice_id} updated successfully!`)}else{const r=await K(a);alert(`✅ Payable created successfully! Invoice ID: ${r.invoice_id}`)}c(!1),m(!1),D(null),g()}catch(a){console.error("❌ Error saving payable:",((t=a.response)==null?void 0:t.data)||a),alert("❌ Failed to save payable. Please try again.")}},G=b.filter(t=>Object.values(t).some(a=>a==null?void 0:a.toString().toLowerCase().includes(v.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Accounts Payable"}),e.jsxs(o,{container:!0,spacing:2,direction:"column",children:[e.jsx(o,{item:!0,xs:12,children:e.jsxs(P,{sx:{p:2},children:[e.jsx(y,{variant:"h6",children:"Vendor List"}),e.jsx("input",{type:"text",placeholder:"Search Vendor ID",value:v,onChange:t=>M(t.target.value),className:"input",style:{width:"100%",margin:"10px 0",padding:"8px",borderRadius:4}}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(p,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Vendor ID"})}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(w,{children:V.filter(t=>{var a;return(a=t.vendor_id)==null?void 0:a.toLowerCase().includes(v.toLowerCase())}).map((t,a)=>e.jsxs(p,{children:[e.jsx(n,{children:t.vendor_id}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(_,{slug:u,action:"can_create",children:e.jsx(h,{onClick:()=>k(t.vendor_id),color:"primary",children:e.jsx(te,{sx:{color:"#7267ef"}})})})})]},a))})]})]})}),e.jsx(o,{item:!0,xs:12,children:e.jsxs(P,{sx:{p:2,mt:2},children:[e.jsx(y,{variant:"h6",children:"Payable Records"}),e.jsx(ae,{children:e.jsxs(S,{stickyHeader:!0,children:[e.jsx(A,{children:e.jsxs(p,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:"Invoice ID"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Vendor ID"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Invoice Date"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Due Date"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Total Amount"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Amount Paid"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Outstanding"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Status"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Method"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Approval"}),e.jsx(n,{sx:{color:"#660000"},children:"Actions"})]})}),e.jsx(w,{children:G.map((t,a)=>e.jsxs(p,{sx:{backgroundColor:L(t.due_date,t.payment_status)?"#ffe6e6":"inherit"},children:[e.jsx(n,{children:t.invoice_id}),e.jsx(n,{children:t.vendor}),e.jsx(n,{children:t.invoice_date}),e.jsx(n,{children:t.due_date}),e.jsx(n,{children:t.total_amount}),e.jsx(n,{children:t.amount_paid}),e.jsx(n,{children:t.outstanding_balance}),e.jsx(n,{children:t.payment_status}),e.jsx(n,{children:t.payment_method}),e.jsx(n,{children:t.approval_status}),e.jsxs(n,{children:[e.jsx(I,{slug:u,action:"can_update",children:e.jsx(h,{onClick:()=>B(t),color:"warning",children:e.jsx(ne,{sx:{color:"orange"}})})}),e.jsx(_,{slug:u,action:"can_delete",children:e.jsx(h,{onClick:()=>R(t.invoice_id),color:"error",children:e.jsx(se,{sx:{color:"red"}})})})]})]},a))})]})})]})})]}),e.jsxs(Q,{open:E,onClose:()=>c(!1),fullWidth:!0,children:[e.jsxs(X,{children:[d?"Edit Invoice Details":"New Invoice Entry",e.jsx(h,{"aria-label":"close",onClick:()=>c(!1),sx:{position:"absolute",right:8,top:8},children:e.jsx(H,{})})]}),e.jsx(Z,{children:e.jsxs(o,{container:!0,spacing:2,mt:1,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Invoice ID"}),e.jsx("input",{className:"input",value:s.invoiceId||"",disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Vendor ID"}),e.jsx("input",{className:"input",value:s.vendorId||"",disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Invoice Date"}),e.jsx("input",{name:"invoiceDate",type:"date",className:"input",value:s.invoiceDate||"",onChange:i})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{name:"dueDate",type:"date",className:"input",value:s.dueDate||"",onChange:i})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Total Amount"}),e.jsx("input",{name:"totalAmount",type:"number",className:"input",value:s.totalAmount||"",onChange:i})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Amount Paid"}),e.jsx("input",{name:"amountPaid",type:"number",className:"input",value:s.amountPaid||"",onChange:i})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Outstanding"}),e.jsx("input",{className:"input",value:s.outstandingBalance||"",disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Payment Status"}),e.jsxs("select",{name:"paymentStatus",className:"input",value:s.paymentStatus||"Pending",onChange:i,disabled:d,children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Paid",children:"Paid"}),e.jsx("option",{value:"Overdue",children:"Overdue"})]})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Payment Method"}),e.jsx("input",{name:"paymentMethod",className:"input",value:s.paymentMethod||"",onChange:i})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Approval Status"}),e.jsxs("select",{name:"approvalStatus",className:"input",value:s.approvalStatus||"Pending",onChange:i,children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]})]})}),e.jsxs(ee,{children:[e.jsx(C,{onClick:()=>c(!1),sx:{outline:"2px solid #800000",color:"#800000"},children:"Cancel"}),e.jsx(I,{slug:u,action:d&&f?"can_update":"can_create",children:e.jsx(C,{onClick:$,variant:"outlined",sx:{color:"#7267ef",borderColor:"#7267ef"},children:d?"Update":"Submit"})})]})]})]})};export{fe as default};
