import{ai as Te,r as a,X as Re,m as Le,n as We,o as De,j as e,t as Ge,q as Oe,T as v,v as q,w as He,x as Fe,Z as Ve,z as I,a4 as se}from"./main-IxGEKZMA.js";import{C as re}from"./Close-DoqWsXz3.js";import{S as te,A as ne,g as H,a as Qe,b as Be,c as $e,u as Ne}from"./user-DcK7T3v4.js";import{u as qe,s as S,a as Xe,e as M,t as Ze,T as Je,h as Ke,i as ae,j as m,k as Ye,I as z,D as oe,f as le,g as ie}from"./TableRow-CRAT5KT_.js";import{g as es,G as u}from"./Grid-C72N-tAO.js";import{T as E,F,I as V}from"./TextField-CXzLsa8y.js";import{T as ss}from"./TableContainer-BaU58JEj.js";import{C as Q,D as R}from"./Divider-CA15gT4h.js";import{E as rs}from"./Edit-g2hjeeYC.js";import{T as ts}from"./TablePagination-DkVFCvhA.js";import{a as ns,F as as,S as B,M as $,O as de}from"./Select-CDJTZGaT.js";import{D as ce}from"./DialogActions-D5wP0Mt-.js";import"./Transition-C29ZPDdz.js";import"./dividerClasses-DK6Syutt.js";import"./KeyboardArrowRight-Y-VTRWJY.js";function os(n,o,t,d,p){const[i,g]=a.useState(()=>p&&t?t(n).matches:d?d(n).matches:o);return qe(()=>{if(!t)return;const x=t(n),h=()=>{g(x.matches)};return h(),x.addEventListener("change",h),()=>{x.removeEventListener("change",h)}},[n,t]),i}const ls={...Re},fe=ls.useSyncExternalStore;function is(n,o,t,d,p){const i=a.useCallback(()=>o,[o]),g=a.useMemo(()=>{if(p&&t)return()=>t(n).matches;if(d!==null){const{matches:f}=d(n);return()=>f}return i},[i,n,d,p,t]),[x,h]=a.useMemo(()=>{if(t===null)return[i,()=>()=>{}];const f=t(n);return[()=>f.matches,c=>(f.addEventListener("change",c),()=>{f.removeEventListener("change",c)})]},[i,t,n]);return fe(h,x,g)}function je(n={}){const{themeId:o}=n;return function(d,p={}){let i=Te();i&&o&&(i=i[o]||i);const g=typeof window<"u"&&typeof window.matchMedia<"u",{defaultMatches:x=!1,matchMedia:h=g?window.matchMedia:null,ssrMatchMedia:b=null,noSsr:f=!1}=es({name:"MuiUseMediaQuery",props:p,theme:i});let c=typeof d=="function"?d(i):d;return c=c.replace(/^@media( ?)/m,""),(fe!==void 0?is:os)(c,x,h,b,f)}}je();function ds(n){return We("MuiInputAdornment",n)}const ue=Le("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var pe;const cs=(n,o)=>{const{ownerState:t}=n;return[o.root,o[`position${q(t.position)}`],t.disablePointerEvents===!0&&o.disablePointerEvents,o[t.variant]]},us=n=>{const{classes:o,disablePointerEvents:t,hiddenLabel:d,position:p,size:i,variant:g}=n,x={root:["root",t&&"disablePointerEvents",p&&`position${q(p)}`,g,d&&"hiddenLabel",i&&`size${q(i)}`]};return He(x,ds,o)},ps=Ge("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:cs})(Fe(({theme:n})=>({display:"flex",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(n.vars||n).palette.action.active,variants:[{props:{variant:"filled"},style:{[`&.${ue.positionStart}&:not(.${ue.hiddenLabel})`]:{marginTop:16}}},{props:{position:"start"},style:{marginRight:8}},{props:{position:"end"},style:{marginLeft:8}},{props:{disablePointerEvents:!0},style:{pointerEvents:"none"}}]}))),C=a.forwardRef(function(o,t){const d=De({props:o,name:"MuiInputAdornment"}),{children:p,className:i,component:g="div",disablePointerEvents:x=!1,disableTypography:h=!1,position:b,variant:f,...c}=d,w=ns()||{};let y=f;f&&w.variant,w&&!y&&(y=w.variant);const P={...d,hiddenLabel:w.hiddenLabel,size:w.size,disablePointerEvents:x,position:b,variant:y},L=us(P);return e.jsx(as.Provider,{value:null,children:e.jsx(ps,{as:g,ownerState:P,className:Oe(L.root,i),ref:t,...c,children:typeof p=="string"&&!h?e.jsx(v,{color:"textSecondary",children:p}):e.jsxs(a.Fragment,{children:[b==="start"?pe||(pe=e.jsx("span",{className:"notranslate","aria-hidden":!0,children:"â€‹"})):null,p]})})})}),xs=je({themeId:Ve}),hs=S(e.jsx("path",{d:"M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2zm-2 0-8 5-8-5zm0 12H4V8l8 5 8-5z"})),xe=S(e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2M9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9zm9 14H6V10h12zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2"})),ms=S(e.jsx("path",{d:"M13 8c0-2.21-1.79-4-4-4S5 5.79 5 8s1.79 4 4 4 4-1.79 4-4m2 2v2h3v3h2v-3h3v-2h-3V7h-2v3zM1 18v2h16v-2c0-2.66-5.33-4-8-4s-8 1.34-8 4"})),fs=S(e.jsx("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"})),js=S(e.jsx("path",{d:"M15.5 1h-8C6.12 1 5 2.12 5 3.5v17C5 21.88 6.12 23 7.5 23h8c1.38 0 2.5-1.12 2.5-2.5v-17C18 2.12 16.88 1 15.5 1m-4 21c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m4.5-4H7V4h9z"})),he=S(e.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"})),me=S(e.jsx("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"})),N=[{value:"project manager",label:"Project Manager"},{value:"engineer",label:"Engineer"},{value:"accountant",label:"Accountant"},{value:"procurement officer",label:"Procurement Officer"},{value:"inventory manager",label:"Inventory Manager"},{value:"site supervisor",label:"Site Supervisor"},{value:"maintenance staff",label:"Maintenance Staff"}],_s=()=>{const n=Xe(),o=xs(n.breakpoints.down("sm")),[t,d]=a.useState([]),[p,i]=a.useState([]),[g,x]=a.useState(!1),[h,b]=a.useState(!1),[f,c]=a.useState(""),[w,y]=a.useState(""),[P,L]=a.useState(""),[W,X]=a.useState(0),[U,ge]=a.useState(10),[ve,Z]=a.useState(!1),[be,J]=a.useState(!1),[l,k]=a.useState({full_name:"",email:"",mobile_number:"",role:"",groups:[],password:"",password2:""}),[D,we]=a.useState(!1),[G,ye]=a.useState(!1),[K,Ce]=a.useState(null),[Y,O]=a.useState([]);a.useEffect(()=>{(async()=>{x(!0);try{const[r,j]=await Promise.all([H(),Qe()]);d(r||[]),i(j||[])}catch{c("Failed to load users or groups.")}finally{x(!1)}})()},[]);const Se=(s,r)=>X(r),Pe=s=>{ge(parseInt(s.target.value,10)),X(0)},ee=a.useMemo(()=>{const s=P.trim().toLowerCase();return s?t.filter(r=>[r.user_id,r.full_name,r.email,r.mobile_number,r.role,...Array.isArray(r.groups)?r.groups:[]].filter(Boolean).join(" ").toLowerCase().includes(s)):t},[t,P]),Ie=s=>{var r;return((r=N.find(j=>j.value===s))==null?void 0:r.label)||s||"-"},Ee=()=>{k({full_name:"",email:"",mobile_number:"",role:"",groups:[],password:"",password2:""}),Z(!0)},Ae=async s=>{Ce(s.user_id),J(!0);try{x(!0);const r=await Be(s.user_id),j=Array.isArray(r==null?void 0:r.groups)?r.groups:[];O(j)}catch{c("Failed to load user details."),O([])}finally{x(!1)}},_=()=>Z(!1),T=()=>J(!1),A=s=>{const{name:r,value:j}=s.target;k(_e=>({..._e,[r]:j}))},Me=s=>{const r=s.target.value;k(j=>({...j,groups:typeof r=="string"?r.split(","):r}))},ze=async()=>{if(!l.full_name||!l.password||!l.password2){c("Please fill all required fields.");return}if(l.password!==l.password2){c("Passwords do not match.");return}b(!0);try{await $e(l),y("User created successfully."),_();const s=await H();d(s||[])}catch{c("Failed to create user.")}finally{b(!1)}},Ue=s=>{const r=s.target.value;O(typeof r=="string"?r.split(","):r)},ke=async()=>{if(K){b(!0);try{await Ne(K,{groups:Y}),y("User groups updated."),T();const s=await H();d(s||[])}catch{c("Failed to update user groups.")}finally{b(!1)}}};return e.jsxs(I,{children:[e.jsxs(u,{container:!0,alignItems:"center",justifyContent:"space-between",sx:{mt:2,mb:2},children:[e.jsx(u,{item:!0,children:e.jsx(v,{variant:"h6",sx:{color:"#7267ef"},children:"Users & Roles"})}),e.jsx(u,{item:!0,children:e.jsx(M,{variant:"contained",onClick:Ee,sx:{backgroundColor:"#7267ef"},children:"Add User"})})]}),e.jsxs(Ze,{sx:{p:2},children:[e.jsx(u,{container:!0,spacing:2,alignItems:"center",sx:{mb:1},children:e.jsx(u,{item:!0,xs:12,sm:6,md:4,children:e.jsx(E,{fullWidth:!0,size:"small",label:"Search Users",value:P,onChange:s=>L(s.target.value)})})}),g?e.jsx(I,{display:"flex",justifyContent:"center",alignItems:"center",sx:{minHeight:200},children:e.jsx(se,{})}):e.jsx(ss,{children:e.jsxs(Je,{size:"small",children:[e.jsx(Ke,{children:e.jsxs(ae,{children:[e.jsx(m,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"User ID"})}),e.jsx(m,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Name"})}),e.jsx(m,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Email"})}),e.jsx(m,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Mobile"})}),e.jsx(m,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Role"})}),e.jsx(m,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Groups"})}),e.jsx(m,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(Ye,{children:ee.slice(W*U,W*U+U).map(s=>e.jsxs(ae,{hover:!0,children:[e.jsx(m,{children:s.user_id}),e.jsx(m,{children:s.full_name||"-"}),e.jsx(m,{children:s.email||"-"}),e.jsx(m,{children:s.mobile_number||"-"}),e.jsx(m,{children:Ie(s.role)}),e.jsx(m,{children:e.jsx(I,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:(Array.isArray(s.groups)?s.groups:[]).map(r=>e.jsx(Q,{label:r,size:"small"},`${s.user_id}-${r}`))})}),e.jsx(m,{children:e.jsx(z,{color:"warning",onClick:()=>Ae(s),"aria-label":"Edit groups",children:e.jsx(rs,{sx:{color:"orange"}})})})]},s.user_id))})]})}),e.jsx(ts,{rowsPerPageOptions:[5,10,25],component:"div",count:ee.length,rowsPerPage:U,page:W,onPageChange:Se,onRowsPerPageChange:Pe})]}),e.jsxs(oe,{open:ve,onClose:_,maxWidth:"xl",fullWidth:!0,fullScreen:o,PaperProps:{sx:{borderRadius:o?0:3,boxShadow:6,width:o?"100vw":"min(1100px, 94vw)"}},children:[e.jsxs(le,{sx:{backgroundColor:"#f7f7fb",color:"#2f2a8d",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(I,{children:[e.jsx(v,{variant:"h6",sx:{fontWeight:700},children:"Create User"}),e.jsx(v,{variant:"body2",sx:{color:"text.secondary"},children:"Add a new team member and assign access"})]}),e.jsx(z,{onClick:_,sx:{color:"#7267ef"},"aria-label":"Close dialog",children:e.jsx(re,{})})]}),e.jsx(ie,{dividers:!0,sx:{backgroundColor:"#fff"},children:e.jsxs(u,{container:!0,spacing:4,sx:{mt:0},children:[e.jsxs(u,{item:!0,xs:12,children:[e.jsx(v,{variant:"overline",sx:{color:"text.secondary"},children:"Basic Information"}),e.jsx(R,{sx:{mt:1,mb:2}})]}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(E,{fullWidth:!0,label:"Full Name",name:"full_name",value:l.full_name,onChange:A,required:!0,InputProps:{startAdornment:e.jsx(C,{position:"start",children:e.jsx(fs,{fontSize:"small"})})}})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(E,{fullWidth:!0,label:"Email",name:"email",type:"email",value:l.email,onChange:A,required:!0,InputProps:{startAdornment:e.jsx(C,{position:"start",children:e.jsx(hs,{fontSize:"small"})})}})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(E,{fullWidth:!0,label:"Mobile Number",name:"mobile_number",value:l.mobile_number,onChange:A,required:!0,InputProps:{startAdornment:e.jsx(C,{position:"start",children:e.jsx(js,{fontSize:"small"})})}})}),e.jsxs(u,{item:!0,xs:12,children:[e.jsx(v,{variant:"overline",sx:{color:"text.secondary"},children:"Roles"}),e.jsx(R,{sx:{mt:1,mb:2}})]}),e.jsx(u,{item:!0,xs:12,children:e.jsxs(F,{fullWidth:!0,required:!0,variant:"outlined",sx:{minWidth:"100%",display:"block"},children:[e.jsx(V,{id:"role-label",shrink:!0,children:"Role"}),e.jsx(B,{fullWidth:!0,sx:{width:"100%","& .MuiSelect-select":{py:1.75}},size:"medium",displayEmpty:!0,labelId:"role-label",id:"role-select",label:"Role",name:"role",value:l.role,onChange:s=>k(r=>({...r,role:s.target.value})),input:e.jsx(de,{label:"Role"}),renderValue:s=>{var r;return s?((r=N.find(j=>j.value===s))==null?void 0:r.label)||s:e.jsx(v,{sx:{color:"text.disabled"},children:"Select a role"})},children:N.map(s=>e.jsx($,{value:s.value,children:s.label},s.value))})]})}),e.jsxs(u,{item:!0,xs:12,children:[e.jsx(v,{variant:"overline",sx:{color:"text.secondary"},children:"Groups"}),e.jsx(R,{sx:{mt:1,mb:2}})]}),e.jsx(u,{item:!0,xs:12,children:e.jsxs(F,{fullWidth:!0,required:!0,variant:"outlined",sx:{minWidth:"100%",display:"block"},children:[e.jsx(V,{id:"add-groups-label",shrink:!0,children:"Groups"}),e.jsx(B,{fullWidth:!0,sx:{width:"100%","& .MuiSelect-select":{py:1.75}},size:"medium",displayEmpty:!0,labelId:"add-groups-label",id:"groups-select",multiple:!0,value:l.groups,onChange:Me,label:"Groups",input:e.jsx(de,{label:"Groups"}),renderValue:s=>!s||s.length===0?e.jsx(v,{sx:{color:"text.disabled"},children:"Select groups"}):e.jsx(I,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s.map(r=>e.jsx(Q,{label:r,size:"small"},r))}),children:p.map(s=>e.jsx($,{value:s.name,children:s.name},s.id))})]})}),e.jsxs(u,{item:!0,xs:12,children:[e.jsx(v,{variant:"overline",sx:{color:"text.secondary"},children:"Security"}),e.jsx(R,{sx:{mt:1,mb:2}})]}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(E,{fullWidth:!0,label:"Password",name:"password",type:D?"text":"password",value:l.password,onChange:A,required:!0,InputProps:{startAdornment:e.jsx(C,{position:"start",children:e.jsx(xe,{fontSize:"small"})}),endAdornment:e.jsx(C,{position:"end",children:e.jsx(z,{"aria-label":D?"Hide password":"Show password",onClick:()=>we(s=>!s),edge:"end",children:D?e.jsx(me,{}):e.jsx(he,{})})})}})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(E,{fullWidth:!0,label:"Confirm Password",name:"password2",type:G?"text":"password",value:l.password2,onChange:A,helperText:l.password&&l.password2&&l.password!==l.password2?"Passwords do not match":" ",error:!!(l.password&&l.password2&&l.password!==l.password2),required:!0,InputProps:{startAdornment:e.jsx(C,{position:"start",children:e.jsx(xe,{fontSize:"small"})}),endAdornment:e.jsx(C,{position:"end",children:e.jsx(z,{"aria-label":G?"Hide confirm password":"Show confirm password",onClick:()=>ye(s=>!s),edge:"end",children:G?e.jsx(me,{}):e.jsx(he,{})})})}})})]})}),e.jsxs(ce,{sx:{pr:3,pb:2},children:[e.jsx(M,{onClick:_,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(M,{variant:"contained",onClick:ze,disabled:h,sx:{backgroundColor:"#7267ef"},startIcon:h?e.jsx(se,{size:18,color:"inherit"}):e.jsx(ms,{}),children:h?"Creating...":"Create User"})]})]}),e.jsxs(oe,{open:be,onClose:T,maxWidth:"sm",fullWidth:!0,fullScreen:o,children:[e.jsxs(le,{sx:{backgroundColor:"#f3f3f3",color:"#7267ef",display:"flex",justifyContent:"space-between"},children:["Update User Groups",e.jsx(z,{onClick:T,sx:{color:"#7267ef"},children:e.jsx(re,{})})]}),e.jsxs(ie,{dividers:!0,children:[e.jsx(v,{variant:"body2",sx:{mb:1,color:"text.secondary"},children:"Only groups can be modified for an existing user."}),e.jsxs(F,{fullWidth:!0,children:[e.jsx(V,{id:"edit-groups-label",children:"Groups"}),e.jsx(B,{labelId:"edit-groups-label",multiple:!0,value:Y,onChange:Ue,label:"Groups",renderValue:s=>e.jsx(I,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s.map(r=>e.jsx(Q,{label:r,size:"small"},r))}),children:p.map(s=>e.jsx($,{value:s.name,children:s.name},s.id))})]})]}),e.jsxs(ce,{sx:{pr:3,pb:2},children:[e.jsx(M,{onClick:T,sx:{color:"#800000"},children:"Cancel"}),e.jsx(M,{variant:"contained",onClick:ke,disabled:h,sx:{backgroundColor:"#7267ef"},children:h?"Saving...":"Update"})]})]}),e.jsx(te,{open:!!f,autoHideDuration:4e3,onClose:()=>c(""),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(ne,{onClose:()=>c(""),severity:"error",variant:"filled",children:f})}),e.jsx(te,{open:!!w,autoHideDuration:3e3,onClose:()=>y(""),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(ne,{onClose:()=>y(""),severity:"success",variant:"filled",children:w})})]})};export{_s as default};
