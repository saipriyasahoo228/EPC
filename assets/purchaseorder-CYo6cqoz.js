import{r as l,j as e,T as C,x as V,S as M,D as N}from"./main-BIxdd69i.js";import{C as Z}from"./Close-D340Gps3.js";import{g as ee,h as re,i as te,j as se,k as oe,l as ae}from"./procurement-Dxzq-DH5.js";import{E as ne,a as le}from"./jspdf.plugin.autotable-y_YJgUzU.js";import{D as de}from"./Download-D_b47uoU.js";import{G as a}from"./Grid-BnZNKmae.js";import{P as A,I as h,e as S,D as ie,f as ce,g as ue,h as xe}from"./DialogTitle-D59uELMl.js";import{T as k,a as R,b as p,c as t,d as z}from"./TableRow-D8X36zJO.js";import{A as he}from"./AddCircle-Bn9h5MaP.js";import{T as me}from"./TableContainer-1Xqyy-f8.js";import{E as je}from"./Edit-BJV-h6Li.js";import{D as pe}from"./Delete-BHKbKfZ2.js";import{M as fe,a as ve}from"./minimize-2-Dl_U24Qm.js";const Me=()=>{const m="procurement",[B,U]=l.useState(""),[O,$]=l.useState(""),[f,T]=l.useState(null),[v,j]=l.useState(!1),[w,H]=l.useState([]),[g,y]=l.useState(!1),[D,q]=l.useState(!1),[F,E]=l.useState([]),[o,u]=l.useState({projectId:"",purchaseOrderId:"",vendorId:"",procurementId:"",orderDate:"",deliveryDate:"",totalOrderValue:"",paymentTerms:"",taxDetails:"",orderStatus:"",invoiceId:""}),[I,L]=l.useState([]),[ge,ye]=l.useState(0),W=()=>{q(!D)};l.useEffect(()=>{(async()=>{try{const s=await re();L(s)}catch(s){console.error("Failed to fetch procurements:",s)}})()},[]),l.useEffect(()=>{ee().then(r=>{console.log("Full API response:",r);const s=r.data||r;console.log("Vendors data to set:",s),Array.isArray(s)?E(s):(console.error("Received data is not an array:",s),E([]))}).catch(r=>console.error("Error fetching vendors:",r))},[]);const G=r=>{T(r),y(!1),j(!0)};l.useEffect(()=>{if(v&&f!==null){const r=I[f];u({projectId:r.project,procurementId:r.procurement_id,purchaseOrderId:r.purchase_order})}},[v,f]);const b=()=>{j(!1),T(null)},d=r=>{const{name:s,value:i}=r.target;u(c=>{const n={...c,[s]:i};if(s==="quantity"||s==="unitPrice"){const x=parseFloat(n.quantity)||0,P=parseFloat(n.unitPrice)||0,X=(x*P).toFixed(2);n.totalCost=X}return n})},_=async()=>{try{const r=await te();H(r)}catch(r){console.error("❌ Failed to fetch PO data:",r)}};l.useEffect(()=>{_()},[]);const Q=async r=>{var i,c,n;r.preventDefault();const s={vendor:o.vendorId,procurement:o.procurementId,po_number:o.purchaseOrderId,order_date:o.orderDate,delivery_date:o.deliveryDate,total_order_value:o.totalOrderValue,payment_terms:o.paymentTerms,tax_details:o.taxDetails,order_status:o.orderStatus,invoice_id:o.invoiceId||null};try{if(g)await oe(o.po_id,s),alert(`✅ Purchase Order Updated: ${o.po_id}`);else{const x=await ae(s);alert(`✅ Purchase Order Created: ${x.po_number}`)}u({}),j(!1),y(!1),_()}catch(x){const P=((n=(c=(i=x.response)==null?void 0:i.data)==null?void 0:c.po_number)==null?void 0:n[0])||"Operation failed";alert(`❌ ${P}`)}},Y=r=>{u({po_id:r.po_number,vendorId:r.vendor,procurementId:r.procurement,purchaseOrderId:r.po_number,orderDate:r.order_date,deliveryDate:r.delivery_date,totalOrderValue:r.total_order_value,paymentTerms:r.payment_terms,taxDetails:r.tax_details,orderStatus:r.order_status,invoiceId:r.invoice_id||""}),y(!0),j(!0)},J=async r=>{if(window.confirm(`Are you sure you want to delete Purchase Order ${r}?`))try{await se(r),console.log(`✅ Purchase Order ${r} deleted successfully.`),_()}catch(s){console.error(`❌ Failed to delete Purchase Order ${r}:`,s)}};I.filter(r=>Object.values(r).some(s=>s&&s.toString().toLowerCase().includes(O.toLowerCase())));const K=r=>{const s=new ne("l","mm","a4");s.setFontSize(16),s.text("All Purchase Order Report",14,15);const i=["PO Number","Vendor","Procurement","Order Date","Delivery Date","Total Order Value","Payment Terms","Tax Details","Order Status","Invoice ID"],c=r.map(n=>[n.po_number,n.vendor,n.procurement,n.order_date,n.delivery_date,n.total_order_value,n.payment_terms,n.tax_details,n.order_status,n.invoice_id]);le(s,{head:[i],body:c,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),s.save("purchase_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Purchase Order"}),e.jsx(a,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(A,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(C,{variant:"h6",gutterBottom:!0,children:"PURCHASE ORDERS"}),e.jsx(V,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Purchase Orders",value:B,onChange:r=>U(r.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(k,{children:[e.jsx(R,{children:e.jsxs(p,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Procurement ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Purchase Order ID"})}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(z,{children:I.map((r,s)=>e.jsxs(p,{children:[e.jsx(t,{children:r.project}),e.jsx(t,{children:r.procurement_id}),e.jsx(t,{children:r.purchase_order}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(M,{slug:m,action:"can_create",children:e.jsx(h,{onClick:()=>G(s),color:"primary",children:e.jsx(he,{sx:{color:"#7267ef"}})})})})]},r.id))})]})]})})}),e.jsx(a,{container:!0,spacing:2,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(A,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(S,{startIcon:e.jsx(de,{}),onClick:()=>K(w)}),e.jsx(C,{variant:"h6",gutterBottom:!0,children:"SUBMITTED PURCHASE RECORDS"}),e.jsx("input",{type:"text",placeholder:"Search Purchase Order Details",value:O,onChange:r=>$(r.target.value),className:"input"}),e.jsx(me,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(k,{stickyHeader:!0,children:[e.jsx(R,{children:e.jsxs(p,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"PO Number"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Vendor"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Procurement"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Order Date"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Delivery Date"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Total Value"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Payment Terms"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Tax Details"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Order Status"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Invoice ID"})}),e.jsx(t,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(z,{children:w.map((r,s)=>e.jsxs(p,{children:[e.jsx(t,{children:r.po_number}),e.jsx(t,{children:r.vendor}),e.jsx(t,{children:r.procurement}),e.jsx(t,{children:r.order_date}),e.jsx(t,{children:r.delivery_date}),e.jsx(t,{children:r.total_order_value}),e.jsx(t,{children:r.payment_terms}),e.jsx(t,{children:r.tax_details}),e.jsx(t,{children:r.order_status}),e.jsx(t,{children:r.invoice_id}),e.jsxs(t,{children:[e.jsx(N,{slug:m,action:"can_update",children:e.jsx(h,{color:"warning",onClick:()=>Y(r),children:e.jsx(je,{sx:{color:"orange"}})})}),e.jsx(M,{slug:m,action:"can_delete",children:e.jsx(h,{color:"error",onClick:()=>J(r.po_number),children:e.jsx(pe,{sx:{color:"red"}})})})]})]},r.id||s))})]})})]})})}),e.jsxs(ie,{open:v,onClose:b,fullWidth:!0,maxWidth:"xl",PaperProps:{style:D?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(ce,{children:"Enter Purchase Order Details"}),e.jsxs(ue,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(h,{"aria-label":"toggle-size",onClick:W,sx:{position:"absolute",right:40,top:8,color:r=>r.palette.grey[600]},children:D?e.jsx(fe,{}):e.jsx(ve,{})}),e.jsx(h,{"aria-label":"close",onClick:b,sx:{position:"absolute",right:8,top:8,color:r=>r.palette.grey[500]},children:e.jsx(Z,{})}),e.jsx(V,{component:"form",sx:{mt:2},children:e.jsxs(a,{container:!0,spacing:3,direction:"column",children:[e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Purchase Order & Vendor info.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"purchaseOrderId",children:"Purchase Order ID"}),e.jsx("input",{id:"purchaseOrderId",name:"purchaseOrderId",className:"input",value:o.purchaseOrderId||"",disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",name:"projectId",className:"input",value:o.projectId||"",disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"vendorId",children:"Vendor ID"}),e.jsxs("select",{id:"vendorId",name:"vendorId",className:"input",value:o.vendorId||"",onChange:r=>u({...o,vendorId:r.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Vendor --"}),Array.isArray(F)&&F.map(r=>e.jsxs("option",{value:r.vendor_id,children:[r.vendor_id," - ",r.vendor_name]},r.id))]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"procurementId",children:"Procurement ID"}),e.jsx("input",{id:"procurementId",name:"procurementId",className:"input",value:o.procurementId||"",disabled:!0})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Material Information & Payment.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"orderDate",children:"Order Date "}),e.jsx("input",{type:"date",id:"orderDate",name:"orderDate",className:"input",value:o.orderDate||"",onChange:d})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"deliveryDate",children:"Dalivery Date "}),e.jsx("input",{type:"date",id:"deliveryDate",name:"deliveryDate",className:"input",value:o.deliveryDate||"",onChange:d})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"totalOrderValue",children:"Total Order Value"}),e.jsx("input",{type:"number",id:"totalOrderValue",name:"totalOrderValue",className:"input",value:o.totalOrderValue||"",onChange:d})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"paymentTerms",children:"Payment Terms"}),e.jsx("input",{id:"paymentTerms",name:"paymentTerms",className:"input",value:o.paymentTerms||"",onChange:d})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Tax & Order Status.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"taxDetails",children:"Tax Details"}),e.jsx("input",{id:"taxDetails",name:"taxDetails",className:"input",value:o.taxDetails||"",onChange:d})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"orderStatus",children:"Order Status"}),e.jsxs("select",{id:"orderStatus",name:"orderStatus",className:"input",value:o.orderStatus||"",onChange:d,children:[e.jsx("option",{value:"",children:"Select Status"})," ",e.jsx("option",{value:"Issued",children:"Issued"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Delivered",children:"Delivered"}),e.jsx("option",{value:"Canceled",children:"Canceled"})]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"requestDate",children:"Invoice Id"}),e.jsx("input",{id:"invoiceId",name:"invoiceId",className:"input",value:o.invoiceId||"",onChange:d})]})]})]})]})})]}),e.jsxs(xe,{children:[e.jsx(S,{onClick:b,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(N,{slug:m,action:g?"can_update":"can_create",children:e.jsx(S,{variant:"outlined",onClick:Q,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:g?"Update":"Submit"})})]})]})]})};export{Me as default};
