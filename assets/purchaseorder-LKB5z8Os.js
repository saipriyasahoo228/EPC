import{r as n,j as e,T as C,J as V,E as M,S as N,I as h,K as A}from"./main-Skim5IJC.js";import{C as ee}from"./Close-BKZ7QrSY.js";import{g as re,h as te,i as se,j as ae,k as oe,l as le}from"./procurement-BWIn9uW6.js";import{E as ne,a as de}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{D as ie}from"./Download-C4sxsXoP.js";import{f as k}from"./date-DdrLtg20.js";import{G as o}from"./Grid-fY_ATwTx.js";import{T as R,a as B,b as p,c as s,d as z}from"./TableRow-B6k_bSOs.js";import{A as ce}from"./AddCircle-CJp4DZj3.js";import{B as O,D as ue,a as xe,b as he,c as me}from"./DialogTitle-CvDFHAwp.js";import{T as je}from"./TableContainer-gCCy6yK7.js";import{E as pe}from"./Edit-6vcT2Cu4.js";import{D as fe}from"./Delete-Be1vvbhC.js";import{M as ve,a as ye}from"./minimize-2-RCuvNn0X.js";const Ae=()=>{const m="procurement",[U,Y]=n.useState(""),[S,$]=n.useState(""),[f,T]=n.useState(null),[v,j]=n.useState(!1),[w,H]=n.useState([]),[y,g]=n.useState(!1),[D,q]=n.useState(!1),[F,E]=n.useState([]),[t,u]=n.useState({projectId:"",purchaseOrderId:"",vendorId:"",procurementId:"",orderDate:"",deliveryDate:"",totalOrderValue:"",paymentTerms:"",taxDetails:"",orderStatus:"",invoiceId:""}),[I,L]=n.useState([]),[ge,De]=n.useState(0),W=()=>{q(!D)};n.useEffect(()=>{(async()=>{try{const a=await te();L(a)}catch(a){console.error("Failed to fetch procurements:",a)}})()},[]),n.useEffect(()=>{re().then(r=>{console.log("Full API response:",r);const a=r.data||r;console.log("Vendors data to set:",a),Array.isArray(a)?E(a):(console.error("Received data is not an array:",a),E([]))}).catch(r=>console.error("Error fetching vendors:",r))},[]);const G=r=>{T(r),g(!1),j(!0)};n.useEffect(()=>{if(v&&f!==null){const r=I[f];u({projectId:r.project,procurementId:r.procurement_id,purchaseOrderId:r.purchase_order})}},[v,f]);const b=()=>{j(!1),T(null)},d=r=>{const{name:a,value:i}=r.target;u(c=>{const l={...c,[a]:i};if(a==="quantity"||a==="unitPrice"){const x=parseFloat(l.quantity)||0,_=parseFloat(l.unitPrice)||0,Z=(x*_).toFixed(2);l.totalCost=Z}return l})},P=async()=>{try{const r=await se();H(r)}catch(r){console.error("❌ Failed to fetch PO data:",r)}};n.useEffect(()=>{P()},[]);const Q=async r=>{var i,c,l;if(r.preventDefault(),!t.orderDate){alert("Please select the order date.");return}if(!t.deliveryDate){alert("Please select the delivery date.");return}if(!t.totalOrderValue||Number(t.totalOrderValue)<=0){alert("Please enter the total order value (must be greater than 0).");return}if(!t.paymentTerms||!t.paymentTerms.trim()){alert("Please enter the payment terms.");return}if(!t.taxDetails||!t.taxDetails.trim()){alert("Please enter the tax details.");return}const a={vendor:t.vendorId,procurement:t.procurementId,po_number:t.purchaseOrderId,order_date:t.orderDate,delivery_date:t.deliveryDate,total_order_value:t.totalOrderValue,payment_terms:t.paymentTerms,tax_details:t.taxDetails,order_status:t.orderStatus,invoice_id:t.invoiceId||null};try{if(y)await oe(t.po_id,a),alert(`✅ Purchase Order Updated: ${t.po_id}`);else{const x=await le(a);alert(`✅ Purchase Order Created: ${x.po_number}`)}u({}),j(!1),g(!1),P()}catch(x){const _=((l=(c=(i=x.response)==null?void 0:i.data)==null?void 0:c.po_number)==null?void 0:l[0])||"Operation failed";alert(`❌ ${_}`)}},J=r=>{u({po_id:r.po_number,vendorId:r.vendor,procurementId:r.procurement,purchaseOrderId:r.po_number,orderDate:r.order_date,deliveryDate:r.delivery_date,totalOrderValue:r.total_order_value,paymentTerms:r.payment_terms,taxDetails:r.tax_details,orderStatus:r.order_status,invoiceId:r.invoice_id||""}),g(!0),j(!0)},K=async r=>{if(window.confirm(`Are you sure you want to delete Purchase Order ${r}?`))try{await ae(r),console.log(`✅ Purchase Order ${r} deleted successfully.`),P()}catch(a){console.error(`❌ Failed to delete Purchase Order ${r}:`,a)}};I.filter(r=>Object.values(r).some(a=>a&&a.toString().toLowerCase().includes(S.toLowerCase())));const X=r=>{const a=new ne("l","mm","a4");a.setFontSize(16),a.text("All Purchase Order Report",14,15);const i=["PO Number","Vendor","Procurement","Order Date","Delivery Date","Total Order Value","Payment Terms","Tax Details","Order Status","Invoice ID"],c=r.map(l=>[l.po_number,l.vendor,l.procurement,l.order_date,l.delivery_date,l.total_order_value,l.payment_terms,l.tax_details,l.order_status,l.invoice_id]);de(a,{head:[i],body:c,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),a.save("purchase_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Purchase Order"}),e.jsx(o,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(o,{item:!0,xs:12,children:e.jsxs(V,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(C,{variant:"h6",gutterBottom:!0,children:"PURCHASE ORDERS"}),e.jsx(M,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Purchase Orders",value:U,onChange:r=>Y(r.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(R,{children:[e.jsx(B,{children:e.jsxs(p,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Procurement ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Purchase Order ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(z,{children:I.map((r,a)=>e.jsxs(p,{children:[e.jsx(s,{children:r.project}),e.jsx(s,{children:r.procurement_id}),e.jsx(s,{children:r.purchase_order}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(N,{slug:m,action:"can_create",children:e.jsx(h,{onClick:()=>G(a),color:"primary",children:e.jsx(ce,{sx:{color:"#7267ef"}})})})})]},r.id))})]})]})})}),e.jsx(o,{container:!0,spacing:2,children:e.jsx(o,{item:!0,xs:12,children:e.jsxs(V,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(O,{startIcon:e.jsx(ie,{}),onClick:()=>X(w)}),e.jsx(C,{variant:"h6",gutterBottom:!0,children:"SUBMITTED PURCHASE RECORDS"}),e.jsx("input",{type:"text",placeholder:"Search Purchase Order Details",value:S,onChange:r=>$(r.target.value),className:"input"}),e.jsx(je,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(R,{stickyHeader:!0,children:[e.jsx(B,{children:e.jsxs(p,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"PO Number"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Vendor"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Procurement"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Order Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Delivery Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Total Value"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Payment Terms"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Tax Details"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Order Status"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Invoice ID"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(z,{children:w.map((r,a)=>e.jsxs(p,{children:[e.jsx(s,{children:r.po_number}),e.jsx(s,{children:r.vendor}),e.jsx(s,{children:r.procurement}),e.jsx(s,{children:k(r.order_date)}),e.jsx(s,{children:k(r.delivery_date)}),e.jsx(s,{children:r.total_order_value}),e.jsx(s,{children:r.payment_terms}),e.jsx(s,{children:r.tax_details}),e.jsx(s,{children:r.order_status}),e.jsx(s,{children:r.invoice_id}),e.jsxs(s,{children:[e.jsx(A,{slug:m,action:"can_update",children:e.jsx(h,{color:"warning",onClick:()=>J(r),children:e.jsx(pe,{sx:{color:"orange"}})})}),e.jsx(N,{slug:m,action:"can_delete",children:e.jsx(h,{color:"error",onClick:()=>K(r.po_number),children:e.jsx(fe,{sx:{color:"red"}})})})]})]},r.id||a))})]})})]})})}),e.jsxs(ue,{open:v,onClose:b,fullWidth:!0,maxWidth:"xl",PaperProps:{style:D?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(xe,{children:"Enter Purchase Order Details"}),e.jsxs(he,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(h,{"aria-label":"toggle-size",onClick:W,sx:{position:"absolute",right:40,top:8,color:r=>r.palette.grey[600]},children:D?e.jsx(ve,{}):e.jsx(ye,{})}),e.jsx(h,{"aria-label":"close",onClick:b,sx:{position:"absolute",right:8,top:8,color:r=>r.palette.grey[500]},children:e.jsx(ee,{})}),e.jsx(M,{component:"form",sx:{mt:2},children:e.jsxs(o,{container:!0,spacing:3,direction:"column",children:[e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Purchase Order & Vendor info.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"purchaseOrderId",children:"Purchase Order ID"}),e.jsx("input",{id:"purchaseOrderId",name:"purchaseOrderId",className:"input",value:t.purchaseOrderId||"",disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",name:"projectId",className:"input",value:t.projectId||"",disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"vendorId",children:"Vendor ID"}),e.jsxs("select",{id:"vendorId",name:"vendorId",className:"input",value:t.vendorId||"",onChange:r=>u({...t,vendorId:r.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Vendor --"}),Array.isArray(F)&&F.map(r=>e.jsxs("option",{value:r.vendor_id,children:[r.vendor_id," - ",r.vendor_name]},r.id))]})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"procurementId",children:"Procurement ID"}),e.jsx("input",{id:"procurementId",name:"procurementId",className:"input",value:t.procurementId||"",disabled:!0})]})]})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Material Information & Payment.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"orderDate",children:["Order Date ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"date",id:"orderDate",name:"orderDate",className:"input",value:t.orderDate||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"deliveryDate",children:["Delivery Date ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"date",id:"deliveryDate",name:"deliveryDate",className:"input",value:t.deliveryDate||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"totalOrderValue",children:["Total Order Value ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"number",id:"totalOrderValue",name:"totalOrderValue",className:"input",value:t.totalOrderValue||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"paymentTerms",children:["Payment Terms ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"paymentTerms",name:"paymentTerms",className:"input",value:t.paymentTerms||"",onChange:d})]})]})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Tax & Order Status.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"taxDetails",children:["Tax Details ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"taxDetails",name:"taxDetails",className:"input",value:t.taxDetails||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"orderStatus",children:"Order Status"}),e.jsxs("select",{id:"orderStatus",name:"orderStatus",className:"input",value:t.orderStatus||"",onChange:d,children:[e.jsx("option",{value:"",children:"Select Status"})," ",e.jsx("option",{value:"Issued",children:"Issued"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Delivered",children:"Delivered"}),e.jsx("option",{value:"Canceled",children:"Canceled"})]})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"requestDate",children:"Invoice Id"}),e.jsx("input",{id:"invoiceId",name:"invoiceId",className:"input",value:t.invoiceId||"",onChange:d})]})]})]})]})})]}),e.jsxs(me,{children:[e.jsx(O,{onClick:b,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(A,{slug:m,action:y?"can_update":"can_create",children:e.jsx(O,{variant:"outlined",onClick:Q,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:y?"Update":"Submit"})})]})]})]})};export{Ae as default};
