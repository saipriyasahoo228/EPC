import{r as o,j as e,T as u,z as g}from"./main-IxGEKZMA.js";import{g as ee,a as se,d as re,u as te,c as ne}from"./engineering-BuN6Pdrr.js";import{C as ie}from"./Close-DoqWsXz3.js";import{G as n}from"./Grid-C72N-tAO.js";import{t as k,T as q,h as L,i as f,j as r,k as M,I as d,D as ae,f as oe,g as le,e as B}from"./TableRow-CRAT5KT_.js";import{A as de}from"./AddCircle-DWIRGPUh.js";import{A as $,a as O}from"./ArrowForwardIos-CgfNjsk_.js";import{T as ce}from"./TableContainer-BaU58JEj.js";import{E as pe}from"./Edit-g2hjeeYC.js";import{D as xe}from"./Delete-cHl_EB0l.js";import{D as ue}from"./DialogActions-D5wP0Mt-.js";import"./Transition-C29ZPDdz.js";const _e=()=>{const[h,U]=o.useState(""),[N,G]=o.useState(""),[H,j]=o.useState(!1),[P,v]=o.useState(""),[t,c]=o.useState({}),[T,Q]=o.useState([]),[y,V]=o.useState([]),[b,C]=o.useState(null),[Y,I]=o.useState("create"),m=4,[p,R]=o.useState(1),[x,F]=o.useState(1),D=5;o.useEffect(()=>{(async()=>{try{const i=await ee();V(i)}catch(i){console.error("Error fetching projects:",i)}})()},[]);const S=async()=>{try{const s=await se();Q(s)}catch(s){console.error("Error fetching design plans:",s)}};o.useEffect(()=>{S()},[]);const z=async()=>{const s=new FormData;if(s.append("project",P),s.append("design_name",t.designName),s.append("design_type",t.designType),s.append("prepared_by",t.preparedBy),s.append("version_number",t.versionNumber),s.append("reviewed_by",t.reviewedBy||""),s.append("approval_status",t.approvalStatus||"Pending"),s.append("approval_date",t.approvalDate||""),s.append("compliance_standard",t.complianceStandard),s.append("design_constraints",t.designConstraints),s.append("estimated_budget",t.estimatedBudget),s.append("resource_requirements",t.resourceRequirements),s.append("design_completion_date",t.designCompletionDate),s.append("status",t.status),t.blueprint)s.append("blueprint",t.blueprint);else if(!b){alert("Please upload a blueprint file.");return}try{let i;b?(s.append("design_id",t.designId),i=await te(b,s),alert("✅ Design updated successfully")):(i=await ne(s),alert("✅ Design submitted successfully")),await S(),c({designName:"",designType:"",preparedBy:"",versionNumber:"",reviewedBy:"",approvalStatus:"",approvalDate:"",complianceStandard:"",designConstraints:"",estimatedBudget:"",resourceRequirements:"",designCompletionDate:"",status:"",blueprint:null,projectCode:"",designId:""}),v(null),C(null),j(!1)}catch(i){if(i.response){console.error("Backend Error:",i.response.data);const l=typeof i.response.data=="object"?Object.entries(i.response.data).map(([_,Z])=>`${_}: ${Z}`).join(`
`):i.response.data;alert(`❌ Submission failed:
${l}`)}else console.error("Network/Other Error:",i.message),alert(`❌ Submission failed: ${i.message}`)}},J=s=>{I("edit"),C(s.design_id),v(s.project),c({designId:s.design_id,designName:s.design_name,designType:s.design_type,versionNumber:s.version_number,preparedBy:s.prepared_by,reviewedBy:s.reviewed_by,approvalStatus:s.approval_status,approvalDate:s.approval_date,complianceStandard:s.compliance_standard,designConstraints:s.design_constraints,estimatedBudget:s.estimated_budget,resourceRequirements:s.resource_requirements,designCompletionDate:s.design_completion_date,status:s.status,blueprint:null,projectCode:""}),j(!0)},W=async s=>{var i;if(window.confirm(`Are you sure you want to delete ${s}?`))try{await re(s),alert(`Design ${s} deleted successfully ✅`),await S()}catch(l){console.error("Delete failed:",((i=l.response)==null?void 0:i.data)||l.message),alert("❌ Failed to delete the design.")}},K=s=>{I("create"),v(s);const i=new Date().getFullYear(),l=String(T.length+1).padStart(4,"0");c({designId:`DES-${i}-${l}`,designName:"",designType:"",preparedBy:"",versionNumber:"",reviewedBy:"",approvalStatus:"Pending",approvalDate:"",complianceStandard:"",designConstraints:"",estimatedBudget:"",resourceRequirements:"",designCompletionDate:"",status:"",blueprint:null,projectCode:""}),C(null),j(!0)},w=()=>j(!1),a=s=>{const{name:i,value:l}=s.target;c(_=>({..._,[i]:l}))},E=T.filter(s=>Object.values(s).some(i=>i&&i.toString().toLowerCase().includes(N.toLowerCase()))),A=Math.ceil(E.length/D),X=E.slice((x-1)*D,x*D);return e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Design Management"}),e.jsx(n,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(k,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(u,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(g,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:h,onChange:s=>U(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(q,{children:[e.jsx(L,{children:e.jsxs(f,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(M,{children:y.filter(s=>s.project_id.toLowerCase().includes(h.toLowerCase())).slice((p-1)*m,p*m).map((s,i)=>e.jsxs(f,{children:[e.jsx(r,{children:s.project_id}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(d,{onClick:()=>K(s.project_id),color:"primary",children:e.jsx(de,{sx:{color:"#7267ef"}})})})]},i))})]}),e.jsxs(g,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(d,{disabled:p===1,onClick:()=>R(s=>s-1),children:e.jsx($,{})}),e.jsxs(u,{variant:"body2",sx:{mx:2},children:["Page ",p," of ",Math.ceil(y.filter(s=>s.project_id.toLowerCase().includes(h.toLowerCase())).length/m)]}),e.jsx(d,{disabled:p>=Math.ceil(y.filter(s=>s.project_id.toLowerCase().includes(h.toLowerCase())).length/m),onClick:()=>R(s=>s+1),children:e.jsx(O,{})})]})]})})}),e.jsx(n,{container:!0,spacing:2,children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(k,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(u,{variant:"h6",gutterBottom:!0,children:"SUBMITTED DESIGNS"}),e.jsx("input",{type:"text",placeholder:"Search Designs",value:N,onChange:s=>G(s.target.value),className:"input"}),e.jsx(ce,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(q,{stickyHeader:!0,children:[e.jsx(L,{children:e.jsxs(f,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Design ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Name"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Type"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Version"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Prepared By"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Reviewed By"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Status"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Date"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Constraints"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Budget"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Resources"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Completion Date"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Status"})}),e.jsx(r,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(M,{children:X.map((s,i)=>e.jsxs(f,{children:[e.jsx(r,{children:s.project}),e.jsx(r,{children:s.design_id}),e.jsx(r,{children:s.design_name}),e.jsx(r,{children:s.design_type}),e.jsx(r,{children:s.version_number}),e.jsx(r,{children:s.prepared_by}),e.jsx(r,{children:s.reviewed_by}),e.jsx(r,{children:s.approval_status}),e.jsx(r,{children:s.approval_date}),e.jsx(r,{children:s.compliance_standard}),e.jsx(r,{children:s.design_constraints}),e.jsx(r,{children:s.estimated_budget}),e.jsx(r,{children:s.resource_requirements}),e.jsx(r,{children:s.design_completion_date}),e.jsx(r,{children:s.status}),e.jsxs(r,{children:[e.jsx(d,{color:"warning",onClick:()=>J(s),children:e.jsx(pe,{sx:{color:"orange"}})}),e.jsx(d,{color:"error",onClick:()=>W(s.design_id),children:e.jsx(xe,{sx:{color:"red"}})})]})]},i))})]})}),e.jsxs(g,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(d,{disabled:x===1,onClick:()=>F(s=>s-1),children:e.jsx($,{})}),e.jsxs(u,{variant:"body2",sx:{mx:2},children:["Page ",x," of ",A||1]}),e.jsx(d,{disabled:x>=A,onClick:()=>F(s=>s+1),children:e.jsx(O,{})})]})]})})}),e.jsxs(ae,{open:H,onClose:w,fullWidth:!0,children:[e.jsx(oe,{children:"Enter Design Details"}),e.jsxs(le,{sx:{position:"relative"},children:[e.jsx(d,{"aria-label":"close",onClick:w,sx:{position:"absolute",right:8,top:8,color:s=>s.palette.grey[500]},children:e.jsx(ie,{})}),e.jsx(g,{component:"form",sx:{mt:2},children:e.jsxs(n,{container:!0,spacing:3,direction:"column",children:[e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:P,disabled:!0})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"designId",children:"Design ID"}),e.jsx("input",{id:"designId",className:"input",value:t.designId||"",disabled:!0})]})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Design Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"designName",children:"Design Name"}),e.jsx("input",{id:"designName",name:"designName",className:"input",value:t.designName||"",onChange:a})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"designType",children:"Design Type"}),e.jsxs("select",{id:"designType",name:"designType",className:"input",value:t.designType||"",onChange:a,children:[e.jsx("option",{value:"",children:"Select Type"}),["Architectural","Structural","Electrical","Mechanical","Civil"].map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"versionNumber",children:"Version Number"}),e.jsx("input",{id:"versionNumber",name:"versionNumber",className:"input",value:t.versionNumber||"",onChange:a})]})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Approval Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"preparedBy",children:"Prepared By"}),e.jsx("input",{id:"preparedBy",name:"preparedBy",className:"input",value:t.preparedBy||"",onChange:a})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"reviewedBy",children:"Reviewed By"}),e.jsx("input",{id:"reviewedBy",name:"reviewedBy",className:"input",value:t.reviewedBy||"",onChange:a})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:t.approvalStatus||"",onChange:a,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"}),e.jsx("option",{value:"Under Review",children:"Under Review"})]})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalDate",children:"Approval Date"}),e.jsx("input",{type:"date",id:"approvalDate",name:"approvalDate",className:"input",value:t.approvalDate||"",onChange:a})]})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Budget and Requirements"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"complianceStandard",children:"Compliance Standard"}),e.jsx("input",{id:"complianceStandard",name:"complianceStandard",className:"input",value:t.complianceStandard||"",onChange:a})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"designConstraints",children:"Design Constraints"}),e.jsx("textarea",{id:"designConstraints",name:"designConstraints",className:"input",rows:3,value:t.designConstraints||"",onChange:a})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"estimatedBudget",children:"Estimated Budget"}),e.jsx("input",{type:"number",id:"estimatedBudget",name:"estimatedBudget",className:"input",value:t.estimatedBudget||"",onChange:a})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"resourceRequirements",children:"Resource Requirements"}),e.jsx("textarea",{id:"resourceRequirements",name:"resourceRequirements",className:"input",rows:3,value:t.resourceRequirements||"",onChange:a})]})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Status and Actions"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"designCompletionDate",children:"Design Completion Date"}),e.jsx("input",{type:"date",id:"designCompletionDate",name:"designCompletionDate",className:"input",value:t.designCompletionDate||"",onChange:a})]}),e.jsxs("select",{id:"status",name:"status",className:"input",value:t.status||"",onChange:a,required:!0,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Draft",children:"Draft"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Completed",children:"Completed"})]})]})]}),e.jsxs(B,{variant:"contained",component:"label",children:["Upload Blueprints/Documents",e.jsx("input",{type:"file",hidden:!0,onChange:s=>c({...t,blueprint:s.target.files[0]})})]})]})})]}),e.jsxs(ue,{children:[e.jsx(B,{onClick:w,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(B,{variant:"outlined",onClick:z,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:Y==="edit"?"Update Design":"Submit Design"})]})]})]})};export{_e as default};
