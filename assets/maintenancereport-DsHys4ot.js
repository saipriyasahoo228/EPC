import{r as o,j as e,T as C,J as M,E as F,S as W,I as h,K as T}from"./main-Skim5IJC.js";import{C as X}from"./Close-BKZ7QrSY.js";import{g as Z,f as E,h as ee,i as te,j as se}from"./maintenance-DLF_HkF3.js";import{f as d}from"./date-DdrLtg20.js";import{D as re}from"./Download-C4sxsXoP.js";import{E as ne,a as ae}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{G as a}from"./Grid-fY_ATwTx.js";import{T as A,a as B,b as f,c as s,d as N}from"./TableRow-B6k_bSOs.js";import{A as oe}from"./AddCircle-CJp4DZj3.js";import{B as I,D as ie,a as le,b as ce,c as de}from"./DialogTitle-CvDFHAwp.js";import{T as pe}from"./TableContainer-gCCy6yK7.js";import{E as xe}from"./Edit-6vcT2Cu4.js";import{D as he}from"./Delete-Be1vvbhC.js";import{M as ue,a as me}from"./minimize-2-RCuvNn0X.js";const We=()=>{const u="maintenance",[b,O]=o.useState(""),[y,P]=o.useState(""),[z,g]=o.useState(!1),[je,Y]=o.useState(""),[n,p]=o.useState({}),[w,_]=o.useState([]),[m,k]=o.useState(null),[fe,R]=o.useState(null),[L,$]=o.useState([]),[D,G]=o.useState(!1),[H,S]=o.useState(!1),U=()=>{G(!D)};o.useEffect(()=>{(async()=>{try{const r=await Z();$(r)}catch(r){console.error("❌ Error loading assets:",r)}})()},[]),o.useEffect(()=>{(async()=>{try{const r=await E();_(r)}catch(r){console.error("❌ Failed to load work orders:",r)}})()},[]);const Q=t=>{Y(t);const r=new Date().getFullYear(),x=(w.length+1).toString().padStart(4,"0");p({workOrderID:`WO-${r}-${x}`,assetId:t}),S(!1),R(null),g(!0)},J=t=>{p({workOrderID:t.work_order_id,assetId:t.asset,reportedIssue:t.reported_issue,issueReportedBy:t.issue_reported_by,reportDate:t.report_date,inspectionDate:t.inspection_date,technicianId:t.technician_id,repairWorkDone:t.repair_work_done,partsReplaced:t.parts_replaced,totalMaintenanceCost:t.total_maintenance_cost,completionDate:t.completion_date,finalStatus:t.final_status}),k(t.work_order_id),g(!0)},K=async t=>{if(window.confirm(`Are you sure you want to delete this work order?  ${t}`))try{await ee(t),alert(`🗑️ Work order ${t} deleted successfully`),_(r=>r.filter(c=>c.work_order_id!==t))}catch(r){alert("❌ Failed to delete work order"),console.error(r)}},j=()=>{g(!1),p({}),S(!1),R(null)},i=t=>{const{name:r,value:c}=t.target;p(x=>({...x,[r]:c}))},q=async()=>{try{const t={asset:n.assetId,reported_issue:n.reportedIssue,issue_reported_by:n.issueReportedBy,report_date:n.reportDate,inspection_date:n.inspectionDate||null,technician_id:n.technicianId,repair_work_done:n.repairWorkDone,parts_replaced:n.partsReplaced||null,total_maintenance_cost:parseFloat(n.totalMaintenanceCost||0),completion_date:n.completionDate||null,final_status:n.finalStatus};if(m){const c=await te(m,t);alert(`✏️ Work order updated: ${c.work_order_id}`)}else{const c=await se(t);alert(`✅ Work order created: ${c.work_order_id}`)}const r=await E();_(r),j(),k(null),p({})}catch(t){alert("❌ Failed to save work order"),console.error(t)}},v=w.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(y.toLowerCase()))),V=t=>{const r=new ne("l","mm","a4");r.setFontSize(16),r.text("All Maintenance Management Report",14,15);const c=["Asset ID","WorkOrder ID","Reported Issues","Issues Reported By","Report Date","Inspection Date","Technician ID","Repair Work Done","Parts Replaced","Total Maintenance Cost","Completion Date","Final Status"],x=t.map(l=>[l.asset,l.work_order_id,l.reported_issue,l.issue_reported_by,d(l.report_date),d(l.inspection_date),l.technician_id,l.repair_work_done,l.parts_replaced,l.total_maintenance_cost,d(l.completion_date),l.final_status]);ae(r,{head:[c],body:x,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),r.save("all_maintenance_management_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Maintenance Management Report"}),e.jsx(a,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(M,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(C,{variant:"h6",gutterBottom:!0,children:"ASSETS RECORDS"}),e.jsx(F,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Asset ID",value:b,onChange:t=>O(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(A,{children:[e.jsx(B,{children:e.jsxs(f,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(N,{children:L.filter(t=>t.asset_id.toLowerCase().includes(b.toLowerCase())).map((t,r)=>e.jsxs(f,{children:[e.jsx(s,{children:t.asset_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(W,{slug:u,action:"can_create",children:e.jsx(h,{onClick:()=>Q(t.asset_id),color:"primary",children:e.jsx(oe,{sx:{color:"#7267ef"}})})})})]},r))})]})]})})}),e.jsx(a,{container:!0,spacing:2,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(M,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(I,{startIcon:e.jsx(re,{}),onClick:()=>V(v),children:"Download PDF"}),e.jsx(C,{variant:"h6",gutterBottom:!0,children:"Maintenance Management Report"}),e.jsx("input",{type:"text",placeholder:"Search Maintenance Details",value:y,onChange:t=>P(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(pe,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(A,{stickyHeader:!0,children:[e.jsx(B,{children:e.jsxs(f,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"WorkOrder ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Reported Issuees"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Issuees ReportedBy"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Report Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Technician ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Repair WorkDone"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Parts Replaced"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Total Maintenance Cost"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Completion Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Final Status"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(N,{children:v.map((t,r)=>e.jsxs(f,{children:[e.jsx(s,{children:t.asset}),e.jsx(s,{children:t.work_order_id}),e.jsx(s,{children:t.reported_issue}),e.jsx(s,{children:t.issue_reported_by}),e.jsx(s,{children:d(t.report_date)}),e.jsx(s,{children:d(t.inspection_date)}),e.jsx(s,{children:t.technician_id}),e.jsx(s,{children:t.repair_work_done}),e.jsx(s,{children:t.parts_replaced}),e.jsx(s,{children:t.total_maintenance_cost}),e.jsx(s,{children:d(t.completion_date)}),e.jsx(s,{children:t.final_status}),e.jsxs(s,{children:[e.jsx(T,{slug:u,action:"can_update",children:e.jsx(h,{onClick:()=>J(t),color:"warning",children:e.jsx(xe,{sx:{color:"orange"}})})}),e.jsx(W,{slug:u,action:"can_delete",children:e.jsx(h,{onClick:()=>K(t.work_order_id),color:"error",children:e.jsx(he,{sx:{color:"red"}})})})]})]},r))})]})})]})})}),e.jsxs(ie,{open:z,onClose:j,fullWidth:!0,maxWidth:"xl",PaperProps:{style:D?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(le,{children:H?"Edit Maintenance Report":"Enter Maintenance Report"}),e.jsxs(ce,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(h,{"aria-label":"toggle-size",onClick:U,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:D?e.jsx(ue,{}):e.jsx(me,{})}),e.jsx(h,{"aria-label":"close",onClick:j,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(X,{})}),e.jsx(F,{component:"form",sx:{mt:2},children:e.jsx(a,{container:!0,spacing:3,direction:"column",children:e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Maintenance Report"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Asset ID"}),e.jsx("input",{id:"projectId",name:"projectId",className:"input",value:n.assetId||"",onChange:i,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"workOrderID",children:"Work Order ID"}),e.jsx("input",{id:"workOrderID",name:"workOrderID",className:"input",value:n.workOrderID||"",onChange:i,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"reportedIssue",children:"Reported Issue"}),e.jsx("textarea",{id:"reportedIssue",name:"reportedIssue",className:"input",rows:"3",value:n.reportedIssue||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"issueReportedBy",children:"Issue Reported By"}),e.jsx("input",{id:"issueReportedBy",name:"issueReportedBy",className:"input",value:n.issueReportedBy||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"reportDate",children:"Report Date"}),e.jsx("input",{type:"date",id:"reportDate",name:"reportDate",className:"input",value:n.reportDate||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionDate",children:"Inspection Date"}),e.jsx("input",{type:"date",id:"inspectionDate",name:"inspectionDate",className:"input",value:n.inspectionDate||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"technicianId",children:"Technician ID"}),e.jsx("input",{id:"technicianId",name:"technicianId",className:"input",value:n.technicianId||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"repairWorkDone",children:"Repair Work Done"}),e.jsx("textarea",{id:"repairWorkDone",name:"repairWorkDone",className:"input",rows:"3",value:n.repairWorkDone||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"partsReplaced",children:"Parts Replaced"}),e.jsx("textarea",{id:"partsReplaced",name:"partsReplaced",className:"input",rows:"2",value:n.partsReplaced||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"totalMaintenanceCost",children:"Total Maintenance Cost"}),e.jsx("input",{type:"number",step:"0.01",id:"totalMaintenanceCost",name:"totalMaintenanceCost",className:"input",value:n.totalMaintenanceCost||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"completionDate",children:"Completion Date"}),e.jsx("input",{type:"date",id:"completionDate",name:"completionDate",className:"input",value:n.completionDate||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"finalStatus",children:"Final Status"}),e.jsxs("select",{id:"finalStatus",name:"finalStatus",className:"input",value:n.finalStatus||"",onChange:i,children:[e.jsx("option",{value:"",children:"-- Select Status --"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Pending",children:"Pending Approval"})]})]})]})]})})})]}),e.jsxs(de,{children:[e.jsx(I,{onClick:j,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(T,{slug:u,action:m?"can_update":"can_create",children:e.jsx(I,{variant:"outlined",onClick:q,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:m?"Update":"Create"})})]})]})]})};export{We as default};
