import{r as l,j as e,T as f,z as b}from"./main-IxGEKZMA.js";import{C as H}from"./Close-DoqWsXz3.js";import{a as G,g as K,b as P,e as Q,f as Y}from"./inventory-TCBUaCbN.js";import{G as n}from"./Grid-C72N-tAO.js";import{t as C,T as _,h as B,i as m,j as t,k as v,I as p,D as z,f as W,g as q,e as w}from"./TableRow-CRAT5KT_.js";import{A as J}from"./AddCircle-DWIRGPUh.js";import{T as X}from"./TableContainer-BaU58JEj.js";import{E as Z}from"./Edit-g2hjeeYC.js";import{D as ee}from"./Delete-cHl_EB0l.js";import{D as se}from"./DialogActions-D5wP0Mt-.js";import"./Transition-C29ZPDdz.js";const he=()=>{const[S,D]=l.useState(""),[I,T]=l.useState(""),[F,j]=l.useState(!1),[E,M]=l.useState([]),[x,k]=l.useState(""),[r,u]=l.useState({}),[y,N]=l.useState([]),$=s=>{const o=new Date().getFullYear(),a=y.length+1,c=`STK-${o}-${String(a).padStart(3,"0")}`;k(null),u({itemId:s,stockManagementId:c,openingStock:"",stockIssued:"",stockIssuedBy:"",stockBalance:"",stockValuation:"",lastUpdated:new Date().toISOString().split("T")[0]}),j(!0)},h=()=>{u({}),j(!1)};l.useEffect(()=>{(async()=>{try{const o=await K();M(o)}catch(o){console.error("Error loading inventory items:",o)}})()},[]),l.useEffect(()=>{g()},[]);const g=async()=>{try{const s=await G();N(s),setFilteredStockManagement(s)}catch(s){console.error("Error loading stock management:",s)}},d=s=>{const{name:o,value:a}=s.target;u(c=>{let i={...c,[o]:a};if(o==="openingStock"||o==="stockIssued"){const R=parseFloat(i.openingStock)||0,L=parseFloat(i.stockIssued)||0;i.stockBalance=R-L}return i})},O=s=>{u({stockManagementId:s.stock_id,itemId:s.item,openingStock:s.opening_stock,stockIssued:s.stock_issued,stockIssuedBy:s.stock_issued_by,stockBalance:s.stock_balance,stockValuation:s.stock_valuation,lastUpdated:s.last_updated}),k(s.stock_id||s.stockManagementId),j(!0)},U=async()=>{var s,o;try{const a={item:r.itemId,opening_stock:Number(r.openingStock)||0,stock_issued:Number(r.stockIssued)||0,stock_issued_by:r.stockIssuedBy,stock_valuation:Number(r.stockValuation)||0,last_updated:r.lastUpdated||new Date().toISOString().split("T")[0]};let c;x?c=await Q(x,a):c=await Y(a),console.log("✅ API Response:",c);let i=`✅ ${c.message||(x?"Stock updated":"Stock created")}`;(s=c.data)!=null&&s.stock_id&&(i+=`
Stock ID: ${c.data.stock_id}`),c.alert&&(i+=`

⚠️ ${c.alert}`),alert(i),await g(),u({}),k(null),h()}catch(a){console.error(`❌ Error ${x?"updating":"creating"} stock:`,a),alert(`⚠️ Failed to ${x?"update":"create"} stock:
${((o=a.response)==null?void 0:o.data)||a.message}`)}},V=async s=>{if(window.confirm(`Are you sure you want to delete stock ${s}?`))try{await P(s),await g(),alert(`✅ Stock ${s} deleted successfully`)}catch(a){alert(`❌ Failed to delete stock ${s}`),console.error(`Error deleting stock ${s}:`,a)}},A=y.filter(s=>Object.values(s).some(o=>o&&o.toString().toLowerCase().includes(I.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Stock Management"}),e.jsx(n,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(C,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(f,{variant:"h6",gutterBottom:!0,children:"ITEM RECORDS"}),e.jsx(b,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Item ID",value:S,onChange:s=>D(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(_,{children:[e.jsx(B,{children:e.jsxs(m,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Item ID"})}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(v,{children:E.filter(s=>s.item_id.toLowerCase().includes(S.toLowerCase())).map((s,o)=>e.jsxs(m,{children:[e.jsx(t,{children:s.item_id}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(p,{onClick:()=>$(s.item_id),color:"primary",children:e.jsx(J,{sx:{color:"#7267ef"}})})})]},o))})]})]})})}),e.jsx(n,{container:!0,spacing:2,children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(C,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(f,{variant:"h6",gutterBottom:!0,children:"SUBMITTED STOCKS"}),e.jsx("input",{type:"text",placeholder:"Search Stock Management",value:I,onChange:s=>T(s.target.value),className:"input",style:{width:"100%",padding:"8px",marginBottom:"1rem",border:"1px solid #ccc",borderRadius:4}}),e.jsx(X,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(_,{stickyHeader:!0,children:[e.jsx(B,{children:e.jsxs(m,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Item ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Opening Stock"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock Issued"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock Issued By"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock Balance"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock Valuation"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Last Updated"})}),e.jsx(t,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(v,{children:A.map((s,o)=>e.jsxs(m,{children:[e.jsx(t,{children:s.item})," ",e.jsx(t,{children:s.stock_id})," ",e.jsx(t,{children:s.opening_stock}),e.jsx(t,{children:s.stock_issued}),e.jsx(t,{children:s.stock_issued_by}),e.jsx(t,{children:s.stock_balance}),e.jsx(t,{children:s.stock_valuation}),e.jsx(t,{children:s.last_updated}),e.jsxs(t,{children:[e.jsx(p,{color:"warning",onClick:()=>O(s),children:e.jsx(Z,{sx:{color:"orange"}})}),e.jsx(p,{color:"error",onClick:()=>V(s.stock_id),children:e.jsx(ee,{sx:{color:"red"}})})]})]},o))})]})})]})})}),e.jsxs(z,{open:F,onClose:h,fullWidth:!0,children:[e.jsx(W,{children:"Enter Stock Management Details"}),e.jsxs(q,{sx:{position:"relative"},children:[e.jsx(p,{"aria-label":"close",onClick:h,sx:{position:"absolute",right:8,top:8,color:s=>s.palette.grey[500]},children:e.jsx(H,{})}),e.jsx(b,{component:"form",sx:{mt:2},children:e.jsxs(n,{container:!0,spacing:3,direction:"column",children:[e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Stock Id's Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"itemId",children:"Item ID"}),e.jsx("input",{id:"itemId",name:"itemId",className:"input",value:r.itemId||"",disabled:!0})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockManagementId",children:"Stock Id"}),e.jsx("input",{id:"stockManagementId",name:"stockManagementId",className:"input",value:r.stockManagementId||"",disabled:!0})]})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Stock Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"openingStock",children:"Opening Stock"}),e.jsx("input",{id:"openingStock",name:"openingStock",className:"input",value:r.openingStock||"",onChange:d,type:"number"})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockIssued",children:"Stock Issued"}),e.jsx("input",{type:"number",id:"stockIssued",name:"stockIssued",className:"input",value:r.stockIssued||"",onChange:d})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockIssuedBy",children:"Stock Issued By"}),e.jsx("input",{id:"stockIssuedBy",name:"stockIssuedBy",className:"input",value:r.stockIssuedBy||"",onChange:d})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Stock Balance and Valuations"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockBalance",children:"Stock Balance"}),e.jsx("input",{id:"stockBalance",name:"stockBalance",className:"input",value:r.stockBalance||"",onChange:d,readOnly:!0})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockValuation",children:"Stock Valuation"}),e.jsx("input",{id:"stockValuation",name:"stockValuation",className:"input",value:r.stockValuation||"",onChange:d})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"lastUpdated",children:"Last Updated "}),e.jsx("input",{type:"date",id:"lastUpdated",name:"lastUpdated",className:"input",value:r.lastUpdated||"",onChange:d})]})]})]})})]}),e.jsxs(se,{children:[e.jsx(w,{onClick:h,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(w,{variant:"outlined",onClick:U,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:"Submit"})]})]})]})};export{he as default};
