import{r as a,j as e,T as v,J as F,E as B,S as L,I as x,K as M}from"./main-Skim5IJC.js";import{C as ee}from"./Close-BKZ7QrSY.js";import{D as te}from"./Download-C4sxsXoP.js";import{E as ie,a as se}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{g as oe}from"./engineering-BJ3wTiKO.js";import{h as ne,i as re,j as ce,k as ae}from"./commision-Dp7iUYLu.js";import{f}from"./date-DdrLtg20.js";import{G as o}from"./Grid-fY_ATwTx.js";import{T as A,a as R,b as g,c as i,d as z}from"./TableRow-B6k_bSOs.js";import{A as le}from"./AddCircle-CJp4DZj3.js";import{B as S,D as de,a as pe,b as xe,c as he}from"./DialogTitle-CvDFHAwp.js";import{T as me}from"./TableContainer-gCCy6yK7.js";import{E as ue}from"./Edit-6vcT2Cu4.js";import{D as je}from"./Delete-Be1vvbhC.js";import{M as fe,a as ge}from"./minimize-2-RCuvNn0X.js";const Le=()=>{const h="commissioning",[C,O]=a.useState(!1),[w,Y]=a.useState(""),[E,$]=a.useState(""),[W,y]=a.useState(!1),[N,D]=a.useState(""),[n,p]=a.useState({}),[_,G]=a.useState([]),[m,u]=a.useState(!1),[Ce,k]=a.useState(null),[H,U]=a.useState([]),[I,P]=a.useState(null),J=()=>{O(!C)};a.useEffect(()=>{(async()=>{try{const s=await oe();U(s)}catch(s){console.error("❌ Error fetching projects:",s)}})()},[]),a.useEffect(()=>{b()},[]);const b=async()=>{try{const t=await ne();G(t)}catch(t){console.error("❌ Error fetching compliance:",t)}},Q=t=>{D(t);const s=new Date().getFullYear(),l=(_.length+1).toString().padStart(4,"0");p({complianceprocessID:`CMP-${s}-${l}`,projectId:t}),u(!1),k(null),y(!0)},K=t=>{p({complianceprocessID:t.compliance_id,regulatoryBody:t.regulatory_body,inspectionDate:t.inspection_date,inspectorName:t.inspector_name,checkListID:t.compliance_checklist_id,complianceStatus:t.compliance_status,issues:t.non_compliance_issues,actionplan:t.corrective_action_plan,certificationID:t.certification_id,expiryDate:t.certification_expiry_date}),D(t.project),P(t.compliance_id),u(!0),y(!0)},V=async t=>{if(window.confirm("⚠️ Are you sure you want to delete this compliance?"))try{await re(t),alert(`🗑️ Compliance ${t} deleted successfully`),b()}catch(r){console.error("❌ Error deleting compliance:",r),alert("Error while deleting compliance. Please try again.")}},j=()=>{y(!1),p({}),u(!1),k(null)},d=t=>{const{name:s,value:r}=t.target;p(l=>({...l,[s]:r}))},q=async t=>{t.preventDefault();const s={project:N,regulatory_body:n.regulatoryBody||"",inspection_date:n.inspectionDate||"",inspector_name:n.inspectorName||"",compliance_checklist_id:n.checkListID||"",compliance_status:n.complianceStatus||"",non_compliance_issues:n.issues||"",corrective_action_plan:n.actionplan||"",certification_id:n.certificationID||"",certification_expiry_date:n.expiryDate||""};try{let r;m&&I?(r=await ce(I,s),alert(`✅ Compliance updated successfully. Compliance ID: ${r.data.compliance_id}`)):(r=await ae(s),alert(`✅ Compliance submitted successfully. Compliance ID: ${r.data.compliance_id}`)),b(),p({complianceprocessID:"",regulatoryBody:"",inspectionDate:"",inspectorName:"",checkListID:"",complianceStatus:"",issues:"",actionplan:"",certificationID:"",expiryDate:""}),D(""),P(null),u(!1),j()}catch(r){if(console.error("❌ Error saving compliance:",r),r.response&&r.response.data){const l=r.response.data;if(typeof l=="object"){let c=[];for(let T in l)c.push(`${T}: ${l[T]}`);alert(`❌ Validation Errors:
`+c.join(`
`))}else alert(`❌ Error: ${l}`)}else alert("❌ Error while saving compliance. Please try again.")}},X=_.filter(t=>Object.values(t).some(s=>s&&s.toString().toLowerCase().includes(E.toLowerCase()))),Z=t=>{const s=new ie("l","mm","a4");s.setFontSize(16),s.text("All Compliance & Certification Report",14,15);const r=["Project ID","Compliance ID","Regulatory Body","Inspection Date","Inspector Name","Checklist ID","Status","Non-Compliance Issues","Corrective Action Plan","Certification ID","Certification Expiry Date"],l=t.map(c=>[c.project,c.compliance_id,c.regulatory_body,f(c.inspection_date),c.inspector_name,c.compliance_checklist_id,c.compliance_status,c.non_compliance_issues,c.corrective_action_plan,c.certification_id,f(c.certification_expiry_date)]);se(s,{head:[r],body:l,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),s.save("all_compliance_certification_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Compliance & Certification"}),e.jsx(o,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(o,{item:!0,xs:12,children:e.jsxs(F,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(v,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(B,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:w,onChange:t=>Y(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(A,{children:[e.jsx(R,{children:e.jsxs(g,{children:[e.jsx(i,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(i,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(z,{children:H.filter(t=>t.project_id.toLowerCase().includes(w.toLowerCase())).map((t,s)=>e.jsxs(g,{children:[e.jsx(i,{children:t.project_id}),e.jsx(i,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(L,{slug:h,action:"can_create",children:e.jsx(x,{onClick:()=>Q(t.project_id),color:"primary",children:e.jsx(le,{sx:{color:"#7267ef"}})})})})]},s))})]})]})})}),e.jsx(o,{container:!0,spacing:2,children:e.jsx(o,{item:!0,xs:12,children:e.jsxs(F,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(S,{startIcon:e.jsx(te,{}),onClick:()=>Z(_),children:"Download PDF"}),e.jsx(v,{variant:"h6",gutterBottom:!0,children:"COMPLIANCE & CERTIFICATION DETAILS"}),e.jsx("input",{type:"text",placeholder:"Search Compliance & Certification",value:E,onChange:t=>$(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(me,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(A,{stickyHeader:!0,children:[e.jsx(R,{children:e.jsxs(g,{children:[e.jsx(i,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(i,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance Process ID"})}),e.jsx(i,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Regulatory Body"})}),e.jsx(i,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Date"})}),e.jsx(i,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspector Name"})}),e.jsx(i,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance Checklist ID"})}),e.jsx(i,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance Status"})}),e.jsx(i,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Non-Compliance Issues"})}),e.jsx(i,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Corrective Action Plan"})}),e.jsx(i,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Certification ID"})}),e.jsx(i,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Certification Expiry Date"})}),e.jsx(i,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(z,{children:X.map((t,s)=>e.jsxs(g,{children:[e.jsx(i,{children:t.project}),e.jsx(i,{children:t.compliance_id}),e.jsx(i,{children:t.regulatory_body}),e.jsx(i,{children:f(t.inspection_date)}),e.jsx(i,{children:t.inspector_name}),e.jsx(i,{children:t.compliance_checklist_id}),e.jsx(i,{children:t.compliance_status}),e.jsx(i,{children:t.non_compliance_issues}),e.jsx(i,{children:t.corrective_action_plan}),e.jsx(i,{children:t.certification_id}),e.jsx(i,{children:f(t.certification_expiry_date)}),e.jsxs(i,{children:[e.jsx(M,{slug:h,action:"can_update",children:e.jsx(x,{onClick:()=>K(t),color:"warning",children:e.jsx(ue,{sx:{color:"orange"}})})}),e.jsx(L,{slug:h,action:"can_delete",children:e.jsx(x,{onClick:()=>V(t.compliance_id),color:"error",children:e.jsx(je,{sx:{color:"red"}})})})]})]},s))})]})})]})})}),e.jsxs(de,{open:W,onClose:j,fullWidth:!0,maxWidth:"xl",PaperProps:{style:C?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(pe,{children:m?"Edit Compliance Details":"Enter Compliance Details"}),e.jsxs(xe,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(x,{"aria-label":"toggle-size",onClick:J,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:C?e.jsx(fe,{}):e.jsx(ge,{})}),e.jsx(x,{"aria-label":"close",onClick:j,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(ee,{})}),e.jsx(B,{component:"form",sx:{mt:2},children:e.jsxs(o,{container:!0,spacing:3,direction:"column",children:[e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:N,disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"complianceprocessID",children:"Compliance ID"}),e.jsx("input",{id:"complianceprocessID",className:"input",value:n.complianceprocessID||"",disabled:!0})]})]})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Compliance & Certification Infor.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"regulatoryBody",children:"Regulatory Body"}),e.jsx("input",{id:"regulatoryBody",name:"regulatoryBody",className:"input",value:n.regulatoryBody||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionDate",children:"Inspection Date"}),e.jsx("input",{type:"date",id:"inspectionDate",name:"inspectionDate",className:"input",value:n.inspectionDate||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectorName",children:"Inspector Name"}),e.jsx("input",{id:"inspectorName",name:"inspectorName",className:"input",value:n.inspectorName||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"checkListID",children:"Compliance CheckList ID"}),e.jsx("input",{id:"checkListID",name:"checkListID",className:"input",value:n.checkListID||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"complianceStatus",children:"Compliance Status"}),e.jsxs("select",{id:"complianceStatus",name:"complianceStatus",className:"input",value:n.complianceStatus||"",onChange:d,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Compliant",children:"Compliant"}),e.jsx("option",{value:"Pending",children:"Pending"})]})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"issues",children:"Non-Compliant Issues"}),e.jsx("input",{id:"issues",name:"issues",className:"input",value:n.issues||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"actionplan",children:"Corrective Action Plan"}),e.jsx("input",{id:"actionplan",name:"actionplan",className:"input",value:n.actionplan||"",onChange:d})]})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Certification ID & Expiry Date"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"certificationID",children:"Certification ID"}),e.jsx("input",{id:"certificationID",name:"certificationID",className:"input",value:n.certificationID||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"expiryDate",children:"Certification Expiry Date"}),e.jsx("input",{type:"date",id:"expiryDate",name:"expiryDate",className:"input",value:n.expiryDate||"",onChange:d})]})]})]})]})]})})]}),e.jsxs(he,{children:[e.jsx(S,{onClick:j,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(M,{slug:h,action:m&&I?"can_update":"can_create",children:e.jsx(S,{variant:"outlined",onClick:q,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:m?"Update":"Submit"})})]})]})]})};export{Le as default};
