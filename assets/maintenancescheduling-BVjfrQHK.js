import{r as c,j as e,T as f,J as T,E as k,S as A,I as u,K as E}from"./main-Skim5IJC.js";import{C as Z}from"./Close-BKZ7QrSY.js";import{D as ee}from"./Download-C4sxsXoP.js";import{E as se,a as te}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{g as ne,a as F,b as ae,e as ie}from"./maintenance-DLF_HkF3.js";import{f as P}from"./date-DdrLtg20.js";import{G as i}from"./Grid-fY_ATwTx.js";import{T as q,a as N,b as m,c as t,d as B}from"./TableRow-B6k_bSOs.js";import{A as re}from"./AddCircle-CJp4DZj3.js";import{B as y,D as le,a as ce,b as oe,c as de}from"./DialogTitle-CvDFHAwp.js";import{T as he}from"./TableContainer-gCCy6yK7.js";import{E as ue}from"./Edit-6vcT2Cu4.js";import{D as xe}from"./Delete-Be1vvbhC.js";import{M as pe,a as me}from"./minimize-2-RCuvNn0X.js";const Ee=()=>{const x="maintenance",[D,R]=c.useState(""),[S,z]=c.useState(""),[j,Y]=c.useState(!1),[O,g]=c.useState(!1),[je,$]=c.useState(""),[a,h]=c.useState({}),[v,_]=c.useState([]),[L,b]=c.useState(!1),[ge,C]=c.useState(null),[W,G]=c.useState([]),[w,Q]=c.useState(null),H=()=>{Y(!j)};c.useEffect(()=>{(async()=>{try{const n=await ne();G(n)}catch(n){console.error("❌ Failed to fetch assets:",n)}})()},[]);const I=async()=>{try{const s=await F();_(s),console.log(s)}catch(s){console.error("❌ Error loading schedules:",s)}};c.useEffect(()=>{I()},[]);const J=s=>{$(s);const n=new Date().getFullYear(),d=(v.length+1).toString().padStart(3,"0");h({maintenanceID:`MNT-${n}-${d}`,assetId:s}),b(!1),C(null),g(!0)},U=s=>{h({assetId:s.asset||"",maintenanceID:s.maintenance_id||"",maintenanceType:s.maintenance_type||"",scheduledDate:s.scheduled_date||"",frequency:s.frequency||"",technicianId:s.assigned_technician_id||"",taskDescription:s.task_description||"",sparePart:s.spare_parts_required||"",EstimatedDowntime:s.estimated_downtime||"",approvalStatus:s.approval_status||"Pending"}),Q(s.maintenance_id),g(!0)},K=async s=>{var n;if(window.confirm(`Are you sure you want to delete schedule ${s}?`))try{await ae(s),alert(`✅ Schedule ${s} deleted successfully!`);const l=await F();_(l)}catch(l){alert(`❌ Failed to delete schedule:
${JSON.stringify(((n=l.response)==null?void 0:n.data)||l.message,null,2)}`),console.error("❌ Delete error:",l)}},p=()=>{g(!1),h({}),b(!1),C(null)},o=s=>{const{name:n,value:l}=s.target;h(d=>({...d,[n]:l}))},V=async()=>{var s,n,l;try{const d={asset_id:a.assetId||"",maintenance_type:a.maintenanceType||"",scheduled_date:a.scheduledDate||"",frequency:a.frequency||"",assigned_technician_id:a.technicianId||"",task_description:a.taskDescription||"",spare_parts_required:a.sparePart||"",estimated_downtime:a.EstimatedDowntime||null,approval_status:a.approvalStatus||"Pending"},r=await ie(d);alert(`✅ Maintenance Schedule created!
Generated ID: ${r.data.maintenance_id}`),I(),h({}),p()}catch(d){const r=((n=(s=d.response)==null?void 0:s.data)==null?void 0:n.detail)||((l=d.response)==null?void 0:l.data)||d.message;alert(`❌ Failed to create schedule:
${JSON.stringify(r,null,2)}`)}},M=v.filter(s=>Object.values(s).some(n=>n&&n.toString().toLowerCase().includes(S.toLowerCase()))),X=s=>{const n=new se("l","mm","a4");n.setFontSize(16),n.text("All Maintenance Scheduling Report",14,15);const l=["Asset ID","Maintenance ID","Maintenance Type","Scheduled Date","Frequency","Assigned Technician ID","Task Description","Spare Parts Required","Estimated Downtime","Approval Status"],d=s.map(r=>[r.asset_id,r.maintenance_id,r.maintenance_type,P(r.scheduled_date),r.frequency,r.assigned_technician_id,r.task_description,r.spare_parts_required,r.estimated_downtime,r.approval_status]);te(n,{head:[l],body:d,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),n.save("all_maintenance_scheduling_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Maintenance Scheduling Details"}),e.jsx(i,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(f,{variant:"h6",gutterBottom:!0,children:"ASSETS RECORDS"}),e.jsx(k,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Asset ID",value:D,onChange:s=>R(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(q,{children:[e.jsx(N,{children:e.jsxs(m,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(B,{children:W.filter(s=>s.asset_id.toLowerCase().includes(D.toLowerCase())).map((s,n)=>e.jsxs(m,{children:[e.jsx(t,{children:s.asset_id}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(A,{slug:x,action:"can_create",children:e.jsx(u,{onClick:()=>J(s.asset_id),color:"primary",children:e.jsx(re,{sx:{color:"#7267ef"}})})})})]},n))})]})]})})}),e.jsx(i,{container:!0,spacing:2,children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(y,{startIcon:e.jsx(ee,{}),onClick:()=>X(M),children:"Download PDF"}),e.jsx(f,{variant:"h6",gutterBottom:!0,children:"Maintenance Scheduling Details"}),e.jsx("input",{type:"text",placeholder:"Search Maintenance Scheduling Details",value:S,onChange:s=>z(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(he,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(q,{stickyHeader:!0,children:[e.jsx(N,{children:e.jsxs(m,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Maintenance ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Maintenance Type"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Scheduled Date"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Frequency"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Assigned TechnicianId"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Task Description"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Spare Parts Required"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Estimated Downtime"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Status"})}),e.jsx(t,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(B,{children:M.map((s,n)=>e.jsxs(m,{children:[e.jsx(t,{children:s.asset_id}),e.jsx(t,{children:s.maintenance_id}),e.jsx(t,{children:s.maintenance_type}),e.jsx(t,{children:P(s.scheduled_date)}),e.jsx(t,{children:s.frequency}),e.jsx(t,{children:s.assigned_technician_id}),e.jsx(t,{children:s.task_description}),e.jsx(t,{children:s.spare_parts_required}),e.jsx(t,{children:s.estimated_downtime}),e.jsx(t,{children:s.approval_status}),e.jsxs(t,{children:[e.jsx(E,{slug:x,action:"can_update",children:e.jsx(u,{onClick:()=>U(s),color:"warning",children:e.jsx(ue,{sx:{color:"orange"}})})}),e.jsx(A,{slug:x,action:"can_delete",children:e.jsx(u,{onClick:()=>K(s.maintenance_id),color:"error",children:e.jsx(xe,{sx:{color:"red"}})})})]})]},n))})]})})]})})}),e.jsxs(le,{open:O,onClose:p,fullWidth:!0,maxWidth:"xl",PaperProps:{style:j?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(ce,{children:L?"Edit Maintenance Scheduling Details":"Enter Maintenance Scheduling Details"}),e.jsxs(oe,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(u,{"aria-label":"toggle-size",onClick:H,sx:{position:"absolute",right:40,top:8,color:s=>s.palette.grey[600]},children:j?e.jsx(pe,{}):e.jsx(me,{})}),e.jsx(u,{"aria-label":"close",onClick:p,sx:{position:"absolute",right:8,top:8,color:s=>s.palette.grey[500]},children:e.jsx(Z,{})}),e.jsx(k,{component:"form",sx:{mt:2},children:e.jsx(i,{container:!0,spacing:3,direction:"column",children:e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Maintenance Scheduling Info.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"assetId",children:"Asset ID"}),e.jsx("input",{id:"assetId",name:"assetId",className:"input",value:a.assetId||"",onChange:o,disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"maintenanceID",children:"Maintenance ID"}),e.jsx("input",{id:"maintenanceID",name:"maintenanceID",className:"input",value:a.maintenanceID||"",onChange:o,disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"maintenanceType",children:"Maintenance Type"}),e.jsxs("select",{id:"maintenanceType",name:"maintenanceType",className:"input",value:a.maintenanceType||"",onChange:o,children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"Preventive",children:"Preventive"}),e.jsx("option",{value:"Predictive",children:"Predictive"}),e.jsx("option",{value:"Corrective",children:"Corrective"}),e.jsx("option",{value:"Breakdown",children:"Breakdown"})]})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"scheduledDate",children:"Scheduled Date"}),e.jsx("input",{type:"date",id:"scheduledDate",name:"scheduledDate",className:"input",value:a.scheduledDate||"",onChange:o})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"frequency",children:"Frequency"}),e.jsxs("select",{id:"frequency",name:"frequency",className:"input",value:a.frequency||"",onChange:o,children:[e.jsx("option",{value:"",children:"-- Select Frequency --"}),e.jsx("option",{value:"Daily",children:"Daily"}),e.jsx("option",{value:"Weekly",children:"Weekly"}),e.jsx("option",{value:"Monthly",children:"Monthly"}),e.jsx("option",{value:"Quarterly",children:"Quarterly"}),e.jsx("option",{value:"Annually",children:"Annually"})]})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"technicianId",children:"Technician ID"}),e.jsx("input",{id:"technicianId",name:"technicianId",className:"input",value:a.technicianId||"",onChange:o})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"taskDescription",children:"Task Description"}),e.jsx("input",{id:"taskDescription",name:"taskDescription",className:"input",value:a.taskDescription||"",onChange:o})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"purchaseDate",children:"Purchase Date"}),e.jsx("input",{type:"date",id:"purchaseDate",name:"purchaseDate",className:"input",value:a.purchaseDate||"",onChange:o})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"sparePart",children:"Spare Parts Required"}),e.jsx("input",{id:"sparePart",name:"sparePart",className:"input",value:a.sparePart||"",onChange:o})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"EstimatedDowntime",children:"Estimated Downtime"}),e.jsx("input",{type:"number",id:"EstimatedDowntime",name:"EstimatedDowntime",className:"input",value:a.EstimatedDowntime||"",onChange:o})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:a.approvalStatus||"",onChange:o,children:[e.jsx("option",{value:"",children:"-- Select Status --"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Completed",children:"Completed"})]})]})]})]})})})]}),e.jsxs(de,{children:[e.jsx(y,{onClick:p,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(E,{slug:x,action:w?"can_update":"can_create",children:e.jsx(y,{variant:"outlined",onClick:V,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:w?"Update":"Submit"})})]})]})]})};export{Ee as default};
