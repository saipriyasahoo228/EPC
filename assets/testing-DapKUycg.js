import{r as a,j as e,T as y,x as E,S as N,D as M}from"./main-BIxdd69i.js";import{C as Z}from"./Close-D340Gps3.js";import{g as ee}from"./engineering-4VzvUWDc.js";import{g as te,d as se,u as re,c as ne}from"./commision-BQqrAN-2.js";import{G as r}from"./Grid-BnZNKmae.js";import{P as F,I as u,D as ie,f as oe,g as ae,h as ce,e as R}from"./DialogTitle-D59uELMl.js";import{T as B,a as k,b as g,c as s,d as $}from"./TableRow-D8X36zJO.js";import{A as le}from"./AddCircle-Bn9h5MaP.js";import{T as de}from"./TableContainer-1Xqyy-f8.js";import{E as xe}from"./Edit-BJV-h6Li.js";import{D as he}from"./Delete-BHKbKfZ2.js";import{M as ue,a as me}from"./minimize-2-Dl_U24Qm.js";const we=()=>{const m="commissioning",[p,A]=a.useState(!1),[D,G]=a.useState(""),[T,q]=a.useState(""),[L,j]=a.useState(!1),[b,_]=a.useState(""),[i,x]=a.useState({}),[C,S]=a.useState([]),[z,I]=a.useState(!1),[je,v]=a.useState(null),[O,U]=a.useState([]),[h,w]=a.useState(null),H=()=>{A(!p)};a.useEffect(()=>{(async()=>{try{const n=await ee();U(n)}catch(n){console.error("❌ Error fetching projects:",n)}})()},[]),a.useEffect(()=>{P()},[]);const P=async()=>{try{const t=await te();S(t)}catch(t){console.error("❌ Error fetching testing records:",t)}},Y=t=>{_(t);const n=new Date().getFullYear(),o=(C.length+1).toString().padStart(3,"0");x({testingmanagementID:`TST-${n}-${o}`,projectId:t}),I(!1),v(null),j(!0)},Q=t=>{x({testingmanagementID:t.testing_id,systemName:t.system_equipment_name,testingDate:t.testing_date,testingBy:t.test_conducted_by,testProcedure:t.test_procedure,performance:t.performance_parameters,defect:t.defects_identified,correction:t.correction_measures,retestDate:t.retest_date,testingStatus:t.testing_status}),w(t.testing_id),_(t.project_id),j(!0)},W=async t=>{var d,o;if(window.confirm(`Are you sure you want to delete the testing record with ID: ${t}?`))try{const l=await se(t);l.MSG?alert(`✅ ${l.MSG}
Deleted Testing ID: ${t}`):alert(`✅ Record deleted successfully!
Deleted Testing ID: ${t}`),S(V=>V.filter(X=>X.testing_id!==t))}catch(l){console.error("❌ Delete failed:",l),alert(`❌ Failed to delete Testing ID: ${t}
${((o=(d=l.response)==null?void 0:d.data)==null?void 0:o.MSG)||l.message||"Unknown error"}`)}},f=()=>{j(!1),x({}),I(!1),v(null)},c=t=>{const{name:n,value:d}=t.target;x(o=>({...o,[n]:d}))},J=async t=>{var n,d;t.preventDefault();try{const o={project_id:b,system_equipment_name:i.systemName,testing_date:i.testingDate,test_conducted_by:i.testingBy,test_procedure:i.testProcedure,performance_parameters:i.performance,defects_identified:i.defect||null,correction_measures:i.correction||null,retest_date:i.retestDate||null,testing_status:i.testingStatus};if(h){const l=await re(h,o);alert(`✅ Record updated successfully!
Updated Testing ID: ${h}`)}else{const l=await ne(o);alert(`✅ Record created successfully!
Generated Testing ID: ${l.Data.testing_id}`)}P(),x({}),w(null),j(!1)}catch(o){console.error("❌ Error saving testing record:",o),alert(`❌ Error: ${((d=(n=o.response)==null?void 0:n.data)==null?void 0:d.MSG)||o.message||"Something went wrong"}`)}},K=C.filter(t=>Object.values(t).some(n=>n&&n.toString().toLowerCase().includes(T.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Testing & Inspection"}),e.jsx(r,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(r,{item:!0,xs:12,children:e.jsxs(F,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(y,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(E,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:D,onChange:t=>G(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(B,{children:[e.jsx(k,{children:e.jsxs(g,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx($,{children:O.filter(t=>{var n;return(n=t.id)==null?void 0:n.toString().toLowerCase().includes(D.toLowerCase())}).map((t,n)=>e.jsxs(g,{children:[e.jsx(s,{children:t.project_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(N,{slug:m,action:"can_create",children:e.jsx(u,{onClick:()=>Y(t.project_id),color:"primary",children:e.jsx(le,{sx:{color:"#7267ef"}})})})})]},n))})]})]})})}),e.jsx(r,{container:!0,spacing:2,children:e.jsx(r,{item:!0,xs:12,children:e.jsxs(F,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(y,{variant:"h6",gutterBottom:!0,children:"TESTING MANAGEMENT DETAILS"}),e.jsx("input",{type:"text",placeholder:"Search Testing Management",value:T,onChange:t=>q(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(de,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(B,{stickyHeader:!0,children:[e.jsx(k,{children:e.jsxs(g,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Testing ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Equipment Name"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Testing Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Testing ConductedBy"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Test Procedure"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Performane Parameters"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Defects Identified"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Corrective Measures"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Retest Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Testing Date"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx($,{children:K.map((t,n)=>e.jsxs(g,{children:[e.jsx(s,{children:t.project_id}),e.jsx(s,{children:t.testing_id}),e.jsx(s,{children:t.system_equipment_name}),e.jsx(s,{children:t.testing_date}),e.jsx(s,{children:t.test_conducted_by}),e.jsx(s,{children:t.test_procedure}),e.jsx(s,{children:t.performance_parameters}),e.jsx(s,{children:t.defects_identified}),e.jsx(s,{children:t.correction_measures}),e.jsx(s,{children:t.retest_date||"-"}),e.jsx(s,{children:t.testing_status}),e.jsxs(s,{children:[e.jsx(M,{slug:m,action:"can_update",children:e.jsx(u,{onClick:()=>Q(t),color:"warning",children:e.jsx(xe,{sx:{color:"orange"}})})}),e.jsx(N,{slug:m,action:"can_delete",children:e.jsx(u,{onClick:()=>W(t.testing_id),color:"error",children:e.jsx(he,{sx:{color:"red"}})})})]})]},n))})]})})]})})}),e.jsxs(ie,{open:L,onClose:f,fullWidth:!0,maxWidth:"xl",PaperProps:{style:p?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(oe,{children:z?"Edit Testing Management Details":"Enter Testing Management Details"}),e.jsxs(ae,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(u,{"aria-label":"toggle-size",onClick:H,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:p?e.jsx(ue,{}):e.jsx(me,{})}),e.jsx(u,{"aria-label":"close",onClick:f,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(Z,{})}),e.jsx(E,{component:"form",sx:{mt:2},children:e.jsxs(r,{container:!0,spacing:3,direction:"column",children:[e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:b,disabled:!0})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"testingmanagementID",children:"Testing ID"}),e.jsx("input",{id:"testingmanagementID",className:"input",value:i.testingmanagementID||"",disabled:!0})]})]})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Testing & Equipment Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"systemName",children:"System/Equipment Name"}),e.jsx("input",{id:"systemName",name:"systemName",className:"input",value:i.systemName||"",onChange:c})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"testingDate",children:"Testing Date"}),e.jsx("input",{type:"date",id:"testingDate",name:"testingDate",className:"input",value:i.testingDate||"",onChange:c})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"testingBy",children:"Testing CoductedBy"}),e.jsx("input",{id:"testingBy",name:"testingBy",className:"input",value:i.testingBy||"",onChange:c})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"testProcedure",children:"Test Procedure"}),e.jsx("input",{id:"testProcedure",name:"testProcedure",className:"input",value:i.testProcedure||"",onChange:c})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"performance",children:"Performance Parameters"}),e.jsx("input",{id:"performance",name:"performance",className:"input",value:i.performance||"",onChange:c})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"defect",children:"Defects Identified"}),e.jsx("input",{id:"defect",name:"defect",className:"input",value:i.defect||"",onChange:c})]})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Correction Measure & Testing Status"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"correction",children:"Correction Measure"}),e.jsx("input",{id:"correction",name:"correction",className:"input",value:i.correction||"",onChange:c})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"retestDate",children:"Retest Date"}),e.jsx("input",{type:"date",id:"retestDate",name:"retestDate",className:"input",value:i.retestDate||"",onChange:c})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"testingStatus",children:"Testing Status"}),e.jsxs("select",{id:"testingStatus",name:"testingStatus",className:"input",value:i.testingStatus||"",onChange:c,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Passed",children:"Passed"}),e.jsx("option",{value:"Failed",children:"Failed"}),e.jsx("option",{value:"Retest Required",children:"Retest Required"})]})]})]})]})]})]})})]}),e.jsxs(ce,{children:[e.jsx(R,{onClick:f,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(M,{slug:m,action:h?"can_update":"can_create",children:e.jsx(R,{variant:"outlined",onClick:J,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:h?"Update":"Submit"})})]})]})]})};export{we as default};
