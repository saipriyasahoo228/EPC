import{i as ne,k as ie,r as c,m as ce,T as q,j as e,n as J,o as K,q as de,t as ue,v as me,x as H,J as Z,az as ee,aA as xe,aB as se,aC as he}from"./main-BIxdd69i.js";import{C as be}from"./Close-D340Gps3.js";import{g as ge}from"./user-C2xECiyh.js";import{c as je,P as re,e as E,D as Ce,f as _e,I as ye,g as ve,h as Pe}from"./DialogTitle-D59uELMl.js";import{G as x}from"./Grid-BnZNKmae.js";import{F as Se,I as we,T as O}from"./TextField-BZ4knvb7.js";import{j as pe,k as fe,S as Fe}from"./Select-CcRDAcIa.js";import{M as te}from"./MenuItem-BSRQ3XbJ.js";import{T as ke}from"./TableContainer-1Xqyy-f8.js";import{T as Me,a as Be,b as ae,c as P,d as Te}from"./TableRow-D8X36zJO.js";import{C as D}from"./Checkbox-CzTq-GCU.js";import{S as oe,A as le}from"./Snackbar-D6Cxzpo8.js";import"./index-E3WhgaTq.js";import"./dividerClasses-BHbp2fTT.js";function De(r){return ie("MuiFormControlLabel",r)}const R=ne("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),Re=r=>{const{classes:t,disabled:l,labelPlacement:d,error:i,required:C}=r,f={root:["root",l&&"disabled",`labelPlacement${de(d)}`,i&&"error",C&&"required"],label:["label",l&&"disabled"],asterisk:["asterisk",i&&"error"]};return ue(f,De,t)},Ue=K("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:l}=r;return[{[`& .${R.label}`]:t.label},t.root,t[`labelPlacement${de(l.labelPlacement)}`]]}})(me(({theme:r})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${R.disabled}`]:{cursor:"default"},[`& .${R.label}`]:{[`&.${R.disabled}`]:{color:(r.vars||r).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:t})=>t==="start"||t==="top"||t==="bottom",style:{marginLeft:16}}]}))),Le=K("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(r,t)=>t.asterisk})(me(({theme:r})=>({[`&.${R.error}`]:{color:(r.vars||r).palette.error.main}}))),I=c.forwardRef(function(t,l){const d=ce({props:t,name:"MuiFormControlLabel"}),{checked:i,className:C,componentsProps:f={},control:u,disabled:g,disableTypography:_,inputRef:S,label:U,labelPlacement:G="end",name:$,onChange:N,required:p,slots:L={},slotProps:y={},value:Q,...W}=d,v=pe(),M=g??u.props.disabled??(v==null?void 0:v.disabled),m=p??u.props.required,B={disabled:M,required:m};["checked","name","onChange","value","inputRef"].forEach(s=>{typeof u.props[s]>"u"&&typeof d[s]<"u"&&(B[s]=d[s])});const z=fe({props:d,muiFormControl:v,states:["error"]}),w={...d,disabled:M,labelPlacement:G,required:m,error:z.error},F=Re(w),k={slots:L,slotProps:{...f,...y}},[T,h]=je("typography",{elementType:q,externalForwardedProps:k,ownerState:w});let j=U;return j!=null&&j.type!==q&&!_&&(j=e.jsx(T,{component:"span",...h,className:J(F.label,h==null?void 0:h.className),children:j})),e.jsxs(Ue,{className:J(F.root,C),ownerState:w,ref:l,...W,children:[c.cloneElement(u,B),m?e.jsxs("div",{children:[j,e.jsxs(Le,{ownerState:w,"aria-hidden":!0,className:F.asterisk,children:["â€‰","*"]})]}):j]})});function Ae(r){return ie("MuiFormGroup",r)}ne("MuiFormGroup",["root","row","error"]);const Ee=r=>{const{classes:t,row:l,error:d}=r;return ue({root:["root",l&&"row",d&&"error"]},Ae,t)},Ie=K("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:l}=r;return[t.root,l.row&&t.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),qe=c.forwardRef(function(t,l){const d=ce({props:t,name:"MuiFormGroup"}),{className:i,row:C=!1,...f}=d,u=pe(),g=fe({props:d,muiFormControl:u,states:["error"]}),_={...d,row:C,error:g.error},S=Ee(_);return e.jsx(Ie,{className:J(S.root,i),ownerState:_,ref:l,...f})}),es=()=>{const[r,t]=c.useState([]),[l,d]=c.useState([]),[i,C]=c.useState(""),[f,u]=c.useState({}),[g,_]=c.useState(!1),[S,U]=c.useState(!1),[G,$]=c.useState(null),[N,p]=c.useState(""),[L,y]=c.useState(""),[Q,W]=c.useState(!1),[v,M]=c.useState(!1),[m,B]=c.useState({name:"",slug:"",description:"",default_read:!1,default_create:!1,default_update:!1,default_delete:!1});c.useEffect(()=>{(async()=>{_(!0);try{const[a,n]=await Promise.all([ge(),ee()]);t(a||[]),d(n||[])}catch{p("Failed to load users or modules.")}finally{_(!1)}})()},[]),c.useEffect(()=>{(async()=>{if(i){U(!0);try{const a=await xe(i),n={};(a||[]).forEach(o=>{var A,V,X,Y;const b=o.module;n[b.id]={can_read:!!((A=o.permissions)!=null&&A.can_read),can_create:!!((V=o.permissions)!=null&&V.can_create),can_update:!!((X=o.permissions)!=null&&X.can_update),can_delete:!!((Y=o.permissions)!=null&&Y.can_delete)}}),l.forEach(o=>{n[o.id]||(n[o.id]={can_read:!!o.default_read,can_create:!!o.default_create,can_update:!!o.default_update,can_delete:!!o.default_delete})}),u(n)}catch{p("Failed to load user permissions."),u({})}finally{U(!1)}}})()},[i,l.length]);const z=c.useMemo(()=>l.map(s=>({module:s,perms:f[s.id]||{can_read:!!s.default_read,can_create:!!s.default_create,can_update:!!s.default_update,can_delete:!!s.default_delete}})),[l,f]),w=async(s,a)=>{if(!i){p("Please select a user first.");return}const n=f[s]||{},o={...n,[a]:!n[a]};u(b=>({...b,[s]:o})),$(s);try{await se(i,s,o),y("Permissions updated.")}catch{u(A=>({...A,[s]:n})),p("Failed to update permissions.")}finally{$(null)}},F=async s=>{if(!i){p("Please select a user first.");return}const a={can_read:s,can_create:s,can_update:s,can_delete:s},n=f,o={...f};l.forEach(b=>{o[b.id]=a}),u(o);try{await Promise.all(l.map(b=>se(i,b.id,a))),y(s?"All permissions granted.":"All permissions revoked.")}catch{u(n),p("Bulk update failed.")}},k=()=>W(!1),T=s=>{const{name:a,value:n}=s.target;B(o=>({...o,[a]:n}))},h=s=>{B(a=>({...a,[s]:!a[s]}))},j=async()=>{if(!m.name||!m.slug){p("Name and slug are required.");return}M(!0);try{await he(m),y("Module created."),k();const s=await ee();d(s||[]),u(a=>({...a}))}catch{p("Failed to create module.")}finally{M(!1)}};return e.jsxs(H,{children:[e.jsx(re,{sx:{p:2,mb:2},children:e.jsxs(x,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(x,{item:!0,xs:12,md:8,children:e.jsxs(Se,{fullWidth:!0,size:"small",sx:{minWidth:{md:480}},children:[e.jsx(we,{id:"user-select-label",children:"Select User"}),e.jsxs(Fe,{labelId:"user-select-label",label:"Select User",value:i,onChange:s=>C(s.target.value),children:[e.jsx(te,{value:"",children:"Select User"})," ",r.map(s=>e.jsxs(te,{value:s.user_id,children:[s.user_id," - ",s.full_name||s.email||s.mobile_number]},s.user_id))]})]})}),e.jsx(x,{item:!0,xs:12,md:4,children:e.jsxs(H,{display:"flex",gap:1,justifyContent:{xs:"flex-start",md:"flex-end"},children:[e.jsx(E,{variant:"outlined",onClick:()=>F(!0),disabled:!i||g||S,children:"Select All"}),e.jsx(E,{variant:"outlined",color:"warning",onClick:()=>F(!1),disabled:!i||g||S,children:"Revoke All"})]})})]})}),e.jsxs(re,{sx:{p:2},children:[e.jsxs(x,{container:!0,alignItems:"center",justifyContent:"space-between",sx:{mb:2},children:[e.jsx(x,{item:!0,children:e.jsx(q,{variant:"h6",sx:{color:"#7267ef"},children:"Module Permissions"})}),e.jsx(x,{item:!0,children:(g||S)&&e.jsx(Z,{size:20})})]}),g?e.jsx(H,{display:"flex",justifyContent:"center",alignItems:"center",sx:{minHeight:200},children:e.jsx(Z,{})}):e.jsx(ke,{children:e.jsxs(Me,{size:"small",children:[e.jsx(Be,{children:e.jsxs(ae,{children:[e.jsx(P,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Module"})}),e.jsx(P,{align:"center",sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Read"})}),e.jsx(P,{align:"center",sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Create"})}),e.jsx(P,{align:"center",sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Update"})}),e.jsx(P,{align:"center",sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Delete"})})]})}),e.jsx(Te,{children:z.map(({module:s,perms:a})=>e.jsxs(ae,{hover:!0,children:[e.jsx(P,{children:s.name}),["can_read","can_create","can_update","can_delete"].map(n=>e.jsx(P,{align:"center",children:e.jsx(D,{checked:!!a[n],onChange:()=>w(s.id,n),disabled:!i||G===s.id,color:"primary",inputProps:{"aria-label":`${s.name} ${n}`}})},n))]},s.id))})]})})]}),e.jsxs(Ce,{open:Q,onClose:k,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(_e,{sx:{backgroundColor:"#f7f7fb",color:"#2f2a8d",display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Create Module",e.jsx(ye,{onClick:k,sx:{color:"#7267ef"},"aria-label":"Close dialog",children:e.jsx(be,{})})]}),e.jsx(ve,{dividers:!0,children:e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(O,{fullWidth:!0,label:"Name",name:"name",value:m.name,onChange:T,required:!0})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(O,{fullWidth:!0,label:"Slug",name:"slug",value:m.slug,onChange:T,required:!0})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(O,{fullWidth:!0,multiline:!0,minRows:2,label:"Description",name:"description",value:m.description,onChange:T})}),e.jsxs(x,{item:!0,xs:12,children:[e.jsx(q,{variant:"subtitle2",sx:{mb:1},children:"Default Permissions"}),e.jsxs(qe,{row:!0,children:[e.jsx(I,{control:e.jsx(D,{checked:m.default_read,onChange:()=>h("default_read")}),label:"Read"}),e.jsx(I,{control:e.jsx(D,{checked:m.default_create,onChange:()=>h("default_create")}),label:"Create"}),e.jsx(I,{control:e.jsx(D,{checked:m.default_update,onChange:()=>h("default_update")}),label:"Update"}),e.jsx(I,{control:e.jsx(D,{checked:m.default_delete,onChange:()=>h("default_delete")}),label:"Delete"})]})]})]})}),e.jsxs(Pe,{sx:{pr:3,pb:2},children:[e.jsx(E,{onClick:k,color:"inherit",children:"Cancel"}),e.jsx(E,{variant:"contained",onClick:j,disabled:v,sx:{backgroundColor:"#7267ef"},children:v?"Creating...":"Create"})]})]}),e.jsx(oe,{open:!!N,autoHideDuration:4e3,onClose:()=>p(""),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(le,{onClose:()=>p(""),severity:"error",variant:"filled",children:N})}),e.jsx(oe,{open:!!L,autoHideDuration:2e3,onClose:()=>y(""),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(le,{onClose:()=>y(""),severity:"success",variant:"filled",children:L})})]})};export{es as default};
