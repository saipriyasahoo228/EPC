import{r as l,j as e}from"./main-DTv03d8r.js";import{C as se}from"./Close-BAEP8ymL.js";import{A as R,a as k,g as ae}from"./ArrowForwardIos-BR1LDHVw.js";import{a as ne,b as le,e as ie,f as oe}from"./procurement-DdbtAVRG.js";import{T as m,H as L,v as $,w as H,x as g,y as r,z as U,I as u,D as ce,r as de,t as ue,q as Q}from"./TableRow-DyRCyY9b.js";import{G as a}from"./Grid-C5mdLuvI.js";import{B as P}from"./Box-CyTnG5kx.js";import{A as xe}from"./AddCircle-Br8tjFgv.js";import{T as pe}from"./TableContainer-DOhr4ZW5.js";import{E as he,D as me}from"./Edit-DGVU-IuU.js";import{D as je}from"./DialogActions-CMm5oWDU.js";import"./api-Dv6wi5j0.js";import"./auth-4s9nFscl.js";import"./Transition-ChWAEdMD.js";const Be=()=>{const[C,G]=l.useState(""),[z,J]=l.useState([]),[I,W]=l.useState(""),[Y,j]=l.useState(!1),[ye,K]=l.useState(""),[fe,ge]=l.useState(!1),[_,v]=l.useState("create"),D=1,[x,w]=l.useState(1),[p,N]=l.useState(1),b=5,[s,y]=l.useState({projectId:"",procurementId:"",materialName:"",materialCode:"",quantity:"",unitPrice:"",totalCost:"",requestedBy:"",requestDate:"",approvalStatus:"Pending",poId:"",expectedDeliveryDate:"",paymentStatus:"",purchaseOrder:""}),[F,T]=l.useState([]),M=z.filter(t=>t.project_id.toLowerCase().includes(C.toLowerCase())),B=Math.ceil(M.length/D),V=M.slice((x-1)*D,x*D);l.useEffect(()=>{(async()=>{try{const n=await ae();J(n)}catch(n){console.error("Failed to load accepted projects:",n)}})()},[]);const f=async()=>{try{const t=await ne();T(t)}catch(t){console.error("❌ Error loading procurements:",t)}};l.useEffect(()=>{f()},[]);const i=t=>{const{name:n,value:d}=t.target;y(o=>{const c={...o,[n]:d};if(n==="quantity"||n==="unitPrice"){const O=parseFloat(c.quantity)||0,q=parseFloat(c.unitPrice)||0,h=(O*q).toFixed(2);c.totalCost=h}return c})},X=t=>{const n=new Date().getFullYear(),o=(F.length+1).toString().padStart(3,"0"),c=`${n}-PRC-${o}`;y({projectId:t,procurementId:c,materialName:"",materialCode:"",quantity:"",unitPrice:"",totalCost:"",requestedBy:"",requestDate:"",approvalStatus:"Pending",paymentStatus:"Pending",expectedDeliveryDate:"",purchaseOrder:""}),v("create"),j(!0)},S=()=>j(!1),Z=async()=>{var n;const t=new FormData;t.append("project",s.projectId),t.append("material_name",s.materialName),t.append("material_code",s.materialCode),t.append("quantity_requested",s.quantity),t.append("unit_price",s.unitPrice),t.append("requested_by",s.requestedBy),t.append("request_date",s.requestDate),t.append("purchase_order",s.purchaseOrder||""),t.append("approval_status",s.approvalStatus||"Pending"),t.append("payment_status",s.paymentStatus||"Pending"),s.expectedDeliveryDate&&t.append("expected_delivery_date",s.expectedDeliveryDate);try{_==="update"?(await ie(s.procurementId,t),alert("✅ Material Procurement updated successfully!")):(await oe(t),alert("✅ Material Procurement submitted successfully!")),y({projectId:"",procurementId:"",materialName:"",materialCode:"",quantity:"",unitPrice:"",totalCost:"",requestedBy:"",requestDate:"",approvalStatus:"",paymentStatus:"",expectedDeliveryDate:"",purchaseOrder:""}),K(null),j(!1),v("create"),typeof f=="function"&&await f()}catch(d){const o=(n=d.response)==null?void 0:n.data;console.error("❌ Submission failed:",o||d.message);let c="Submission failed. Please check form values.";o&&typeof o=="object"&&(c=Object.entries(o).map(([q,h])=>`${q}: ${Array.isArray(h)?h.join(", "):h}`).join(`
`)),alert(`❌ ${c}`)}},ee=t=>{y({projectId:t.project,procurementId:t.procurement_id,materialName:t.material_name,materialCode:t.material_code,quantity:t.quantity_requested,unitPrice:t.unit_price,totalCost:t.total_cost,requestedBy:t.requested_by,requestDate:t.request_date,approvalStatus:t.approval_status,paymentStatus:t.payment_status,expectedDeliveryDate:t.expected_delivery_date,purchaseOrder:t.purchase_order}),v("update"),j(!0)},te=async t=>{if(window.confirm(`Delete ${t}?`))try{await le(t),alert(`Deleted ${t} successfully`),f(),T(d=>d.filter(o=>o.procurementId!==t))}catch{alert("Failed to delete. Check console for details.")}},E=F.filter(t=>Object.values(t).some(n=>n&&n.toString().toLowerCase().includes(I.toLowerCase()))),A=Math.ceil(E.length/b),re=E.slice((p-1)*b,p*b);return e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Material Procurement"}),e.jsx(a,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(L,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(m,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(P,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:C,onChange:t=>G(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs($,{children:[e.jsx(H,{children:e.jsxs(g,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(U,{children:V.filter(t=>{var n;return(n=t.project_id)==null?void 0:n.toLowerCase().includes(C.toLowerCase())}).map((t,n)=>e.jsxs(g,{children:[e.jsx(r,{children:t.project_id}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(u,{onClick:()=>X(t.project_id),color:"primary",children:e.jsx(xe,{sx:{color:"#7267ef"}})})})]},n))})]}),e.jsxs(P,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(u,{disabled:x===1,onClick:()=>w(t=>t-1),children:e.jsx(R,{})}),e.jsxs(m,{variant:"body2",sx:{mx:2},children:["Page ",x," of ",B||1]}),e.jsx(u,{disabled:x>=B,onClick:()=>w(t=>t+1),children:e.jsx(k,{})})]})]})})}),e.jsx(a,{container:!0,spacing:2,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(L,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(m,{variant:"h6",gutterBottom:!0,children:"SUBMITTED MATERIALS PROCUREMENT RECORDS"}),e.jsx("input",{type:"text",placeholder:"Search Materials Procurements Here....",value:I,onChange:t=>W(t.target.value),className:"input"}),e.jsx(pe,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs($,{stickyHeader:!0,children:[e.jsx(H,{children:e.jsxs(g,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Procurement ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Purchase Order ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Material Name"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Material Code"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Quantity"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Unit Price"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Total Cost"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Requested By"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Request Date"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Status"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Payment Status"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Expected Delivery Date"})}),e.jsx(r,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(U,{children:re.map((t,n)=>e.jsxs(g,{children:[e.jsx(r,{children:t.project}),e.jsx(r,{children:t.procurement_id}),e.jsx(r,{children:t.purchase_order||"-"}),e.jsx(r,{children:t.material_name}),e.jsx(r,{children:t.material_code}),e.jsx(r,{children:t.quantity_requested}),e.jsx(r,{children:t.unit_price}),e.jsx(r,{children:t.total_cost}),e.jsx(r,{children:t.requested_by}),e.jsx(r,{children:t.request_date}),e.jsx(r,{children:t.approval_status}),e.jsx(r,{children:t.payment_status}),e.jsx(r,{children:t.expected_delivery_date}),e.jsxs(r,{children:[e.jsx(u,{color:"warning",onClick:()=>ee(t),children:e.jsx(he,{sx:{color:"orange"}})}),e.jsx(u,{color:"error",onClick:()=>te(t.procurement_id),children:e.jsx(me,{sx:{color:"red"}})})]})]},n))})]})}),e.jsxs(P,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(u,{disabled:p===1,onClick:()=>N(t=>t-1),children:e.jsx(R,{})}),e.jsxs(m,{variant:"body2",sx:{mx:2},children:["Page ",p," of ",A||1]}),e.jsx(u,{disabled:p>=A,onClick:()=>N(t=>t+1),children:e.jsx(k,{})})]})]})})}),e.jsxs(ce,{open:Y,onClose:S,fullWidth:!0,children:[e.jsx(de,{children:"Enter Procurement Details"}),e.jsxs(ue,{sx:{position:"relative"},children:[e.jsx(u,{"aria-label":"close",onClick:S,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(se,{})}),e.jsx(P,{component:"form",sx:{mt:2},children:e.jsxs(a,{container:!0,spacing:3,direction:"column",children:[e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project & Procurement Info"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",name:"projectId",className:"input",value:s.projectId||"",disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"procurementId",children:"Procurement ID"}),e.jsx("input",{id:"procurementId",name:"procurementId",className:"input",value:s.procurementId||"",disabled:!0})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Material Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"materialName",children:"Material Name"}),e.jsx("input",{id:"materialName",name:"materialName",className:"input",value:s.materialName||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"materialCode",children:"Material Code"}),e.jsx("input",{id:"materialCode",name:"materialCode",className:"input",value:s.materialCode||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"quantity",children:"Quantity"}),e.jsx("input",{id:"quantity",name:"quantity",className:"input",value:s.quantity||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"unitPrice",children:"Unit Price"}),e.jsx("input",{id:"unitPrice",name:"unitPrice",className:"input",value:s.unitPrice||"",onChange:i})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Cost & Info"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"totalCost",children:"Total Cost"}),e.jsx("input",{id:"totalCost",name:"totalCost",className:"input",value:s.totalCost||"",disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"requestedBy",children:"Requested By"}),e.jsx("input",{id:"requestedBy",name:"requestedBy",className:"input",value:s.requestedBy||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"requestDate",children:"Request Date"}),e.jsx("input",{type:"date",id:"requestDate",name:"requestDate",className:"input",value:s.requestDate||"",onChange:i})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Approval & Payment"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:s.approvalStatus||"",onChange:i,children:[e.jsx("option",{value:"",children:"Select Approval Status"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"expectedDeliveryDate",children:"Expected Delivery Date"}),e.jsx("input",{type:"date",id:"expectedDeliveryDate",name:"expectedDeliveryDate",className:"input",value:s.expectedDeliveryDate||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"paymentStatus",children:"Payment Status"}),e.jsxs("select",{id:"paymentStatus",name:"paymentStatus",className:"input",value:s.paymentStatus||"",onChange:i,children:[e.jsx("option",{value:"",children:"Select Payment Status"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Partially Paid",children:"Partially Paid"})]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"purchaseOrder",children:"Purchase OrderId"}),e.jsx("input",{id:"purchaseOrder",name:"purchaseOrder",className:"input",value:s.purchaseOrder||"",onChange:i})]})]})]})]})})]}),e.jsxs(je,{children:[e.jsx(Q,{onClick:S,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(Q,{variant:"outlined",onClick:Z,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:_==="update"?"Update Procurement":"Submit Procurement"})]})]})]})};export{Be as default};
