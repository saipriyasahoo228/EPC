import{r as o,j as e,T as I,J as F,E as N,S as P,I as x,K as M}from"./main-Skim5IJC.js";import{C as X}from"./Close-BKZ7QrSY.js";import{D as Z}from"./Download-C4sxsXoP.js";import{E as ee,a as te}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{g as se,k as _,l as ne,m as ie,n as ae}from"./maintenance-DLF_HkF3.js";import{f as j}from"./date-DdrLtg20.js";import{G as a}from"./Grid-fY_ATwTx.js";import{B as S,D as oe,a as re,b as ce,c as le}from"./DialogTitle-CvDFHAwp.js";import{T as R,a as B,b as f,c as n,d as z}from"./TableRow-B6k_bSOs.js";import{A as de}from"./AddCircle-CJp4DZj3.js";import{T as pe}from"./TableContainer-gCCy6yK7.js";import{E as xe}from"./Edit-6vcT2Cu4.js";import{D as he}from"./Delete-Be1vvbhC.js";import{M as ue,a as me}from"./minimize-2-RCuvNn0X.js";const Fe=()=>{const h="maintenance",[b,Y]=o.useState(""),[v,L]=o.useState(""),[$,y]=o.useState(!1),[g,O]=o.useState(!1),[je,W]=o.useState(""),[i,d]=o.useState({}),[w,C]=o.useState([]),[E,u]=o.useState(!1),[D,k]=o.useState(null),[fe,A]=o.useState(null),[G,H]=o.useState([]),U=()=>{O(!g)};o.useEffect(()=>{(async()=>{try{const s=await se();H(s)}catch(s){console.error("❌ Failed to fetch assets:",s)}})()},[]),o.useEffect(()=>{(async()=>{try{const s=await _();C(s)}catch(s){console.error(s)}})()},[]);const Q=t=>{W(t);const s=new Date().getFullYear(),p=(w.length+1).toString().padStart(4,"0");d({complianceID:`CMS-${s}-${p}`,assetId:t}),u(!1),A(null),y(!0)},J=t=>{d({complianceID:t.compliance_id,assetId:t.asset,inspectionDate:t.inspection_date,inspectionType:t.inspection_type,inspectorID:t.inspector_id,regulatoryStandards:t.regulatory_standards,nonComplianceIssues:t.non_compliance_issues||"",correctiveActionPlan:t.corrective_action_plan||"",certificationExpiryDate:t.certification_expiry_date||""}),k(t.compliance_id),u(!0),y(!0)},K=async t=>{if(window.confirm(`⚠️ Are you sure you want to delete Compliance ID: ${t}?`))try{await ne(t),alert(`✅ Compliance ${t} deleted successfully`);const r=await _();C(r)}catch(r){alert("❌ Failed to delete compliance"),console.error("Delete error:",r)}},m=()=>{y(!1),d({}),u(!1),A(null)},c=t=>{const{name:s,value:r}=t.target;d(p=>({...p,[s]:r}))},q=async()=>{try{const t={asset:i.assetId,inspection_date:i.inspectionDate,inspection_type:i.inspectionType,inspector_id:i.inspectorID,regulatory_standards:i.regulatoryStandards,non_compliance_issues:i.nonComplianceIssues||null,corrective_action_plan:i.correctiveActionPlan||null,certification_expiry_date:i.certificationExpiryDate||null};let s;D?(s=await ie(D,t),alert(`✅ Safety Check updated: ${s.compliance_id}`)):(s=await ae(t),alert(`✅ Safety Check created: ${s.compliance_id}`));const r=await _();C(r),d({}),k(null),u(!1),m()}catch(t){console.error("❌ handleSubmit error:",t),alert("❌ Failed to submit safety check")}},T=w.filter(t=>Object.values(t).some(s=>s&&s.toString().toLowerCase().includes(v.toLowerCase()))),V=t=>{const s=new ee("l","mm","a4");s.setFontSize(16),s.text("All Compliance & Safety Checks Report",14,15);const r=["Asset ID","Compliance ID","Inspection Date","Inspection Type","Inspector ID","Regulatory Standards","Non-Compliance Issues","Corrective Action Plan","Certification Expiry Date"],p=t.map(l=>[l.asset,l.compliance_id,j(l.inspection_date),l.inspection_type,l.inspector_id,l.regulatory_standards,l.non_compliance_issues,l.corrective_action_plan,j(l.certification_expiry_date)]);te(s,{head:[r],body:p,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),s.save("all_compliance_safety_checks_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(I,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Compliance & Safety Checks"}),e.jsx(a,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(F,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsxs(I,{variant:"h6",gutterBottom:!0,children:[e.jsx(S,{startIcon:e.jsx(Z,{}),onClick:()=>V(T),children:"Download PDF"}),"ASSETS RECORDS"]}),e.jsx(N,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Asset ID",value:b,onChange:t=>Y(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(R,{children:[e.jsx(B,{children:e.jsxs(f,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(z,{children:G.filter(t=>t.asset_id.toLowerCase().includes(b.toLowerCase())).map((t,s)=>e.jsxs(f,{children:[e.jsx(n,{children:t.asset_id}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(P,{slug:h,action:"can_create",children:e.jsx(x,{onClick:()=>Q(t.asset_id),color:"primary",children:e.jsx(de,{sx:{color:"#7267ef"}})})})})]},s))})]})]})})}),e.jsx(a,{container:!0,spacing:2,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(F,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(I,{variant:"h6",gutterBottom:!0,children:"Compliance & Safety Checks Details"}),e.jsx("input",{type:"text",placeholder:"Search Safety Check Details",value:v,onChange:t=>L(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(pe,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(R,{stickyHeader:!0,children:[e.jsx(B,{children:e.jsxs(f,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Date"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Type"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspector ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Regulatory Standards"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Non-Compliance Issues"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Corrective Action Plan"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Certification ExpiryDate"})}),e.jsx(n,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(z,{children:T.map((t,s)=>e.jsxs(f,{children:[e.jsx(n,{children:t.asset}),e.jsx(n,{children:t.compliance_id}),e.jsx(n,{children:j(t.inspection_date)}),e.jsx(n,{children:t.inspection_type}),e.jsx(n,{children:t.inspector_id}),e.jsx(n,{children:t.regulatory_standards}),e.jsx(n,{children:t.non_compliance_issues}),e.jsx(n,{children:t.corrective_action_plan}),e.jsx(n,{children:j(t.certification_expiry_date)}),e.jsxs(n,{children:[e.jsx(M,{slug:h,action:"can_update",children:e.jsx(x,{onClick:()=>J(t),color:"warning",children:e.jsx(xe,{sx:{color:"orange"}})})}),e.jsx(P,{slug:h,action:"can_delete",children:e.jsx(x,{onClick:()=>K(t.compliance_id),color:"error",children:e.jsx(he,{sx:{color:"red"}})})})]})]},s))})]})})]})})}),e.jsxs(oe,{open:$,onClose:m,fullWidth:!0,maxWidth:"xl",PaperProps:{style:g?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(re,{children:E?"Edit Safety Check Details":"Enter Safety Check Details"}),e.jsxs(ce,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(x,{"aria-label":"toggle-size",onClick:U,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:g?e.jsx(ue,{}):e.jsx(me,{})}),e.jsx(x,{"aria-label":"close",onClick:m,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(X,{})}),e.jsx(N,{component:"form",sx:{mt:2},children:e.jsx(a,{container:!0,spacing:3,direction:"column",children:e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Compliance Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"complianceID",children:"Compliance ID"}),e.jsx("input",{id:"complianceID",name:"complianceID",className:"input",value:i.complianceID||"",onChange:c,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"assetId",children:"Asset ID"}),e.jsx("input",{id:"assetId",name:"assetId",className:"input",value:i.assetId||"",onChange:c,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionDate",children:"Inspection Date"}),e.jsx("input",{type:"date",id:"inspectionDate",name:"inspectionDate",className:"input",value:i.inspectionDate||"",onChange:c})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionType",children:"Inspection Type"}),e.jsx("input",{id:"inspectionType",name:"inspectionType",className:"input",value:i.inspectionType||"",onChange:c})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectorID",children:"Inspector ID"}),e.jsx("input",{id:"inspectorID",name:"inspectorID",className:"input",value:i.inspectorID||"",onChange:c})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"regulatoryStandards",children:"Regulatory Standards"}),e.jsx("input",{id:"regulatoryStandards",name:"regulatoryStandards",className:"input",value:i.regulatoryStandards||"",onChange:c})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"nonComplianceIssues",children:"Non-Compliance Issues"}),e.jsx("textarea",{id:"nonComplianceIssues",name:"nonComplianceIssues",className:"input",rows:"3",value:i.nonComplianceIssues||"",onChange:c})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"correctiveActionPlan",children:"Corrective Action Plan"}),e.jsx("textarea",{id:"correctiveActionPlan",name:"correctiveActionPlan",className:"input",rows:"3",value:i.correctiveActionPlan||"",onChange:c})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"certificationExpiryDate",children:"Certification Expiry Date"}),e.jsx("input",{type:"date",id:"certificationExpiryDate",name:"certificationExpiryDate",className:"input",value:i.certificationExpiryDate||"",onChange:c})]})]})]})})})]}),e.jsxs(le,{children:[e.jsx(S,{onClick:m,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(M,{slug:h,action:D?"can_update":"can_create",children:e.jsx(S,{variant:"outlined",onClick:q,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:E?"Update":"Submit"})})]})]})]})};export{Fe as default};
