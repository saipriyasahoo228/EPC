import{r as l,j as e,T as I,x as _,S as v,D as w}from"./main-BIxdd69i.js";import{C as Q}from"./Close-D340Gps3.js";import{a as W,g as q,b as J,e as X,f as Z}from"./inventory-Bcy74QM6.js";import{G as n}from"./Grid-BnZNKmae.js";import{P as B,I as h,D as ee,f as te,g as se,h as oe,e as D}from"./DialogTitle-D59uELMl.js";import{T as M,a as T,b as j,c as s,d as F}from"./TableRow-D8X36zJO.js";import{A as ne}from"./AddCircle-Bn9h5MaP.js";import{T as ae}from"./TableContainer-1Xqyy-f8.js";import{E as re}from"./Edit-BJV-h6Li.js";import{D as ce}from"./Delete-BHKbKfZ2.js";import{M as le,a as ie}from"./minimize-2-Dl_U24Qm.js";const Ie=()=>{const m="inventory",[y,E]=l.useState(""),[b,N]=l.useState(""),[U,k]=l.useState(!1),[$,O]=l.useState([]),[d,g]=l.useState(""),[a,u]=l.useState({}),[C,V]=l.useState([]),[f,L]=l.useState(!1),A=()=>{L(!f)},R=t=>{const o=new Date().getFullYear(),r=C.length+1,c=`STK-${o}-${String(r).padStart(3,"0")}`;g(null),u({itemId:t,stockManagementId:c,openingStock:"",stockIssued:"",stockIssuedBy:"",stockBalance:"",stockValuation:"",lastUpdated:new Date().toISOString().split("T")[0]}),k(!0)},p=()=>{u({}),k(!1)};l.useEffect(()=>{(async()=>{try{const o=await q();O(o)}catch(o){console.error("Error loading inventory items:",o)}})()},[]),l.useEffect(()=>{S()},[]);const S=async()=>{try{const t=await W();V(t),setFilteredStockManagement(t)}catch(t){console.error("Error loading stock management:",t)}},x=t=>{const{name:o,value:r}=t.target;u(c=>{let i={...c,[o]:r};if(o==="openingStock"||o==="stockIssued"){const Y=parseFloat(i.openingStock)||0,K=parseFloat(i.stockIssued)||0;i.stockBalance=Y-K}return i})},z=t=>{u({stockManagementId:t.stock_id,itemId:t.item,openingStock:t.opening_stock,stockIssued:t.stock_issued,stockIssuedBy:t.stock_issued_by,stockBalance:t.stock_balance,stockValuation:t.stock_valuation,lastUpdated:t.last_updated}),g(t.stock_id||t.stockManagementId),k(!0)},P=async()=>{var t,o;try{const r={item:a.itemId,opening_stock:Number(a.openingStock)||0,stock_issued:Number(a.stockIssued)||0,stock_issued_by:a.stockIssuedBy,stock_valuation:Number(a.stockValuation)||0,last_updated:a.lastUpdated||new Date().toISOString().split("T")[0]};let c;d?c=await X(d,r):c=await Z(r),console.log("✅ API Response:",c);let i=`✅ ${c.message||(d?"Stock updated":"Stock created")}`;(t=c.data)!=null&&t.stock_id&&(i+=`
Stock ID: ${c.data.stock_id}`),c.alert&&(i+=`

⚠️ ${c.alert}`),alert(i),await S(),u({}),g(null),p()}catch(r){console.error(`❌ Error ${d?"updating":"creating"} stock:`,r),alert(`⚠️ Failed to ${d?"update":"create"} stock:
${((o=r.response)==null?void 0:o.data)||r.message}`)}},G=async t=>{if(window.confirm(`Are you sure you want to delete stock ${t}?`))try{await J(t),await S(),alert(`✅ Stock ${t} deleted successfully`)}catch(r){alert(`❌ Failed to delete stock ${t}`),console.error(`Error deleting stock ${t}:`,r)}},H=C.filter(t=>Object.values(t).some(o=>o&&o.toString().toLowerCase().includes(b.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(I,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Stock Management"}),e.jsx(n,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(B,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(I,{variant:"h6",gutterBottom:!0,children:"ITEM RECORDS"}),e.jsx(_,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Item ID",value:y,onChange:t=>E(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(M,{children:[e.jsx(T,{children:e.jsxs(j,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Item ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(F,{children:$.filter(t=>t.item_id.toLowerCase().includes(y.toLowerCase())).map((t,o)=>e.jsxs(j,{children:[e.jsx(s,{children:t.item_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(v,{slug:m,action:"can_create",children:e.jsx(h,{onClick:()=>R(t.item_id),color:"primary",children:e.jsx(ne,{sx:{color:"#7267ef"}})})})})]},o))})]})]})})}),e.jsx(n,{container:!0,spacing:2,children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(B,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(I,{variant:"h6",gutterBottom:!0,children:"SUBMITTED STOCKS"}),e.jsx("input",{type:"text",placeholder:"Search Stock Management",value:b,onChange:t=>N(t.target.value),className:"input",style:{width:"100%",padding:"8px",marginBottom:"1rem",border:"1px solid #ccc",borderRadius:4}}),e.jsx(ae,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(M,{stickyHeader:!0,children:[e.jsx(T,{children:e.jsxs(j,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Item ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Opening Stock"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock Issued"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock Issued By"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock Balance"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock Valuation"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Last Updated"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(F,{children:H.map((t,o)=>e.jsxs(j,{children:[e.jsx(s,{children:t.item})," ",e.jsx(s,{children:t.stock_id})," ",e.jsx(s,{children:t.opening_stock}),e.jsx(s,{children:t.stock_issued}),e.jsx(s,{children:t.stock_issued_by}),e.jsx(s,{children:t.stock_balance}),e.jsx(s,{children:t.stock_valuation}),e.jsx(s,{children:t.last_updated}),e.jsxs(s,{children:[e.jsx(w,{slug:m,action:"can_update",children:e.jsx(h,{color:"warning",onClick:()=>z(t),children:e.jsx(re,{sx:{color:"orange"}})})}),e.jsx(v,{slug:m,action:"can_delete",children:e.jsx(h,{color:"error",onClick:()=>G(t.stock_id),children:e.jsx(ce,{sx:{color:"red"}})})})]})]},o))})]})})]})})}),e.jsxs(ee,{open:U,onClose:p,fullWidth:!0,maxWidth:"xl",PaperProps:{style:f?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(te,{children:"Enter Stock Management Details"}),e.jsxs(se,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(h,{"aria-label":"toggle-size",onClick:A,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:f?e.jsx(le,{}):e.jsx(ie,{})}),e.jsx(h,{"aria-label":"close",onClick:p,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(Q,{})}),e.jsx(_,{component:"form",sx:{mt:2},children:e.jsxs(n,{container:!0,spacing:3,direction:"column",children:[e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Stock Id's Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"itemId",children:"Item ID"}),e.jsx("input",{id:"itemId",name:"itemId",className:"input",value:a.itemId||"",disabled:!0})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockManagementId",children:"Stock Id"}),e.jsx("input",{id:"stockManagementId",name:"stockManagementId",className:"input",value:a.stockManagementId||"",disabled:!0})]})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Stock Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"openingStock",children:"Opening Stock"}),e.jsx("input",{id:"openingStock",name:"openingStock",className:"input",value:a.openingStock||"",onChange:x,type:"number"})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockIssued",children:"Stock Issued"}),e.jsx("input",{type:"number",id:"stockIssued",name:"stockIssued",className:"input",value:a.stockIssued||"",onChange:x})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockIssuedBy",children:"Stock Issued By"}),e.jsx("input",{id:"stockIssuedBy",name:"stockIssuedBy",className:"input",value:a.stockIssuedBy||"",onChange:x})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Stock Balance and Valuations"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockBalance",children:"Stock Balance"}),e.jsx("input",{id:"stockBalance",name:"stockBalance",className:"input",value:a.stockBalance||"",onChange:x,readOnly:!0})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockValuation",children:"Stock Valuation"}),e.jsx("input",{id:"stockValuation",name:"stockValuation",className:"input",value:a.stockValuation||"",onChange:x})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"lastUpdated",children:"Last Updated "}),e.jsx("input",{type:"date",id:"lastUpdated",name:"lastUpdated",className:"input",value:a.lastUpdated||"",onChange:x})]})]})]})})]}),e.jsxs(oe,{children:[e.jsx(D,{onClick:p,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(w,{slug:m,action:d?"can_update":"can_create",children:e.jsx(D,{variant:"outlined",onClick:P,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:"Submit"})})]})]})]})};export{Ie as default};
