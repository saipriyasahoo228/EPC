import{r as n,j as e,T as b,x as S,S as T,D as N}from"./main-BIxdd69i.js";import{C as ee}from"./Close-D340Gps3.js";import{g as te}from"./engineering-4VzvUWDc.js";import{f as se,g as re,a as oe,b as ne,e as ae,h as ie}from"./construction-TCh-rxln.js";import{G as a}from"./Grid-BnZNKmae.js";import{P as L,I as d,e as w,D as le,f as ce,g as de,h as xe}from"./DialogTitle-D59uELMl.js";import{T as k,a as F,b as y,c as r,d as B}from"./TableRow-D8X36zJO.js";import{A as he}from"./AddCircle-Bn9h5MaP.js";import{T as je}from"./TableContainer-1Xqyy-f8.js";import{L as ue}from"./LinearProgress-BeP33HTl.js";import{E as pe}from"./Edit-BJV-h6Li.js";import{D as me}from"./Delete-BHKbKfZ2.js";import{M as fe,a as ge}from"./minimize-2-Dl_U24Qm.js";import"./index-E3WhgaTq.js";const Fe=()=>{const x="construction",[Ce,A]=n.useState([]),[c,O]=n.useState([]),[M,z]=n.useState([]),[h,D]=n.useState(""),[be,E]=n.useState(""),[R,v]=n.useState(!1),[I,U]=n.useState(!1),[j,_]=n.useState(!1),[u,P]=n.useState(null),[p,W]=n.useState(""),[m,G]=n.useState(""),[i,f]=n.useState({project:"",name:"",description:"",start_date:"",end_date:"",status:"not started"}),H=()=>U(t=>!t),g=()=>{v(!1),_(!1),P(null),f({project:"",name:"",description:"",start_date:"",end_date:"",status:"not started"})};n.useEffect(()=>{(async()=>{try{const s=await te();A(s||[]);const o=await se();O(o||[])}catch(s){console.error("❌ Error fetching projects:",s)}})()},[]);const C=async t=>{try{const s=t?await re(t):await oe();z(s||[])}catch(s){console.error("❌ Failed to load milestones:",s)}};n.useEffect(()=>{C("")},[]);const $=n.useMemo(()=>{if(!p)return c;const t=p.toLowerCase();return(c||[]).filter(s=>[s.project,s.project_name,s.project_status].filter(Boolean).some(o=>o.toString().toLowerCase().includes(t)))},[c,p]),q=n.useMemo(()=>{if(!m)return M;const t=m.toLowerCase();return(M||[]).filter(s=>[s.name,s.description,s.status,s.project].filter(Boolean).some(o=>o.toString().toLowerCase().includes(t)))},[M,m]),J=t=>t?t.toString().toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "):"",V=t=>{const s=(c||[]).find(o=>String(o.id)===String(t));return(s==null?void 0:s.project)||t},Y=(t,s)=>{E(t),D(s||""),f({project:t,name:"",description:"",start_date:"",end_date:"",status:"not started"}),_(!1),P(null),v(!0)},K=t=>{_(!0),P(t),E(t.project),f({project:t.project,name:t.name||"",description:t.description||"",start_date:(t.start_date||"").slice(0,10),end_date:(t.end_date||"").slice(0,10),status:t.status||"not started"}),v(!0)},Q=async t=>{if(window.confirm(`Are you sure you want to delete milestone ID: ${t}?`))try{await ne(t),alert("✅ Milestone deleted successfully!"),C(h)}catch(o){console.error("❌ Error deleting milestone:",o),alert("❌ Failed to delete milestone.")}},l=t=>{const{name:s,value:o}=t.target;f(Z=>({...Z,[s]:o}))},X=async()=>{var t;try{const s={project:i.project,name:i.name,description:i.description,start_date:i.start_date,end_date:i.end_date,status:i.status};j&&(u!=null&&u.id)?(await ae(u.id,s),alert("Milestone updated successfully!")):(await ie(s),alert("Milestone created successfully!")),g(),C(h)}catch(s){if(console.error("❌ Error submitting milestone:",s),(t=s.response)!=null&&t.data){const o=s.response.data.message||s.response.data.error||Object.values(s.response.data)[0];alert(`Error: ${o}`)}else alert("Error in submitting milestone details!")}};return e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Milestones"}),e.jsx(a,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(L,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:"PROJECTS"}),e.jsx(S,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Projects",value:p,onChange:t=>W(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(k,{children:[e.jsx(F,{children:e.jsxs(y,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(B,{children:($||[]).map((t,s)=>e.jsxs(y,{children:[e.jsx(r,{children:t.project}),e.jsxs(r,{sx:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(T,{slug:x,action:"can_create",children:e.jsx(d,{onClick:()=>Y(t.id,t.project),color:"primary",children:e.jsx(he,{sx:{color:"#7267ef"}})})}),e.jsx(w,{variant:"text",onClick:()=>{D(t.project),C(t.project)},children:"View Milestones"})]})]},s))})]})]})})}),e.jsx(a,{container:!0,spacing:2,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(L,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:h?`MILESTONES FOR PROJECT ${h}`:"ALL MILESTONES"}),e.jsx("input",{type:"text",placeholder:"Search Milestones",value:m,onChange:t=>G(t.target.value),className:"input"}),e.jsx(je,{sx:{maxHeight:450,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(k,{stickyHeader:!0,children:[e.jsx(F,{children:e.jsxs(y,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Name"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Description"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Start Date"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"End Date"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Status"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Progress"})}),e.jsx(r,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(B,{children:(q||[]).map(t=>{var s,o;return e.jsxs(y,{children:[e.jsx(r,{children:t.id}),e.jsx(r,{children:V(t.project)}),e.jsx(r,{children:t.name}),e.jsx(r,{children:t.description}),e.jsx(r,{children:(s=t.start_date)==null?void 0:s.slice(0,10)}),e.jsx(r,{children:(o=t.end_date)==null?void 0:o.slice(0,10)}),e.jsx(r,{children:J(t.status)}),e.jsx(r,{sx:{minWidth:120},children:e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(S,{sx:{width:"100%"},children:e.jsx(ue,{variant:"determinate",value:Number(t.progress||0)})}),e.jsxs(b,{variant:"body2",sx:{minWidth:36},children:[Number(t.progress||0),"%"]})]})}),e.jsxs(r,{children:[e.jsx(N,{slug:x,action:"can_update",children:e.jsx(d,{color:"warning",onClick:()=>K(t),children:e.jsx(pe,{sx:{color:"orange"}})})}),e.jsx(T,{slug:x,action:"can_delete",children:e.jsx(d,{color:"error",onClick:()=>Q(t.id),children:e.jsx(me,{sx:{color:"red"}})})})]})]},t.id)})})]})})]})})}),e.jsxs(le,{open:R,onClose:g,fullWidth:!0,maxWidth:"lg",PaperProps:{style:I?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"90vh"}},children:[e.jsx(ce,{children:j?"Edit Milestone":"Create Milestone"}),e.jsxs(de,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(d,{"aria-label":"toggle-size",onClick:H,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:I?e.jsx(fe,{}):e.jsx(ge,{})}),e.jsx(d,{"aria-label":"close",onClick:g,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(ee,{})}),e.jsx(S,{component:"form",sx:{mt:2},children:e.jsx(a,{container:!0,spacing:3,direction:"column",children:e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Milestone Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"project",children:"Project"}),e.jsxs("select",{id:"project",name:"project",className:"input",value:i.project,onChange:l,children:[e.jsx("option",{value:"",children:"Select Project"}),(c||[]).map(t=>e.jsx("option",{value:t.id,children:t.project},t.id))]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"name",children:"Name"}),e.jsx("input",{id:"name",name:"name",className:"input",value:i.name,onChange:l})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",className:"input",rows:3,value:i.description,onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"start_date",children:"Start Date"}),e.jsx("input",{type:"date",id:"start_date",name:"start_date",className:"input",value:i.start_date,onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"end_date",children:"End Date"}),e.jsx("input",{type:"date",id:"end_date",name:"end_date",className:"input",value:i.end_date,onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",className:"input",value:i.status,onChange:l,children:[e.jsx("option",{value:"not started",children:"Not Started"}),e.jsx("option",{value:"in progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"delayed",children:"Delayed"})]})]})]})]})})})]}),e.jsxs(xe,{children:[e.jsx(w,{onClick:g,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(N,{slug:x,action:j?"can_update":"can_create",children:e.jsx(w,{variant:"outlined",onClick:X,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:j?"Update Milestone":"Submit Milestone"})})]})]})]})};export{Fe as default};
