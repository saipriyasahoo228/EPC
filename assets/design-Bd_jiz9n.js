import{r as o,j as e,T as j,J as z,E as m,S as O,I as c,K as Y}from"./main-Skim5IJC.js";import{g as le,a as de,d as ce,u as pe,c as xe}from"./engineering-BJ3wTiKO.js";import{C as ue}from"./Close-BKZ7QrSY.js";import{D as he}from"./Download-C4sxsXoP.js";import{E as je,a as me}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{f as $}from"./date-DdrLtg20.js";import{G as a}from"./Grid-fY_ATwTx.js";import{T as U,a as V,b,c as t,d as G}from"./TableRow-B6k_bSOs.js";import{A as ge}from"./AddCircle-CJp4DZj3.js";import{A as W,a as H}from"./ArrowForwardIos-D05tyAMF.js";import{B as C,D as fe,a as ye,b as ve,c as be}from"./DialogTitle-CvDFHAwp.js";import{T as Ce}from"./TableContainer-gCCy6yK7.js";import{V as De}from"./Visibility-CWvGRW87.js";import{E as _e}from"./Edit-6vcT2Cu4.js";import{D as Se}from"./Delete-Be1vvbhC.js";import{M as we,a as Be}from"./minimize-2-RCuvNn0X.js";const Ue=()=>{const g="engineering",[f,J]=o.useState(""),[F,Q]=o.useState(""),[K,y]=o.useState(!1),[E,D]=o.useState(""),[n,p]=o.useState({}),[_,X]=o.useState([]),[S,Z]=o.useState([]),[w,B]=o.useState(null),[P,A]=o.useState("create"),[I,ee]=o.useState(!1),v=4,[x,k]=o.useState(1),[u,M]=o.useState(1),T=5;o.useEffect(()=>{(async()=>{try{const r=await le();Z(r)}catch(r){console.error("Error fetching projects:",r)}})()},[]);const N=async()=>{try{const s=await de();X(s)}catch(s){console.error("Error fetching design plans:",s)}};o.useEffect(()=>{N()},[]);const se=async()=>{const s=new FormData;if(s.append("project",E),s.append("design_name",n.designName),s.append("design_type",n.designType),s.append("prepared_by",n.preparedBy),s.append("version_number",n.versionNumber),s.append("reviewed_by",n.reviewedBy||""),s.append("approval_status",n.approvalStatus||"Pending"),s.append("approval_date",n.approvalDate||""),s.append("compliance_standard",n.complianceStandard),s.append("design_constraints",n.designConstraints),s.append("estimated_budget",n.estimatedBudget),s.append("resource_requirements",n.resourceRequirements),s.append("design_completion_date",n.designCompletionDate),s.append("status",n.status),n.blueprint)s.append("blueprint",n.blueprint);else if(!w){alert("Please upload a blueprint file.");return}try{let r;w?(s.append("design_id",n.designId),r=await pe(w,s),alert("✅ Design updated successfully")):(r=await xe(s),alert("✅ Design submitted successfully")),await N(),p({designName:"",designType:"",preparedBy:"",versionNumber:"",reviewedBy:"",approvalStatus:"",approvalDate:"",complianceStandard:"",designConstraints:"",estimatedBudget:"",resourceRequirements:"",designCompletionDate:"",status:"",blueprint:null,projectCode:"",designId:""}),D(null),B(null),y(!1)}catch(r){if(r.response){console.error("Backend Error:",r.response.data);const d=typeof r.response.data=="object"?Object.entries(r.response.data).map(([h,i])=>`${h}: ${i}`).join(`
`):r.response.data;alert(`❌ Submission failed:
${d}`)}else console.error("Network/Other Error:",r.message),alert(`❌ Submission failed: ${r.message}`)}},te=s=>{A("edit"),B(s.design_id),D(s.project),p({designId:s.design_id,designName:s.design_name,designType:s.design_type,versionNumber:s.version_number,preparedBy:s.prepared_by,reviewedBy:s.reviewed_by,approvalStatus:s.approval_status,approvalDate:s.approval_date,complianceStandard:s.compliance_standard,designConstraints:s.design_constraints,estimatedBudget:s.estimated_budget,resourceRequirements:s.resource_requirements,designCompletionDate:s.design_completion_date,status:s.status,blueprint:null,projectCode:""}),y(!0)},re=async s=>{var r;if(window.confirm(`Are you sure you want to delete ${s}?`))try{await ce(s),alert(`Design ${s} deleted successfully ✅`),await N()}catch(d){console.error("Delete failed:",((r=d.response)==null?void 0:r.data)||d.message),alert("❌ Failed to delete the design.")}},ne=s=>{A("create"),D(s);const r=new Date().getFullYear(),d=String(_.length+1).padStart(4,"0");p({designId:`DES-${r}-${d}`,designName:"",designType:"",preparedBy:"",versionNumber:"",reviewedBy:"",approvalStatus:"Pending",approvalDate:"",complianceStandard:"",designConstraints:"",estimatedBudget:"",resourceRequirements:"",designCompletionDate:"",status:"",blueprint:null,projectCode:""}),B(null),y(!0)},R=()=>y(!1),l=s=>{const{name:r,value:d}=s.target;p(h=>({...h,[r]:d}))},q=_.filter(s=>Object.values(s).some(r=>r&&r.toString().toLowerCase().includes(F.toLowerCase()))),L=Math.ceil(q.length/T),ae=q.slice((u-1)*T,u*T),ie=()=>{ee(!I)},oe=s=>{const r=new je("l","mm","a4");r.setFontSize(16),r.text("All Designs Report",14,15);const d=["Project","Design ID","Name","Type","Version","Prepared By","Reviewed By","Approval Status","Approval Date","Compliance Standard","Constraints","Budget","Resources","Completion Date","Status"],h=s.map(i=>[i.project,i.design_id,i.design_name,i.design_type,i.version_number,i.prepared_by,i.reviewed_by,i.approval_status,i.approval_date,i.compliance_standard,i.design_constraints,i.estimated_budget,i.resource_requirements,i.design_completion_date,i.status]);me(r,{head:[d],body:h,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),r.save("all_designs_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Design Management"}),e.jsx(a,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(z,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(j,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(m,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:f,onChange:s=>J(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(U,{children:[e.jsx(V,{children:e.jsxs(b,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(G,{children:S.filter(s=>s.project_id.toLowerCase().includes(f.toLowerCase())).slice((x-1)*v,x*v).map((s,r)=>e.jsxs(b,{children:[e.jsx(t,{children:s.project_id}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(O,{slug:g,action:"can_create",children:e.jsx(c,{onClick:()=>ne(s.project_id),color:"primary",children:e.jsx(ge,{sx:{color:"#7267ef"}})})})})]},r))})]}),e.jsxs(m,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(c,{disabled:x===1,onClick:()=>k(s=>s-1),children:e.jsx(W,{})}),e.jsxs(j,{variant:"body2",sx:{mx:2},children:["Page ",x," of ",Math.ceil(S.filter(s=>s.project_id.toLowerCase().includes(f.toLowerCase())).length/v)]}),e.jsx(c,{disabled:x>=Math.ceil(S.filter(s=>s.project_id.toLowerCase().includes(f.toLowerCase())).length/v),onClick:()=>k(s=>s+1),children:e.jsx(H,{})})]})]})})}),e.jsx(a,{container:!0,spacing:2,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(z,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(C,{startIcon:e.jsx(he,{}),onClick:()=>oe(_)}),e.jsx(j,{variant:"h6",gutterBottom:!0,children:"SUBMITTED DESIGNS"}),e.jsx("input",{type:"text",placeholder:"Search Designs",value:F,onChange:s=>Q(s.target.value),className:"input"}),e.jsx(Ce,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(U,{stickyHeader:!0,children:[e.jsx(V,{children:e.jsxs(b,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Design ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Name"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Type"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Version"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Prepared By"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Reviewed By"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Status"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Date"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Constraints"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Budget"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Resources"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Completion Date"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Status"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Blueprint"})}),e.jsx(t,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(G,{children:ae.map((s,r)=>e.jsxs(b,{children:[e.jsx(t,{children:s.project}),e.jsx(t,{children:s.design_id}),e.jsx(t,{children:s.design_name}),e.jsx(t,{children:s.design_type}),e.jsx(t,{children:s.version_number}),e.jsx(t,{children:s.prepared_by}),e.jsx(t,{children:s.reviewed_by}),e.jsx(t,{children:s.approval_status}),e.jsx(t,{children:$(s.approval_date)}),e.jsx(t,{children:s.compliance_standard}),e.jsx(t,{children:s.design_constraints}),e.jsx(t,{children:s.estimated_budget}),e.jsx(t,{children:s.resource_requirements}),e.jsx(t,{children:$(s.design_completion_date)}),e.jsx(t,{children:s.status}),e.jsx(t,{children:s.blueprint?e.jsx(m,{sx:{display:"flex",gap:1,alignItems:"center"},children:e.jsx(c,{component:"a",href:s.blueprint,target:"_blank",rel:"noopener noreferrer",title:"View",children:e.jsx(De,{})})}):"-"}),e.jsxs(t,{children:[e.jsx(Y,{slug:g,action:"can_update",children:e.jsx(c,{color:"warning",onClick:()=>te(s),children:e.jsx(_e,{sx:{color:"orange"}})})}),e.jsx(O,{slug:g,action:"can_delete",children:e.jsx(c,{color:"error",onClick:()=>re(s.design_id),children:e.jsx(Se,{sx:{color:"red"}})})})]})]},r))})]})}),e.jsxs(m,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(c,{disabled:u===1,onClick:()=>M(s=>s-1),children:e.jsx(W,{})}),e.jsxs(j,{variant:"body2",sx:{mx:2},children:["Page ",u," of ",L||1]}),e.jsx(c,{disabled:u>=L,onClick:()=>M(s=>s+1),children:e.jsx(H,{})})]})]})})}),e.jsxs(fe,{open:K,onClose:R,fullWidth:!0,maxWidth:"xl",PaperProps:{style:I?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(ye,{children:"Enter Design Details"}),e.jsxs(ve,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(c,{"aria-label":"toggle-size",onClick:ie,sx:{position:"absolute",right:40,top:8,color:s=>s.palette.grey[600]},children:I?e.jsx(we,{}):e.jsx(Be,{})}),e.jsx(c,{"aria-label":"close",onClick:R,sx:{position:"absolute",right:8,top:8,color:s=>s.palette.grey[500]},children:e.jsx(ue,{})}),e.jsx(m,{component:"form",sx:{mt:2},children:e.jsxs(a,{container:!0,spacing:3,direction:"column",children:[e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:E,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"designId",children:"Design ID"}),e.jsx("input",{id:"designId",className:"input",value:n.designId||"",disabled:!0})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Design Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"designName",children:["Design Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"designName",name:"designName",className:"input",value:n.designName||"",onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"designType",children:["Design Type ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{id:"designType",name:"designType",className:"input",value:n.designType||"",onChange:l,children:[e.jsx("option",{value:"",children:"Select Type"}),["Architectural","Structural","Electrical","Mechanical","Civil"].map(s=>e.jsx("option",{value:s,children:s},s))]})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Approval Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"preparedBy",children:["Prepared By ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"preparedBy",name:"preparedBy",className:"input",value:n.preparedBy||"",onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"reviewedBy",children:"Reviewed By"}),e.jsx("input",{id:"reviewedBy",name:"reviewedBy",className:"input",value:n.reviewedBy||"",onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:n.approvalStatus||"",onChange:l,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"}),e.jsx("option",{value:"Under Review",children:"Under Review"})]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalDate",children:"Approval Date"}),e.jsx("input",{type:"date",id:"approvalDate",name:"approvalDate",className:"input",value:n.approvalDate||"",onChange:l})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Budget and Requirements"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"complianceStandard",children:["Compliance Standard ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"complianceStandard",name:"complianceStandard",className:"input",value:n.complianceStandard||"",onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"designConstraints",children:["Design Constraints ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("textarea",{id:"designConstraints",name:"designConstraints",className:"input",rows:3,value:n.designConstraints||"",onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"estimatedBudget",children:["Estimated Budget ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"number",id:"estimatedBudget",name:"estimatedBudget",className:"input",value:n.estimatedBudget||"",onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"resourceRequirements",children:["Resource Requirements ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("textarea",{id:"resourceRequirements",name:"resourceRequirements",className:"input",rows:3,value:n.resourceRequirements||"",onChange:l})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Status and Actions"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"designCompletionDate",children:["Design Completion Date ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"date",id:"designCompletionDate",name:"designCompletionDate",className:"input",value:n.designCompletionDate||"",onChange:l})]}),e.jsxs("label",{htmlFor:"status",children:["Status ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{id:"status",name:"status",className:"input",value:n.status||"",onChange:l,required:!0,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Draft",children:"Draft"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Completed",children:"Completed"})]})]})]}),e.jsxs(C,{variant:"contained",component:"label",children:["Upload Blueprints/Documents ",P!=="edit"&&e.jsx("span",{style:{color:"red"},children:"*"}),e.jsx("input",{type:"file",hidden:!0,onChange:s=>p({...n,blueprint:s.target.files[0]})})]})]})})]}),e.jsxs(be,{children:[e.jsx(C,{onClick:R,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(Y,{slug:g,action:P==="edit"?"can_update":"can_create",children:e.jsx(C,{variant:"outlined",onClick:se,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:P==="edit"?"Update Design":"Submit Design"})})]})]})]})};export{Ue as default};
