import{r as o,j as e,T as b,x as F,S as w,D as O}from"./main-BIxdd69i.js";import{C as Z}from"./Close-D340Gps3.js";import{h as ee,m as te,n as re,o as se,p as ae}from"./procurement-Dxzq-DH5.js";import{D as ie}from"./Download-D_b47uoU.js";import"./jspdf.plugin.autotable-y_YJgUzU.js";import{G as i}from"./Grid-BnZNKmae.js";import{P as R,I as p,e as S,D as le,f as oe,g as ce,h as ne}from"./DialogTitle-D59uELMl.js";import{T as E,a as P,b as D,c as s,d as M}from"./TableRow-D8X36zJO.js";import{A as de}from"./AddCircle-Bn9h5MaP.js";import{T as he}from"./TableContainer-1Xqyy-f8.js";import{E as pe}from"./Edit-BJV-h6Li.js";import{D as xe}from"./Delete-BHKbKfZ2.js";import{M as ue,a as me}from"./minimize-2-Dl_U24Qm.js";const Fe=()=>{const x="procurement",[C,k]=o.useState(""),[L,B]=o.useState(""),[d,A]=o.useState([]),[$,z]=o.useState([]),[u,G]=o.useState([]),[f,N]=o.useState(!1),[je,T]=o.useState(null),[H,m]=o.useState(!1),[U,ge]=o.useState([]),[I,q]=o.useState(!1),[a,j]=o.useState({projectId:"",purchaseOrderId:"",logisticId:"",transportId:"",vehicleDetails:"",driverName:"",dispatchDate:"",expectedArrivalDate:"",actualArrivalDate:"",deliveryLocation:"",shippingStatus:"",damageReport:""}),V=()=>{q(!I)};o.useEffect(()=>{(async()=>{try{const r=await ee();G(r),console.log("✅ Material procurements:",r)}catch(r){console.error("❌ Failed to fetch material procurements:",r)}})()},[]);const y=async()=>{try{const t=await te();A(t);const r=t.map(l=>({logisticId:l.logistics_id,transportId:l.transport_provider_id,vehicleDetails:l.vehicle_details,driverName:l.driver_name,dispatchDate:l.dispatch_date,expectedArrivalDate:l.expected_arrival_date,actualArrivalDate:l.actual_arrival_date,deliveryLocation:l.delivery_location,shippingStatus:l.shipping_status,damageReport:l.damage_report}));z(r)}catch(t){console.error("Failed to load logistics:",t)}};o.useEffect(()=>{y()},[]);const W=()=>{const t=new Date().getFullYear(),r=(d==null?void 0:d.reduce((c,h)=>{var g;if((g=h.logistics_id)!=null&&g.startsWith(`LOG-${t}-`)){const v=parseInt(h.logistics_id.split("-")[2],10);return v>c?v:c}return c},0))||0,l=String(r+1).padStart(3,"0");return`LOG-${t}-${l}`},Y=t=>{const r=u==null?void 0:u[t];r&&(T(t),j({projectId:r.project,procurementId:r.procurement_id,purchaseOrderId:r.purchase_order,logisticId:W(),transportId:"",vehicleDetails:"",driverName:"",dispatchDate:"",expectedArrivalDate:"",actualArrivalDate:"",deliveryLocation:"",shippingStatus:"",damageReport:""}),m(!0))},_=()=>{m(!1)},n=t=>{const{name:r,value:l}=t.target;j(c=>{const h={...c,[r]:l};if(r==="quantity"||r==="unitPrice"){const g=parseFloat(h.quantity)||0,v=parseFloat(h.unitPrice)||0,X=(g*v).toFixed(2);h.totalCost=X}return h})},Q=async()=>{try{const t={po_number:a.purchaseOrderId,transport_provider_id:a.transportId,vehicle_details:a.vehicleDetails,driver_name:a.driverName,dispatch_date:a.dispatchDate,expected_arrival_date:a.expectedArrivalDate,actual_arrival_date:a.actualArrivalDate||null,delivery_location:a.deliveryLocation,shipping_status:a.shippingStatus||"In Transit",damage_report:a.damageReport||""};f?(await se(a.logisticId,t),alert("Logistics details updated successfully!")):(await ae({...t,logistics_id:a.logisticId}),alert("Logistics details submitted successfully!")),j({projectId:"",procurementId:"",purchaseOrderId:"",logisticId:"",transportId:"",vehicleDetails:"",driverName:"",dispatchDate:"",expectedArrivalDate:"",actualArrivalDate:"",deliveryLocation:"",shippingStatus:"In Transit",damageReport:""}),N(!1),m(!1),y()}catch(t){console.error("❌ Error submitting logistics:",t),alert(`Error: ${t.message}`)}},J=async(t,r)=>{if(window.confirm(`Are you sure you want to delete logistics ID: ${t}?`))try{await re(t);const c=[...d];c.splice(r,1),A(c),alert("✅ Logistics deleted successfully!"),y()}catch(c){console.error("❌ Error deleting logistics:",c),alert("❌ Failed to delete logistics.")}},K=t=>{const r=d==null?void 0:d[t];r&&(T(t),N(!0),j({purchaseOrderId:r.po_number||"",logisticId:r.logistics_id||"",transportId:r.transport_provider_id||"",vehicleDetails:r.vehicle_details||"",driverName:r.driver_name||"",dispatchDate:r.dispatch_date||"",expectedArrivalDate:r.expected_arrival_date||"",actualArrivalDate:r.actual_arrival_date||"",deliveryLocation:r.delivery_location||"",shippingStatus:r.shipping_status||"In Transit",damageReport:r.damage_report||""}),m(!0))};return U.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(L.toLowerCase()))),e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Logistic Management"}),e.jsx(i,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(R,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:"PURCHASE ORDERS"}),e.jsx(F,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Purchase Orders",value:C,onChange:t=>k(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(E,{children:[e.jsx(P,{children:e.jsxs(D,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Procurement ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Purchase Order ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(M,{children:u.filter(t=>`${t.project_id} ${t.procurement_id} ${t.purchase_order_id}`.toLowerCase().includes(C.toLowerCase())).map((t,r)=>e.jsxs(D,{children:[e.jsx(s,{children:t.project}),e.jsx(s,{children:t.procurement_id}),e.jsx(s,{children:t.purchase_order}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{slug:x,action:"can_create",children:e.jsx(p,{onClick:()=>Y(r),color:"primary",children:e.jsx(de,{sx:{color:"#7267ef"}})})})})]},r))})]})]})})}),e.jsx(i,{container:!0,spacing:2,children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(R,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(S,{startIcon:e.jsx(ie,{})}),e.jsx(b,{variant:"h6",gutterBottom:!0,children:"SUBMITTED LOGISTIC RECORDS"}),e.jsx("input",{type:"text",placeholder:"Search Logistic Management Here..",value:L,onChange:t=>B(t.target.value),className:"input"}),e.jsx(he,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(E,{stickyHeader:!0,children:[e.jsx(P,{children:e.jsxs(D,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Logistic ID "})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Transport Provider Id "})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Vehicle Details"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Driver Name"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Dispatch Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Expected Arrival Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Actual Arrival Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Delivery Location"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Shipping Status"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Damage Report"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(M,{children:$.map((t,r)=>e.jsxs(D,{children:[e.jsx(s,{children:t.logisticId}),e.jsx(s,{children:t.transportId}),e.jsx(s,{children:t.vehicleDetails}),e.jsx(s,{children:t.driverName}),e.jsx(s,{children:t.dispatchDate}),e.jsx(s,{children:t.expectedArrivalDate}),e.jsx(s,{children:t.actualArrivalDate}),e.jsx(s,{children:t.deliveryLocation}),e.jsx(s,{children:t.shippingStatus}),e.jsx(s,{children:t.damageReport}),e.jsxs(s,{children:[e.jsx(O,{slug:x,action:"can_update",children:e.jsx(p,{color:"warning",onClick:()=>K(r),children:e.jsx(pe,{sx:{color:"orange"}})})}),e.jsx(w,{slug:x,action:"can_delete",children:e.jsx(p,{color:"error",onClick:()=>J(t.logisticId,r),children:e.jsx(xe,{sx:{color:"red"}})})})]})]},r))})]})})]})})}),e.jsxs(le,{open:H,onClose:_,fullWidth:!0,maxWidth:"xl",PaperProps:{style:I?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(oe,{children:"Enter Logistic Details"}),e.jsxs(ce,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(p,{"aria-label":"toggle-size",onClick:V,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:I?e.jsx(ue,{}):e.jsx(me,{})}),e.jsx(p,{"aria-label":"close",onClick:_,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(Z,{})}),e.jsx(F,{component:"form",sx:{mt:2},children:e.jsxs(i,{container:!0,spacing:3,direction:"column",children:[e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Purchase Order & Vendor info.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"purchaseOrderId",children:"Purchase Order ID"}),e.jsx("input",{id:"purchaseOrderId",name:"purchaseOrderId",className:"input",value:a.purchaseOrderId||"",disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",name:"projectId",className:"input",value:a.projectId||"",disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"procurementId",children:"Procurement ID"}),e.jsx("input",{id:"procurementId",name:"procurementId",className:"input",value:a.procurementId||"",disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"logisticId",children:"Logistic ID"}),e.jsx("input",{id:"logisticId",name:"logisticId",className:"input",value:a.logisticId||"",disabled:!0})]})]})]}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Transport Information.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"transportId",children:"Transport provider Id"}),e.jsx("input",{id:"transportId",name:"transportId",className:"input",value:a.transportId||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"vehicleDetails",children:"Vehicle Details"}),e.jsx("input",{id:"vehicleDetails",name:"vehicleDetails",className:"input",value:a.vehicleDetails||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"driverName",children:"Driver Name"}),e.jsx("input",{id:"driverName",name:"driverName",className:"input",value:a.driverName||"",onChange:n})]})]})]}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Shipping Status.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"dispatchDate",children:"Dispatch Date"}),e.jsx("input",{type:"date",id:"dispatchDate",name:"dispatchDate",className:"input",value:a.dispatchDate||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"expectedArrivalDate",children:"Expected Arrival Date"}),e.jsx("input",{type:"date",id:"expectedArrivalDate",name:"expectedArrivalDate",className:"input",value:a.expectedArrivalDate||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"actualArrivalDate",children:"Actual Arrival Date"}),e.jsx("input",{type:"date",id:"actualArrivalDate",name:"actualArrivalDate",className:"input",value:a.actualArrivalDate||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"deliveryLocation",children:"Delivery Location"}),e.jsx("input",{id:"deliveryLocation",name:"deliveryLocation",className:"input",value:a.deliveryLocation||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"shippingStatus",children:"Shipping Status"}),e.jsxs("select",{id:"shippingStatus",name:"shippingStatus",className:"input",value:a.shippingStatus||"",onChange:n,children:[e.jsx("option",{value:"",children:"Select Status"})," ",e.jsx("option",{value:"In Transit",children:"In Transit"}),e.jsx("option",{value:"Delivered",children:"Delivered "}),e.jsx("option",{value:"Delayed",children:"Delayed"}),e.jsx("option",{value:"Canceled",children:"Canceled"})]})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"damageReport",children:"Damage Report"}),e.jsx("input",{id:"damageReport",name:"damageReport",className:"input",value:a.damageReport||"",onChange:n})]})]})]})]})})]}),e.jsxs(ne,{children:[e.jsx(S,{onClick:_,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(O,{slug:x,action:f?"can_update":"can_create",children:e.jsx(S,{variant:"outlined",onClick:Q,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:f?"Update Logistic Details":"Submit Logistic Details"})})]})]})]})};export{Fe as default};
