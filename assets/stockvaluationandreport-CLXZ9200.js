import{r as s,j as e,S as M,I as S,T as d,K as A,E as T}from"./main-Skim5IJC.js";import{E as U,a as $}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{D as H}from"./Download-C4sxsXoP.js";import{a as q,l as V,s as J,m as Q}from"./inventory-BCILrqmV.js";import{B as m,D as X,a as Z,b as ee,c as te}from"./DialogTitle-CvDFHAwp.js";import{M as oe,a as se}from"./minimize-2-RCuvNn0X.js";import{G as l}from"./Grid-fY_ATwTx.js";import{T as ne,a as ae,b as R,c,d as re}from"./TableRow-B6k_bSOs.js";import{E as le}from"./Edit-6vcT2Cu4.js";import{D as ce}from"./Delete-Be1vvbhC.js";const ye=()=>{const p="inventory",[E,x]=s.useState(!1),[b,I]=s.useState(null),[F,O]=s.useState([]),[f,K]=s.useState(!1),[r,k]=s.useState({valuationMethod:"",stockId:"",stockValue:"",stockTurnoverRatio:"",lowStockAlerts:!1,excessStockAlerts:!1,monthlyStockReport:""}),[h,j]=s.useState([]),z=s.useRef(null),y=s.useRef(null),v=s.useRef(null),D=s.useRef(null),w=s.useRef(null),C=s.useRef(null),W=()=>{K(!f)};s.useEffect(()=>{(async()=>{try{const o=await q();O(o.map(a=>a.stock_id))}catch(o){console.error("Error fetching stock IDs:",o)}})()},[]),s.useEffect(()=>{(async()=>{try{const o=await V();j(o)}catch(o){console.error("❌ Error fetching valuation reports:",o)}})()},[]);const i=t=>{const{name:o,type:a,value:n,checked:g,files:Y}=t.target;k(G=>{var _;return{...G,[o]:a==="checkbox"?g:a==="file"?((_=Y[0])==null?void 0:_.name)||"":n}})},u=(t,o)=>{t.key==="Enter"&&(t.preventDefault(),o&&o.current&&o.current.focus())},N=async()=>{var t;try{const o={stock:r.stockId,valuation_method:r.valuationMethod},a=await J(o),n=await V();j(n),k({valuationMethod:"",stockId:"",stockValue:"",stockTurnoverRatio:"",lowStockAlerts:!1,excessStockAlerts:!1,monthlyStockReport:""}),x(!1),alert("✅ Valuation report generated successfully!")}catch(o){alert(`⚠️ Failed to submit valuation: ${((t=o.response)==null?void 0:t.data)||o.message}`)}},B=t=>{k(h[t]),I(t),x(!0)},L=async t=>{const o=h[t].id;if(window.confirm("Are you sure you want to delete this report?"))try{await Q(o),j(a=>a.filter((n,g)=>g!==t)),console.log(`✅ Report ${o} deleted`),alert("Report Delete Successfully!!")}catch(a){console.error("❌ Error deleting report:",a),alert("Something Went Wrong!!!")}},P=()=>{const t=new U("l","mm","a4");t.setFontSize(16),t.text("Inventory Valuation Reports",14,15);const o=[["Stock ID","Valuation Method","Stock Value","Turnover Ratio","Low Alert","Excess Alert","Monthly Report"]],a=h.map(n=>[n.stock,n.valuation_method,n.stock_value,n.stock_turnover_ratio,n.low_stock_alert?"Yes":"No",n.excess_stock_alert?"Yes":"No",n.monthly_stock_report||"—"]);$(t,{head:o,body:a,startY:25,styles:{fontSize:7,cellPadding:2,overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),t.save("inventory_valuation_reports.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(M,{slug:p,action:"can_create",children:e.jsx(m,{variant:"contained",onClick:()=>x(!0),sx:{backgroundColor:"#7267ef",mt:4},children:"Add Inventory Valuation"})}),e.jsxs(X,{open:E,fullWidth:!0,maxWidth:"xl",PaperProps:{style:f?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(Z,{children:"Inventory Valuation & Reporting"}),e.jsxs(ee,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(S,{"aria-label":"toggle-size",onClick:W,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:f?e.jsx(oe,{}):e.jsx(se,{})}),e.jsxs(l,{container:!0,spacing:2,direction:"column",children:[e.jsxs(l,{item:!0,children:[e.jsx(d,{variant:"subtitle2",children:"Valuation Method"}),e.jsxs("select",{name:"valuationMethod",className:"input",value:r.valuationMethod,onChange:i,onKeyDown:t=>u(t,y),ref:z,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"FIFO",children:"FIFO"}),e.jsx("option",{value:"LIFO",children:"LIFO"}),e.jsx("option",{value:"Weighted Average",children:"Weighted Average"})]})]}),e.jsxs(l,{item:!0,children:[e.jsx(d,{variant:"subtitle2",children:"Stock ID"}),e.jsx("input",{list:"stockIdOptions",name:"stockId",type:"text",value:r.stockId,onChange:i,className:"input",onKeyDown:t=>u(t,v),ref:y,placeholder:"Search Stock ID"}),e.jsx("datalist",{id:"stockIdOptions",children:F.map((t,o)=>e.jsx("option",{value:t},o))})]}),e.jsxs(l,{item:!0,children:[e.jsx(d,{variant:"subtitle2",children:"Stock Value"}),e.jsx("input",{name:"stockValue",type:"number",value:r.stockValue,onChange:i,className:"input",onKeyDown:t=>u(t,v),ref:y})]}),e.jsxs(l,{item:!0,children:[e.jsx(d,{variant:"subtitle2",children:"Stock Turnover Ratio"}),e.jsx("input",{name:"stockTurnoverRatio",type:"number",value:r.stockTurnoverRatio,onChange:i,className:"input",onKeyDown:t=>u(t,D),ref:v})]}),e.jsx(l,{item:!0,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"lowStockAlerts",checked:r.lowStockAlerts,onChange:i,onKeyDown:t=>u(t,w),ref:D,style:{marginRight:"8px"}}),"Low Stock Alerts"]})}),e.jsx(l,{item:!0,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"excessStockAlerts",checked:r.excessStockAlerts,onChange:i,onKeyDown:t=>u(t,C),ref:w,style:{marginRight:"8px"}}),"Excess Stock Alerts"]})}),e.jsxs(l,{item:!0,children:[e.jsx(d,{variant:"subtitle2",children:"Monthly Stock Report"}),e.jsx("input",{type:"file",name:"monthlyStockReport",onChange:i,onKeyDown:t=>{t.key==="Enter"&&t.preventDefault()},ref:C,style:{marginTop:"5px"}}),r.monthlyStockReport&&e.jsx(d,{variant:"caption",style:{marginTop:"4px",display:"block"},children:r.monthlyStockReport})]})]})]}),e.jsxs(te,{children:[e.jsx(m,{onClick:()=>{x(!1),I(null)},sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(A,{slug:p,action:b!==null?"can_update":"can_create",children:e.jsx(m,{variant:"outlined",onClick:N,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:b!==null?"Update":"Submit"})})]})]}),e.jsxs(T,{mt:4,sx:{backgroundColor:"#fff",p:2,borderRadius:2,boxShadow:1},children:[e.jsxs(T,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Inventory Reports"}),e.jsx(m,{startIcon:e.jsx(H,{}),onClick:P,sx:{backgroundColor:"#7267ef",color:"#fff"},children:"Download"})]}),e.jsxs(ne,{children:[e.jsx(ae,{children:e.jsx(R,{children:["Stock ID","Valuation Method","Stock Value","Turnover Ratio","Monthly Report","Actions"].map((t,o)=>e.jsx(c,{sx:{color:"#7267ef",fontWeight:"bold"},children:t},o))})}),e.jsx(re,{children:h.length>0?h.map((t,o)=>e.jsxs(R,{children:[e.jsx(c,{children:t.stock}),e.jsx(c,{children:t.valuation_method}),e.jsx(c,{children:t.stock_value}),e.jsx(c,{children:t.stock_turnover_ratio}),e.jsx(c,{children:t.monthly_stock_report||"—"}),e.jsxs(c,{children:[e.jsx(A,{slug:p,action:"can_update",children:e.jsx(S,{onClick:()=>B(o),sx:{color:"warning"},children:e.jsx(le,{sx:{color:"orange"}})})}),e.jsx(M,{slug:p,action:"can_delete",children:e.jsx(S,{onClick:()=>L(o),sx:{color:"error"},children:e.jsx(ce,{sx:{color:"red"}})})})]})]},o)):e.jsx(R,{children:e.jsx(c,{colSpan:5,align:"center",children:"No inventory reports added yet."})})})]})]})]})};export{ye as default};
