import{r as l,j as e,T as h,x as f,S as L,D as Y}from"./main-BIxdd69i.js";import{C as ce}from"./Close-D340Gps3.js";import{g as de,f as pe,b as xe,p as me,e as he}from"./engineering-4VzvUWDc.js";import{D as ue}from"./Download-D_b47uoU.js";import{E as je,a as ye}from"./jspdf.plugin.autotable-y_YJgUzU.js";import{G as r}from"./Grid-BnZNKmae.js";import{P as W,I as c,e as w,D as fe,f as ge,g as be,h as Ce}from"./DialogTitle-D59uELMl.js";import{T as $,a as G,b as u,c as s,d as H}from"./TableRow-D8X36zJO.js";import{A as Se}from"./AddCircle-Bn9h5MaP.js";import{A as Q,a as J}from"./ArrowForwardIos-DapvvZ-0.js";import{T as ve}from"./TableContainer-1Xqyy-f8.js";import{E as Te}from"./Edit-BJV-h6Li.js";import{D as _e}from"./Delete-BHKbKfZ2.js";import{M as Ie,a as Fe}from"./minimize-2-Dl_U24Qm.js";const Ye=()=>{const j="engineering",[q,K]=l.useState([]),[P,V]=l.useState(""),[R,X]=l.useState(""),[Z,y]=l.useState(!1),[k,A]=l.useState(""),[g,ee]=l.useState(!1),[b,te]=l.useState([]),[C,B]=l.useState("create"),S=4,[d,v]=l.useState(1),T=l.useRef(null),[p,E]=l.useState(1),_=5,[i,x]=l.useState({feasibilityStudyId:null,studyTitle:"",preparedBy:"",studyType:"",reports:null,riskAssessment:"",regulatoryCompliance:"",projectedROI:"",estimatedCompletionTime:"",recommendations:"",approvalStatus:"Pending",approvalDate:"",status:"Draft"}),O=q.filter(t=>t.project_id.toLowerCase().includes(P.toLowerCase())),N=Math.ceil(O.length/S),M=O.slice((d-1)*S,d*S);l.useEffect(()=>{(async()=>{try{const a=await de();K(a)}catch(a){console.error("Error fetching projects:",a)}})()},[]);const I=async()=>{try{const t=await pe();te(t)}catch(t){console.error("Fetch failed:",t)}};l.useEffect(()=>{I()},[]);const se=t=>{B("edit"),A(t.project),x({feasibilityStudyId:t.feasibility_study_id,studyTitle:t.study_title,preparedBy:t.prepared_by,studyType:t.study_type,reports:null,riskAssessment:t.risk_assessment,regulatoryCompliance:t.regulatory_compliance,projectedROI:t.projected_roi,estimatedCompletionTime:t.estimated_completion_time,recommendations:t.recommendations,approvalStatus:t.approval_status,approvalDate:t.approval_date,status:t.status}),y(!0)},re=async()=>{const t=new FormData;t.append("project",k),t.append("study_title",i.studyTitle),t.append("prepared_by",i.preparedBy),t.append("study_type",i.studyType),i.reports&&t.append("reports",i.reports),t.append("risk_assessment",i.riskAssessment),t.append("regulatory_compliance",i.regulatoryCompliance),t.append("projected_roi",i.projectedROI),t.append("estimated_completion_time",i.estimatedCompletionTime),t.append("recommendations",i.recommendations),t.append("approval_status",i.approvalStatus),t.append("approval_date",i.approvalDate),t.append("status",i.status);try{C==="edit"?(await me(i.feasibilityStudyId,t),alert("Feasibility study updated successfully!")):(await he(t),alert("Feasibility study submitted successfully!")),await I(),y(!1),B("create"),x({studyTitle:"",preparedBy:"",studyType:"",reports:null,riskAssessment:"",regulatoryCompliance:"",projectedROI:"",estimatedCompletionTime:"",recommendations:"",approvalStatus:"Pending",approvalDate:"",status:"Draft"}),T.current&&(T.current.value=null)}catch(a){console.error("Submission failed:",a),alert("Failed to submit/update feasibility study.")}},ie=t=>{A(t);const a=new Date().getFullYear(),m=String(b.length+1).padStart(4,"0");x({feasibilityStudyId:`FS-${a}-${m}`}),y(!0)},ae=async t=>{if(window.confirm(`Are you sure you want to delete ${t}?`))try{await xe(t),alert(`✅ Feasibility study ${t} deleted successfully!`),await I()}catch{alert("❌ Failed to delete. See console for details.")}},F=()=>y(!1),n=t=>{const{name:a,value:m}=t.target;x(D=>({...D,[a]:m}))},le=t=>{const a=new je("l","mm","a4");a.setFontSize(16),a.text("All Feasibility Report",14,15);const m=["Project ID","Feasibility Study ID","Study Title","Study Type","Prepared By","Risk Assessment","Regulatory Compliance","Projected ROI (%)","Est. Completion Time","Recommendations","Approval Status","Approval Date","Status","Actions"],D=t.map(o=>[o.project,o.feasibility_study_id,o.study_title,o.study_type,o.prepared_by,o.risk_assessment,o.regulatory_compliance,o.projected_roi,o.estimated_completion_time,o.recommendations,o.approval_status,o.approval_date,o.status]);ye(a,{head:[m],body:D,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),a.save("feasibility report.pdf")},z=b.filter(t=>Object.values(t).some(a=>a&&a.toString().toLowerCase().includes(R.toLowerCase()))),U=Math.ceil(z.length/_),oe=z.slice((p-1)*_,p*_),ne=()=>{ee(!g)};return e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Feasibility Study Management"}),e.jsx(r,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(r,{item:!0,xs:12,children:e.jsxs(W,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(f,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:P,onChange:t=>{V(t.target.value),v(1)},className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs($,{children:[e.jsx(G,{children:e.jsxs(u,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(H,{children:M.length>0?M.map((t,a)=>e.jsxs(u,{children:[e.jsx(s,{children:t.project_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(L,{slug:j,action:"can_create",children:e.jsx(c,{onClick:()=>ie(t.project_id),color:"primary",children:e.jsx(Se,{sx:{color:"#7267ef"}})})})})]},a)):e.jsx(u,{children:e.jsx(s,{colSpan:2,align:"center",children:"No records found"})})})]}),e.jsxs(f,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(c,{disabled:d===1,onClick:()=>v(t=>t-1),children:e.jsx(Q,{})}),e.jsxs(h,{variant:"body2",sx:{mx:2},children:["Page ",d," of ",N||1]}),e.jsx(c,{disabled:d>=N,onClick:()=>v(t=>t+1),children:e.jsx(J,{})})]})]})})}),e.jsx(r,{container:!0,spacing:2,children:e.jsx(r,{item:!0,xs:12,children:e.jsxs(W,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(w,{startIcon:e.jsx(ue,{}),onClick:()=>le(b)}),e.jsx(h,{variant:"h6",gutterBottom:!0,children:"SUBMITTED FEASIBILITY STUDIES"}),e.jsx("input",{type:"text",placeholder:"Search Feasibility Studies",value:R,onChange:t=>X(t.target.value),className:"input"}),e.jsx(ve,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs($,{stickyHeader:!0,children:[e.jsx(G,{children:e.jsxs(u,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Feasibility Study ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Study Title"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Study Type"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Prepared By"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Risk Assessment"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Regulatory Compliance"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Projected ROI (%)"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Est. Completion Time"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Recommendations"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Status"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Status"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(H,{children:oe.map((t,a)=>e.jsxs(u,{children:[e.jsx(s,{children:t.project}),e.jsx(s,{children:t.feasibility_study_id}),e.jsx(s,{children:t.study_title}),e.jsx(s,{children:t.study_type}),e.jsx(s,{children:t.prepared_by}),e.jsx(s,{children:t.risk_assessment}),e.jsx(s,{children:t.regulatory_compliance}),e.jsx(s,{children:t.projected_roi}),e.jsx(s,{children:t.estimated_completion_time}),e.jsx(s,{children:t.recommendations}),e.jsx(s,{children:t.approval_status}),e.jsx(s,{children:t.approval_date}),e.jsx(s,{children:t.status}),e.jsxs(s,{children:[e.jsx(Y,{slug:j,action:"can_edit",children:e.jsx(c,{color:"warning",onClick:()=>se(t),children:e.jsx(Te,{sx:{color:"orange"}})})}),e.jsx(L,{slug:j,action:"can_delete",children:e.jsx(c,{color:"error",onClick:()=>ae(t.feasibility_study_id),children:e.jsx(_e,{sx:{color:"red"}})})})]})]},a))})]})}),e.jsxs(f,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(c,{disabled:p===1,onClick:()=>E(t=>t-1),children:e.jsx(Q,{})}),e.jsxs(h,{variant:"body2",sx:{mx:2},children:["Page ",p," of ",U||1]}),e.jsx(c,{disabled:p>=U,onClick:()=>E(t=>t+1),children:e.jsx(J,{})})]})]})})}),e.jsxs(fe,{open:Z,onClose:F,fullWidth:!0,maxWidth:"xl",PaperProps:{style:g?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(ge,{children:"Enter Feasibility Study Details"}),e.jsxs(be,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(c,{"aria-label":"toggle-size",onClick:ne,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:g?e.jsx(Ie,{}):e.jsx(Fe,{})}),e.jsx(c,{"aria-label":"close",onClick:F,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(ce,{})}),e.jsx(f,{component:"form",sx:{mt:2},children:e.jsxs(r,{container:!0,spacing:3,direction:"column",children:[e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Feasibility Study Information & Documents"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",name:"projectId",className:"input",value:k,disabled:!0})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"feasibilityStudyId",children:"Feasibility Study ID"}),e.jsx("input",{id:"feasibilityStudyId",name:"feasibilityStudyId",className:"input",value:i.feasibilityStudyId||"",disabled:!0})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"studyTitle",children:"Study Title"}),e.jsx("input",{id:"studyTitle",name:"studyTitle",className:"input",value:i.studyTitle||"",onChange:n})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"preparedBy",children:"Prepared By"}),e.jsx("input",{id:"preparedBy",name:"preparedBy",className:"input",value:i.preparedBy||"",onChange:n})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"studyType",children:"Study Type"}),e.jsxs("select",{id:"studyType",name:"studyType",className:"input",value:i.studyType||"",onChange:n,children:[e.jsx("option",{value:"",children:"Select Type"}),["Technical","Financial","Environmental","Operational"].map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{children:"Upload"}),e.jsx("input",{type:"file",className:"input",ref:T,onChange:t=>{x(a=>({...a,reports:t.target.files[0]}))}})]})]})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Risk and Compliance"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"riskAssessment",children:"Risk Assessment"}),e.jsx("textarea",{id:"riskAssessment",name:"riskAssessment",className:"input",rows:3,value:i.riskAssessment||"",onChange:n})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"regulatoryCompliance",children:"Regulatory Compliance"}),e.jsx("input",{id:"regulatoryCompliance",name:"regulatoryCompliance",className:"input",value:i.regulatoryCompliance||"",onChange:n})]})]})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Financial Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectedROI",children:"Projected ROI (%)"}),e.jsx("input",{type:"number",id:"projectedROI",name:"projectedROI",className:"input",value:i.projectedROI||"",onChange:n})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"estimatedCompletionTime",children:"Estimated Completion Time (Months/Years)"}),e.jsx("input",{type:"number",id:"estimatedCompletionTime",name:"estimatedCompletionTime",className:"input",value:i.estimatedCompletionTime||"",onChange:n})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"recommendations",children:"Recommendations"}),e.jsx("textarea",{id:"recommendations",name:"recommendations",className:"input",rows:3,value:i.recommendations||"",onChange:n})]})]})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Approval Information & Study Status"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:i.approvalStatus||"",onChange:n,children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalDate",children:"Approval Date"}),e.jsx("input",{type:"date",id:"approvalDate",name:"approvalDate",className:"input",value:i.approvalDate||"",onChange:n})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",className:"input",value:i.status||"",onChange:n,children:[e.jsx("option",{value:"Draft",children:"Draft"}),e.jsx("option",{value:"Under Review",children:"Under Review"}),e.jsx("option",{value:"Completed",children:"Completed"})]})]})]})]})]})})]}),e.jsxs(Ce,{children:[e.jsx(w,{onClick:F,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(Y,{slug:j,action:C==="edit"?"can_update":"can_create",children:e.jsx(w,{variant:"outlined",onClick:re,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:C==="edit"?"Update":"Submit"})})]})]})]})};export{Ye as default};
