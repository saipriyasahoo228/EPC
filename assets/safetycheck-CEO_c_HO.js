import{r as a,j as e,T as f,z as v}from"./main-IxGEKZMA.js";import{C as Q}from"./Close-DoqWsXz3.js";import{g as Y,k as y,l as z,m as U,n as W}from"./maintenance-CWRDLbWQ.js";import{G as r}from"./Grid-C72N-tAO.js";import{t as w,T as E,h as k,i as p,j as n,k as A,I as h,D as q,f as J,g as K,e as T}from"./TableRow-CRAT5KT_.js";import{A as V}from"./AddCircle-DWIRGPUh.js";import{T as X}from"./TableContainer-BaU58JEj.js";import{E as Z}from"./Edit-g2hjeeYC.js";import{D as ee}from"./Delete-cHl_EB0l.js";import{D as se}from"./DialogActions-D5wP0Mt-.js";import"./Transition-C29ZPDdz.js";const me=()=>{const[C,F]=a.useState(""),[g,N]=a.useState(""),[P,u]=a.useState(!1),[te,B]=a.useState(""),[i,l]=a.useState({}),[D,m]=a.useState([]),[I,d]=a.useState(!1),[S,b]=a.useState(null),[ne,_]=a.useState(null),[R,$]=a.useState([]);a.useEffect(()=>{(async()=>{try{const t=await Y();$(t)}catch(t){console.error("❌ Failed to fetch assets:",t)}})()},[]),a.useEffect(()=>{(async()=>{try{const t=await y();m(t)}catch(t){console.error(t)}})()},[]);const L=s=>{B(s);const t=new Date().getFullYear(),j=(D.length+1).toString().padStart(4,"0");l({complianceID:`CMS-${t}-${j}`,assetId:s}),d(!1),_(null),u(!0)},O=s=>{l({complianceID:s.compliance_id,assetId:s.asset,inspectionDate:s.inspection_date,inspectionType:s.inspection_type,inspectorID:s.inspector_id,regulatoryStandards:s.regulatory_standards,nonComplianceIssues:s.non_compliance_issues||"",correctiveActionPlan:s.corrective_action_plan||"",certificationExpiryDate:s.certification_expiry_date||""}),b(s.compliance_id),d(!0),u(!0)},H=async s=>{if(window.confirm(`⚠️ Are you sure you want to delete Compliance ID: ${s}?`))try{await z(s),alert(`✅ Compliance ${s} deleted successfully`);const c=await y();m(c)}catch(c){alert("❌ Failed to delete compliance"),console.error("Delete error:",c)}},x=()=>{u(!1),l({}),d(!1),_(null)},o=s=>{const{name:t,value:c}=s.target;l(j=>({...j,[t]:c}))},M=async()=>{try{const s={asset:i.assetId,inspection_date:i.inspectionDate,inspection_type:i.inspectionType,inspector_id:i.inspectorID,regulatory_standards:i.regulatoryStandards,non_compliance_issues:i.nonComplianceIssues||null,corrective_action_plan:i.correctiveActionPlan||null,certification_expiry_date:i.certificationExpiryDate||null};let t;S?(t=await U(S,s),alert(`✅ Safety Check updated: ${t.compliance_id}`)):(t=await W(s),alert(`✅ Safety Check created: ${t.compliance_id}`));const c=await y();m(c),l({}),b(null),d(!1),x()}catch(s){console.error("❌ handleSubmit error:",s),alert("❌ Failed to submit safety check")}},G=D.filter(s=>Object.values(s).some(t=>t&&t.toString().toLowerCase().includes(g.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Compliance & Safety Checks"}),e.jsx(r,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(r,{item:!0,xs:12,children:e.jsxs(w,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(f,{variant:"h6",gutterBottom:!0,children:"ASSETS RECORDS"}),e.jsx(v,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Asset ID",value:C,onChange:s=>F(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(E,{children:[e.jsx(k,{children:e.jsxs(p,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(A,{children:R.filter(s=>s.asset_id.toLowerCase().includes(C.toLowerCase())).map((s,t)=>e.jsxs(p,{children:[e.jsx(n,{children:s.asset_id}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(h,{onClick:()=>L(s.asset_id),color:"primary",children:e.jsx(V,{sx:{color:"#7267ef"}})})})]},t))})]})]})})}),e.jsx(r,{container:!0,spacing:2,children:e.jsx(r,{item:!0,xs:12,children:e.jsxs(w,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(f,{variant:"h6",gutterBottom:!0,children:"Compliance & Safety Checks Details"}),e.jsx("input",{type:"text",placeholder:"Search Safety Check Details",value:g,onChange:s=>N(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(X,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(E,{stickyHeader:!0,children:[e.jsx(k,{children:e.jsxs(p,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Date"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Type"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspector ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Regulatory Standards"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Non-Compliance Issues"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Corrective Action Plan"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Certification ExpiryDate"})}),e.jsx(n,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(A,{children:G.map((s,t)=>e.jsxs(p,{children:[e.jsx(n,{children:s.asset}),e.jsx(n,{children:s.compliance_id}),e.jsx(n,{children:s.inspection_date}),e.jsx(n,{children:s.inspection_type}),e.jsx(n,{children:s.inspector_id}),e.jsx(n,{children:s.regulatory_standards}),e.jsx(n,{children:s.non_compliance_issues}),e.jsx(n,{children:s.corrective_action_plan}),e.jsx(n,{children:s.certification_expiry_date}),e.jsxs(n,{children:[e.jsx(h,{onClick:()=>O(s),color:"warning",children:e.jsx(Z,{sx:{color:"orange"}})}),e.jsx(h,{onClick:()=>H(s.compliance_id),color:"error",children:e.jsx(ee,{sx:{color:"red"}})})]})]},t))})]})})]})})}),e.jsxs(q,{open:P,onClose:x,fullWidth:!0,children:[e.jsx(J,{children:I?"Edit Safety Check Details":"Enter Safety Check Details"}),e.jsxs(K,{sx:{position:"relative"},children:[e.jsx(h,{"aria-label":"close",onClick:x,sx:{position:"absolute",right:8,top:8,color:s=>s.palette.grey[500]},children:e.jsx(Q,{})}),e.jsx(v,{component:"form",sx:{mt:2},children:e.jsx(r,{container:!0,spacing:3,direction:"column",children:e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Compliance Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"complianceID",children:"Compliance ID"}),e.jsx("input",{id:"complianceID",name:"complianceID",className:"input",value:i.complianceID||"",onChange:o,disabled:!0})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"assetId",children:"Asset ID"}),e.jsx("input",{id:"assetId",name:"assetId",className:"input",value:i.assetId||"",onChange:o,disabled:!0})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionDate",children:"Inspection Date"}),e.jsx("input",{type:"date",id:"inspectionDate",name:"inspectionDate",className:"input",value:i.inspectionDate||"",onChange:o})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionType",children:"Inspection Type"}),e.jsx("input",{id:"inspectionType",name:"inspectionType",className:"input",value:i.inspectionType||"",onChange:o})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectorID",children:"Inspector ID"}),e.jsx("input",{id:"inspectorID",name:"inspectorID",className:"input",value:i.inspectorID||"",onChange:o})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"regulatoryStandards",children:"Regulatory Standards"}),e.jsx("input",{id:"regulatoryStandards",name:"regulatoryStandards",className:"input",value:i.regulatoryStandards||"",onChange:o})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"nonComplianceIssues",children:"Non-Compliance Issues"}),e.jsx("textarea",{id:"nonComplianceIssues",name:"nonComplianceIssues",className:"input",rows:"3",value:i.nonComplianceIssues||"",onChange:o})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"correctiveActionPlan",children:"Corrective Action Plan"}),e.jsx("textarea",{id:"correctiveActionPlan",name:"correctiveActionPlan",className:"input",rows:"3",value:i.correctiveActionPlan||"",onChange:o})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"certificationExpiryDate",children:"Certification Expiry Date"}),e.jsx("input",{type:"date",id:"certificationExpiryDate",name:"certificationExpiryDate",className:"input",value:i.certificationExpiryDate||"",onChange:o})]})]})]})})})]}),e.jsxs(se,{children:[e.jsx(T,{onClick:x,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(T,{variant:"outlined",onClick:M,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:I?"Update":"Submit"})]})]})]})};export{me as default};
