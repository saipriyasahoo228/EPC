import{r as o,j as e,T as b,J as T,E as M,S as N,I as d,K as L}from"./main-Skim5IJC.js";import{C as te}from"./Close-BKZ7QrSY.js";import{g as se}from"./engineering-BJ3wTiKO.js";import{f as re,g as oe,a as ne,b as ae,e as ie,h as le}from"./construction-CMO2W9OH.js";import{f as k}from"./date-DdrLtg20.js";import{G as a}from"./Grid-fY_ATwTx.js";import{T as B,a as F,b as S,c as r,d as A}from"./TableRow-B6k_bSOs.js";import{A as ce}from"./AddCircle-CJp4DZj3.js";import{B as D,D as de,a as xe,b as he,c as je}from"./DialogTitle-CvDFHAwp.js";import{T as ue}from"./TableContainer-gCCy6yK7.js";import{L as pe}from"./LinearProgress-Doxu96ic.js";import{E as me}from"./Edit-6vcT2Cu4.js";import{D as fe}from"./Delete-Be1vvbhC.js";import{M as ge,a as Ce}from"./minimize-2-RCuvNn0X.js";import"./index-Pp9EW3wT.js";const Ae=()=>{const x="construction",[be,O]=o.useState([]),[c,z]=o.useState([]),[y,R]=o.useState([]),[h,w]=o.useState(""),[Me,E]=o.useState(""),[Y,v]=o.useState(!1),[I,U]=o.useState(!1),[j,_]=o.useState(!1),[u,P]=o.useState(null),[p,W]=o.useState(""),[m,G]=o.useState(""),[i,f]=o.useState({project:"",name:"",description:"",start_date:"",end_date:"",status:"not started"}),H=()=>U(t=>!t),g=()=>{v(!1),_(!1),P(null),f({project:"",name:"",description:"",start_date:"",end_date:"",status:"not started"})};o.useEffect(()=>{(async()=>{try{const s=await se();O(s||[]);const n=await re();z(n||[])}catch(s){console.error("❌ Error fetching projects:",s)}})()},[]);const C=async t=>{try{const s=t?await oe(t):await ne();R(s||[])}catch(s){console.error("❌ Failed to load milestones:",s)}};o.useEffect(()=>{C("")},[]);const J=o.useMemo(()=>{if(!p)return c;const t=p.toLowerCase();return(c||[]).filter(s=>[s.project,s.project_name,s.project_status].filter(Boolean).some(n=>n.toString().toLowerCase().includes(t)))},[c,p]),$=o.useMemo(()=>{if(!m)return y;const t=m.toLowerCase();return(y||[]).filter(s=>[s.name,s.description,s.status,s.project].filter(Boolean).some(n=>n.toString().toLowerCase().includes(t)))},[y,m]),q=t=>t?t.toString().toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "):"",K=t=>{const s=(c||[]).find(n=>String(n.id)===String(t));return(s==null?void 0:s.project)||t},V=(t,s)=>{E(t),w(s||""),f({project:t,name:"",description:"",start_date:"",end_date:"",status:"not started"}),_(!1),P(null),v(!0)},Q=t=>{_(!0),P(t),E(t.project),f({project:t.project,name:t.name||"",description:t.description||"",start_date:(t.start_date||"").slice(0,10),end_date:(t.end_date||"").slice(0,10),status:t.status||"not started"}),v(!0)},X=async t=>{if(window.confirm(`Are you sure you want to delete milestone ID: ${t}?`))try{await ae(t),alert("✅ Milestone deleted successfully!"),C(h)}catch(n){console.error("❌ Error deleting milestone:",n),alert("❌ Failed to delete milestone.")}},l=t=>{const{name:s,value:n}=t.target;f(ee=>({...ee,[s]:n}))},Z=async()=>{var t;try{const s={project:i.project,name:i.name,description:i.description,start_date:i.start_date,end_date:i.end_date,status:i.status};j&&(u!=null&&u.id)?(await ie(u.id,s),alert("Milestone updated successfully!")):(await le(s),alert("Milestone created successfully!")),g(),C(h)}catch(s){if(console.error("❌ Error submitting milestone:",s),(t=s.response)!=null&&t.data){const n=s.response.data.message||s.response.data.error||Object.values(s.response.data)[0];alert(`Error: ${n}`)}else alert("Error in submitting milestone details!")}};return e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Milestones"}),e.jsx(a,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:"PROJECTS"}),e.jsx(M,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Projects",value:p,onChange:t=>W(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(B,{children:[e.jsx(F,{children:e.jsxs(S,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(A,{children:(J||[]).map((t,s)=>e.jsxs(S,{children:[e.jsx(r,{children:t.project}),e.jsxs(r,{sx:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(N,{slug:x,action:"can_create",children:e.jsx(d,{onClick:()=>V(t.id,t.project),color:"primary",children:e.jsx(ce,{sx:{color:"#7267ef"}})})}),e.jsx(D,{variant:"text",onClick:()=>{w(t.project),C(t.project)},children:"View Milestones"})]})]},s))})]})]})})}),e.jsx(a,{container:!0,spacing:2,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:h?`MILESTONES FOR PROJECT ${h}`:"ALL MILESTONES"}),e.jsx("input",{type:"text",placeholder:"Search Milestones",value:m,onChange:t=>G(t.target.value),className:"input"}),e.jsx(ue,{sx:{maxHeight:450,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(B,{stickyHeader:!0,children:[e.jsx(F,{children:e.jsxs(S,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Name"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Description"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Start Date"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"End Date"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Status"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Progress"})}),e.jsx(r,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(A,{children:($||[]).map(t=>e.jsxs(S,{children:[e.jsx(r,{children:t.id}),e.jsx(r,{children:K(t.project)}),e.jsx(r,{children:t.name}),e.jsx(r,{children:t.description}),e.jsx(r,{children:k(t.start_date)}),e.jsx(r,{children:k(t.end_date)}),e.jsx(r,{children:q(t.status)}),e.jsx(r,{sx:{minWidth:120},children:e.jsxs(M,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(M,{sx:{width:"100%"},children:e.jsx(pe,{variant:"determinate",value:Number(t.progress||0)})}),e.jsxs(b,{variant:"body2",sx:{minWidth:36},children:[Number(t.progress||0),"%"]})]})}),e.jsxs(r,{children:[e.jsx(L,{slug:x,action:"can_update",children:e.jsx(d,{color:"warning",onClick:()=>Q(t),children:e.jsx(me,{sx:{color:"orange"}})})}),e.jsx(N,{slug:x,action:"can_delete",children:e.jsx(d,{color:"error",onClick:()=>X(t.id),children:e.jsx(fe,{sx:{color:"red"}})})})]})]},t.id))})]})})]})})}),e.jsxs(de,{open:Y,onClose:g,fullWidth:!0,maxWidth:"lg",PaperProps:{style:I?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"90vh"}},children:[e.jsx(xe,{children:j?"Edit Milestone":"Create Milestone"}),e.jsxs(he,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(d,{"aria-label":"toggle-size",onClick:H,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:I?e.jsx(ge,{}):e.jsx(Ce,{})}),e.jsx(d,{"aria-label":"close",onClick:g,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(te,{})}),e.jsx(M,{component:"form",sx:{mt:2},children:e.jsx(a,{container:!0,spacing:3,direction:"column",children:e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Milestone Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"project",children:"Project"}),e.jsxs("select",{id:"project",name:"project",className:"input",value:i.project,onChange:l,children:[e.jsx("option",{value:"",children:"Select Project"}),(c||[]).map(t=>e.jsx("option",{value:t.id,children:t.project},t.id))]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"name",children:"Name"}),e.jsx("input",{id:"name",name:"name",className:"input",value:i.name,onChange:l})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",className:"input",rows:3,value:i.description,onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"start_date",children:"Start Date"}),e.jsx("input",{type:"date",id:"start_date",name:"start_date",className:"input",value:i.start_date,onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"end_date",children:"End Date"}),e.jsx("input",{type:"date",id:"end_date",name:"end_date",className:"input",value:i.end_date,onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",className:"input",value:i.status,onChange:l,children:[e.jsx("option",{value:"not started",children:"Not Started"}),e.jsx("option",{value:"in progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"delayed",children:"Delayed"})]})]})]})]})})})]}),e.jsxs(je,{children:[e.jsx(D,{onClick:g,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(L,{slug:x,action:j?"can_update":"can_create",children:e.jsx(D,{variant:"outlined",onClick:Z,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:j?"Update Milestone":"Submit Milestone"})})]})]})]})};export{Ae as default};
