import{r as i,j as e,T as _,J as N,E as S,S as P,I as u,K as k}from"./main-Skim5IJC.js";import{C as Z}from"./Close-BKZ7QrSY.js";import{g as q}from"./engineering-BJ3wTiKO.js";import{o as ee,p as te,q as se,r as ne}from"./construction-CMO2W9OH.js";import{f as m}from"./date-DdrLtg20.js";import{E as oe,a as re}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{D as ie}from"./Download-C4sxsXoP.js";import{G as n}from"./Grid-fY_ATwTx.js";import{T as M,a as B,b as j,c as s,d as L}from"./TableRow-B6k_bSOs.js";import{A as ce}from"./AddCircle-CJp4DZj3.js";import{B as b,D as le,a as ae,b as de,c as pe}from"./DialogTitle-CvDFHAwp.js";import{T as xe}from"./TableContainer-gCCy6yK7.js";import{E as ue}from"./Edit-6vcT2Cu4.js";import{D as he}from"./Delete-Be1vvbhC.js";import{M as je,a as me}from"./minimize-2-RCuvNn0X.js";const fe=p=>{const d=new oe("l","mm","a4");d.setFontSize(16),d.text("Quality Control Report",14,15),re(d,{head:[["Project ID","QC ID","Inspection Date","Inspection Type","Inspector ID","Test Results","Compliance Standard","Defects Identified","Corrective Actions","Approval Status","Next Inspection Date"]],body:(p||[]).map(c=>[c.project,c.qc_id,m(c.inspection_date),c.inspection_type,c.inspector_id,c.test_results,c.compliance_standard,c.defects_identified,c.corrective_actions,c.approval_status,c.next_inspection_date?m(c.next_inspection_date):"—"]),startY:25,styles:{fontSize:7,cellPadding:2,overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),d.save("quality_control_report.pdf")},Ne=()=>{const p="construction",[d,c]=i.useState(""),[f,Y]=i.useState(""),[z,y]=i.useState(!1),[w,T]=i.useState(""),[g,O]=i.useState([]),[A,Q]=i.useState(!1),[ye,R]=i.useState(null),[U,$]=i.useState([]),[E,G]=i.useState([]),[I,F]=i.useState(null),[C,H]=i.useState(!1),[r,x]=i.useState({qcId:"",projectId:"",inspectionDate:"",inspectionType:"",inspectorID:"",testResult:"",complianceStandards:"",defectIdentified:"",correctiveAction:"",approvalStatus:"",nextInspectionDate:""}),W=()=>{H(!C)};i.useEffect(()=>{(async()=>{try{const o=await q();$(o)}catch(o){console.error("Error fetching accepted projects:",o)}})()},[]);const D=async()=>{try{const t=await ee();O(t),console.log("✅ Quality Control records:",t)}catch(t){console.error("❌ Failed to fetch quality control records:",t)}};i.useEffect(()=>{D()},[]);const J=t=>{T(t);const o=new Date().getFullYear(),v=(g.length+1).toString().padStart(4,"0");x({qualitycontrolID:`QC-${o}-${v}`,projectId:t}),Q(!1),R(null),y(!0)},K=t=>{x({qualitycontrolID:t.qc_id,projectId:t.project,inspectionDate:t.inspection_date,inspectionType:t.inspection_type,inspectorID:t.inspector_id,testResult:t.test_results,complianceStandards:t.compliance_standard,defectIdentified:t.defects_identified,correctiveAction:t.corrective_actions,approvalStatus:t.approval_status,nextInspectionDate:t.next_inspection_date}),T(t.project),F(t.qc_id),y(!0)},V=async t=>{if(window.confirm("Are you sure you want to delete this record?"))try{await te(t),alert("✅ Record deleted successfully"),await D()}catch(l){console.error("❌ Failed to delete record:",l),alert("❌ Failed to delete record")}},h=()=>{y(!1),x({}),Q(!1),R(null)},a=t=>{const{name:o,value:l}=t.target;x(v=>({...v,[o]:l}))},X=async()=>{var t;try{const o={project:w,inspection_date:r.inspectionDate,inspection_type:r.inspectionType,inspector_id:r.inspectorID,test_results:r.testResult,compliance_standard:r.complianceStandards,defects_identified:r.defectIdentified||"",corrective_actions:r.correctiveAction||"",approval_status:r.approvalStatus||"pending",next_inspection_date:r.nextInspectionDate||null};let l;I?(l=await se(I,o),alert(`✏️ Quality Control updated!
QC ID: ${l.qc_id}`)):(l=await ne(o),alert(`✅ Quality Control saved!
QC ID: ${l.qc_id}`)),x({}),F(null),h(),D()}catch(o){console.error("❌ Failed to submit Quality Control:",o),alert(`❌ Failed to submit. ${((t=o.response)==null?void 0:t.data)||o.message}`)}};return i.useEffect(()=>{const t=g.filter(o=>Object.values(o).some(l=>l&&l.toString().toLowerCase().includes(f.toLowerCase())));G(t)},[f,g]),e.jsxs(e.Fragment,{children:[e.jsx(_,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Quality Control & Assurance"}),e.jsx(n,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(N,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(_,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(S,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:d,onChange:t=>c(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(M,{children:[e.jsx(B,{children:e.jsxs(j,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(L,{children:U.filter(t=>t.id.toString().toLowerCase().includes(d.toLowerCase())).map((t,o)=>e.jsxs(j,{children:[e.jsx(s,{children:t.project_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(P,{slug:p,action:"can_create",children:e.jsx(u,{onClick:()=>J(t.project_id),color:"primary",children:e.jsx(ce,{sx:{color:"#7267ef"}})})})})]},o))})]})]})})}),e.jsx(n,{container:!0,spacing:2,children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(N,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsxs(S,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(_,{variant:"h6",gutterBottom:!0,children:"QUALITY CONTROL & ASSUARANCE DETAILS"}),e.jsx(b,{startIcon:e.jsx(ie,{}),onClick:()=>fe(E),sx:{backgroundColor:"#7267ef",color:"#fff"},children:"Download"})]}),e.jsx("input",{type:"text",placeholder:"Search Quality Control",value:f,onChange:t=>Y(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(xe,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(M,{stickyHeader:!0,children:[e.jsx(B,{children:e.jsxs(j,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Quality Control ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Type"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspector ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Test Results"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance Standards"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Defects Identified"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Corrective Actions"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Status"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Next Inspection Date"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(L,{children:E.map((t,o)=>e.jsxs(j,{children:[e.jsx(s,{children:t.project}),e.jsx(s,{children:t.qc_id}),e.jsx(s,{children:m(t.inspection_date)}),e.jsx(s,{children:t.inspection_type}),e.jsx(s,{children:t.inspector_id}),e.jsx(s,{children:t.test_results}),e.jsx(s,{children:t.compliance_standard}),e.jsx(s,{children:t.defects_identified}),e.jsx(s,{children:t.corrective_actions}),e.jsx(s,{children:t.approval_status}),e.jsx(s,{children:m(t.next_inspection_date)}),e.jsxs(s,{children:[e.jsx(k,{slug:p,action:"can_update",children:e.jsx(u,{onClick:()=>K(t),color:"warning",children:e.jsx(ue,{sx:{color:"orange"}})})}),e.jsx(P,{slug:p,action:"can_delete",children:e.jsx(u,{onClick:()=>V(t.qc_id),color:"error",children:e.jsx(he,{sx:{color:"red"}})})})]})]},o))})]})})]})})}),e.jsxs(le,{open:z,onClose:h,fullWidth:!0,maxWidth:"xl",PaperProps:{style:C?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(ae,{children:A?"Edit Quality Control & Assurance Details":"Enter Quality Control & Assurance Details"}),e.jsxs(de,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(u,{"aria-label":"toggle-size",onClick:W,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:C?e.jsx(je,{}):e.jsx(me,{})}),e.jsx(u,{"aria-label":"close",onClick:h,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(Z,{})}),e.jsx(S,{component:"form",sx:{mt:2},children:e.jsxs(n,{container:!0,spacing:3,direction:"column",children:[e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:w,disabled:!0})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"qualitycontrolID",children:"Quality Assurance ID"}),e.jsx("input",{id:"qualitycontrolID",className:"input",value:r.qualitycontrolID||"",disabled:!0})]})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Inspection Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionDate",children:"Inspection Date"}),e.jsx("input",{type:"date",id:"inspectionDate",name:"inspectionDate",className:"input",value:r.inspectionDate||"",onChange:a})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionType",children:"Inspection Type"}),e.jsx("input",{id:"inspectionType",name:"inspectionType",className:"input",value:r.inspectionType||"",onChange:a})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectorID",children:"Inspector ID"}),e.jsx("input",{id:"inspectorID",name:"inspectorID",className:"input",value:r.inspectorID||"",onChange:a})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"testResult",children:"Test Results"}),e.jsx("input",{id:"testResult",name:"testResult",className:"input",value:r.testResult||"",onChange:a})]})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Compliance Standards & Approval Status"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"complianceStandards",children:"Compliance Standards"}),e.jsx("input",{id:"complianceStandards",name:"complianceStandards",className:"input",value:r.complianceStandards||"",onChange:a})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"defectIdentified",children:"Defects Identified"}),e.jsx("input",{id:"defectIdentified",name:"defectIdentified",className:"input",value:r.defectIdentified||"",onChange:a})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"correctiveAction",children:"Corrective Actions"}),e.jsx("input",{id:"correctiveAction",name:"correctiveAction",className:"input",value:r.correctiveAction||"",onChange:a})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:r.approvalStatus||"",onChange:a,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"rework required",children:"Rework Required"})]})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"nextInspectionDate",children:"Next Inspection Date"}),e.jsx("input",{type:"date",id:"nextInspectionDate",name:"nextInspectionDate",className:"input",value:r.nextInspectionDate||"",onChange:a})]})]})]})]})})]}),e.jsxs(pe,{children:[e.jsx(b,{onClick:h,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(k,{slug:p,action:I?"can_update":"can_create",children:e.jsx(b,{variant:"outlined",onClick:X,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:A?"Update":"Submit"})})]})]})]})};export{Ne as default};
