import{r as l,j as e,T as f,S as C,D as A}from"./main-BIxdd69i.js";import{C as V}from"./Close-D340Gps3.js";import{g as W,i as Y,j as q,k as z,l as J}from"./account-BvsCUQ6Q.js";import{G as i}from"./Grid-BnZNKmae.js";import{P as R,I as h,D as K,f as Q,g as X,h as Z,e as E}from"./DialogTitle-D59uELMl.js";import{T as w,a as G,b as m,c as s,d as M}from"./TableRow-D8X36zJO.js";import{A as ee}from"./AddCircle-Bn9h5MaP.js";import{E as te}from"./Edit-BJV-h6Li.js";import{D as se}from"./Delete-BHKbKfZ2.js";const me=()=>{const r="account_ledger",[N,u]=l.useState(!1),[g,p]=l.useState(""),[y,D]=l.useState([]),[_,S]=l.useState(!1),[ne,ae]=l.useState(null),[F,T]=l.useState([]),[x,b]=l.useState(!1),[k,I]=l.useState(null),[n,d]=l.useState({invoiceId:"",invoiceDate:"",dueDate:"",totalAmount:"",amountPaid:"",paymentStatus:"Pending",paymentMethod:"",approvalStatus:"Pending"});l.useEffect(()=>{(async()=>{try{const a=await Y();T(a)}catch(a){console.error("Error fetching guests:",a)}})()},[]),l.useEffect(()=>{P()},[]);const P=async()=>{try{const t=await W();D(t)}catch(t){console.error("Error fetching receivables:",t)}},O=t=>{const a=`INV-${new Date().getFullYear()}-${(y.length+1).toString().padStart(3,"0")}`;p(t),d({invoiceId:a,guestId:t,invoiceDate:"",dueDate:"",totalAmount:"",amountPaid:"",paymentStatus:"Pending",paymentMethod:"",approvalStatus:"Pending"}),S(!1),u(!0)},j=()=>{d({}),u(!1),S(!1)},c=t=>{const{name:a,value:o}=t.target;d(v=>({...v,[a]:o}))},B=(parseFloat(n.totalAmount)||0)-(parseFloat(n.amountPaid)||0),$=async()=>{try{const t={guest:g,invoice_id:n.invoiceId,invoice_date:n.invoiceDate,due_date:n.dueDate,total_amount:parseFloat(n.totalAmount),amount_received:parseFloat(n.amountPaid),payment_status:n.paymentStatus,payment_method:n.paymentMethod,approval_status:n.approvalStatus};let a;x?(a=await z(k,t),alert("Receivable updated successfully ✅")):(a=await J(t),alert("Receivable added successfully ✅")),await P(),u(!1),L()}catch(t){console.error(t),alert(`❌ Failed to ${x?"update":"add"} receivable`)}},L=()=>{b(!1),I(null),d({invoiceId:"",invoiceDate:"",dueDate:"",totalAmount:"",amountPaid:"",paymentStatus:"Pending",paymentMethod:"",approvalStatus:"Pending"}),p(null)},U=t=>{var a,o;b(!0),I(t.invoice_id),d({invoiceId:t.invoice_id||"",invoiceDate:t.invoice_date||"",dueDate:t.due_date||"",totalAmount:((a=t.total_amount)==null?void 0:a.toString())||"",amountPaid:((o=t.amount_received)==null?void 0:o.toString())||"",paymentStatus:t.payment_status||"Pending",paymentMethod:t.payment_method||"",approvalStatus:t.approval_status||"Pending"}),p(t.guest||null),u(!0)},H=async t=>{if(window.confirm(`Are you sure you want to delete invoice ${t}?`))try{await q(t),D(o=>o.filter(v=>v.invoice_id!==t)),alert("Record deleted successfully!")}catch(o){console.error("Delete failed:",o),alert("Failed to delete record.")}};return e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"h5",sx:{mt:4},children:"Accounts Receivable"}),e.jsxs(i,{container:!0,spacing:2,sx:{mt:2},direction:"column",children:[e.jsx(i,{item:!0,xs:12,children:e.jsxs(R,{sx:{p:2},children:[e.jsx(f,{variant:"h6",children:"Guest List"}),e.jsxs(w,{children:[e.jsx(G,{children:e.jsxs(m,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Guest ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Guest Name"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(M,{children:F.map((t,a)=>e.jsxs(m,{children:[e.jsx(s,{children:t.guest_id}),e.jsx(s,{children:t.name}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(C,{slug:r,action:"can_create",children:e.jsx(h,{onClick:()=>O(t.guest_id),children:e.jsx(ee,{sx:{color:"#7267ef"}})})})})]},a))})]})]})}),e.jsx(i,{item:!0,xs:12,children:e.jsxs(R,{sx:{p:2},children:[e.jsx(f,{variant:"h6",children:"Receivable Records"}),e.jsxs(w,{children:[e.jsx(G,{children:e.jsxs(m,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:"Invoice ID"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Guest ID"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Invoice Date"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Due Date"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Total"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Paid"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Outstanding"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Payment Status"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Payment Method"}),e.jsx(s,{sx:{color:"#7267ef"},children:"Approval Status"}),e.jsx(s,{sx:{color:"#660000"},children:"Actions"})]})}),e.jsx(M,{children:y.map((t,a)=>e.jsxs(m,{children:[e.jsx(s,{children:t.invoice_id}),e.jsx(s,{children:t.guest_id}),e.jsx(s,{children:t.invoice_date}),e.jsx(s,{children:t.due_date}),e.jsx(s,{children:t.total_amount}),e.jsx(s,{children:t.amount_received}),e.jsx(s,{children:t.outstanding_balance}),e.jsx(s,{children:t.payment_status}),e.jsx(s,{children:t.payment_method}),e.jsx(s,{children:t.approval_status}),e.jsxs(s,{children:[e.jsx(A,{slug:r,action:"can_update",children:e.jsx(h,{onClick:()=>U(t),children:e.jsx(te,{sx:{color:"orange"}})})}),e.jsx(C,{slug:r,action:"can_delete",children:e.jsx(h,{onClick:()=>H(t.invoiceId),children:e.jsx(se,{sx:{color:"red"}})})})]})]},a))})]})]})})]}),e.jsxs(K,{open:N,onClose:j,fullWidth:!0,children:[e.jsxs(Q,{children:[_?"Edit Receivable":"Add Receivable",e.jsx(h,{onClick:j,sx:{position:"absolute",right:8,top:8},children:e.jsx(V,{})})]}),e.jsx(X,{children:e.jsxs(i,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{children:"Guest ID"}),e.jsx("input",{className:"input",value:g,disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{children:"Invoice ID"}),e.jsx("input",{className:"input",value:n.invoiceId||"",disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{children:"Invoice Date"}),e.jsx("input",{type:"date",name:"invoiceDate",className:"input",value:n.invoiceDate||"",onChange:c})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",name:"dueDate",className:"input",value:n.dueDate||"",onChange:c})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{children:"Total Amount"}),e.jsx("input",{type:"number",name:"totalAmount",className:"input",value:n.totalAmount||"",onChange:c})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{children:"Amount Paid"}),e.jsx("input",{type:"number",name:"amountPaid",className:"input",value:n.amountPaid||"",onChange:c})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{children:"Outstanding Balance"}),e.jsx("input",{type:"number",className:"input",value:B,disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{children:"Payment Status"}),e.jsxs("select",{name:"paymentStatus",className:"input",value:n.paymentStatus||"Pending",onChange:c,disabled:x,children:[e.jsx("option",{children:"Pending"}),e.jsx("option",{children:"Paid"}),e.jsx("option",{children:"Overdue"})]})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{children:"Payment Method"}),e.jsx("input",{name:"paymentMethod",className:"input",value:n.paymentMethod||"",onChange:c})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{children:"Approval Status"}),e.jsxs("select",{name:"approvalStatus",className:"input",value:n.approvalStatus||"Pending",onChange:c,children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]})]})}),e.jsxs(Z,{children:[e.jsx(E,{onClick:j,sx:{outline:"2px solid #800000",color:"#800000"},children:"Cancel"}),e.jsx(A,{slug:r,action:_?"can_update":"can_create",children:e.jsx(E,{variant:"outlined",onClick:$,sx:{color:"#7267ef",borderColor:"#7267ef"},children:x?"Update Receivable":"Add Receivable"})})]})]})]})};export{me as default};
