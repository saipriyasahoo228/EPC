import{k as ke,i as Ee,r as l,m as Oe,j as e,o as me,n as pe,t as Me,v as et,z as q,x as k,T as d,D as $,S as tt,y as st}from"./main-BIxdd69i.js";import{C as De}from"./Close-D340Gps3.js";import{b as nt,g as J,a as ot,e as rt,f as at,h as it}from"./tenderAllocation-BonEQ3EB.js";import{g as lt,a as ct}from"./user-C2xECiyh.js";import{T as dt}from"./Tooltip-3Br47uNT.js";import{i as ut,e as f,P as G,D as oe,f as re,I as we,g as ae,h as xt}from"./DialogTitle-D59uELMl.js";import{T as ie}from"./TableContainer-1Xqyy-f8.js";import{T as le,a as ce,b as D,c as a,d as de}from"./TableRow-D8X36zJO.js";import{C as ht,D as pt}from"./Divider-B5eNhVMt.js";import{T as mt}from"./TablePagination-B2UmV3Uz.js";import{i as jt,G as j}from"./Grid-BnZNKmae.js";import{T as gt}from"./TextField-BZ4knvb7.js";import{L as K,i as Pe,a as _e}from"./Select-CcRDAcIa.js";import{l as ft,L as ue}from"./ListItemText-BdTZxcRl.js";import{C as yt}from"./Checkbox-CzTq-GCU.js";import"./index-E3WhgaTq.js";import"./dividerClasses-BHbp2fTT.js";import"./KeyboardArrowRight-H8WcZOfv.js";import"./MenuItem-BSRQ3XbJ.js";import"./Toolbar-CZiWvmFk.js";function Ct(o){return ke("MuiListItem",o)}Ee("MuiListItem",["root","container","dense","alignItemsFlexStart","divider","gutters","padding","secondaryAction"]);function bt(o){return ke("MuiListItemSecondaryAction",o)}Ee("MuiListItemSecondaryAction",["root","disableGutters"]);const vt=o=>{const{disableGutters:n,classes:c}=o;return Me({root:["root",n&&"disableGutters"]},bt,c)},St=me("div",{name:"MuiListItemSecondaryAction",slot:"Root",overridesResolver:(o,n)=>{const{ownerState:c}=o;return[n.root,c.disableGutters&&n.disableGutters]}})({position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",variants:[{props:({ownerState:o})=>o.disableGutters,style:{right:0}}]}),Fe=l.forwardRef(function(n,c){const s=Oe({props:n,name:"MuiListItemSecondaryAction"}),{className:x,...h}=s,y=l.useContext(K),C={...s,disableGutters:y.disableGutters},S=vt(C);return e.jsx(St,{className:pe(S.root,x),ownerState:C,ref:c,...h})});Fe.muiName="ListItemSecondaryAction";const It=(o,n)=>{const{ownerState:c}=o;return[n.root,c.dense&&n.dense,c.alignItems==="flex-start"&&n.alignItemsFlexStart,c.divider&&n.divider,!c.disableGutters&&n.gutters,!c.disablePadding&&n.padding,c.hasSecondaryAction&&n.secondaryAction]},At=o=>{const{alignItems:n,classes:c,dense:s,disableGutters:x,disablePadding:h,divider:y,hasSecondaryAction:C}=o;return Me({root:["root",s&&"dense",!x&&"gutters",!h&&"padding",y&&"divider",n==="flex-start"&&"alignItemsFlexStart",C&&"secondaryAction"],container:["container"]},Ct,c)},Dt=me("div",{name:"MuiListItem",slot:"Root",overridesResolver:It})(et(({theme:o})=>({display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left",variants:[{props:({ownerState:n})=>!n.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:n})=>!n.disablePadding&&n.dense,style:{paddingTop:4,paddingBottom:4}},{props:({ownerState:n})=>!n.disablePadding&&!n.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:n})=>!n.disablePadding&&!!n.secondaryAction,style:{paddingRight:48}},{props:({ownerState:n})=>!!n.secondaryAction,style:{[`& > .${ft.root}`]:{paddingRight:48}}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:n})=>n.divider,style:{borderBottom:`1px solid ${(o.vars||o).palette.divider}`,backgroundClip:"padding-box"}},{props:({ownerState:n})=>n.button,style:{transition:o.transitions.create("background-color",{duration:o.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(o.vars||o).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}}}},{props:({ownerState:n})=>n.hasSecondaryAction,style:{paddingRight:48}}]}))),wt=me("li",{name:"MuiListItem",slot:"Container",overridesResolver:(o,n)=>n.container})({position:"relative"}),xe=l.forwardRef(function(n,c){const s=Oe({props:n,name:"MuiListItem"}),{alignItems:x="center",children:h,className:y,component:C,components:S={},componentsProps:V={},ContainerComponent:w="li",ContainerProps:{className:R,...Y}={},dense:z=!1,disableGutters:L=!1,disablePadding:E=!1,divider:Q=!1,secondaryAction:U,slotProps:H={},slots:N={},...X}=s,p=l.useContext(K),T=l.useMemo(()=>({dense:z||p.dense||!1,alignItems:x,disableGutters:L}),[x,p.dense,z,L]),Z=l.useRef(null),b=l.Children.toArray(h),I=b.length&&jt(b[b.length-1],["ListItemSecondaryAction"]),P={...s,alignItems:x,dense:T.dense,disableGutters:L,disablePadding:E,divider:Q,hasSecondaryAction:I},O=At(P),B=ut(Z,c),M=N.root||S.Root||Dt,_=H.root||V.root||{},A={className:pe(O.root,_.className,y),...X};let v=C||"li";return I?(v=!A.component&&!C?"div":v,w==="li"&&(v==="li"?v="div":A.component==="li"&&(A.component="div")),e.jsx(K.Provider,{value:T,children:e.jsxs(wt,{as:w,className:pe(O.container,R),ref:B,ownerState:P,...Y,children:[e.jsx(M,{..._,...!Pe(M)&&{as:v,ownerState:{...P,..._.ownerState}},...A,children:b}),b.pop()]})})):e.jsx(K.Provider,{value:T,children:e.jsxs(M,{..._,as:v,ref:B,...!Pe(M)&&{ownerState:{...P,..._.ownerState}},...A,children:[b,U&&e.jsx(Fe,{children:U})]})})}),Re=q(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"})),Le=q(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"})),Ue=q(e.jsx("path",{d:"M6 2v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18V2zm10 14.5V20H8v-3.5l4-4zm-4-5-4-4V4h8v3.5z"})),Pt=q(e.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"})),u=[];for(let o=0;o<256;++o)u.push((o+256).toString(16).slice(1));function _t(o,n=0){return(u[o[n+0]]+u[o[n+1]]+u[o[n+2]]+u[o[n+3]]+"-"+u[o[n+4]]+u[o[n+5]]+"-"+u[o[n+6]]+u[o[n+7]]+"-"+u[o[n+8]]+u[o[n+9]]+"-"+u[o[n+10]]+u[o[n+11]]+u[o[n+12]]+u[o[n+13]]+u[o[n+14]]+u[o[n+15]]).toLowerCase()}let he;const Rt=new Uint8Array(16);function Lt(){if(!he){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");he=crypto.getRandomValues.bind(crypto)}return he(Rt)}const Ut=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ne={randomUUID:Ut};function Te(o,n,c){var x;if(Ne.randomUUID&&!o)return Ne.randomUUID();o=o||{};const s=o.random??((x=o.rng)==null?void 0:x.call(o))??Lt();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,_t(s)}const ts=()=>{var Se,Ie,Ae;const o="tender_allocation";new Date().toISOString().split("T")[0];const[n,c]=l.useState([]),[s,x]=l.useState(null),[h,y]=l.useState(null),[C,S]=l.useState(!1),[V,w]=l.useState([]),[R,Y]=l.useState([]),[z,L]=l.useState(!1),[E,Q]=l.useState(""),[U,H]=l.useState(0),[N,X]=l.useState(5),[p,T]=l.useState({jobAllocationDate:"",govtProjectId:"",projectId:Te(),allocationStatus:"Allocated",refundDate:"",cancellationNote:""}),[Z,b]=l.useState(!1),[I,P]=l.useState(null),[O,B]=l.useState([]),[M,_]=l.useState([]),[A,v]=l.useState(""),[W,je]=l.useState(new Set),[Nt,Ge]=l.useState(null),[Tt,Ve]=l.useState({}),ze=l.useRef(),ge=l.useRef(),fe=l.useRef(),He=l.useRef(),ye=l.useRef(),Be=n.filter(t=>t.tenderId.toLowerCase().includes(E.toLowerCase())||t.title.toLowerCase().includes(E.toLowerCase())),We=(t,i)=>{H(i)},$e=t=>{X(parseInt(t.target.value,10)),H(0)},Ce=V.slice(U*N,U*N+N);l.useEffect(()=>{const t=async()=>{try{const g=(await ot()).map(m=>({tenderId:m.tender_id,title:m.tender_ref_no||"Untitled Tender",status:m.status||""}));c(g)}catch(r){console.error("Error fetching tenders:",r)}},i=async()=>{try{const r=await J();w(r),console.log(r)}catch(r){console.error("Error fetching projects:",r)}};t(),i()},[]);const Je=(t,i,r={})=>{const g={id:Te(),timestamp:new Date().toISOString(),action:t,tenderId:i,user:"currentUser",details:r};Y(m=>[...m,g])},Ke=async t=>{P(t),b(!0);const i=new Set((t.users||[]).map(r=>typeof r=="string"?r:r==null?void 0:r.user_id).filter(Boolean));je(i);try{const[r,g]=await Promise.all([lt(),ct()]);B(Array.isArray(r)?r:[]),_(Array.isArray(g)?g:[])}catch(r){console.error("Failed to fetch users/groups",r)}},ee=()=>{b(!1),P(null),v(""),Ge(null),Ve({})},be=t=>{je(i=>{const r=new Set([...i]);return r.has(String(t))?r.delete(String(t)):r.add(String(t)),r})},qe=t=>t!=null&&t.role?t.role:t!=null&&t.is_admin?"Admin":"User",Ye=t=>(t||"").replace(/\b\w/g,i=>i.toUpperCase()),te=async(t,i)=>{if(y(t),S(!0),t==="accept"&&x(i),t==="view")try{const r=await rt(i.tenderId);x(r),Je("Viewed tender details",i.tenderId)}catch(r){console.error("Error fetching tender by ID:",r),alert("Failed to fetch tender details.")}t==="cancel"&&x(i)},se=()=>{S(!1),y(null),x(null)},F=t=>i=>{T({...p,[t]:i.target.value})},ne=(t,i)=>{var r;t.key==="Enter"&&(t.preventDefault(),(r=i==null?void 0:i.current)==null||r.focus())},Qe=async()=>{try{if(!s)return;if(h==="accept"){const t={status:"Accept",job_allocation_date:p.jobAllocationDate,govt_project_id:p.govtProjectId,allocation_state:p.allocationStatus},i=await at(s.tenderId,t);console.log("Project created successfully:",i),alert(`Project ${i.project_id} created successfully!`),c(g=>g.map(m=>m.tenderId===s.tenderId?{...m,status:"Accept"}:m));const r=await J();w(r)}if(h==="cancel"){const t={status:"Cancel",security_money_refund_date:p.refundDate,description:p.cancellationNote},i=await it(s.tenderId,t);console.log("Tender cancelled successfully:",i),alert("Tender cancelled successfully!"),c(g=>g.map(m=>m.tenderId===s.tenderId?{...m,status:"Cancel"}:m));const r=await J();w(r)}T({jobAllocationDate:"",govtProjectId:"",projectId:"",allocationStatus:"Allocated",refundDate:"",cancellationNote:""}),S(!1),x(null),y(null)}catch(t){console.error("Error submitting:",t),alert("Submission failed. Please check data and try again.")}},Xe=t=>{switch(t){case"accepted":return e.jsx(Re,{color:"success"});case"cancelled":return e.jsx(Le,{color:"error"});default:return e.jsx(Ue,{color:"disabled"})}},Ze=()=>{L(!0)},ve=()=>{L(!1)};return e.jsxs("div",{style:{padding:"1rem",position:"relative"},children:[e.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:2,mb:2},children:[e.jsx(d,{variant:"h6",sx:{color:"#7267ef"},children:"TENDER STATUS FOR PROJECT CREATION"}),e.jsx(dt,{title:"View Audit Trail",children:e.jsxs(f,{variant:"outlined",startIcon:e.jsx(Pt,{}),onClick:Ze,disabled:R.length===0,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#5a55d7",backgroundColor:"#e0e0f7"}},children:["Audit Trail (",R.length,")"]})})]}),e.jsxs(ie,{component:G,sx:{border:"1px solid #7267ef"},children:[e.jsx(k,{mx:2,my:1,children:e.jsx("input",{type:"text",placeholder:"Search Tenders",value:E,onChange:t=>Q(t.target.value),className:"input"})}),e.jsxs(le,{children:[e.jsx(ce,{children:e.jsxs(D,{children:[e.jsx(a,{sx:{color:"#7267ef"},children:"Status"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Tender ID"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Tender Ref.No"}),e.jsx(a,{align:"center",sx:{paddingLeft:"160px",color:"#800000"},children:"Actions"})]})}),e.jsx(de,{children:Be.map(t=>e.jsxs(D,{children:[e.jsx(a,{children:Xe(t.status)}),e.jsx(a,{children:t.tenderId}),e.jsx(a,{children:t.title}),e.jsx(a,{align:"right",children:e.jsxs(k,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e.jsx(f,{variant:"outlined",onClick:()=>te("view",t),sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#5a55d7",backgroundColor:"#e0e0f7"}},children:"View"}),e.jsx($,{slug:o,action:"can_create",children:e.jsx(f,{variant:"contained",color:"success",onClick:()=>te("accept",t),children:"Accept"})}),e.jsx($,{slug:o,action:"can_update",children:e.jsx(f,{variant:"contained",color:"error",onClick:()=>te("cancel",t),children:"Cancel"})})]})})]},t.tenderId))})]})]}),e.jsxs(k,{mt:4,children:[e.jsx(d,{variant:"h6",sx:{color:"#7267ef",mb:1},children:"PROJECT ALLOCATION REPORT"}),e.jsxs(ie,{component:G,sx:{border:"1px solid #7267ef"},children:[e.jsxs(le,{children:[e.jsx(ce,{children:e.jsxs(D,{children:[e.jsx(a,{sx:{color:"#7267ef"},children:"Tender ID"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Project ID"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Govt Project ID"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Job Allocation Date"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Allocation State"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Refund Date"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Cancellation Note"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Status"}),e.jsx(a,{align:"right",sx:{color:"#7267ef"},children:"Users"})]})}),e.jsx(de,{children:Ce.length>0?Ce.map(t=>e.jsxs(D,{children:[e.jsx(a,{children:t.tender}),e.jsx(a,{children:t.project_id||"-"}),e.jsx(a,{children:t.govt_project_id||"-"}),e.jsx(a,{children:t.job_allocation_date||"-"}),e.jsx(a,{children:t.allocation_state||"-"}),e.jsx(a,{children:t.security_money_refund_date||"-"}),e.jsx(a,{children:t.description||"-"}),e.jsx(a,{children:t.status==="Accept"?e.jsx(Re,{color:"success"}):t.status==="Cancel"?e.jsx(Le,{color:"error"}):e.jsx(Ue,{color:"disabled"})}),e.jsx(a,{align:"right",children:e.jsxs(k,{sx:{display:"flex",gap:1,justifyContent:"flex-end",alignItems:"center"},children:[e.jsx(ht,{size:"small",label:`${(t.users||[]).length} users`}),e.jsx(tt,{slug:o,action:"can_update",children:e.jsx(f,{variant:"outlined",onClick:()=>Ke(t),children:"Allocate"})})]})})]},t.id)):e.jsx(D,{children:e.jsx(a,{colSpan:8,align:"center",children:"No project records found."})})})]}),e.jsx(mt,{rowsPerPageOptions:[5,10,25],component:"div",count:V.length,rowsPerPage:N,page:U,onPageChange:We,onRowsPerPageChange:$e})]})]}),e.jsxs(oe,{open:C,onClose:se,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(re,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[h==="accept"?"Project Allocation Details":h==="cancel"?"Cancellation Details":"Tender Details",e.jsx(we,{onClick:se,children:e.jsx(De,{})})]}),e.jsxs(ae,{children:[h==="view"?e.jsxs(e.Fragment,{children:[e.jsxs(d,{children:[e.jsx("strong",{children:"Tender ID:"})," ",s==null?void 0:s.tender_id]}),e.jsxs(d,{children:[e.jsx("strong",{children:"Reference No:"})," ",s==null?void 0:s.tender_ref_no]}),e.jsxs(d,{children:[e.jsx("strong",{children:"Location:"})," ",s==null?void 0:s.location]}),e.jsxs(d,{children:[e.jsx("strong",{children:"Release Date:"})," ",s==null?void 0:s.release_date]}),e.jsxs(d,{children:[e.jsx("strong",{children:"Tender Value:"})," ₹",s==null?void 0:s.tender_value]}),e.jsx(d,{children:e.jsx("strong",{children:"EMD Details:"})}),e.jsxs("ul",{style:{margin:0,paddingLeft:"1.2rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Amount:"})," ₹",(Se=s==null?void 0:s.emd_details)==null?void 0:Se.amount]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Validity:"})," ",(Ie=s==null?void 0:s.emd_details)==null?void 0:Ie.validity]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Conditions:"})," ",(Ae=s==null?void 0:s.emd_details)==null?void 0:Ae.conditions]})]}),e.jsxs(d,{children:[e.jsx("strong",{children:"Authority:"})," ",s==null?void 0:s.authority]}),e.jsxs(d,{children:[e.jsx("strong",{children:"Contact:"})," ",s==null?void 0:s.contact]}),e.jsxs(d,{children:[e.jsx("strong",{children:"Authorized Personnel:"})," ",s==null?void 0:s.authorized_personnel]}),e.jsxs(d,{children:[e.jsx("strong",{children:"Start Date:"})," ",s==null?void 0:s.start_date]}),e.jsxs(d,{children:[e.jsx("strong",{children:"End Date:"})," ",s==null?void 0:s.end_date]}),e.jsxs(d,{children:[e.jsx("strong",{children:"Description:"})," ",s==null?void 0:s.tender_description]}),e.jsxs(d,{children:[e.jsx("strong",{children:"Status:"})," ",s==null?void 0:s.status]})]}):h==="accept"?e.jsx(e.Fragment,{children:e.jsxs(j,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(j,{item:!0,xs:12,children:[e.jsx("label",{htmlFor:"jobAllocationDate",children:"Job Allocation Date"}),e.jsx("input",{type:"date",id:"jobAllocationDate",value:p.jobAllocationDate,onChange:F("jobAllocationDate"),onKeyDown:t=>ne(t,ge),ref:ze,className:"input"})]}),e.jsxs(j,{item:!0,xs:12,children:[e.jsx("label",{htmlFor:"govtProjectId",children:"Govt. Project ID"}),e.jsx("input",{type:"text",id:"govtProjectId",value:p.govtProjectId,onChange:F("govtProjectId"),onKeyDown:t=>ne(t,fe),ref:ge,className:"input"})]}),e.jsxs(j,{item:!0,xs:12,children:[e.jsx("label",{htmlFor:"allocationStatus",children:"Status"}),e.jsxs("select",{id:"allocationStatus",value:p.allocationStatus,onChange:F("allocationStatus"),ref:fe,className:"input",children:[e.jsx("option",{value:"Allocated",children:"Allocated"}),e.jsx("option",{value:"Not Allocated",children:"Not Allocated"})]})]})]})}):e.jsxs(j,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(j,{item:!0,xs:12,children:[e.jsx("label",{htmlFor:"refundDate",children:"Security Money Refund Date"}),e.jsx("input",{type:"date",id:"refundDate",value:p.refundDate,onChange:F("refundDate"),onKeyDown:t=>ne(t,ye),ref:He,className:"input"})]}),e.jsxs(j,{item:!0,xs:12,children:[e.jsx("label",{htmlFor:"cancellationNote",children:"Cancellation Notes"}),e.jsx("textarea",{id:"cancellationNote",rows:3,value:p.cancellationNote,onChange:F("cancellationNote"),ref:ye,className:"input"})]})]}),h!=="view"&&e.jsxs(j,{container:!0,justifyContent:"flex-end",spacing:2,sx:{mt:2},children:[e.jsx(j,{item:!0,children:e.jsx(f,{onClick:se,variant:"outlined",sx:{borderColor:"darkred",color:"darkred","&:hover":{borderColor:"darkred",backgroundColor:"rgba(139, 0, 0, 0.1)"}},children:"Close"})}),e.jsx(j,{item:!0,children:e.jsx($,{slug:o,action:h==="accept"?"can_create":"can_update",children:e.jsx(f,{onClick:Qe,variant:"outlined",sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{color:"#7267ef"}},children:"Submit"})})})]})]})]}),e.jsxs(oe,{open:Z,onClose:ee,maxWidth:"md",fullWidth:!0,children:[e.jsxs(re,{children:["Allocate Users to Project ",(I==null?void 0:I.project_id)||""]}),e.jsx(ae,{children:e.jsxs(j,{container:!0,spacing:2,children:[e.jsxs(j,{item:!0,xs:12,md:5,children:[e.jsx(d,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:"All Users"}),e.jsx(gt,{fullWidth:!0,size:"small",placeholder:"Search users by name, username or code",value:A,onChange:t=>v(t.target.value),sx:{mb:1}}),e.jsx(G,{variant:"outlined",sx:{maxHeight:360,overflow:"auto"},children:e.jsx(_e,{dense:!0,children:(O||[]).filter(t=>{const i=A.trim().toLowerCase();return i?[t.user_id,t.full_name,t.email,t.mobile_number,t.role,...Array.isArray(t.groups)?t.groups:[]].filter(Boolean).join(" ").toLowerCase().includes(i):!0}).map(t=>{const i=W.has(String(t.user_id));return e.jsxs(st.Fragment,{children:[e.jsxs(xe,{button:!0,onClick:()=>be(t.user_id),children:[e.jsx(yt,{edge:"start",checked:i,tabIndex:-1,disableRipple:!0}),e.jsx(ue,{primary:`${t.full_name||"-"}`,secondary:e.jsx(k,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:e.jsx(d,{variant:"caption",color:"text.secondary",children:`${t.user_id} ${t.email||""}`})})})]}),e.jsx(pt,{})]},t.user_id)})})})]}),e.jsxs(j,{item:!0,xs:12,md:7,children:[e.jsx(d,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:"Allocated to this Project"}),e.jsx(G,{variant:"outlined",sx:{maxHeight:420,overflow:"auto"},children:e.jsxs(_e,{dense:!0,children:[(O||[]).filter(t=>W.has(String(t.user_id))).map(t=>e.jsx(xe,{secondaryAction:e.jsx(f,{size:"small",onClick:()=>be(t.user_id),children:"Remove"}),alignItems:"flex-start",sx:{pr:2,"& .MuiListItemSecondaryAction-root":{right:8}},children:e.jsx(ue,{primary:`${t.full_name||t.user_id}`,secondary:Ye(qe(t)),primaryTypographyProps:{noWrap:!0},secondaryTypographyProps:{noWrap:!0},sx:{pr:12,overflow:"hidden","& .MuiListItemText-primary, & .MuiListItemText-secondary":{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",display:"block"}}})},`sel-${t.user_id}`)),Array.from(W).length===0&&e.jsx(xe,{children:e.jsx(ue,{primary:"No users allocated yet."})})]})})]})]})}),e.jsxs(xt,{children:[e.jsx(f,{onClick:ee,children:"Close"}),e.jsx($,{slug:o,action:"can_update",children:e.jsx(f,{variant:"contained",sx:{backgroundColor:"#7267ef"},onClick:async()=>{if(I)try{const t=Array.from(W);await nt(I.project_id,{users:t});const i=await J();w(i),alert("Users allocated successfully."),ee()}catch(t){console.error("Failed to save allocation",t),alert("Failed to save allocation. Please try again.")}},children:"Save Allocation"})})]})]}),e.jsxs(oe,{open:z,onClose:ve,maxWidth:"md",fullWidth:!0,children:[e.jsxs(re,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["System Audit Trail",e.jsx(we,{onClick:ve,children:e.jsx(De,{})})]}),e.jsx(ae,{children:e.jsx(ie,{component:G,sx:{mt:2},children:e.jsxs(le,{children:[e.jsx(ce,{children:e.jsxs(D,{children:[e.jsx(a,{children:"Timestamp"}),e.jsx(a,{children:"Tender ID"}),e.jsx(a,{children:"Action"}),e.jsx(a,{children:"Details"}),e.jsx(a,{children:"User"})]})}),e.jsx(de,{children:R.length>0?[...R].reverse().map(t=>e.jsxs(D,{children:[e.jsx(a,{children:new Date(t.timestamp).toLocaleString()}),e.jsx(a,{children:t.tenderId}),e.jsx(a,{children:t.action}),e.jsx(a,{children:t.details&&Object.keys(t.details).length>0?e.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:Object.entries(t.details).map(([i,r])=>e.jsxs("li",{children:[e.jsxs("strong",{children:[i,":"]})," ",r]},i))}):"-"}),e.jsx(a,{children:t.user})]},t.id)):e.jsx(D,{children:e.jsx(a,{colSpan:5,align:"center",children:"No audit records found"})})})]})})})]})]})};export{ts as default};
