import{r as o,j as e,T as y,z as v}from"./main-IxGEKZMA.js";import{C as W}from"./Close-DoqWsXz3.js";import{h as Q}from"./procurement-DNGl8bgG.js";import{g as I,d as Y,u as z,c as J}from"./maintenance-CWRDLbWQ.js";import{G as a}from"./Grid-C72N-tAO.js";import{t as w,T as A,h as S,i as m,j as r,k as E,I as p,D as V,f as K,g as X,e as T}from"./TableRow-CRAT5KT_.js";import{A as Z}from"./AddCircle-DWIRGPUh.js";import{T as ee}from"./TableContainer-BaU58JEj.js";import{E as se}from"./Edit-g2hjeeYC.js";import{D as re}from"./Delete-cHl_EB0l.js";import{D as te}from"./DialogActions-D5wP0Mt-.js";import"./Transition-C29ZPDdz.js";const ge=()=>{const[x,b]=o.useState(null),[j,F]=o.useState(""),[C,P]=o.useState(""),[R,f]=o.useState(!1),[ne,L]=o.useState(""),[t,u]=o.useState({}),[_,g]=o.useState([]),[M,D]=o.useState(!1),[ae,N]=o.useState(null),[q,O]=o.useState([]);o.useEffect(()=>{(async()=>{try{const c=(await Q()).map(l=>({poId:l.po_number,procurementId:l.procurement}));O(c)}catch(n){console.error("❌ Error fetching purchase orders:",n)}})()},[]),o.useEffect(()=>{(async()=>{try{const n=await I();g(n)}catch(n){console.error("❌ Failed to load assets:",n)}})()},[]);const k=(s,n)=>{L(s,n);const c=new Date().getFullYear(),d=(_.length+1).toString().padStart(3,"0");u({assetId:`AST-${c}-${d}`,poId:s,procurementId:n}),D(!1),N(null),f(!0)},B=s=>{u({assetId:s.asset_id||"",assetName:s.asset_name||"",assetType:s.asset_type||"",modelNumber:s.model_number||"",serialNumber:s.serial_number||"",location:s.location||"",purchaseDate:s.purchase_date||"",warrantyExpiryDate:s.warranty_expiry_date||"",procurementId:s.procurement_id||"",maintenanceRequirement:s.maintenance_requirement||"",currentCondition:s.current_condition||"",usefullLife:s.useful_life_years||"",poId:s.purchase_order||""}),b(s.asset_id),f(!0)},$=async s=>{if(window.confirm(`Are you sure you want to delete asset ${s}?`))try{await Y(s),alert(`✅ Asset ${s} deleted successfully`),g(n=>n.filter(c=>c.asset_id!==s))}catch{alert(`❌ Failed to delete asset ${s}`)}},h=()=>{f(!1),u({}),D(!1),N(null)},i=s=>{const{name:n,value:c}=s.target;u(l=>({...l,[n]:c}))},G=async()=>{var s,n,c;try{const l={asset_name:t.assetName||"",asset_type:t.assetType||"",model_number:t.modelNumber||"",serial_number:t.serialNumber||"",location:t.location||"",purchase_date:t.purchaseDate||"",warranty_expiry_date:t.warrantyExpiryDate||"",procurement_id:t.procurementId||"",maintenance_requirement:t.maintenanceRequirement||"",current_condition:t.currentCondition||"",useful_life_years:t.usefullLife||5,purchase_order:t.poId||""};let d;x?(d=await z(x,l),alert(`✏️ Asset updated successfully! (${x})`)):(d=await J(l),alert(`✅ Asset created successfully!
Generated Asset ID: ${d.asset_id}`));const U=await I();g(U),u({}),b(null),h()}catch(l){const d=((n=(s=l.response)==null?void 0:s.data)==null?void 0:n.detail)||((c=l.response)==null?void 0:c.data)||l.message;alert(`❌ Failed to submit asset:
${JSON.stringify(d,null,2)}`),console.error("❌ Error submitting asset:",l)}},H=_.filter(s=>Object.values(s).some(n=>n&&n.toString().toLowerCase().includes(C.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Assets Management"}),e.jsx(a,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(w,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(y,{variant:"h6",gutterBottom:!0,children:"Purchase & Procurement Details"}),e.jsx(v,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Purchase & Procurement",value:j,onChange:s=>F(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(A,{children:[e.jsx(S,{children:e.jsxs(m,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"PurchaseOrder ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Procurement ID"})}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(E,{children:q.filter(s=>s.poId.toLowerCase().includes(j.toLowerCase())||s.procurementId.toLowerCase().includes(j.toLowerCase())).map((s,n)=>e.jsxs(m,{children:[e.jsx(r,{children:s.poId}),e.jsx(r,{children:s.procurementId}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(p,{onClick:()=>k(s.poId,s.procurementId),color:"primary",children:e.jsx(Z,{sx:{color:"#7267ef"}})})})]},n))})]})]})})}),e.jsx(a,{container:!0,spacing:2,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(w,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(y,{variant:"h6",gutterBottom:!0,children:"Assets Details"}),e.jsx("input",{type:"text",placeholder:"Search Assets Management Details",value:C,onChange:s=>P(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(ee,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(A,{stickyHeader:!0,children:[e.jsx(S,{children:e.jsxs(m,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Purchase Order"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"ProcurementId"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset Name"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset Type"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Model Number"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Serial Number"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Location"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Purchase Date"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Warranty Expiry Date"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Maintenance Requirment"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Current Condition"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Usefull Life"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Depreciation Value"})}),e.jsx(r,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(E,{children:H.map((s,n)=>e.jsxs(m,{children:[e.jsx(r,{children:s.purchase_order}),e.jsx(r,{children:s.procurement_id}),e.jsx(r,{children:s.asset_id}),e.jsx(r,{children:s.asset_name}),e.jsx(r,{children:s.asset_type}),e.jsx(r,{children:s.model_number}),e.jsx(r,{children:s.serial_number}),e.jsx(r,{children:s.location}),e.jsx(r,{children:s.purchase_date}),e.jsx(r,{children:s.warranty_expiry_date}),e.jsx(r,{children:s.maintenance_requirement}),e.jsx(r,{children:s.current_condition}),e.jsx(r,{children:s.useful_life_years}),e.jsx(r,{children:s.depreciation_value}),e.jsxs(r,{children:[e.jsx(p,{onClick:()=>B(s),color:"warning",children:e.jsx(se,{sx:{color:"orange"}})}),e.jsx(p,{onClick:()=>$(s.asset_id),color:"error",children:e.jsx(re,{sx:{color:"red"}})})]})]},n))})]})})]})})}),e.jsxs(V,{open:R,onClose:h,fullWidth:!0,children:[e.jsx(K,{children:M?"Edit Asset Management Details":"Enter Assets Management Details"}),e.jsxs(X,{sx:{position:"relative"},children:[e.jsx(p,{"aria-label":"close",onClick:h,sx:{position:"absolute",right:8,top:8,color:s=>s.palette.grey[500]},children:e.jsx(W,{})}),e.jsx(v,{component:"form",sx:{mt:2},children:e.jsx(a,{container:!0,spacing:3,direction:"column",children:e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Asset Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"assetId",children:"Asset ID"}),e.jsx("input",{id:"assetId",name:"assetId",className:"input",value:t.assetId||"",onChange:i,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"procurementId",children:"procurement ID"}),e.jsx("input",{id:"procurementId",name:"procurementId",className:"input",value:t.procurementId||"",onChange:i,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"poId",children:"PurchaseOrder ID"}),e.jsx("input",{id:"poId",name:"poId",className:"input",value:t.poId||"",onChange:i,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"assetName",children:"Asset Name"}),e.jsx("input",{id:"assetName",name:"assetName",className:"input",value:t.assetName||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"assetType",children:"Asset Type"}),e.jsx("input",{id:"assetType",name:"assetType",className:"input",value:t.assetType||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"modelNumber",children:"Model Number"}),e.jsx("input",{id:"modelNumber",name:"modelNumber",className:"input",value:t.modelNumber||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"serialNumber",children:"Serial Number"}),e.jsx("input",{id:"serialNumber",name:"serialNumber",className:"input",value:t.serialNumber||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"location",children:"Location"}),e.jsx("input",{id:"location",name:"location",className:"input",value:t.location||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"purchaseDate",children:"Purchase Date"}),e.jsx("input",{type:"date",id:"purchaseDate",name:"purchaseDate",className:"input",value:t.purchaseDate||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"warrantyExpiryDate",children:"Warranty Expiry Date"}),e.jsx("input",{type:"date",id:"warrantyExpiryDate",name:"warrantyExpiryDate",className:"input",value:t.warrantyExpiryDate||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"maintenanceRequirement",children:"Maintenance Requirement"}),e.jsxs("select",{id:"maintenanceRequirement",name:"maintenanceRequirement",className:"input",value:t.maintenanceRequirement||"",onChange:i,children:[e.jsx("option",{value:"",children:"-- Select Maintenance Requirement --"}),e.jsx("option",{value:"Regular",children:"Regular"}),e.jsx("option",{value:"Preventive",children:"Preventive"}),e.jsx("option",{value:"Emergency",children:"Emergency"})]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"currentCondition",children:"Current Condition"}),e.jsxs("select",{id:"currentCondition",name:"currentCondition",className:"input",value:t.currentCondition||"",onChange:i,children:[e.jsx("option",{value:"",children:"-- Select Current Condition --"}),e.jsx("option",{value:"Operational",children:"Operational"}),e.jsx("option",{value:"Needs Repair",children:"Needs Repair"}),e.jsx("option",{value:"Decommissioned",children:"Decommissioned"})]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"usefullLife",children:"Usefull Life"}),e.jsx("input",{type:"number",id:"usefullLife",name:"usefullLife",className:"input",value:t.usefullLife||"",onChange:i})]})]})]})})})]}),e.jsxs(te,{children:[e.jsx(T,{onClick:h,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(T,{variant:"outlined",onClick:G,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:x?"Update":"Submit"})]})]})]})};export{ge as default};
