import{r as s,j as e,T as I,J as w,E as k,S as R,I as h,K as T}from"./main-Skim5IJC.js";import{C as X}from"./Close-BKZ7QrSY.js";import{D as Z}from"./Download-C4sxsXoP.js";import{E as ee,a as te}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{g as ne}from"./engineering-BJ3wTiKO.js";import{l as oe,m as re,n as ie,o as se}from"./commision-Dp7iUYLu.js";import{G as r}from"./Grid-fY_ATwTx.js";import{T as E,a as F,b as p,c as o,d as P}from"./TableRow-B6k_bSOs.js";import{A as ae}from"./AddCircle-CJp4DZj3.js";import{B as b,D as ce,a as le,b as de,c as me}from"./DialogTitle-CvDFHAwp.js";import{T as he}from"./TableContainer-gCCy6yK7.js";import{E as xe}from"./Edit-6vcT2Cu4.js";import{D as fe}from"./Delete-Be1vvbhC.js";import{M as ue,a as pe}from"./minimize-2-RCuvNn0X.js";const Fe=()=>{const x="commissioning",[j,L]=s.useState(!1),[S,N]=s.useState(""),[D,A]=s.useState(""),[M,d]=s.useState(!1),[v,B]=s.useState(""),[g,z]=s.useState([]),[O,H]=s.useState(!1),[je,Y]=s.useState(null),[G,W]=s.useState([]),[f,y]=s.useState(null),[i,c]=s.useState({finalReportId:"",project:"",regulatory_body:"",inspection_date:"",inspector_name:"",compliance_checklist_id:"",compliance_status:"",non_compliance_issues:"",corrective_action:""}),$=()=>{L(!j)};s.useEffect(()=>{(async()=>{try{const n=await ne();W(n)}catch(n){console.error("❌ Error fetching projects:",n)}})()},[]),s.useEffect(()=>{u()},[]);const u=async()=>{try{const t=await oe();z(t)}catch(t){console.error("❌ Error fetching reports:",t)}},U=t=>{B(t);const n=new Date().getFullYear(),m=(g.length+1).toString().padStart(4,"0");c({systemmanagementID:`FIN-${n}-${m}`,projectId:t}),y(null),d(!0)},J=async t=>{if(window.confirm("Are you sure you want to delete this report?"))try{await re(t),await u(),alert("Report deleted successfully!")}catch(n){console.error("❌ Error deleting report:",n),alert("Failed to delete report. Please try again.")}},_=()=>{d(!1),c({}),H(!1),Y(null)},C=t=>{const{name:n,value:a}=t.target;c(m=>({...m,[n]:a}))},Q=t=>{c({systemmanagementID:t.final_report_id,projectId:t.project_id,testingInfo:t.summary_of_testing,defectRectification:t.defect_rectification_report,handoverConfirmation:t.handover_confirmation,complianceConfirmation:t.compliance_confirmation,documentLink:t.archival_document_link}),y(t.final_report_id),d(!0)},K=async t=>{t.preventDefault();const n={project_id:v,summary_of_testing:i.testingInfo||"",defect_rectification_report:i.defectRectification||"",handover_confirmation:i.handoverConfirmation||!1,compliance_confirmation:i.complianceConfirmation||!1,archival_document_link:i.documentLink||""};try{if(f){const a=await ie(f,n);await u(),c({}),y(null),d(!1),alert(`System Integration Report updated successfully!
Final Report ID: ${a.data.final_report_id}`)}else{const a=await se(n);await u(),c({}),d(!1),alert(`System Integration Report submitted successfully!
Final Report ID: ${a.data.final_report_id}`)}}catch(a){console.error("❌ Error submitting system integration:",a),alert("Failed to submit System Integration Report. Please try again.")}},V=g.filter(t=>Object.values(t).some(n=>n&&n.toString().toLowerCase().includes(D.toLowerCase()))),q=t=>{const n=new ee("l","mm","a4");n.setFontSize(16),n.text("All System Integration & Certification Report",14,15);const a=["Project ID","Final Report ID","Testing & Inspection","Defect Rectification Report","Handover Confirmation","Compliance Confirmation","Archival Document Link"],m=t.map(l=>[l.project_id,l.final_report_id,l.summary_of_testing,l.defect_rectification_report,l.handover_confirmation?"✅":"❌",l.compliance_confirmation?"✅":"❌",l.archival_document_link?l.archival_document_link:"-"]);te(n,{head:[a],body:m,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),n.save("all_system_integration_certification_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(I,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"System Integration & Certification"}),e.jsx(r,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(r,{item:!0,xs:12,children:e.jsxs(w,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(I,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(k,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:S,onChange:t=>N(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(E,{children:[e.jsx(F,{children:e.jsxs(p,{children:[e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(o,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(P,{children:G.filter(t=>{var n;return(n=t.project_id)==null?void 0:n.toLowerCase().includes(S.toLowerCase())}).map((t,n)=>e.jsxs(p,{children:[e.jsx(o,{children:t.project_id}),e.jsx(o,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(R,{slug:x,action:"can_create",children:e.jsx(h,{onClick:()=>U(t.project_id),color:"primary",children:e.jsx(ae,{sx:{color:"#7267ef"}})})})})]},n))})]})]})})}),e.jsx(r,{container:!0,spacing:2,children:e.jsx(r,{item:!0,xs:12,children:e.jsxs(w,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(b,{startIcon:e.jsx(Z,{}),onClick:()=>q(g),children:"Download PDF"}),e.jsx(I,{variant:"h6",gutterBottom:!0,children:"SYSTEM INTEGRATION & CERTIFICATION DETAILS"}),e.jsx("input",{type:"text",placeholder:"Search System integration & certification",value:D,onChange:t=>A(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(he,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(E,{stickyHeader:!0,children:[e.jsx(F,{children:e.jsxs(p,{children:[e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Final Report ID"})}),e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Testing & Inspection"})}),e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Defect Rectification Report"})}),e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Handover Confirmation"})}),e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance Confirmation"})}),e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Archival Document Link"})}),e.jsx(o,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(P,{children:V.map((t,n)=>e.jsxs(p,{children:[e.jsx(o,{children:t.project_id}),e.jsx(o,{children:t.final_report_id}),e.jsx(o,{children:t.summary_of_testing}),e.jsx(o,{children:t.defect_rectification_report}),e.jsx(o,{children:t.handover_confirmation?"✅":"❌"}),e.jsx(o,{children:t.compliance_confirmation?"✅":"❌"}),e.jsx(o,{children:t.archival_document_link?e.jsx("a",{href:t.archival_document_link,target:"_blank",rel:"noreferrer",children:"View Doc"}):"-"}),e.jsxs(o,{children:[e.jsx(T,{slug:x,action:"can_update",children:e.jsx(h,{onClick:()=>Q(t),color:"warning",children:e.jsx(xe,{sx:{color:"orange"}})})}),e.jsx(R,{slug:x,action:"can_delete",children:e.jsx(h,{onClick:()=>J(t.final_report_id),color:"error",children:e.jsx(fe,{sx:{color:"red"}})})})]})]},n))})]})})]})})}),e.jsxs(ce,{open:M,onClose:_,fullWidth:!0,maxWidth:"xl",PaperProps:{style:j?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(le,{children:O?"Edit System Integration Details":"Enter System Integration Details"}),e.jsxs(de,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(h,{"aria-label":"toggle-size",onClick:$,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:j?e.jsx(ue,{}):e.jsx(pe,{})}),e.jsx(h,{"aria-label":"close",onClick:_,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(X,{})}),e.jsx(k,{component:"form",sx:{mt:2},children:e.jsxs(r,{container:!0,spacing:3,direction:"column",children:[e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:v,disabled:!0})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"systemmanagementID",children:"Final Report ID"}),e.jsx("input",{id:"systemmanagementID",className:"input",value:i.systemmanagementID||"",disabled:!0})]})]})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Summary of Testing"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"testingInfo",children:"Testing Info"}),e.jsx("input",{id:"testingInfo",name:"testingInfo",className:"input",value:i.testingInfo||"",onChange:C})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"defectRectification",children:"Defect Rectification"}),e.jsx("input",{id:"defectRectification",name:"defectRectification",className:"input",value:i.defectRectification||"",onChange:C})]}),e.jsx(r,{item:!0,xs:6,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"handoverConfirmation",checked:i.handoverConfirmation||!1,onChange:t=>c({...i,handoverConfirmation:t.target.checked})})," Handover Confirmation"]})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"complianceConfirmation",checked:i.complianceConfirmation||!1,onChange:t=>c({...i,complianceConfirmation:t.target.checked})})," Compliance Confirmation"]})})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Document Info.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsx(r,{container:!0,spacing:2,children:e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"documentLink",children:"Document Link"}),e.jsx("input",{id:"documentLink",name:"documentLink",className:"input",value:i.documentLink||"",onChange:C})]})})]})]})]})})]}),e.jsxs(me,{children:[e.jsx(b,{onClick:_,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(T,{slug:x,action:f?"can_update":"can_create",children:e.jsx(b,{variant:"outlined",onClick:K,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:f?"Update":"Submit"})})]})]})]})};export{Fe as default};
