import{r,j as e,T as C,x as E,S as k,D as A}from"./main-BIxdd69i.js";import{C as J}from"./Close-D340Gps3.js";import{g as K,k as D,l as V,m as X,n as Z}from"./maintenance-B4U_mUx1.js";import{G as a}from"./Grid-BnZNKmae.js";import{P as T,I as d,D as ee,f as se,g as te,h as ne,e as F}from"./DialogTitle-D59uELMl.js";import{T as N,a as P,b as u,c as n,d as M}from"./TableRow-D8X36zJO.js";import{A as ie}from"./AddCircle-Bn9h5MaP.js";import{T as ae}from"./TableContainer-1Xqyy-f8.js";import{E as re}from"./Edit-BJV-h6Li.js";import{D as oe}from"./Delete-BHKbKfZ2.js";import{M as ce,a as le}from"./minimize-2-Dl_U24Qm.js";const Se=()=>{const x="maintenance",[I,B]=r.useState(""),[S,R]=r.useState(""),[z,m]=r.useState(!1),[j,L]=r.useState(!1),[de,$]=r.useState(""),[i,l]=r.useState({}),[b,f]=r.useState([]),[_,p]=r.useState(!1),[g,v]=r.useState(null),[xe,w]=r.useState(null),[O,G]=r.useState([]),H=()=>{L(!j)};r.useEffect(()=>{(async()=>{try{const t=await K();G(t)}catch(t){console.error("❌ Failed to fetch assets:",t)}})()},[]),r.useEffect(()=>{(async()=>{try{const t=await D();f(t)}catch(t){console.error(t)}})()},[]);const U=s=>{$(s);const t=new Date().getFullYear(),y=(b.length+1).toString().padStart(4,"0");l({complianceID:`CMS-${t}-${y}`,assetId:s}),p(!1),w(null),m(!0)},Y=s=>{l({complianceID:s.compliance_id,assetId:s.asset,inspectionDate:s.inspection_date,inspectionType:s.inspection_type,inspectorID:s.inspector_id,regulatoryStandards:s.regulatory_standards,nonComplianceIssues:s.non_compliance_issues||"",correctiveActionPlan:s.corrective_action_plan||"",certificationExpiryDate:s.certification_expiry_date||""}),v(s.compliance_id),p(!0),m(!0)},Q=async s=>{if(window.confirm(`⚠️ Are you sure you want to delete Compliance ID: ${s}?`))try{await V(s),alert(`✅ Compliance ${s} deleted successfully`);const c=await D();f(c)}catch(c){alert("❌ Failed to delete compliance"),console.error("Delete error:",c)}},h=()=>{m(!1),l({}),p(!1),w(null)},o=s=>{const{name:t,value:c}=s.target;l(y=>({...y,[t]:c}))},W=async()=>{try{const s={asset:i.assetId,inspection_date:i.inspectionDate,inspection_type:i.inspectionType,inspector_id:i.inspectorID,regulatory_standards:i.regulatoryStandards,non_compliance_issues:i.nonComplianceIssues||null,corrective_action_plan:i.correctiveActionPlan||null,certification_expiry_date:i.certificationExpiryDate||null};let t;g?(t=await X(g,s),alert(`✅ Safety Check updated: ${t.compliance_id}`)):(t=await Z(s),alert(`✅ Safety Check created: ${t.compliance_id}`));const c=await D();f(c),l({}),v(null),p(!1),h()}catch(s){console.error("❌ handleSubmit error:",s),alert("❌ Failed to submit safety check")}},q=b.filter(s=>Object.values(s).some(t=>t&&t.toString().toLowerCase().includes(S.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Compliance & Safety Checks"}),e.jsx(a,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(C,{variant:"h6",gutterBottom:!0,children:"ASSETS RECORDS"}),e.jsx(E,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Asset ID",value:I,onChange:s=>B(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(N,{children:[e.jsx(P,{children:e.jsxs(u,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(M,{children:O.filter(s=>s.asset_id.toLowerCase().includes(I.toLowerCase())).map((s,t)=>e.jsxs(u,{children:[e.jsx(n,{children:s.asset_id}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(k,{slug:x,action:"can_create",children:e.jsx(d,{onClick:()=>U(s.asset_id),color:"primary",children:e.jsx(ie,{sx:{color:"#7267ef"}})})})})]},t))})]})]})})}),e.jsx(a,{container:!0,spacing:2,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(C,{variant:"h6",gutterBottom:!0,children:"Compliance & Safety Checks Details"}),e.jsx("input",{type:"text",placeholder:"Search Safety Check Details",value:S,onChange:s=>R(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(ae,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(N,{stickyHeader:!0,children:[e.jsx(P,{children:e.jsxs(u,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Date"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Type"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspector ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Regulatory Standards"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Non-Compliance Issues"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Corrective Action Plan"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Certification ExpiryDate"})}),e.jsx(n,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(M,{children:q.map((s,t)=>e.jsxs(u,{children:[e.jsx(n,{children:s.asset}),e.jsx(n,{children:s.compliance_id}),e.jsx(n,{children:s.inspection_date}),e.jsx(n,{children:s.inspection_type}),e.jsx(n,{children:s.inspector_id}),e.jsx(n,{children:s.regulatory_standards}),e.jsx(n,{children:s.non_compliance_issues}),e.jsx(n,{children:s.corrective_action_plan}),e.jsx(n,{children:s.certification_expiry_date}),e.jsxs(n,{children:[e.jsx(A,{slug:x,action:"can_update",children:e.jsx(d,{onClick:()=>Y(s),color:"warning",children:e.jsx(re,{sx:{color:"orange"}})})}),e.jsx(k,{slug:x,action:"can_delete",children:e.jsx(d,{onClick:()=>Q(s.compliance_id),color:"error",children:e.jsx(oe,{sx:{color:"red"}})})})]})]},t))})]})})]})})}),e.jsxs(ee,{open:z,onClose:h,fullWidth:!0,maxWidth:"xl",PaperProps:{style:j?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(se,{children:_?"Edit Safety Check Details":"Enter Safety Check Details"}),e.jsxs(te,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(d,{"aria-label":"toggle-size",onClick:H,sx:{position:"absolute",right:40,top:8,color:s=>s.palette.grey[600]},children:j?e.jsx(ce,{}):e.jsx(le,{})}),e.jsx(d,{"aria-label":"close",onClick:h,sx:{position:"absolute",right:8,top:8,color:s=>s.palette.grey[500]},children:e.jsx(J,{})}),e.jsx(E,{component:"form",sx:{mt:2},children:e.jsx(a,{container:!0,spacing:3,direction:"column",children:e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Compliance Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"complianceID",children:"Compliance ID"}),e.jsx("input",{id:"complianceID",name:"complianceID",className:"input",value:i.complianceID||"",onChange:o,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"assetId",children:"Asset ID"}),e.jsx("input",{id:"assetId",name:"assetId",className:"input",value:i.assetId||"",onChange:o,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionDate",children:"Inspection Date"}),e.jsx("input",{type:"date",id:"inspectionDate",name:"inspectionDate",className:"input",value:i.inspectionDate||"",onChange:o})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionType",children:"Inspection Type"}),e.jsx("input",{id:"inspectionType",name:"inspectionType",className:"input",value:i.inspectionType||"",onChange:o})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectorID",children:"Inspector ID"}),e.jsx("input",{id:"inspectorID",name:"inspectorID",className:"input",value:i.inspectorID||"",onChange:o})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"regulatoryStandards",children:"Regulatory Standards"}),e.jsx("input",{id:"regulatoryStandards",name:"regulatoryStandards",className:"input",value:i.regulatoryStandards||"",onChange:o})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"nonComplianceIssues",children:"Non-Compliance Issues"}),e.jsx("textarea",{id:"nonComplianceIssues",name:"nonComplianceIssues",className:"input",rows:"3",value:i.nonComplianceIssues||"",onChange:o})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"correctiveActionPlan",children:"Corrective Action Plan"}),e.jsx("textarea",{id:"correctiveActionPlan",name:"correctiveActionPlan",className:"input",rows:"3",value:i.correctiveActionPlan||"",onChange:o})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"certificationExpiryDate",children:"Certification Expiry Date"}),e.jsx("input",{type:"date",id:"certificationExpiryDate",name:"certificationExpiryDate",className:"input",value:i.certificationExpiryDate||"",onChange:o})]})]})]})})})]}),e.jsxs(ne,{children:[e.jsx(F,{onClick:h,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(A,{slug:x,action:g?"can_update":"can_create",children:e.jsx(F,{variant:"outlined",onClick:W,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:_?"Update":"Submit"})})]})]})]})};export{Se as default};
