import{r as i,j as e,T as I,J as w,E as D,S as v,I as u,K as B}from"./main-Skim5IJC.js";import{C as J}from"./Close-BKZ7QrSY.js";import{a as q,g as X,b as Z,e as ee,f as te}from"./inventory-BCILrqmV.js";import{f as M}from"./date-DdrLtg20.js";import{D as se}from"./Download-C4sxsXoP.js";import{E as oe,a as ne}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{G as n}from"./Grid-fY_ATwTx.js";import{T,a as F,b as j,c as o,d as E}from"./TableRow-B6k_bSOs.js";import{A as ae}from"./AddCircle-CJp4DZj3.js";import{T as re}from"./TableContainer-gCCy6yK7.js";import{E as ce}from"./Edit-6vcT2Cu4.js";import{D as le}from"./Delete-Be1vvbhC.js";import{D as ie,a as de,b as xe,c as ue,B as N}from"./DialogTitle-CvDFHAwp.js";import{M as he,a as me}from"./minimize-2-RCuvNn0X.js";const Be=()=>{const m="inventory",[b,U]=i.useState(""),[y,O]=i.useState(""),[$,k]=i.useState(!1),[V,R]=i.useState([]),[d,g]=i.useState(""),[r,h]=i.useState({}),[_,L]=i.useState([]),[f,z]=i.useState(!1),Y=()=>{z(!f)},A=t=>{const s=new Date().getFullYear(),c=_.length+1,l=`STK-${s}-${String(c).padStart(3,"0")}`;g(null),h({itemId:t,stockManagementId:l,openingStock:"",stockIssued:"",stockIssuedBy:"",stockBalance:"",stockValuation:"",lastUpdated:new Date().toISOString().split("T")[0]}),k(!0)},p=()=>{h({}),k(!1)};i.useEffect(()=>{(async()=>{try{const s=await X();R(s)}catch(s){console.error("Error loading inventory items:",s)}})()},[]),i.useEffect(()=>{S()},[]);const S=async()=>{try{const t=await q();L(t),setFilteredStockManagement(t)}catch(t){console.error("Error loading stock management:",t)}},x=t=>{const{name:s,value:c}=t.target;h(l=>{let a={...l,[s]:c};if(s==="openingStock"||s==="stockIssued"){const K=parseFloat(a.openingStock)||0,Q=parseFloat(a.stockIssued)||0;a.stockBalance=K-Q}return a})},P=t=>{h({stockManagementId:t.stock_id,itemId:t.item,openingStock:t.opening_stock,stockIssued:t.stock_issued,stockIssuedBy:t.stock_issued_by,stockBalance:t.stock_balance,stockValuation:t.stock_valuation,lastUpdated:t.last_updated}),g(t.stock_id||t.stockManagementId),k(!0)},W=async()=>{var t,s;try{const c={item:r.itemId,opening_stock:Number(r.openingStock)||0,stock_issued:Number(r.stockIssued)||0,stock_issued_by:r.stockIssuedBy,stock_valuation:Number(r.stockValuation)||0,last_updated:r.lastUpdated||new Date().toISOString().split("T")[0]};let l;d?l=await ee(d,c):l=await te(c),console.log("✅ API Response:",l);let a=`✅ ${l.message||(d?"Stock updated":"Stock created")}`;(t=l.data)!=null&&t.stock_id&&(a+=`
Stock ID: ${l.data.stock_id}`),l.alert&&(a+=`

⚠️ ${l.alert}`),alert(a),await S(),h({}),g(null),p()}catch(c){console.error(`❌ Error ${d?"updating":"creating"} stock:`,c),alert(`⚠️ Failed to ${d?"update":"create"} stock:
${((s=c.response)==null?void 0:s.data)||c.message}`)}},G=async t=>{if(window.confirm(`Are you sure you want to delete stock ${t}?`))try{await Z(t),await S(),alert(`✅ Stock ${t} deleted successfully`)}catch(c){alert(`❌ Failed to delete stock ${t}`),console.error(`Error deleting stock ${t}:`,c)}},C=_.filter(t=>Object.values(t).some(s=>s&&s.toString().toLowerCase().includes(y.toLowerCase()))),H=t=>{const s=new oe("l","mm","a4");s.setFontSize(16),s.text("Stock Management Report",14,15);const c=["Item ID","Stock ID","Opening Stock","Stock Issued","Stock Issued By","Stock Balance","Stock Valuation","Last Updated"],l=t.map(a=>[a.item||"",a.stock_id||"",a.opening_stock||"0",a.stock_issued||"0",a.stock_issued_by||"",a.stock_balance||"0",a.stock_valuation||"0",a.last_updated?M(a.last_updated):""]);ne(s,{head:[c],body:l,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),s.save("stock_management_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(I,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Stock Management"}),e.jsx(n,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(w,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(I,{variant:"h6",gutterBottom:!0,children:"ITEM RECORDS"}),e.jsx(D,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Item ID",value:b,onChange:t=>U(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(j,{children:[e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Item ID"})}),e.jsx(o,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(E,{children:V.filter(t=>t.item_id.toLowerCase().includes(b.toLowerCase())).map((t,s)=>e.jsxs(j,{children:[e.jsx(o,{children:t.item_id}),e.jsx(o,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(v,{slug:m,action:"can_create",children:e.jsx(u,{onClick:()=>A(t.item_id),color:"primary",children:e.jsx(ae,{sx:{color:"#7267ef"}})})})})]},s))})]})]})})}),e.jsx(n,{container:!0,spacing:2,children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(w,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsxs(n,{container:!0,justifyContent:"space-between",alignItems:"center",children:[e.jsx(n,{item:!0,children:e.jsx(I,{variant:"h6",gutterBottom:!0,sx:{color:"#7267ef"},children:"SUBMITTED STOCKS"})}),e.jsx(n,{item:!0,children:e.jsx(u,{onClick:()=>H(C),sx:{color:"#7267ef"},title:"Download Report",children:e.jsx(se,{})})})]}),e.jsx("input",{type:"text",placeholder:"Search Stock Management",value:y,onChange:t=>O(t.target.value),className:"input",style:{width:"100%",padding:"8px",marginBottom:"1rem",border:"1px solid #ccc",borderRadius:4}}),e.jsx(re,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(T,{stickyHeader:!0,children:[e.jsx(F,{children:e.jsxs(j,{children:[e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Item ID"})}),e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock ID"})}),e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Opening Stock"})}),e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock Issued"})}),e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock Issued By"})}),e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock Balance"})}),e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Stock Valuation"})}),e.jsx(o,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Last Updated"})}),e.jsx(o,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(E,{children:C.map((t,s)=>e.jsxs(j,{children:[e.jsx(o,{children:t.item})," ",e.jsx(o,{children:t.stock_id})," ",e.jsx(o,{children:t.opening_stock}),e.jsx(o,{children:t.stock_issued}),e.jsx(o,{children:t.stock_issued_by}),e.jsx(o,{children:t.stock_balance}),e.jsx(o,{children:t.stock_valuation}),e.jsx(o,{children:M(t.last_updated)}),e.jsxs(o,{children:[e.jsx(B,{slug:m,action:"can_update",children:e.jsx(u,{color:"warning",onClick:()=>P(t),children:e.jsx(ce,{sx:{color:"orange"}})})}),e.jsx(v,{slug:m,action:"can_delete",children:e.jsx(u,{color:"error",onClick:()=>G(t.stock_id),children:e.jsx(le,{sx:{color:"red"}})})})]})]},s))})]})})]})})}),e.jsxs(ie,{open:$,onClose:p,fullWidth:!0,maxWidth:"xl",PaperProps:{style:f?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(de,{children:"Enter Stock Management Details"}),e.jsxs(xe,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(u,{"aria-label":"toggle-size",onClick:Y,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:f?e.jsx(he,{}):e.jsx(me,{})}),e.jsx(u,{"aria-label":"close",onClick:p,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(J,{})}),e.jsx(D,{component:"form",sx:{mt:2},children:e.jsxs(n,{container:!0,spacing:3,direction:"column",children:[e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Stock Id's Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"itemId",children:"Item ID"}),e.jsx("input",{id:"itemId",name:"itemId",className:"input",value:r.itemId||"",disabled:!0})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockManagementId",children:"Stock Id"}),e.jsx("input",{id:"stockManagementId",name:"stockManagementId",className:"input",value:r.stockManagementId||"",disabled:!0})]})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Stock Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"openingStock",children:"Opening Stock"}),e.jsx("input",{id:"openingStock",name:"openingStock",className:"input",value:r.openingStock||"",onChange:x,type:"number"})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockIssued",children:"Stock Issued"}),e.jsx("input",{type:"number",id:"stockIssued",name:"stockIssued",className:"input",value:r.stockIssued||"",onChange:x})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockIssuedBy",children:"Stock Issued By"}),e.jsx("input",{id:"stockIssuedBy",name:"stockIssuedBy",className:"input",value:r.stockIssuedBy||"",onChange:x})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Stock Balance and Valuations"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockBalance",children:"Stock Balance"}),e.jsx("input",{id:"stockBalance",name:"stockBalance",className:"input",value:r.stockBalance||"",onChange:x,readOnly:!0})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"stockValuation",children:"Stock Valuation"}),e.jsx("input",{id:"stockValuation",name:"stockValuation",className:"input",value:r.stockValuation||"",onChange:x})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"lastUpdated",children:"Last Updated "}),e.jsx("input",{type:"date",id:"lastUpdated",name:"lastUpdated",className:"input",value:r.lastUpdated||"",onChange:x})]})]})]})})]}),e.jsxs(ue,{children:[e.jsx(N,{onClick:p,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(B,{slug:m,action:d?"can_update":"can_create",children:e.jsx(N,{variant:"outlined",onClick:W,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:"Submit"})})]})]})]})};export{Be as default};
