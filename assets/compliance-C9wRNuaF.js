import{r as c,j as e,T as C,z as k}from"./main-IxGEKZMA.js";import{C as J}from"./Close-DoqWsXz3.js";import{g as U}from"./engineering-BuN6Pdrr.js";import{h as V,i as W,j as q,k as K}from"./commision-C73dLlpE.js";import{G as i}from"./Grid-C72N-tAO.js";import{t as w,T as P,h as T,i as h,j as s,k as B,I as m,D as X,f as Z,g as ee,e as F}from"./TableRow-CRAT5KT_.js";import{A as te}from"./AddCircle-DWIRGPUh.js";import{T as se}from"./TableContainer-BaU58JEj.js";import{E as ie}from"./Edit-g2hjeeYC.js";import{D as ne}from"./Delete-cHl_EB0l.js";import{D as re}from"./DialogActions-D5wP0Mt-.js";import"./Transition-C29ZPDdz.js";const Ce=()=>{const[y,L]=c.useState(""),[D,A]=c.useState(""),[R,u]=c.useState(!1),[I,j]=c.useState(""),[n,d]=c.useState({}),[b,$]=c.useState([]),[f,p]=c.useState(!1),[oe,_]=c.useState(null),[O,M]=c.useState([]),[v,S]=c.useState(null);c.useEffect(()=>{(async()=>{try{const r=await U();M(r)}catch(r){console.error("❌ Error fetching projects:",r)}})()},[]),c.useEffect(()=>{g()},[]);const g=async()=>{try{const t=await V();$(t)}catch(t){console.error("❌ Error fetching compliance:",t)}},H=t=>{j(t);const r=new Date().getFullYear(),l=(b.length+1).toString().padStart(4,"0");d({complianceprocessID:`CMP-${r}-${l}`,projectId:t}),p(!1),_(null),u(!0)},G=t=>{d({complianceprocessID:t.compliance_id,regulatoryBody:t.regulatory_body,inspectionDate:t.inspection_date,inspectorName:t.inspector_name,checkListID:t.compliance_checklist_id,complianceStatus:t.compliance_status,issues:t.non_compliance_issues,actionplan:t.corrective_action_plan,certificationID:t.certification_id,expiryDate:t.certification_expiry_date}),j(t.project),S(t.compliance_id),p(!0),u(!0)},Q=async t=>{if(window.confirm("⚠️ Are you sure you want to delete this compliance?"))try{await W(t),alert(`🗑️ Compliance ${t} deleted successfully`),g()}catch(o){console.error("❌ Error deleting compliance:",o),alert("Error while deleting compliance. Please try again.")}},x=()=>{u(!1),d({}),p(!1),_(null)},a=t=>{const{name:r,value:o}=t.target;d(l=>({...l,[r]:o}))},Y=async t=>{t.preventDefault();const r={project:I,regulatory_body:n.regulatoryBody||"",inspection_date:n.inspectionDate||"",inspector_name:n.inspectorName||"",compliance_checklist_id:n.checkListID||"",compliance_status:n.complianceStatus||"",non_compliance_issues:n.issues||"",corrective_action_plan:n.actionplan||"",certification_id:n.certificationID||"",certification_expiry_date:n.expiryDate||""};try{let o;f&&v?(o=await q(v,r),alert(`✅ Compliance updated successfully. Compliance ID: ${o.data.compliance_id}`)):(o=await K(r),alert(`✅ Compliance submitted successfully. Compliance ID: ${o.data.compliance_id}`)),g(),d({complianceprocessID:"",regulatoryBody:"",inspectionDate:"",inspectorName:"",checkListID:"",complianceStatus:"",issues:"",actionplan:"",certificationID:"",expiryDate:""}),j(""),S(null),p(!1),x()}catch(o){if(console.error("❌ Error saving compliance:",o),o.response&&o.response.data){const l=o.response.data;if(typeof l=="object"){let E=[];for(let N in l)E.push(`${N}: ${l[N]}`);alert(`❌ Validation Errors:
`+E.join(`
`))}else alert(`❌ Error: ${l}`)}else alert("❌ Error while saving compliance. Please try again.")}},z=b.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(D.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Compliance & Certification"}),e.jsx(i,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(w,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(C,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(k,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:y,onChange:t=>L(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(P,{children:[e.jsx(T,{children:e.jsxs(h,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(B,{children:O.filter(t=>t.project_id.toLowerCase().includes(y.toLowerCase())).map((t,r)=>e.jsxs(h,{children:[e.jsx(s,{children:t.project_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(m,{onClick:()=>H(t.project_id),color:"primary",children:e.jsx(te,{sx:{color:"#7267ef"}})})})]},r))})]})]})})}),e.jsx(i,{container:!0,spacing:2,children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(w,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(C,{variant:"h6",gutterBottom:!0,children:"COMPLIANCE & CERTIFICATION DETAILS"}),e.jsx("input",{type:"text",placeholder:"Search Compliance & Certification",value:D,onChange:t=>A(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(se,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(P,{stickyHeader:!0,children:[e.jsx(T,{children:e.jsxs(h,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance Process ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Regulatory Body"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspector Name"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance Checklist ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance Status"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Non-Compliance Issues"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Corrective Action Plan"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Certification ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Certification Expiry Date"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(B,{children:z.map((t,r)=>e.jsxs(h,{children:[e.jsx(s,{children:t.project}),e.jsx(s,{children:t.compliance_id}),e.jsx(s,{children:t.regulatory_body}),e.jsx(s,{children:t.inspection_date}),e.jsx(s,{children:t.inspector_name}),e.jsx(s,{children:t.compliance_checklist_id}),e.jsx(s,{children:t.compliance_status}),e.jsx(s,{children:t.non_compliance_issues}),e.jsx(s,{children:t.corrective_action_plan}),e.jsx(s,{children:t.certification_id}),e.jsx(s,{children:t.certification_expiry_date}),e.jsxs(s,{children:[e.jsx(m,{onClick:()=>G(t),color:"warning",children:e.jsx(ie,{sx:{color:"orange"}})}),e.jsx(m,{onClick:()=>Q(t.compliance_id),color:"error",children:e.jsx(ne,{sx:{color:"red"}})})]})]},r))})]})})]})})}),e.jsxs(X,{open:R,onClose:x,fullWidth:!0,children:[e.jsx(Z,{children:f?"Edit Compliance Details":"Enter Compliance Details"}),e.jsxs(ee,{sx:{position:"relative"},children:[e.jsx(m,{"aria-label":"close",onClick:x,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(J,{})}),e.jsx(k,{component:"form",sx:{mt:2},children:e.jsxs(i,{container:!0,spacing:3,direction:"column",children:[e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:I,disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"complianceprocessID",children:"Compliance ID"}),e.jsx("input",{id:"complianceprocessID",className:"input",value:n.complianceprocessID||"",disabled:!0})]})]})]}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Compliance & Certification Infor.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"regulatoryBody",children:"Regulatory Body"}),e.jsx("input",{id:"regulatoryBody",name:"regulatoryBody",className:"input",value:n.regulatoryBody||"",onChange:a})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionDate",children:"Inspection Date"}),e.jsx("input",{type:"date",id:"inspectionDate",name:"inspectionDate",className:"input",value:n.inspectionDate||"",onChange:a})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectorName",children:"Inspector Name"}),e.jsx("input",{id:"inspectorName",name:"inspectorName",className:"input",value:n.inspectorName||"",onChange:a})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"checkListID",children:"Compliance CheckList ID"}),e.jsx("input",{id:"checkListID",name:"checkListID",className:"input",value:n.checkListID||"",onChange:a})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"complianceStatus",children:"Compliance Status"}),e.jsxs("select",{id:"complianceStatus",name:"complianceStatus",className:"input",value:n.complianceStatus||"",onChange:a,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Compliant",children:"Compliant"}),e.jsx("option",{value:"Pending",children:"Pending"})]})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"issues",children:"Non-Compliant Issues"}),e.jsx("input",{id:"issues",name:"issues",className:"input",value:n.issues||"",onChange:a})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"actionplan",children:"Corrective Action Plan"}),e.jsx("input",{id:"actionplan",name:"actionplan",className:"input",value:n.actionplan||"",onChange:a})]})]}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Certification ID & Expiry Date"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"certificationID",children:"Certification ID"}),e.jsx("input",{id:"certificationID",name:"certificationID",className:"input",value:n.certificationID||"",onChange:a})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"expiryDate",children:"Certification Expiry Date"}),e.jsx("input",{type:"date",id:"expiryDate",name:"expiryDate",className:"input",value:n.expiryDate||"",onChange:a})]})]})]})]})]})})]}),e.jsxs(re,{children:[e.jsx(F,{onClick:x,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(F,{variant:"outlined",onClick:Y,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:f?"Update":"Submit"})]})]})]})};export{Ce as default};
