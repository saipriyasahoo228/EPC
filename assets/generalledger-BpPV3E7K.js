import{r as c,j as e,T as $}from"./main-IxGEKZMA.js";import{E as O}from"./jspdf.plugin.autotable-BR5kQNfz.js";import{C as q}from"./Close-DoqWsXz3.js";import{g as G,u as M,c as Q,d as W}from"./account-bCc6eR-k.js";import{e as m,D as Y,f as H,I as y,g as z,t as J,T as K,h as U,i as N,j as n,k as V}from"./TableRow-CRAT5KT_.js";import{G as o}from"./Grid-C72N-tAO.js";import{D as X}from"./DialogActions-D5wP0Mt-.js";import{E as Z}from"./Edit-g2hjeeYC.js";import{D as ee}from"./Delete-cHl_EB0l.js";import{T as te}from"./TablePagination-DkVFCvhA.js";import"./Transition-C29ZPDdz.js";import"./dividerClasses-DK6Syutt.js";import"./KeyboardArrowRight-Y-VTRWJY.js";import"./Select-CDJTZGaT.js";const je=()=>{const[i,D]=c.useState([]),[_,v]=c.useState(!1),[C,S]=c.useState(""),[L,h]=c.useState(!1),[j,g]=c.useState(null),[b,A]=c.useState(0),[d,T]=c.useState(5),[a,u]=c.useState({ledgerId:"",transactionDate:"",accountName:"",accountType:"",debitAmount:"",creditAmount:"",balance:0,description:"",referenceNumber:"",approvalStatus:""}),f=async()=>{try{const t=await G();D(t)}catch(t){console.error("❌ Failed to fetch ledgers",t)}};c.useEffect(()=>{f()},[]);const E=()=>{const t=new Date().getFullYear(),s=(i.length+1).toString().padStart(3,"0");u({ledgerId:`LED-${t}-${s}`,transactionDate:"",accountName:"",accountType:"",debitAmount:"",creditAmount:"",balance:0,description:"",referenceNumber:"",approvalStatus:"Pending"}),v(!1),g(null),h(!0)},p=()=>h(!1),P=t=>{u({ledgerId:t.ledger_id||"",transactionDate:t.transaction_date||"",accountName:t.account_name||"",accountType:t.account_type||"",debitAmount:t.debit_amount||"",creditAmount:t.credit_amount||"",balance:t.balance||0,description:t.description||"",referenceNumber:t.reference_number||"",approvalStatus:t.approval_status||"Pending"}),g(t.ledger_id),v(!0),h(!0)},l=t=>{const{name:r,value:s}=t.target;u(x=>({...x,[r]:s,balance:r==="debitAmount"||r==="creditAmount"?Number(x.debitAmount||0)-Number(x.creditAmount||0)+(r==="debitAmount"?Number(s):0)-(r==="creditAmount"?Number(s):0):x.balance}))},w=async()=>{try{const t={transaction_date:a.transactionDate,account_name:a.accountName,account_type:a.accountType,debit_amount:parseFloat(a.debitAmount)||0,credit_amount:parseFloat(a.creditAmount)||0,description:a.description,reference_number:a.referenceNumber,approval_status:a.approvalStatus};j?(await M(j,t),alert(`✅ Ledger ${j} updated successfully!`)):(await Q(t),alert("✅ Ledger entry created successfully!")),u({transactionDate:"",accountName:"",accountType:"",debitAmount:"",creditAmount:"",balance:0,description:"",referenceNumber:"",approvalStatus:"Pending"}),g(null),p(),f()}catch(t){console.error("❌ Error saving ledger:",t),alert("❌ Failed to save ledger entry")}},I=async t=>{if(window.confirm(`Are you sure you want to delete Ledger ID: ${t}?`))try{await W(t),alert(`✅ Ledger ${t} deleted`),f()}catch{alert(`❌ Failed to delete Ledger ${t}`)}},R=i.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(C.toLowerCase()))),k=(t,r)=>A(r),F=t=>{T(parseInt(t.target.value,10)),A(0)},B=()=>{const t=new O,r=R.map(s=>[s.ledger_id,s.transaction_date,s.account_name,s.account_type,s.debit_amount,s.credit_amount,s.balance,s.reference_number,s.approval_status]);t.autoTable({head:[["Ledger ID","Date","Account","Type","Debit","Credit","Balance","Ref No","Status"]],body:r}),t.save("ledger_report.pdf")};return e.jsxs("div",{children:[e.jsx(m,{variant:"contained",sx:{mt:4,mb:2,backgroundColor:"#7267ef"},onClick:E,children:"Add Ledger Entry"}),e.jsxs(Y,{open:L,onClose:p,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(H,{sx:{backgroundColor:"#f3f3f3",color:"#7267ef",display:"flex",justifyContent:"space-between"},children:[_?"Edit Ledger Entry":"Add Ledger Entry",e.jsx(y,{onClick:p,sx:{color:"#7267ef"},children:e.jsx(q,{})})]}),e.jsx(z,{children:e.jsxs(o,{container:!0,spacing:2,direction:"column",sx:{mt:1},children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"ledgerId",children:"Ledger ID"}),e.jsx("input",{id:"ledgerId",name:"ledgerId",className:"input",value:a.ledgerId||"",readOnly:!0})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Transaction Date"}),e.jsx("input",{className:"input",type:"date",name:"transactionDate",value:a.transactionDate,onChange:l})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Account Name"}),e.jsx("input",{className:"input",name:"accountName",value:a.accountName,onChange:l,placeholder:"e.g., Revenue"})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Account Type"}),e.jsxs("select",{className:"input",name:"accountType",value:a.accountType,onChange:l,children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"Assets",children:"Assets"}),e.jsx("option",{value:"Liabilities",children:"Liabilities"}),e.jsx("option",{value:"Equity",children:"Equity"}),e.jsx("option",{value:"Revenue",children:"Revenue"}),e.jsx("option",{value:"Expenses",children:"Expenses"})]})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Debit Amount"}),e.jsx("input",{className:"input",name:"debitAmount",type:"number",value:a.debitAmount,onChange:l})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Credit Amount"}),e.jsx("input",{className:"input",name:"creditAmount",type:"number",value:a.creditAmount,onChange:l})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Description"}),e.jsx("input",{className:"input",name:"description",value:a.description,onChange:l,placeholder:"Transaction details..."})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Reference Number"}),e.jsx("input",{className:"input",name:"referenceNumber",value:a.referenceNumber,onChange:l})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Approval Status"}),e.jsxs("select",{className:"input",name:"approvalStatus",value:a.approvalStatus,onChange:l,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]})]})}),e.jsxs(X,{sx:{pr:3,pb:2},children:[e.jsx(m,{onClick:p,sx:{outline:"2px solid #800000",color:"#800000"},children:"Cancel"}),e.jsx(m,{variant:"outlined",onClick:w,sx:{borderColor:"#7267ef",color:"#7267ef"},children:"Submit"})]})]}),e.jsxs(J,{sx:{mt:4,p:2,border:"1px solid #ccc"},children:[e.jsxs(o,{container:!0,justifyContent:"space-between",alignItems:"center",children:[e.jsx(o,{item:!0,children:e.jsx($,{variant:"h6",gutterBottom:!0,sx:{color:"#7267ef"},children:"Account Ledger Report"})}),e.jsx(o,{item:!0,children:e.jsx(m,{onClick:B,sx:{backgroundColor:"#7267ef",color:"#fff",mt:2,mb:2},children:"Export PDF"})})]}),e.jsx("input",{type:"text",placeholder:"Search Ledger Entries...",value:C,onChange:t=>S(t.target.value),className:"input"}),e.jsxs(K,{children:[e.jsx(U,{children:e.jsxs(N,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:"Ledger ID"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Date"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Account"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Type"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Debit"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Credit"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Balance"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Ref No"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Status"}),e.jsx(n,{sx:{color:"#660000"},children:"Actions"})]})}),e.jsx(V,{children:i.slice(b*d,b*d+d).map((t,r)=>e.jsxs(N,{children:[e.jsx(n,{children:t.ledger_id}),e.jsx(n,{children:t.transaction_date}),e.jsx(n,{children:t.account_name}),e.jsx(n,{children:t.account_type}),e.jsx(n,{children:t.debit_amount}),e.jsx(n,{children:t.credit_amount}),e.jsx(n,{children:t.balance}),e.jsx(n,{children:t.reference_number}),e.jsx(n,{children:t.approval_status}),e.jsxs(n,{children:[e.jsx(y,{onClick:()=>P(t),children:e.jsx(Z,{sx:{color:"orange"}})}),e.jsx(y,{onClick:()=>I(t.ledger_id),children:e.jsx(ee,{sx:{color:"red"}})})]})]},r))})]}),e.jsx(te,{rowsPerPageOptions:[5,10,25],component:"div",count:i.length,rowsPerPage:d,page:b,onPageChange:k,onRowsPerPageChange:F})]})]})};export{je as default};
