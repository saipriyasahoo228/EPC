import{r as n,j as e,T as g,z as D}from"./main-IxGEKZMA.js";import{C as Q}from"./Close-DoqWsXz3.js";import{g as X}from"./engineering-BuN6Pdrr.js";import{g as K,a as V,b as Z,e as ee}from"./construction-Ca90qLEO.js";import{G as r}from"./Grid-C72N-tAO.js";import{t as v,T as E,h as k,i as h,j as s,k as P,I as p,D as te,f as se,g as re,e as T}from"./TableRow-CRAT5KT_.js";import{A as ie}from"./AddCircle-DWIRGPUh.js";import{T as oe}from"./TableContainer-BaU58JEj.js";import{E as ne}from"./Edit-g2hjeeYC.js";import{D as le}from"./Delete-cHl_EB0l.js";import{D as ae}from"./DialogActions-D5wP0Mt-.js";import"./Transition-C29ZPDdz.js";const be=()=>{const[ce,de]=n.useState(1),[F,N]=n.useState(""),[S,U]=n.useState(""),[R,m]=n.useState(!1),[C,y]=n.useState(""),[i,d]=n.useState({}),[xe,ue]=n.useState([]),[z,q]=n.useState([]),[A,O]=n.useState([]),[B,M]=n.useState([]),[I,w]=n.useState(null);n.useEffect(()=>{(async()=>{try{const o=await X();q(o)}catch(o){console.error("Error fetching projects:",o)}})()},[]);const j=async()=>{try{const t=await K();console.log("✅ Site Executions:",t),O(t),M(t)}catch(t){console.error("❌ Failed to fetch site executions:",t)}};n.useEffect(()=>{j()},[]);const W=t=>{y(t);const o=new Date().getFullYear(),u=A.filter(f=>{var a;return(a=f.site_id)==null?void 0:a.startsWith(`SIT-${o}-`)});let c=0;u.length>0&&u.forEach(f=>{var _;const a=(_=f.site_id)==null?void 0:_.split("-");if(a&&a.length===3){const b=parseInt(a[2]);b>c&&(c=b)}});const G=c+1,J=String(G).padStart(4,"0");d({siteId:`SIT-${o}-${J}`,project:t}),m(!0)},x=()=>m(!1),l=t=>{const{name:o,value:u}=t.target;d(c=>({...c,[o]:u}))},$=async()=>{try{const t={project:C,site_supervisor_id:i.siteSupervisorID,daily_progress_report_id:i.dailyProgressReportID,work_completed:i.workCompleted,manpower_utilized:i.manpowerUtilize,equipment_used:i.equipmentUsed,weather_conditions:i.wetherCondition,safety_compliance_report:i.safetyCompliance,material_consumption:i.materialConsumption,site_issues:i.siteIssues,site_execution_status:i.siteStatus||"on track"};if(I)await Z(I,t),alert("✅ Site Execution updated successfully!");else{const o=await ee(t);alert(`✅ Site Execution saved!
Site ID: ${o.site_id}`)}d({}),w(null),x(),j()}catch(t){if(console.error("❌ Failed to save site execution:",t),t.response&&t.response.data){const o=t.response.data.detail||JSON.stringify(t.response.data);alert(`❌ Error: ${o}`)}else alert("❌ An unexpected error occurred. Please try again.")}},H=async t=>{if(window.confirm(`Are you sure you want to delete this site execution with projectID: ${t}?`))try{await V(t),alert(`✅ Site execution with projectID: ${t} deleted successfully!`),j()}catch(o){console.error("❌ Failed to delete site execution:",o),alert("❌ Failed to delete site execution. Please try again.")}},L=t=>{d({siteId:t.site_id,siteSupervisorID:t.site_supervisor_id,dailyProgressReportID:t.daily_progress_report_id,workCompleted:t.work_completed,manpowerUtilize:t.manpower_utilized,equipmentUsed:t.equipment_used,wetherCondition:t.weather_conditions,safetyCompliance:t.safety_compliance_report,materialConsumption:t.material_consumption,siteIssues:t.site_issues,siteStatus:t.site_execution_status}),y(t.project),w(t.project),m(!0)},Y=z.filter(t=>Object.values(t).some(o=>o&&o.toString().toLowerCase().includes(S.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Site Management"}),e.jsx(r,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(r,{item:!0,xs:12,children:e.jsxs(v,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(g,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(D,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:F,onChange:t=>N(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(E,{children:[e.jsx(k,{children:e.jsxs(h,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(P,{children:Y.map((t,o)=>e.jsxs(h,{children:[e.jsx(s,{children:t.project_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(p,{onClick:()=>W(t.project_id),color:"primary",children:e.jsx(ie,{sx:{color:"#7267ef"}})})})]},o))})]})]})})}),e.jsx(r,{container:!0,spacing:2,children:e.jsx(r,{item:!0,xs:12,children:e.jsxs(v,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(g,{variant:"h6",gutterBottom:!0,children:"SITE EXECUTION DETAILS"}),e.jsx("input",{type:"text",placeholder:"Search Site",value:S,onChange:t=>U(t.target.value),className:"input"}),e.jsx(oe,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(E,{stickyHeader:!0,children:[e.jsx(k,{children:e.jsxs(h,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"ProjectID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Site ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Site Supervisor ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Daily Progress Report ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Work Completed"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Manpower Utilized"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Equipment Used"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Weather Conditions"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Safety Compliance Report"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Material Consumption "})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Site Issues"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Site Execution Status"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(P,{children:B.map((t,o)=>e.jsxs(h,{children:[e.jsx(s,{children:t.project}),e.jsx(s,{children:t.site_id}),e.jsx(s,{children:t.site_supervisor_id}),e.jsx(s,{children:t.daily_progress_report_id}),e.jsx(s,{children:t.work_completed}),e.jsx(s,{children:t.manpower_utilized}),e.jsx(s,{children:t.equipment_used}),e.jsx(s,{children:t.weather_conditions}),e.jsx(s,{children:t.safety_compliance_report}),e.jsx(s,{children:t.material_consumption}),e.jsx(s,{children:t.site_issues}),e.jsx(s,{children:t.site_execution_status}),e.jsxs(s,{children:[e.jsx(p,{color:"warning",children:e.jsx(ne,{sx:{color:"orange"},onClick:()=>L(t)})}),e.jsx(p,{color:"error",children:e.jsx(le,{sx:{color:"red"},onClick:()=>H(t.project)})})]})]},o))})]})})]})})}),e.jsxs(te,{open:R,onClose:x,fullWidth:!0,children:[e.jsx(se,{children:"Enter Site Execution Details"}),e.jsxs(re,{sx:{position:"relative"},children:[e.jsx(p,{"aria-label":"close",onClick:x,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(Q,{})}),e.jsx(D,{component:"form",sx:{mt:2},children:e.jsxs(r,{container:!0,spacing:3,direction:"column",children:[e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:C,disabled:!0})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"siteId",children:"Site ID"}),e.jsx("input",{id:"siteId",className:"input",value:i.siteId||"",disabled:!0})]})]})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Site Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"siteSupervisorID",children:"Site Supervisor ID"}),e.jsx("input",{id:"siteSupervisorID",name:"siteSupervisorID",className:"input",value:i.siteSupervisorID||"",onChange:l})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"dailyProgressReportID",children:"Daily Progress Report ID"}),e.jsx("input",{id:"dailyProgressReportID",name:"dailyProgressReportID",className:"input",value:i.dailyProgressReportID||"",onChange:l})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"workCompleted",children:"Work Completed"}),e.jsx("input",{id:"workCompleted",name:"workCompleted",className:"input",value:i.workCompleted||"",onChange:l})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"manpowerUtilize",children:"ManPower Utilized"}),e.jsx("input",{type:"number",id:"manpowerUtilize",name:"manpowerUtilize",className:"input",value:i.manpowerUtilize||"",onChange:l})]})]})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Weather Condition and Material Consumption"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"equipmentUsed",children:"Equipment Used"}),e.jsx("input",{id:"equipmentUsed",name:"equipmentUsed",className:"input",value:i.equipmentUsed||"",onChange:l})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"wetherCondition",children:"Wether Condition"}),e.jsx("input",{id:"wetherCondition",name:"wetherCondition",className:"input",value:i.wetherCondition||"",onChange:l})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"safetyCompliance",children:"Safety Compliance Report"}),e.jsx("input",{id:"safetyCompliance",name:"safetyCompliance",className:"input",value:i.safetyCompliance||"",onChange:l})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"materialConsumption",children:"Material Consumption"}),e.jsx("input",{id:"materialConsumption",name:"materialConsumption",className:"input",value:i.materialConsumption||"",onChange:l})]})]})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Site Issues & Status"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"siteIssues",children:"Site Issues"}),e.jsx("textarea",{id:"siteIssues",name:"siteIssues",className:"input",rows:3,value:i.siteIssues||"",onChange:l})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"siteStatus",children:"Site Execution Status"}),e.jsxs("select",{id:"siteStatus",name:"siteStatus",className:"input",value:i.siteStatus||"on track",onChange:l,children:[e.jsx("option",{value:"on track",children:"On Track"}),e.jsx("option",{value:"delayed",children:"Delayed"}),e.jsx("option",{value:"halted",children:"Halted"})]})]})]})]})]})})]}),e.jsxs(ae,{children:[e.jsx(T,{onClick:x,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(T,{variant:"outlined",onClick:$,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:"Submit"})]})]})]})};export{be as default};
