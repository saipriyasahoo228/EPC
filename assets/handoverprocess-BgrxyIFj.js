import{r as i,j as e,T as D,x as E,S as T,D as N}from"./main-BIxdd69i.js";import{C as V}from"./Close-D340Gps3.js";import{g as K}from"./engineering-4VzvUWDc.js";import{a as X,b as Z,e as ee,f as re}from"./commision-BQqrAN-2.js";import{G as n}from"./Grid-BnZNKmae.js";import{P as F,I as x,D as se,f as te,g as ne,h as oe,e as L}from"./DialogTitle-D59uELMl.js";import{T as A,a as k,b as j,c as s,d as M}from"./TableRow-D8X36zJO.js";import{A as ie}from"./AddCircle-Bn9h5MaP.js";import{T as ae}from"./TableContainer-1Xqyy-f8.js";import{E as le}from"./Edit-BJV-h6Li.js";import{D as ce}from"./Delete-BHKbKfZ2.js";import{M as de,a as xe}from"./minimize-2-Dl_U24Qm.js";const Ce=()=>{const h="commissioning",[v,R]=i.useState(!1),[_,O]=i.useState(""),[b,B]=i.useState(""),[z,g]=i.useState(!1),[S,y]=i.useState(""),[o,c]=i.useState({}),[C,I]=i.useState([]),[u,p]=i.useState(!1),[he,P]=i.useState(null),[$,Y]=i.useState([]),[f,H]=i.useState(null),G=()=>{R(!v)},U=r=>{y(r);const t=new Date().getFullYear(),d=(C.length+1).toString().padStart(3,"0");c({handoverprocessID:`HND-${t}-${d}`,projectId:r}),p(!1),P(null),g(!0)};i.useEffect(()=>{(async()=>{try{const t=await K();Y(t)}catch(t){console.error("❌ Error fetching projects:",t)}})()},[]);const w=async()=>{try{const r=await X();I(r)}catch(r){console.error("❌ Error fetching handovers:",r)}};i.useEffect(()=>{w()},[]);const Q=r=>{c({handoverprocessID:r.handover_id,handoverDate:r.handover_date,receivingDepartment:r.receiving_department,handoverDocID:r.handover_document_id,componentList:r.system_component_list,trainingprovided:r.training_provided?"true":"false",document:r.training_documentation,issues:r.pending_issues,approvalStatus:r.final_approval_status}),H(r.handover_id),y(r.project_id),p(!0),g(!0)},W=async r=>{if(window.confirm(`Are you sure you want to delete Handover ID: ${r}?`))try{await Z(r),I(a=>a.filter(d=>d.handover_id!==r)),alert(`✅ Handover ID ${r} deleted successfully!`)}catch(a){console.error("❌ Error deleting handover:",a),alert("⚠️ Failed to delete handover. Please try again.")}},m=()=>{g(!1),c({}),p(!1),P(null)},l=r=>{const{name:t,value:a}=r.target;c(d=>({...d,[t]:a}))},q=async r=>{r.preventDefault();try{if(!o.handoverDocID||!o.componentList||!o.approvalStatus){alert("⚠️ Please fill in all required fields!");return}const t={project_id:S,handover_date:o.handoverDate,receiving_department:o.receivingDepartment,handover_document_id:o.handoverDocID,system_component_list:o.componentList,training_provided:o.trainingprovided==="true",training_documentation:o.document,pending_issues:o.issues,final_approval_status:o.approvalStatus};if(u&&f){const a=await ee(f,t);alert(`✏️ Handover updated successfully! Handover ID: ${a.data.handover_id}`)}else{const a=await re(t);alert(`✅ Handover submitted successfully! Handover ID: ${a.data.handover_id}`)}w(),c({handoverprocessID:"",handoverDate:"",receivingDepartment:"",handoverDocID:"",componentList:"",trainingprovided:"",document:"",issues:"",approvalStatus:""}),p(!1),H(null),m()}catch(t){console.error("❌ Submission error:",t),alert("⚠️ Submission failed! Please check your input.")}},J=C.filter(r=>Object.values(r).some(t=>t&&t.toString().toLowerCase().includes(b.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(D,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Handover Process"}),e.jsx(n,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(F,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(D,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(E,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:_,onChange:r=>O(r.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(A,{children:[e.jsx(k,{children:e.jsxs(j,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(M,{children:$.filter(r=>{var t;return(t=r.id)==null?void 0:t.toString().toLowerCase().includes(_.toLowerCase())}).map((r,t)=>e.jsxs(j,{children:[e.jsx(s,{children:r.project_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(T,{slug:h,action:"can_create",children:e.jsx(x,{onClick:()=>U(r.project_id),color:"primary",children:e.jsx(ie,{sx:{color:"#7267ef"}})})})})]},t))})]})]})})}),e.jsx(n,{container:!0,spacing:2,children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(F,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(D,{variant:"h6",gutterBottom:!0,children:"HANDOVER PROCESS DETAILS"}),e.jsx("input",{type:"text",placeholder:"Search Handover Process",value:b,onChange:r=>B(r.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(ae,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(A,{stickyHeader:!0,children:[e.jsx(k,{children:e.jsxs(j,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Handover ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Handover Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Receiving Department"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Handover Document ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"System/Component List"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Training Provided"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Training Documentation"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Pending Issues"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Final Approval"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(M,{children:J.map((r,t)=>e.jsxs(j,{children:[e.jsx(s,{children:r.project_id}),e.jsx(s,{children:r.handover_id}),e.jsx(s,{children:r.handover_date}),e.jsx(s,{children:r.receiving_department}),e.jsx(s,{children:r.handover_document_id}),e.jsx(s,{children:r.system_component_list}),e.jsx(s,{children:r.training_provided===!0?"YES":r.training_provided===!1?"NO":"-"}),e.jsx(s,{children:r.training_documentation}),e.jsx(s,{children:r.pending_issues}),e.jsx(s,{children:r.final_approval_status}),e.jsxs(s,{children:[e.jsx(N,{slug:h,action:"can_update",children:e.jsx(x,{onClick:()=>Q(r),color:"warning",children:e.jsx(le,{sx:{color:"orange"}})})}),e.jsx(T,{slug:h,action:"can_delete",children:e.jsx(x,{onClick:()=>W(r.handover_id),color:"error",children:e.jsx(ce,{sx:{color:"red"}})})})]})]},t))})]})})]})})}),e.jsxs(se,{open:z,onClose:m,fullWidth:!0,maxWidth:"xl",PaperProps:{style:v?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(te,{children:u?"Edit Handover Process":"Enter Handover Process Details"}),e.jsxs(ne,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(x,{"aria-label":"toggle-size",onClick:G,sx:{position:"absolute",right:40,top:8,color:r=>r.palette.grey[600]},children:v?e.jsx(de,{}):e.jsx(xe,{})}),e.jsx(x,{"aria-label":"close",onClick:m,sx:{position:"absolute",right:8,top:8,color:r=>r.palette.grey[500]},children:e.jsx(V,{})}),e.jsx(E,{component:"form",sx:{mt:2},children:e.jsxs(n,{container:!0,spacing:3,direction:"column",children:[e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:S||"",disabled:!0})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"handoverprocessID",children:"Handover ID"}),e.jsx("input",{id:"handoverprocessID",className:"input",value:o.handoverprocessID||"",disabled:!0})]})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Handover Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"handoverDate",children:"Handover Date"}),e.jsx("input",{type:"date",id:"handoverDate",name:"handoverDate",className:"input",value:o.handoverDate||"",onChange:l})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"receivingDepartment",children:"Recieving Department"}),e.jsx("input",{id:"receivingDepartment",name:"receivingDepartment",className:"input",value:o.receivingDepartment||"",onChange:l})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"handoverDocID",children:"Handover DocumentID"}),e.jsx("input",{id:"handoverDocID",name:"handoverDocID",className:"input",value:o.handoverDocID||"",onChange:l})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"componentList",children:"System/Component List"}),e.jsx("input",{id:"componentList",name:"componentList",className:"input",value:o.componentList||"",onChange:l})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"trainingprovided",children:"Training Provided"}),e.jsxs("select",{id:"trainingprovided",name:"trainingprovided",className:"input",value:o.trainingprovided||"",onChange:l,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"true",children:"YES"}),e.jsx("option",{value:"false",children:"NO"})]})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"document",children:"Training Documentation"}),e.jsx("input",{id:"document",name:"document",className:"input",value:o.document||"",onChange:l})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Pending Issues & Final Status"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"issues",children:"Pending Issues"}),e.jsx("input",{id:"issues",name:"issues",className:"input",value:o.issues||"",onChange:l})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:o.approvalStatus||"",onChange:l,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Conditional",children:"Conditional"}),e.jsx("option",{value:"Pending",children:"Pending"})]})]})]})]})]})]})})]}),e.jsxs(oe,{children:[e.jsx(L,{onClick:m,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(N,{slug:h,action:u&&f?"can_update":"can_create",children:e.jsx(L,{variant:"outlined",onClick:q,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:u?"Update":"Submit"})})]})]})]})};export{Ce as default};
