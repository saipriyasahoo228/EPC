import{r as s,j as e,T as g,z as b}from"./main-IxGEKZMA.js";import{C as Q}from"./Close-DoqWsXz3.js";import{g as z}from"./engineering-BuN6Pdrr.js";import{l as J,m as U,n as V,o as W}from"./commision-C73dLlpE.js";import{G as o}from"./Grid-C72N-tAO.js";import{t as S,T as D,h as v,i as m,j as n,k,I as x,D as q,f as K,g as X,e as R}from"./TableRow-CRAT5KT_.js";import{A as Z}from"./AddCircle-DWIRGPUh.js";import{T as ee}from"./TableContainer-BaU58JEj.js";import{E as te}from"./Edit-g2hjeeYC.js";import{D as re}from"./Delete-cHl_EB0l.js";import{D as ne}from"./DialogActions-D5wP0Mt-.js";import"./Transition-C29ZPDdz.js";const je=()=>{const[y,w]=s.useState(""),[C,T]=s.useState(""),[E,l]=s.useState(!1),[I,F]=s.useState(""),[_,P]=s.useState([]),[N,L]=s.useState(!1),[oe,A]=s.useState(null),[B,O]=s.useState([]),[h,f]=s.useState(null),[i,c]=s.useState({finalReportId:"",project:"",regulatory_body:"",inspection_date:"",inspector_name:"",compliance_checklist_id:"",compliance_status:"",non_compliance_issues:"",corrective_action:""});s.useEffect(()=>{(async()=>{try{const r=await z();O(r)}catch(r){console.error("❌ Error fetching projects:",r)}})()},[]),s.useEffect(()=>{d()},[]);const d=async()=>{try{const t=await J();P(t)}catch(t){console.error("❌ Error fetching reports:",t)}},H=t=>{F(t);const r=new Date().getFullYear(),j=(_.length+1).toString().padStart(4,"0");c({systemmanagementID:`FIN-${r}-${j}`,projectId:t}),f(null),l(!0)},M=async t=>{if(window.confirm("Are you sure you want to delete this report?"))try{await U(t),await d(),alert("Report deleted successfully!")}catch(r){console.error("❌ Error deleting report:",r),alert("Failed to delete report. Please try again.")}},u=()=>{l(!1),c({}),L(!1),A(null)},p=t=>{const{name:r,value:a}=t.target;c(j=>({...j,[r]:a}))},$=t=>{c({systemmanagementID:t.final_report_id,projectId:t.project_id,testingInfo:t.summary_of_testing,defectRectification:t.defect_rectification_report,handoverConfirmation:t.handover_confirmation,complianceConfirmation:t.compliance_confirmation,documentLink:t.archival_document_link}),f(t.final_report_id),l(!0)},G=async t=>{t.preventDefault();const r={project_id:I,summary_of_testing:i.testingInfo||"",defect_rectification_report:i.defectRectification||"",handover_confirmation:i.handoverConfirmation||!1,compliance_confirmation:i.complianceConfirmation||!1,archival_document_link:i.documentLink||""};try{if(h){const a=await V(h,r);await d(),c({}),f(null),l(!1),alert(`System Integration Report updated successfully!
Final Report ID: ${a.data.final_report_id}`)}else{const a=await W(r);await d(),c({}),l(!1),alert(`System Integration Report submitted successfully!
Final Report ID: ${a.data.final_report_id}`)}}catch(a){console.error("❌ Error submitting system integration:",a),alert("Failed to submit System Integration Report. Please try again.")}},Y=_.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(C.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"System Integration & Certification"}),e.jsx(o,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(o,{item:!0,xs:12,children:e.jsxs(S,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(g,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(b,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:y,onChange:t=>w(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(D,{children:[e.jsx(v,{children:e.jsxs(m,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(k,{children:B.filter(t=>{var r;return(r=t.project_id)==null?void 0:r.toLowerCase().includes(y.toLowerCase())}).map((t,r)=>e.jsxs(m,{children:[e.jsx(n,{children:t.project_id}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(x,{onClick:()=>H(t.project_id),color:"primary",children:e.jsx(Z,{sx:{color:"#7267ef"}})})})]},r))})]})]})})}),e.jsx(o,{container:!0,spacing:2,children:e.jsx(o,{item:!0,xs:12,children:e.jsxs(S,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(g,{variant:"h6",gutterBottom:!0,children:"SYSTEM INTEGRATION & CERTIFICATION DETAILS"}),e.jsx("input",{type:"text",placeholder:"Search System integration & certification",value:C,onChange:t=>T(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(ee,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(D,{stickyHeader:!0,children:[e.jsx(v,{children:e.jsxs(m,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Final Report ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Testing & Inspection"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Defect Rectification Report"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Handover Confirmation"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance Confirmation"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Archival Document Link"})}),e.jsx(n,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(k,{children:Y.map((t,r)=>e.jsxs(m,{children:[e.jsx(n,{children:t.project_id}),e.jsx(n,{children:t.final_report_id}),e.jsx(n,{children:t.summary_of_testing}),e.jsx(n,{children:t.defect_rectification_report}),e.jsx(n,{children:t.handover_confirmation?"✅":"❌"}),e.jsx(n,{children:t.compliance_confirmation?"✅":"❌"}),e.jsx(n,{children:t.archival_document_link?e.jsx("a",{href:t.archival_document_link,target:"_blank",rel:"noreferrer",children:"View Doc"}):"-"}),e.jsxs(n,{children:[e.jsx(x,{onClick:()=>$(t),color:"warning",children:e.jsx(te,{sx:{color:"orange"}})}),e.jsx(x,{onClick:()=>M(t.final_report_id),color:"error",children:e.jsx(re,{sx:{color:"red"}})})]})]},r))})]})})]})})}),e.jsxs(q,{open:E,onClose:u,fullWidth:!0,children:[e.jsx(K,{children:N?"Edit System Integration Details":"Enter System Integration Details"}),e.jsxs(X,{sx:{position:"relative"},children:[e.jsx(x,{"aria-label":"close",onClick:u,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(Q,{})}),e.jsx(b,{component:"form",sx:{mt:2},children:e.jsxs(o,{container:!0,spacing:3,direction:"column",children:[e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:I,disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"systemmanagementID",children:"Final Report ID"}),e.jsx("input",{id:"systemmanagementID",className:"input",value:i.systemmanagementID||"",disabled:!0})]})]})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Summary of Testing"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"testingInfo",children:"Testing Info"}),e.jsx("input",{id:"testingInfo",name:"testingInfo",className:"input",value:i.testingInfo||"",onChange:p})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"defectRectification",children:"Defect Rectification"}),e.jsx("input",{id:"defectRectification",name:"defectRectification",className:"input",value:i.defectRectification||"",onChange:p})]}),e.jsx(o,{item:!0,xs:6,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"handoverConfirmation",checked:i.handoverConfirmation||!1,onChange:t=>c({...i,handoverConfirmation:t.target.checked})})," Handover Confirmation"]})}),e.jsx(o,{item:!0,xs:6,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"complianceConfirmation",checked:i.complianceConfirmation||!1,onChange:t=>c({...i,complianceConfirmation:t.target.checked})})," Compliance Confirmation"]})})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Document Info.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsx(o,{container:!0,spacing:2,children:e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"documentLink",children:"Document Link"}),e.jsx("input",{id:"documentLink",name:"documentLink",className:"input",value:i.documentLink||"",onChange:p})]})})]})]})]})})]}),e.jsxs(ne,{children:[e.jsx(R,{onClick:u,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(R,{variant:"outlined",onClick:G,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:h?"Update":"Submit"})]})]})]})};export{je as default};
