import{r as l,j as e,S as D,I as v,K as R,J as G,T as O}from"./main-Skim5IJC.js";import{E as L,a as W}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{C as z}from"./Close-BKZ7QrSY.js";import{D as M}from"./Download-C4sxsXoP.js";import{m as Q,n as U,o as H,p as J}from"./account-CQ2dqr_G.js";import{f as _}from"./date-DdrLtg20.js";import{B as m,D as K,a as q,b as V,c as X}from"./DialogTitle-CvDFHAwp.js";import{G as n}from"./Grid-fY_ATwTx.js";import{T as Z}from"./Select-BThNtn2k.js";import{T as ee,a as te,b as w,c as a,d as re}from"./TableRow-B6k_bSOs.js";import{E as ae}from"./Edit-6vcT2Cu4.js";import{D as oe}from"./Delete-Be1vvbhC.js";import{T as ne}from"./TablePagination-_dHW1U1A.js";import"./index-Pp9EW3wT.js";import"./useSlotProps-CCL6Y0ZK.js";import"./useFormControl-C6hS7-Rn.js";import"./useControlled-CHkDrNg3.js";import"./KeyboardArrowRight-BzCb_W4p.js";import"./MenuItem-Cm5ZuES4.js";import"./Toolbar-Dufg8Txv.js";const _e=()=>{const p="account_ledger",[C,T]=l.useState(""),[P,j]=l.useState(!1),[d,b]=l.useState(null),[S,F]=l.useState([]),[o,u]=l.useState({reportType:"",generatedDate:"",preparedBy:"",approvalStatus:"",comments:""}),[f,I]=l.useState(0),[x,E]=l.useState(5),g=async()=>{try{const t=await Q();F(t)}catch(t){console.error("Error fetching reports:",t)}};l.useEffect(()=>{g()},[]);const B=(t=null)=>{b(t),j(!0),u(t?{...t}:{reportType:"",generatedDate:"",preparedBy:"",approvalStatus:"",comments:""})},h=()=>j(!1),A=t=>{b(t),u({reportId:t.report_id||"",reportType:t.report_type||"",generatedDate:t.generated_date||"",preparedBy:t.prepared_by||"",approvalStatus:t.approval_status||"",comments:t.comments||""}),j(!0)},c=t=>{const{name:r,value:i}=t.target;u(s=>({...s,[r]:i}))},k=()=>{const t=new Date().getFullYear(),r=S.length+1;return`REP-${t}-${String(r).padStart(4,"0")}`},N=async()=>{try{const t={report_type:o.reportType,generated_date:o.generatedDate,prepared_by:o.preparedBy,approval_status:o.approvalStatus,comments:o.comments};if(d){const r=await U(d.report_id,t);alert(`Report ${r.report_id} updated successfully`)}else{const r=await H(t);alert(`Report ${r.report_id} created successfully`)}h(),g()}catch(t){console.error("Error saving financial report:",t),alert("Something went wrong while saving the financial report")}},Y=async t=>{if(window.confirm(`Are you sure you want to delete Financial Report: ${t}?`))try{await J(t),g(),alert(`Report ${t} deleted successfully`)}catch(i){console.error("Error deleting report:",i),alert("Failed to delete report")}},y=S.filter(t=>Object.values(t).some(r=>r.toString().toLowerCase().includes(C.toLowerCase()))),$=()=>{const t=new L("l","mm","a4");t.setFontSize(16),t.text("All Financial Reports",14,15);const r=["Report ID","Report Type","Generated Date","Prepared By","Approval Status","Comments"],i=y.map(s=>[s.report_id,s.report_type,_(s.generated_date),s.prepared_by,s.approval_status,s.comments]);W(t,{head:[r],body:i,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),t.save("all_financial_reports.pdf")};return e.jsxs("div",{children:[e.jsx(D,{slug:p,action:"can_create",children:e.jsx(m,{variant:"contained",sx:{mt:4,mb:2,backgroundColor:"#7267ef"},onClick:()=>B(),children:"Add Financial Report"})}),e.jsxs(K,{open:P,onClose:h,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(q,{sx:{backgroundColor:"#f3f3f3",color:"#7267ef",display:"flex",justifyContent:"space-between"},children:[d?"Edit Financial Report":"Add Financial Report",e.jsx(v,{onClick:h,sx:{color:"#7267ef"},children:e.jsx(z,{})})]}),e.jsx(V,{children:e.jsxs(n,{container:!0,spacing:2,direction:"column",sx:{mt:1},children:[e.jsxs(n,{item:!0,xs:12,children:[e.jsx("label",{children:"Report ID (Auto)"}),e.jsx("input",{className:"input",disabled:!0,value:o.reportId||k()})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("label",{children:"Report Type"}),e.jsxs("select",{className:"input",name:"reportType",value:o.reportType,onChange:c,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Balance Sheet",children:"Balance Sheet"}),e.jsx("option",{value:"Income Statement",children:"Income Statement"}),e.jsx("option",{value:"Cash Flow Statement",children:"Cash Flow Statement"})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("label",{children:"Generated Date"}),e.jsx("input",{type:"date",className:"input",name:"generatedDate",value:o.generatedDate,onChange:c})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("label",{children:"Prepared By"}),e.jsx("input",{className:"input",name:"preparedBy",value:o.preparedBy,onChange:c})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("label",{children:"Approval Status"}),e.jsxs("select",{className:"input",name:"approvalStatus",value:o.approvalStatus,onChange:c,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("label",{children:"Comments"}),e.jsx(Z,{name:"comments",value:o.comments,onChange:c,className:"input",minRows:3,placeholder:"Enter comments here..."})]})]})}),e.jsxs(X,{sx:{pr:3,pb:2},children:[e.jsx(m,{onClick:h,sx:{outline:"2px solid #800000",color:"#800000"},children:"Cancel"}),e.jsx(R,{slug:p,action:d?"can_update":"can_create",children:e.jsx(m,{variant:"outlined",onClick:N,sx:{borderColor:"#7267ef",color:"#7267ef"},children:"Submit"})})]})]}),e.jsxs(G,{sx:{mt:4,p:2,border:"1px solid #ccc"},children:[e.jsxs(n,{container:!0,justifyContent:"space-between",alignItems:"center",children:[e.jsx(n,{item:!0,children:e.jsx(O,{variant:"h6",gutterBottom:!0,sx:{color:"#7267ef"},children:"Financial Reports"})}),e.jsx(n,{item:!0,children:e.jsx(m,{startIcon:e.jsx(M,{}),onClick:$,sx:{backgroundColor:"#7267ef",color:"#fff",mt:2,mb:2},children:"Export PDF"})})]}),e.jsx("input",{type:"text",placeholder:"Search Reports...",value:C,onChange:t=>T(t.target.value),className:"input"}),e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs(w,{children:[e.jsx(a,{sx:{color:"#7267ef"},children:"ID"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Type"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Date"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Prepared By"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Status"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Comments"}),e.jsx(a,{sx:{color:"#660000"},children:"Actions"})]})}),e.jsx(re,{children:y.slice(f*x,f*x+x).map((t,r)=>e.jsxs(w,{children:[e.jsx(a,{children:t.report_id}),e.jsx(a,{children:t.report_type}),e.jsx(a,{children:_(t.generated_date)}),e.jsx(a,{children:t.prepared_by}),e.jsx(a,{children:t.approval_status}),e.jsx(a,{children:t.comments}),e.jsxs(a,{children:[e.jsx(R,{slug:p,action:"can_update",children:e.jsx(v,{color:"warning",onClick:()=>A(t),children:e.jsx(ae,{sx:{color:"orange"}})})}),e.jsx(D,{slug:p,action:"can_delete",children:e.jsx(v,{color:"error",onClick:()=>Y(t.report_id),children:e.jsx(oe,{sx:{color:"red"}})})})]})]},r))})]}),e.jsx(ne,{rowsPerPageOptions:[5,10,25],component:"div",count:y.length,rowsPerPage:x,page:f,onPageChange:(t,r)=>I(r),onRowsPerPageChange:t=>E(parseInt(t.target.value,10))})]})]})};export{_e as default};
