import{r as s,j as e,T as i,z as W}from"./main-IxGEKZMA.js";import{a as B,l as I,s as N,m as L}from"./inventory-TCBUaCbN.js";import{e as y,D as G,f as $,g as z,T as H,h as U,i as v,j as a,k as q,I as w}from"./TableRow-CRAT5KT_.js";import{G as l}from"./Grid-C72N-tAO.js";import{D as J}from"./DialogActions-D5wP0Mt-.js";import{E as P}from"./Edit-g2hjeeYC.js";import{D as Q}from"./Delete-cHl_EB0l.js";import"./Transition-C29ZPDdz.js";const re=()=>{const[C,d]=s.useState(!1),[A,g]=s.useState(null),[T,V]=s.useState([]),[n,x]=s.useState({valuationMethod:"",stockId:"",stockValue:"",stockTurnoverRatio:"",lowStockAlerts:!1,excessStockAlerts:!1,monthlyStockReport:""}),[h,m]=s.useState([]),E=s.useRef(null),k=s.useRef(null),f=s.useRef(null),S=s.useRef(null),R=s.useRef(null),b=s.useRef(null);s.useEffect(()=>{(async()=>{try{const o=await B();V(o.map(r=>r.stock_id))}catch(o){console.error("Error fetching stock IDs:",o)}})()},[]),s.useEffect(()=>{(async()=>{try{const o=await I();m(o)}catch(o){console.error("❌ Error fetching valuation reports:",o)}})()},[]);const c=t=>{const{name:o,type:r,value:p,checked:j,files:F}=t.target;x(K=>{var D;return{...K,[o]:r==="checkbox"?j:r==="file"?((D=F[0])==null?void 0:D.name)||"":p}})},u=(t,o)=>{t.key==="Enter"&&(t.preventDefault(),o&&o.current&&o.current.focus())},M=async()=>{var t;try{const o={stock:n.stockId,valuation_method:n.valuationMethod},r=await N(o),p=await I();m(p),x({valuationMethod:"",stockId:"",stockValue:"",stockTurnoverRatio:"",lowStockAlerts:!1,excessStockAlerts:!1,monthlyStockReport:""}),d(!1),alert("✅ Valuation report generated successfully!")}catch(o){alert(`⚠️ Failed to submit valuation: ${((t=o.response)==null?void 0:t.data)||o.message}`)}},O=t=>{x(h[t]),g(t),d(!0)},_=async t=>{const o=h[t].id;if(window.confirm("Are you sure you want to delete this report?"))try{await L(o),m(r=>r.filter((p,j)=>j!==t)),console.log(`✅ Report ${o} deleted`),alert("Report Delete Successfully!!")}catch(r){console.error("❌ Error deleting report:",r),alert("Something Went Wrong!!!")}};return e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"contained",onClick:()=>d(!0),sx:{backgroundColor:"#7267ef",mt:4},children:"Add Inventory Valuation"}),e.jsxs(G,{open:C,onClose:()=>d(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx($,{children:"Inventory Valuation & Reporting"}),e.jsx(z,{dividers:!0,children:e.jsxs(l,{container:!0,spacing:2,direction:"column",children:[e.jsxs(l,{item:!0,children:[e.jsx(i,{variant:"subtitle2",children:"Valuation Method"}),e.jsxs("select",{name:"valuationMethod",className:"input",value:n.valuationMethod,onChange:c,onKeyDown:t=>u(t,k),ref:E,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"FIFO",children:"FIFO"}),e.jsx("option",{value:"LIFO",children:"LIFO"}),e.jsx("option",{value:"Weighted Average",children:"Weighted Average"})]})]}),e.jsxs(l,{item:!0,children:[e.jsx(i,{variant:"subtitle2",children:"Stock ID"}),e.jsx("input",{list:"stockIdOptions",name:"stockId",type:"text",value:n.stockId,onChange:c,className:"input",onKeyDown:t=>u(t,f),ref:k,placeholder:"Search Stock ID"}),e.jsx("datalist",{id:"stockIdOptions",children:T.map((t,o)=>e.jsx("option",{value:t},o))})]}),e.jsxs(l,{item:!0,children:[e.jsx(i,{variant:"subtitle2",children:"Stock Value"}),e.jsx("input",{name:"stockValue",type:"number",value:n.stockValue,onChange:c,className:"input",onKeyDown:t=>u(t,f),ref:k})]}),e.jsxs(l,{item:!0,children:[e.jsx(i,{variant:"subtitle2",children:"Stock Turnover Ratio"}),e.jsx("input",{name:"stockTurnoverRatio",type:"number",value:n.stockTurnoverRatio,onChange:c,className:"input",onKeyDown:t=>u(t,S),ref:f})]}),e.jsx(l,{item:!0,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"lowStockAlerts",checked:n.lowStockAlerts,onChange:c,onKeyDown:t=>u(t,R),ref:S,style:{marginRight:"8px"}}),"Low Stock Alerts"]})}),e.jsx(l,{item:!0,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"excessStockAlerts",checked:n.excessStockAlerts,onChange:c,onKeyDown:t=>u(t,b),ref:R,style:{marginRight:"8px"}}),"Excess Stock Alerts"]})}),e.jsxs(l,{item:!0,children:[e.jsx(i,{variant:"subtitle2",children:"Monthly Stock Report"}),e.jsx("input",{type:"file",name:"monthlyStockReport",onChange:c,onKeyDown:t=>{t.key==="Enter"&&t.preventDefault()},ref:b,style:{marginTop:"5px"}}),n.monthlyStockReport&&e.jsx(i,{variant:"caption",style:{marginTop:"4px",display:"block"},children:n.monthlyStockReport})]})]})}),e.jsxs(J,{children:[e.jsx(y,{onClick:()=>{d(!1),g(null)},sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(y,{variant:"outlined",onClick:M,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:A!==null?"Update":"Submit"})]})]}),e.jsxs(W,{mt:4,sx:{backgroundColor:"#fff",p:2,borderRadius:2,boxShadow:1},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Inventory Reports"}),e.jsxs(H,{children:[e.jsx(U,{children:e.jsx(v,{children:["Stock ID","Valuation Method","Stock Value","Turnover Ratio","Monthly Report","Actions"].map((t,o)=>e.jsx(a,{sx:{color:"#7267ef",fontWeight:"bold"},children:t},o))})}),e.jsx(q,{children:h.length>0?h.map((t,o)=>e.jsxs(v,{children:[e.jsx(a,{children:t.stock}),e.jsx(a,{children:t.valuation_method}),e.jsx(a,{children:t.stock_value}),e.jsx(a,{children:t.stock_turnover_ratio}),e.jsx(a,{children:t.monthly_stock_report||"—"}),e.jsxs(a,{children:[e.jsx(w,{onClick:()=>O(o),sx:{color:"warning"},children:e.jsx(P,{sx:{color:"orange"}})}),e.jsx(w,{onClick:()=>_(o),sx:{color:"error"},children:e.jsx(Q,{sx:{color:"red"}})})]})]},o)):e.jsx(v,{children:e.jsx(a,{colSpan:5,align:"center",children:"No inventory reports added yet."})})})]})]})]})};export{re as default};
