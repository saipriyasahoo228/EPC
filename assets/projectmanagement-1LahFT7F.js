import{r as l,j as e,T as b,J as T,E as w,S as E,I as x,K as B}from"./main-Skim5IJC.js";import{C as V}from"./Close-BKZ7QrSY.js";import{g as X}from"./engineering-BJ3wTiKO.js";import{f as Z,d as ee,u as te,c as re}from"./construction-CMO2W9OH.js";import{f as m}from"./date-DdrLtg20.js";import{E as oe,a as se}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{D as ae}from"./Download-C4sxsXoP.js";import{G as s}from"./Grid-fY_ATwTx.js";import{T as A,a as F,b as g,c as r,d as L}from"./TableRow-B6k_bSOs.js";import{A as ne}from"./AddCircle-CJp4DZj3.js";import{B as D,D as ce,a as le,b as ie,c as de}from"./DialogTitle-CvDFHAwp.js";import{T as je}from"./TableContainer-gCCy6yK7.js";import{E as xe}from"./Edit-6vcT2Cu4.js";import{D as ue}from"./Delete-Be1vvbhC.js";import{M as he,a as pe}from"./minimize-2-RCuvNn0X.js";const Ee=()=>{const u="construction",[me,N]=l.useState(null),[k,R]=l.useState(""),[S,z]=l.useState(""),[O,h]=l.useState(!1),[p,f]=l.useState(""),[I,Y]=l.useState([]),[M,U]=l.useState([]),[_,v]=l.useState(!1),[y,G]=l.useState(!1),[a,j]=l.useState({project:"",projectName:"",projectType:"",clientName:"",projectLocation:"",startDate:"",endDate:"",projectManagerId:"",projectManagerName:"",projectStatus:"planning",projectBudget:"",resourceAllocation:""}),H=()=>{G(!y)};l.useEffect(()=>{(async()=>{try{const o=await X();Y(o)}catch(o){console.error("Error fetching projects:",o)}})()},[]);const C=async()=>{try{const t=await Z();console.log("✅ Construction Projects:",t),U(t)}catch(t){console.error("❌ Failed to load construction projects:",t)}};l.useEffect(()=>{C()},[]);const J=(t,o=null)=>{f(t),N(o),j(o!==null?I[o]:{}),h(!0)},P=()=>{h(!1),N(null),j({})},W=t=>{j({projectName:t.project_name,projectType:t.project_type,clientName:t.client_name,projectLocation:t.project_location,startDate:t.start_date,endDate:t.end_date,projectManagerId:t.project_manager_id,projectManagerName:t.project_manager_name,projectStatus:t.project_status,projectBudget:t.project_budget,resourceAllocation:t.resource_allocation}),f(t.project),v(!0),h(!0)},i=t=>{const{name:o,value:n}=t.target;j(d=>({...d,[o]:n}))},Q=async()=>{var t,o;try{const n={project:p,project_name:a.projectName,project_type:a.projectType,client_name:a.clientName,project_location:a.projectLocation,start_date:a.startDate,end_date:a.endDate,project_manager_id:a.projectManagerId,project_manager_name:a.projectManagerName,project_status:((t=a.projectStatus)==null?void 0:t.toLowerCase())||"planning",project_budget:a.projectBudget,resource_allocation:a.resourceAllocation};let d;_&&p?(d=await te(p,n),console.log("✅ Project updated:",d),alert("Project updated successfully!")):(d=await re(n),console.log("✅ Project created:",d),alert("Project Details for Construction Submitted Successfully!!")),j({projectName:"",projectType:"",clientName:"",projectLocation:"",startDate:"",endDate:"",projectManagerId:"",projectManagerName:"",projectStatus:"planning",projectBudget:"",resourceAllocation:""}),f(""),v(!1),h(!1),C()}catch(n){if(console.error("❌ Error in project submit:",n),(o=n.response)!=null&&o.data){const d=n.response.data.message||n.response.data.error||Object.values(n.response.data)[0];alert(`Error: ${d}`)}else alert("Error in submitting Project Details for Construction!!")}},$=async t=>{if(window.confirm(`Are you sure you want to delete project with ID: ${t}?`))try{await ee(t),alert("✅ Project deleted successfully!"),C()}catch(n){console.error("❌ Error deleting project:",n),alert("❌ Failed to delete project.")}},q=I.filter(t=>Object.values(t).some(o=>o&&o.toString().toLowerCase().includes(S.toLowerCase()))),K=t=>{const o=new oe("l","mm","a4");o.setFontSize(16),o.text("Construction Projects Report",14,15);const n=[["Project ID","Project Name","Type","Client","Location","Start Date","End Date","Manager ID","Manager Name","Status","Budget","Resource Allocation"]],d=(t||[]).map(c=>[c.project,c.project_name,c.project_type,c.client_name,c.project_location,m(c.start_date),m(c.end_date),c.project_manager_id,c.project_manager_name,c.project_status,c.project_budget,c.resource_allocation]);se(o,{head:n,body:d,startY:25,styles:{fontSize:7,cellPadding:2,overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),o.save("construction_projects_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Project Management"}),e.jsx(s,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(s,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(w,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:k,onChange:t=>R(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(A,{children:[e.jsx(F,{children:e.jsxs(g,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(L,{children:q.map((t,o)=>e.jsxs(g,{children:[e.jsx(r,{children:t.project_id}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{slug:u,action:"can_create",children:e.jsx(x,{onClick:()=>J(t.project_id),color:"primary",children:e.jsx(ne,{sx:{color:"#7267ef"}})})})})]},o))})]})]})})}),e.jsx(s,{container:!0,spacing:2,children:e.jsx(s,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(D,{startIcon:e.jsx(ae,{}),onClick:()=>K(M),sx:{mr:1}}),e.jsx(b,{variant:"h6",gutterBottom:!0,children:"SUBMITTED PROJECTS"}),e.jsx("input",{type:"text",placeholder:"Search Projects",value:S,onChange:t=>z(t.target.value),className:"input"}),e.jsx(je,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(A,{stickyHeader:!0,children:[e.jsx(F,{children:e.jsxs(g,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project Name"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project Type"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Client Name"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project Location"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Start Date"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"End Date"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project Manager Id"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project Manager Name"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project Status"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project Budget"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Resource Allocation"})}),e.jsx(r,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(L,{children:M.map((t,o)=>e.jsxs(g,{children:[e.jsx(r,{children:t.project}),e.jsx(r,{children:t.project_name}),e.jsx(r,{children:t.project_type}),e.jsx(r,{children:t.client_name}),e.jsx(r,{children:t.project_location}),e.jsx(r,{children:m(t.start_date)}),e.jsx(r,{children:m(t.end_date)}),e.jsx(r,{children:t.project_manager_id}),e.jsx(r,{children:t.project_manager_name}),e.jsx(r,{children:t.project_status}),e.jsx(r,{children:t.project_budget}),e.jsx(r,{children:t.resource_allocation}),e.jsxs(r,{children:[e.jsx(B,{slug:u,action:"can_update",children:e.jsx(x,{color:"warning",onClick:()=>W(t),children:e.jsx(xe,{sx:{color:"orange"}})})}),e.jsx(E,{slug:u,action:"can_delete",children:e.jsx(x,{color:"error",onClick:()=>$(t.project),children:e.jsx(ue,{sx:{color:"red"}})})})]})]},o))})]})})]})})}),e.jsxs(ce,{open:O,onClose:P,fullWidth:!0,maxWidth:"xl",PaperProps:{style:y?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(le,{children:"Enter Project Details"}),e.jsxs(ie,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(x,{"aria-label":"toggle-size",onClick:H,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:y?e.jsx(he,{}):e.jsx(pe,{})}),e.jsx(x,{"aria-label":"close",onClick:P,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(V,{})}),e.jsx(w,{component:"form",sx:{mt:2},children:e.jsxs(s,{container:!0,spacing:3,direction:"column",children:[e.jsxs(s,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:p,disabled:!0})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectName",children:"Project Name"}),e.jsx("input",{id:"projectName",name:"projectName",className:"input",value:a.projectName||"",onChange:i})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectType",children:"Project Type"}),e.jsx("input",{id:"projectType",name:"projectType",className:"input",value:a.projectType||"",onChange:i})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"clientName",children:"Client Name"}),e.jsx("input",{id:"clientName",name:"clientName",className:"input",value:a.clientName||"",onChange:i})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectLocation",children:"Project Location"}),e.jsx("input",{id:"projectLocation",name:"projectLocation",className:"input",value:a.projectLocation||"",onChange:i})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectStatus",children:"Project Status"}),e.jsxs("select",{id:"projectStatus",name:"projectStatus",className:"input",value:a.projectStatus||"",onChange:i,children:[e.jsx("option",{value:"planning",children:"Planning"}),e.jsx("option",{value:"in progress",children:"In Progress"}),e.jsx("option",{value:"delayed",children:"Delayed"}),e.jsx("option",{value:"completed",children:"Completed"})]})]})]})]}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Approval Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"startDate",children:"Start Date"}),e.jsx("input",{type:"date",id:"startDate",name:"startDate",className:"input",value:a.startDate||"",onChange:i})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"endDate",children:"End Date"}),e.jsx("input",{type:"date",id:"endDate",name:"endDate",className:"input",value:a.endDate||"",onChange:i})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectManagerId",children:"Project Manager ID"}),e.jsx("input",{id:"projectManagerId",name:"projectManagerId",className:"input",value:a.projectManagerId||"",onChange:i})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectManagerName",children:"Project Manager Name"}),e.jsx("input",{id:"projectManagerName",name:"projectManagerName",className:"input",value:a.projectManagerName||"",onChange:i})]})]})]}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Budget and Requirements"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectBudget",children:"Project Budget"}),e.jsx("input",{id:"projectBudget",name:"projectBudget",className:"input",value:a.projectBudget||"",onChange:i})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"resourceAllocation",children:"Resource Allocation"}),e.jsx("input",{id:"resourceAllocation",name:"resourceAllocation",className:"input",value:a.resourceAllocation||"",onChange:i})]})]})]})]})})]}),e.jsxs(de,{children:[e.jsx(D,{onClick:P,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(B,{slug:u,action:_?"can_update":"can_create",children:e.jsx(D,{variant:"outlined",onClick:Q,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:_?"Update Project":"Submit Project"})})]})]})]})};export{Ee as default};
