import{r as o,j as e,T as m,x as b,S as z,D as O}from"./main-BIxdd69i.js";import{g as oe,a as le,d as de,u as ce,c as pe}from"./engineering-4VzvUWDc.js";import{C as ue}from"./Close-D340Gps3.js";import{D as xe}from"./Download-D_b47uoU.js";import{E as he,a as me}from"./jspdf.plugin.autotable-y_YJgUzU.js";import{G as a}from"./Grid-BnZNKmae.js";import{P as $,I as c,e as y,D as je,f as ge,g as fe,h as ve}from"./DialogTitle-D59uELMl.js";import{T as U,a as G,b as C,c as t,d as W}from"./TableRow-D8X36zJO.js";import{A as be}from"./AddCircle-Bn9h5MaP.js";import{A as Y,a as H}from"./ArrowForwardIos-DapvvZ-0.js";import{T as ye}from"./TableContainer-1Xqyy-f8.js";import{E as Ce}from"./Edit-BJV-h6Li.js";import{D as De}from"./Delete-BHKbKfZ2.js";import{M as _e,a as Se}from"./minimize-2-Dl_U24Qm.js";const ze=()=>{const j="engineering",[g,V]=o.useState(""),[R,Q]=o.useState(""),[J,f]=o.useState(!1),[F,D]=o.useState(""),[n,p]=o.useState({}),[_,K]=o.useState([]),[S,X]=o.useState([]),[w,B]=o.useState(null),[A,E]=o.useState("create"),[P,Z]=o.useState(!1),v=4,[u,k]=o.useState(1),[x,M]=o.useState(1),I=5;o.useEffect(()=>{(async()=>{try{const r=await oe();X(r)}catch(r){console.error("Error fetching projects:",r)}})()},[]);const N=async()=>{try{const s=await le();K(s)}catch(s){console.error("Error fetching design plans:",s)}};o.useEffect(()=>{N()},[]);const ee=async()=>{const s=new FormData;if(s.append("project",F),s.append("design_name",n.designName),s.append("design_type",n.designType),s.append("prepared_by",n.preparedBy),s.append("version_number",n.versionNumber),s.append("reviewed_by",n.reviewedBy||""),s.append("approval_status",n.approvalStatus||"Pending"),s.append("approval_date",n.approvalDate||""),s.append("compliance_standard",n.complianceStandard),s.append("design_constraints",n.designConstraints),s.append("estimated_budget",n.estimatedBudget),s.append("resource_requirements",n.resourceRequirements),s.append("design_completion_date",n.designCompletionDate),s.append("status",n.status),n.blueprint)s.append("blueprint",n.blueprint);else if(!w){alert("Please upload a blueprint file.");return}try{let r;w?(s.append("design_id",n.designId),r=await ce(w,s),alert("✅ Design updated successfully")):(r=await pe(s),alert("✅ Design submitted successfully")),await N(),p({designName:"",designType:"",preparedBy:"",versionNumber:"",reviewedBy:"",approvalStatus:"",approvalDate:"",complianceStandard:"",designConstraints:"",estimatedBudget:"",resourceRequirements:"",designCompletionDate:"",status:"",blueprint:null,projectCode:"",designId:""}),D(null),B(null),f(!1)}catch(r){if(r.response){console.error("Backend Error:",r.response.data);const d=typeof r.response.data=="object"?Object.entries(r.response.data).map(([h,i])=>`${h}: ${i}`).join(`
`):r.response.data;alert(`❌ Submission failed:
${d}`)}else console.error("Network/Other Error:",r.message),alert(`❌ Submission failed: ${r.message}`)}},se=s=>{E("edit"),B(s.design_id),D(s.project),p({designId:s.design_id,designName:s.design_name,designType:s.design_type,versionNumber:s.version_number,preparedBy:s.prepared_by,reviewedBy:s.reviewed_by,approvalStatus:s.approval_status,approvalDate:s.approval_date,complianceStandard:s.compliance_standard,designConstraints:s.design_constraints,estimatedBudget:s.estimated_budget,resourceRequirements:s.resource_requirements,designCompletionDate:s.design_completion_date,status:s.status,blueprint:null,projectCode:""}),f(!0)},te=async s=>{var r;if(window.confirm(`Are you sure you want to delete ${s}?`))try{await de(s),alert(`Design ${s} deleted successfully ✅`),await N()}catch(d){console.error("Delete failed:",((r=d.response)==null?void 0:r.data)||d.message),alert("❌ Failed to delete the design.")}},re=s=>{E("create"),D(s);const r=new Date().getFullYear(),d=String(_.length+1).padStart(4,"0");p({designId:`DES-${r}-${d}`,designName:"",designType:"",preparedBy:"",versionNumber:"",reviewedBy:"",approvalStatus:"Pending",approvalDate:"",complianceStandard:"",designConstraints:"",estimatedBudget:"",resourceRequirements:"",designCompletionDate:"",status:"",blueprint:null,projectCode:""}),B(null),f(!0)},T=()=>f(!1),l=s=>{const{name:r,value:d}=s.target;p(h=>({...h,[r]:d}))},q=_.filter(s=>Object.values(s).some(r=>r&&r.toString().toLowerCase().includes(R.toLowerCase()))),L=Math.ceil(q.length/I),ne=q.slice((x-1)*I,x*I),ae=()=>{Z(!P)},ie=s=>{const r=new he("l","mm","a4");r.setFontSize(16),r.text("All Designs Report",14,15);const d=["Project","Design ID","Name","Type","Version","Prepared By","Reviewed By","Approval Status","Approval Date","Compliance Standard","Constraints","Budget","Resources","Completion Date","Status"],h=s.map(i=>[i.project,i.design_id,i.design_name,i.design_type,i.version_number,i.prepared_by,i.reviewed_by,i.approval_status,i.approval_date,i.compliance_standard,i.design_constraints,i.estimated_budget,i.resource_requirements,i.design_completion_date,i.status]);me(r,{head:[d],body:h,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),r.save("all_designs_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Design Management"}),e.jsx(a,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(a,{item:!0,xs:12,children:e.jsxs($,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(m,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(b,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:g,onChange:s=>V(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(U,{children:[e.jsx(G,{children:e.jsxs(C,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(W,{children:S.filter(s=>s.project_id.toLowerCase().includes(g.toLowerCase())).slice((u-1)*v,u*v).map((s,r)=>e.jsxs(C,{children:[e.jsx(t,{children:s.project_id}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(z,{slug:j,action:"can_create",children:e.jsx(c,{onClick:()=>re(s.project_id),color:"primary",children:e.jsx(be,{sx:{color:"#7267ef"}})})})})]},r))})]}),e.jsxs(b,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(c,{disabled:u===1,onClick:()=>k(s=>s-1),children:e.jsx(Y,{})}),e.jsxs(m,{variant:"body2",sx:{mx:2},children:["Page ",u," of ",Math.ceil(S.filter(s=>s.project_id.toLowerCase().includes(g.toLowerCase())).length/v)]}),e.jsx(c,{disabled:u>=Math.ceil(S.filter(s=>s.project_id.toLowerCase().includes(g.toLowerCase())).length/v),onClick:()=>k(s=>s+1),children:e.jsx(H,{})})]})]})})}),e.jsx(a,{container:!0,spacing:2,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs($,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(y,{startIcon:e.jsx(xe,{}),onClick:()=>ie(_)}),e.jsx(m,{variant:"h6",gutterBottom:!0,children:"SUBMITTED DESIGNS"}),e.jsx("input",{type:"text",placeholder:"Search Designs",value:R,onChange:s=>Q(s.target.value),className:"input"}),e.jsx(ye,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(U,{stickyHeader:!0,children:[e.jsx(G,{children:e.jsxs(C,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Design ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Name"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Type"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Version"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Prepared By"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Reviewed By"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Status"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Date"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Constraints"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Budget"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Resources"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Completion Date"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Status"})}),e.jsx(t,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(W,{children:ne.map((s,r)=>e.jsxs(C,{children:[e.jsx(t,{children:s.project}),e.jsx(t,{children:s.design_id}),e.jsx(t,{children:s.design_name}),e.jsx(t,{children:s.design_type}),e.jsx(t,{children:s.version_number}),e.jsx(t,{children:s.prepared_by}),e.jsx(t,{children:s.reviewed_by}),e.jsx(t,{children:s.approval_status}),e.jsx(t,{children:s.approval_date}),e.jsx(t,{children:s.compliance_standard}),e.jsx(t,{children:s.design_constraints}),e.jsx(t,{children:s.estimated_budget}),e.jsx(t,{children:s.resource_requirements}),e.jsx(t,{children:s.design_completion_date}),e.jsx(t,{children:s.status}),e.jsxs(t,{children:[e.jsx(O,{slug:j,action:"can_update",children:e.jsx(c,{color:"warning",onClick:()=>se(s),children:e.jsx(Ce,{sx:{color:"orange"}})})}),e.jsx(z,{slug:j,action:"can_delete",children:e.jsx(c,{color:"error",onClick:()=>te(s.design_id),children:e.jsx(De,{sx:{color:"red"}})})})]})]},r))})]})}),e.jsxs(b,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(c,{disabled:x===1,onClick:()=>M(s=>s-1),children:e.jsx(Y,{})}),e.jsxs(m,{variant:"body2",sx:{mx:2},children:["Page ",x," of ",L||1]}),e.jsx(c,{disabled:x>=L,onClick:()=>M(s=>s+1),children:e.jsx(H,{})})]})]})})}),e.jsxs(je,{open:J,onClose:T,fullWidth:!0,maxWidth:"xl",PaperProps:{style:P?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(ge,{children:"Enter Design Details"}),e.jsxs(fe,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(c,{"aria-label":"toggle-size",onClick:ae,sx:{position:"absolute",right:40,top:8,color:s=>s.palette.grey[600]},children:P?e.jsx(_e,{}):e.jsx(Se,{})}),e.jsx(c,{"aria-label":"close",onClick:T,sx:{position:"absolute",right:8,top:8,color:s=>s.palette.grey[500]},children:e.jsx(ue,{})}),e.jsx(b,{component:"form",sx:{mt:2},children:e.jsxs(a,{container:!0,spacing:3,direction:"column",children:[e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:F,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"designId",children:"Design ID"}),e.jsx("input",{id:"designId",className:"input",value:n.designId||"",disabled:!0})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Design Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"designName",children:"Design Name"}),e.jsx("input",{id:"designName",name:"designName",className:"input",value:n.designName||"",onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"designType",children:"Design Type"}),e.jsxs("select",{id:"designType",name:"designType",className:"input",value:n.designType||"",onChange:l,children:[e.jsx("option",{value:"",children:"Select Type"}),["Architectural","Structural","Electrical","Mechanical","Civil"].map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"versionNumber",children:"Version Number"}),e.jsx("input",{id:"versionNumber",name:"versionNumber",className:"input",value:n.versionNumber||"",onChange:l})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Approval Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"preparedBy",children:"Prepared By"}),e.jsx("input",{id:"preparedBy",name:"preparedBy",className:"input",value:n.preparedBy||"",onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"reviewedBy",children:"Reviewed By"}),e.jsx("input",{id:"reviewedBy",name:"reviewedBy",className:"input",value:n.reviewedBy||"",onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:n.approvalStatus||"",onChange:l,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"}),e.jsx("option",{value:"Under Review",children:"Under Review"})]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalDate",children:"Approval Date"}),e.jsx("input",{type:"date",id:"approvalDate",name:"approvalDate",className:"input",value:n.approvalDate||"",onChange:l})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Budget and Requirements"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"complianceStandard",children:"Compliance Standard"}),e.jsx("input",{id:"complianceStandard",name:"complianceStandard",className:"input",value:n.complianceStandard||"",onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"designConstraints",children:"Design Constraints"}),e.jsx("textarea",{id:"designConstraints",name:"designConstraints",className:"input",rows:3,value:n.designConstraints||"",onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"estimatedBudget",children:"Estimated Budget"}),e.jsx("input",{type:"number",id:"estimatedBudget",name:"estimatedBudget",className:"input",value:n.estimatedBudget||"",onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"resourceRequirements",children:"Resource Requirements"}),e.jsx("textarea",{id:"resourceRequirements",name:"resourceRequirements",className:"input",rows:3,value:n.resourceRequirements||"",onChange:l})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Status and Actions"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"designCompletionDate",children:"Design Completion Date"}),e.jsx("input",{type:"date",id:"designCompletionDate",name:"designCompletionDate",className:"input",value:n.designCompletionDate||"",onChange:l})]}),e.jsxs("select",{id:"status",name:"status",className:"input",value:n.status||"",onChange:l,required:!0,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Draft",children:"Draft"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Completed",children:"Completed"})]})]})]}),e.jsxs(y,{variant:"contained",component:"label",children:["Upload Blueprints/Documents",e.jsx("input",{type:"file",hidden:!0,onChange:s=>p({...n,blueprint:s.target.files[0]})})]})]})})]}),e.jsxs(ve,{children:[e.jsx(y,{onClick:T,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(O,{slug:j,action:A==="edit"?"can_update":"can_create",children:e.jsx(y,{variant:"outlined",onClick:ee,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:A==="edit"?"Update Design":"Submit Design"})})]})]})]})};export{ze as default};
