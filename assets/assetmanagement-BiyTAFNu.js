import{r as o,j as e,T as C,x as w,S as A,D as S}from"./main-BIxdd69i.js";import{C as K}from"./Close-D340Gps3.js";import{i as X}from"./procurement-Dxzq-DH5.js";import{g as E,d as Z,u as ee,c as se}from"./maintenance-B4U_mUx1.js";import{G as a}from"./Grid-BnZNKmae.js";import{P as T,I as h,D as re,f as te,g as ne,h as ae,e as M}from"./DialogTitle-D59uELMl.js";import{T as P,a as F,b as j,c as r,d as L}from"./TableRow-D8X36zJO.js";import{A as ie}from"./AddCircle-Bn9h5MaP.js";import{T as le}from"./TableContainer-1Xqyy-f8.js";import{E as oe}from"./Edit-BJV-h6Li.js";import{D as ce}from"./Delete-BHKbKfZ2.js";import{M as de,a as ue}from"./minimize-2-Dl_U24Qm.js";const ve=()=>{const m="maintenance",[u,_]=o.useState(null),[f,R]=o.useState(!1),[g,O]=o.useState(""),[D,q]=o.useState(""),[k,y]=o.useState(!1),[xe,B]=o.useState(""),[t,x]=o.useState({}),[N,b]=o.useState([]),[$,I]=o.useState(!1),[he,v]=o.useState(null),[z,U]=o.useState([]),G=()=>{R(!f)};o.useEffect(()=>{(async()=>{try{const c=(await X()).map(l=>({poId:l.po_number,procurementId:l.procurement}));U(c)}catch(n){console.error("❌ Error fetching purchase orders:",n)}})()},[]),o.useEffect(()=>{(async()=>{try{const n=await E();b(n)}catch(n){console.error("❌ Failed to load assets:",n)}})()},[]);const W=(s,n)=>{B(s,n);const c=new Date().getFullYear(),d=(N.length+1).toString().padStart(3,"0");x({assetId:`AST-${c}-${d}`,poId:s,procurementId:n}),I(!1),v(null),y(!0)},H=s=>{x({assetId:s.asset_id||"",assetName:s.asset_name||"",assetType:s.asset_type||"",modelNumber:s.model_number||"",serialNumber:s.serial_number||"",location:s.location||"",purchaseDate:s.purchase_date||"",warrantyExpiryDate:s.warranty_expiry_date||"",procurementId:s.procurement_id||"",maintenanceRequirement:s.maintenance_requirement||"",currentCondition:s.current_condition||"",usefullLife:s.useful_life_years||"",poId:s.purchase_order||""}),_(s.asset_id),y(!0)},Y=async s=>{if(window.confirm(`Are you sure you want to delete asset ${s}?`))try{await Z(s),alert(`✅ Asset ${s} deleted successfully`),b(n=>n.filter(c=>c.asset_id!==s))}catch{alert(`❌ Failed to delete asset ${s}`)}},p=()=>{y(!1),x({}),I(!1),v(null)},i=s=>{const{name:n,value:c}=s.target;x(l=>({...l,[n]:c}))},Q=async()=>{var s,n,c;try{const l={asset_name:t.assetName||"",asset_type:t.assetType||"",model_number:t.modelNumber||"",serial_number:t.serialNumber||"",location:t.location||"",purchase_date:t.purchaseDate||"",warranty_expiry_date:t.warrantyExpiryDate||"",procurement_id:t.procurementId||"",maintenance_requirement:t.maintenanceRequirement||"",current_condition:t.currentCondition||"",useful_life_years:t.usefullLife||5,purchase_order:t.poId||""};let d;u?(d=await ee(u,l),alert(`✏️ Asset updated successfully! (${u})`)):(d=await se(l),alert(`✅ Asset created successfully!
Generated Asset ID: ${d.asset_id}`));const V=await E();b(V),x({}),_(null),p()}catch(l){const d=((n=(s=l.response)==null?void 0:s.data)==null?void 0:n.detail)||((c=l.response)==null?void 0:c.data)||l.message;alert(`❌ Failed to submit asset:
${JSON.stringify(d,null,2)}`),console.error("❌ Error submitting asset:",l)}},J=N.filter(s=>Object.values(s).some(n=>n&&n.toString().toLowerCase().includes(D.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Assets Management"}),e.jsx(a,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(C,{variant:"h6",gutterBottom:!0,children:"Purchase & Procurement Details"}),e.jsx(w,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Purchase & Procurement",value:g,onChange:s=>O(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs(j,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"PurchaseOrder ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Procurement ID"})}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(L,{children:z.filter(s=>s.poId.toLowerCase().includes(g.toLowerCase())||s.procurementId.toLowerCase().includes(g.toLowerCase())).map((s,n)=>e.jsxs(j,{children:[e.jsx(r,{children:s.poId}),e.jsx(r,{children:s.procurementId}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(A,{slug:m,action:"can_create",children:e.jsx(h,{onClick:()=>W(s.poId,s.procurementId),color:"primary",children:e.jsx(ie,{sx:{color:"#7267ef"}})})})})]},n))})]})]})})}),e.jsx(a,{container:!0,spacing:2,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(C,{variant:"h6",gutterBottom:!0,children:"Assets Details"}),e.jsx("input",{type:"text",placeholder:"Search Assets Management Details",value:D,onChange:s=>q(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(le,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(P,{stickyHeader:!0,children:[e.jsx(F,{children:e.jsxs(j,{children:[e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Purchase Order"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"ProcurementId"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset Name"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset Type"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Model Number"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Serial Number"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Location"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Purchase Date"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Warranty Expiry Date"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Maintenance Requirment"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Current Condition"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Usefull Life"})}),e.jsx(r,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Depreciation Value"})}),e.jsx(r,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(L,{children:J.map((s,n)=>e.jsxs(j,{children:[e.jsx(r,{children:s.purchase_order}),e.jsx(r,{children:s.procurement_id}),e.jsx(r,{children:s.asset_id}),e.jsx(r,{children:s.asset_name}),e.jsx(r,{children:s.asset_type}),e.jsx(r,{children:s.model_number}),e.jsx(r,{children:s.serial_number}),e.jsx(r,{children:s.location}),e.jsx(r,{children:s.purchase_date}),e.jsx(r,{children:s.warranty_expiry_date}),e.jsx(r,{children:s.maintenance_requirement}),e.jsx(r,{children:s.current_condition}),e.jsx(r,{children:s.useful_life_years}),e.jsx(r,{children:s.depreciation_value}),e.jsxs(r,{children:[e.jsx(S,{slug:m,action:"can_update",children:e.jsx(h,{onClick:()=>H(s),color:"warning",children:e.jsx(oe,{sx:{color:"orange"}})})}),e.jsx(A,{slug:m,action:"can_delete",children:e.jsx(h,{onClick:()=>Y(s.asset_id),color:"error",children:e.jsx(ce,{sx:{color:"red"}})})})]})]},n))})]})})]})})}),e.jsxs(re,{open:k,onClose:p,fullWidth:!0,maxWidth:"xl",PaperProps:{style:f?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(te,{children:$?"Edit Asset Management Details":"Enter Assets Management Details"}),e.jsxs(ne,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(h,{"aria-label":"toggle-size",onClick:G,sx:{position:"absolute",right:40,top:8,color:s=>s.palette.grey[600]},children:f?e.jsx(de,{}):e.jsx(ue,{})}),e.jsx(h,{"aria-label":"close",onClick:p,sx:{position:"absolute",right:8,top:8,color:s=>s.palette.grey[500]},children:e.jsx(K,{})}),e.jsx(w,{component:"form",sx:{mt:2},children:e.jsx(a,{container:!0,spacing:3,direction:"column",children:e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Asset Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"assetId",children:"Asset ID"}),e.jsx("input",{id:"assetId",name:"assetId",className:"input",value:t.assetId||"",onChange:i,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"procurementId",children:"procurement ID"}),e.jsx("input",{id:"procurementId",name:"procurementId",className:"input",value:t.procurementId||"",onChange:i,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"poId",children:"PurchaseOrder ID"}),e.jsx("input",{id:"poId",name:"poId",className:"input",value:t.poId||"",onChange:i,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"assetName",children:"Asset Name"}),e.jsx("input",{id:"assetName",name:"assetName",className:"input",value:t.assetName||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"assetType",children:"Asset Type"}),e.jsx("input",{id:"assetType",name:"assetType",className:"input",value:t.assetType||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"modelNumber",children:"Model Number"}),e.jsx("input",{id:"modelNumber",name:"modelNumber",className:"input",value:t.modelNumber||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"serialNumber",children:"Serial Number"}),e.jsx("input",{id:"serialNumber",name:"serialNumber",className:"input",value:t.serialNumber||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"location",children:"Location"}),e.jsx("input",{id:"location",name:"location",className:"input",value:t.location||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"purchaseDate",children:"Purchase Date"}),e.jsx("input",{type:"date",id:"purchaseDate",name:"purchaseDate",className:"input",value:t.purchaseDate||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"warrantyExpiryDate",children:"Warranty Expiry Date"}),e.jsx("input",{type:"date",id:"warrantyExpiryDate",name:"warrantyExpiryDate",className:"input",value:t.warrantyExpiryDate||"",onChange:i})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"maintenanceRequirement",children:"Maintenance Requirement"}),e.jsxs("select",{id:"maintenanceRequirement",name:"maintenanceRequirement",className:"input",value:t.maintenanceRequirement||"",onChange:i,children:[e.jsx("option",{value:"",children:"-- Select Maintenance Requirement --"}),e.jsx("option",{value:"Regular",children:"Regular"}),e.jsx("option",{value:"Preventive",children:"Preventive"}),e.jsx("option",{value:"Emergency",children:"Emergency"})]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"currentCondition",children:"Current Condition"}),e.jsxs("select",{id:"currentCondition",name:"currentCondition",className:"input",value:t.currentCondition||"",onChange:i,children:[e.jsx("option",{value:"",children:"-- Select Current Condition --"}),e.jsx("option",{value:"Operational",children:"Operational"}),e.jsx("option",{value:"Needs Repair",children:"Needs Repair"}),e.jsx("option",{value:"Decommissioned",children:"Decommissioned"})]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"usefullLife",children:"Usefull Life"}),e.jsx("input",{type:"number",id:"usefullLife",name:"usefullLife",className:"input",value:t.usefullLife||"",onChange:i})]})]})]})})})]}),e.jsxs(ae,{children:[e.jsx(M,{onClick:p,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(S,{slug:m,action:u?"can_update":"can_create",children:e.jsx(M,{variant:"outlined",onClick:Q,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:u?"Update":"Submit"})})]})]})]})};export{ve as default};
