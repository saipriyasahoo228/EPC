import{n as oe,m as se,r as d,t as G,j as e,v as O,w as re,a7 as ye,o as ie,q as Z,x as ce,V as pe,y as me,T as ee,z as ae,a4 as fe,ak as he,al as ke,am as xe,an as we}from"./main-IxGEKZMA.js";import{C as _e}from"./Close-DoqWsXz3.js";import{S as be,A as ge,g as Fe}from"./user-DcK7T3v4.js";import{c as te,B as Be,s as de,t as Ce,e as X,T as Re,h as Ie,i as je,j as A,k as Me,D as ze,f as Te,I as $e,g as Ue}from"./TableRow-CRAT5KT_.js";import{G as _}from"./Grid-C72N-tAO.js";import{F as De,I as Le,T as ne}from"./TextField-CXzLsa8y.js";import{u as Ee,a as ue,m as Ne,f as Pe,S as qe,M as ve}from"./Select-CDJTZGaT.js";import{T as Ae}from"./TableContainer-BaU58JEj.js";import{D as Oe}from"./DialogActions-D5wP0Mt-.js";import"./Transition-C29ZPDdz.js";import"./dividerClasses-DK6Syutt.js";function Ge(t){return oe("PrivateSwitchBase",t)}se("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const He=t=>{const{classes:s,checked:r,disabled:l,edge:a}=t,x={root:["root",r&&"checked",l&&"disabled",a&&`edge${O(a)}`],input:["input"]};return re(x,Ge,s)},We=G(Be)({padding:9,borderRadius:"50%",variants:[{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:({edge:t,ownerState:s})=>t==="start"&&s.size!=="small",style:{marginLeft:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}},{props:({edge:t,ownerState:s})=>t==="end"&&s.size!=="small",style:{marginRight:-12}}]}),Ve=G("input",{shouldForwardProp:ye})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),Je=d.forwardRef(function(s,r){const{autoFocus:l,checked:a,checkedIcon:x,defaultChecked:f,disabled:u,disableFocusRipple:b=!1,edge:S=!1,icon:v,id:R,inputProps:E,inputRef:M,name:z,onBlur:h,onChange:F,onFocus:C,readOnly:T,required:$=!1,tabIndex:j,type:y,value:m,slots:N={},slotProps:H={},...U}=s,[I,D]=Ee({controlled:a,default:!!f,name:"SwitchBase",state:"checked"}),g=ue(),k=c=>{C&&C(c),g&&g.onFocus&&g.onFocus(c)},B=c=>{h&&h(c),g&&g.onBlur&&g.onBlur(c)},o=c=>{if(c.nativeEvent.defaultPrevented)return;const w=c.target.checked;D(w),F&&F(c,w)};let n=u;g&&typeof n>"u"&&(n=g.disabled);const p=y==="checkbox"||y==="radio",i={...s,checked:I,disabled:n,disableFocusRipple:b,edge:S},P=He(i),q={slots:N,slotProps:{input:E,...H}},[J,K]=te("root",{ref:r,elementType:We,className:P.root,shouldForwardComponentProp:!0,externalForwardedProps:{...q,component:"span",...U},getSlotProps:c=>({...c,onFocus:w=>{var L;(L=c.onFocus)==null||L.call(c,w),k(w)},onBlur:w=>{var L;(L=c.onBlur)==null||L.call(c,w),B(w)}}),ownerState:i,additionalProps:{centerRipple:!0,focusRipple:!b,disabled:n,role:void 0,tabIndex:null}}),[Q,Se]=te("input",{ref:M,elementType:Ve,className:P.input,externalForwardedProps:q,getSlotProps:c=>({...c,onChange:w=>{var L;(L=c.onChange)==null||L.call(c,w),o(w)}}),ownerState:i,additionalProps:{autoFocus:l,checked:a,defaultChecked:f,disabled:n,id:p?R:void 0,name:z,readOnly:T,required:$,tabIndex:j,type:y,...y==="checkbox"&&m===void 0?{}:{value:m}}});return e.jsxs(J,{...K,children:[e.jsx(Q,{...Se}),I?x:v]})}),Ke=de(e.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"})),Qe=de(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})),Xe=de(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}));function Ye(t){return oe("MuiCheckbox",t)}const le=se("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),Ze=t=>{const{classes:s,indeterminate:r,color:l,size:a}=t,x={root:["root",r&&"indeterminate",`color${O(l)}`,`size${O(a)}`]},f=re(x,Ye,s);return{...s,...f}},et=G(Je,{shouldForwardProp:t=>ye(t)||t==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[s.root,r.indeterminate&&s.indeterminate,s[`size${O(r.size)}`],r.color!=="default"&&s[`color${O(r.color)}`]]}})(ce(({theme:t})=>({color:(t.vars||t).palette.text.secondary,variants:[{props:{color:"default",disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:pe(t.palette.action.active,t.palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(me()).map(([s])=>({props:{color:s,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[s].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:pe(t.palette[s].main,t.palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(me()).map(([s])=>({props:{color:s},style:{[`&.${le.checked}, &.${le.indeterminate}`]:{color:(t.vars||t).palette[s].main},[`&.${le.disabled}`]:{color:(t.vars||t).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]}))),tt=e.jsx(Qe,{}),ot=e.jsx(Ke,{}),st=e.jsx(Xe,{}),W=d.forwardRef(function(s,r){const l=ie({props:s,name:"MuiCheckbox"}),{checkedIcon:a=tt,color:x="primary",icon:f=ot,indeterminate:u=!1,indeterminateIcon:b=st,inputProps:S,size:v="medium",disableRipple:R=!1,className:E,slots:M={},slotProps:z={},...h}=l,F=u?b:f,C=u?b:a,T={...l,disableRipple:R,color:x,indeterminate:u,size:v},$=Ze(T),j=z.input??S,[y,m]=te("root",{ref:r,elementType:et,className:Z($.root,E),shouldForwardComponentProp:!0,externalForwardedProps:{slots:M,slotProps:z,...h},ownerState:T,additionalProps:{type:"checkbox",icon:d.cloneElement(F,{fontSize:F.props.fontSize??v}),checkedIcon:d.cloneElement(C,{fontSize:C.props.fontSize??v}),disableRipple:R,slots:M,slotProps:{input:Ne(typeof j=="function"?j(T):j,{"data-indeterminate":u})}}});return e.jsx(y,{...m,classes:$})});function rt(t){return oe("MuiFormControlLabel",t)}const V=se("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),at=t=>{const{classes:s,disabled:r,labelPlacement:l,error:a,required:x}=t,f={root:["root",r&&"disabled",`labelPlacement${O(l)}`,a&&"error",x&&"required"],label:["label",r&&"disabled"],asterisk:["asterisk",a&&"error"]};return re(f,rt,s)},nt=G("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[{[`& .${V.label}`]:s.label},s.root,s[`labelPlacement${O(r.labelPlacement)}`]]}})(ce(({theme:t})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${V.disabled}`]:{cursor:"default"},[`& .${V.label}`]:{[`&.${V.disabled}`]:{color:(t.vars||t).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:s})=>s==="start"||s==="top"||s==="bottom",style:{marginLeft:16}}]}))),lt=G("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(t,s)=>s.asterisk})(ce(({theme:t})=>({[`&.${V.error}`]:{color:(t.vars||t).palette.error.main}}))),Y=d.forwardRef(function(s,r){const l=ie({props:s,name:"MuiFormControlLabel"}),{checked:a,className:x,componentsProps:f={},control:u,disabled:b,disableTypography:S,inputRef:v,label:R,labelPlacement:E="end",name:M,onChange:z,required:h,slots:F={},slotProps:C={},value:T,...$}=l,j=ue(),y=b??u.props.disabled??(j==null?void 0:j.disabled),m=h??u.props.required,N={disabled:y,required:m};["checked","name","onChange","value","inputRef"].forEach(o=>{typeof u.props[o]>"u"&&typeof l[o]<"u"&&(N[o]=l[o])});const H=Pe({props:l,muiFormControl:j,states:["error"]}),U={...l,disabled:y,labelPlacement:E,required:m,error:H.error},I=at(U),D={slots:F,slotProps:{...f,...C}},[g,k]=te("typography",{elementType:ee,externalForwardedProps:D,ownerState:U});let B=R;return B!=null&&B.type!==ee&&!S&&(B=e.jsx(g,{component:"span",...k,className:Z(I.label,k==null?void 0:k.className),children:B})),e.jsxs(nt,{className:Z(I.root,x),ownerState:U,ref:r,...$,children:[d.cloneElement(u,N),m?e.jsxs("div",{children:[B,e.jsxs(lt,{ownerState:U,"aria-hidden":!0,className:I.asterisk,children:["â€‰","*"]})]}):B]})});function it(t){return oe("MuiFormGroup",t)}se("MuiFormGroup",["root","row","error"]);const ct=t=>{const{classes:s,row:r,error:l}=t;return re({root:["root",r&&"row",l&&"error"]},it,s)},dt=G("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[s.root,r.row&&s.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),ut=d.forwardRef(function(s,r){const l=ie({props:s,name:"MuiFormGroup"}),{className:a,row:x=!1,...f}=l,u=ue(),b=Pe({props:l,muiFormControl:u,states:["error"]}),S={...l,row:x,error:b.error},v=ct(S);return e.jsx(dt,{className:Z(v.root,a),ownerState:S,ref:r,...f})}),Pt=()=>{const[t,s]=d.useState([]),[r,l]=d.useState([]),[a,x]=d.useState(""),[f,u]=d.useState({}),[b,S]=d.useState(!1),[v,R]=d.useState(!1),[E,M]=d.useState(null),[z,h]=d.useState(""),[F,C]=d.useState(""),[T,$]=d.useState(!1),[j,y]=d.useState(!1),[m,N]=d.useState({name:"",slug:"",description:"",default_read:!1,default_create:!1,default_update:!1,default_delete:!1});d.useEffect(()=>{(async()=>{S(!0);try{const[n,p]=await Promise.all([Fe(),he()]);s(n||[]),l(p||[])}catch{h("Failed to load users or modules.")}finally{S(!1)}})()},[]),d.useEffect(()=>{(async()=>{if(a){R(!0);try{const n=await ke(a),p={};(n||[]).forEach(i=>{var q,J,K,Q;const P=i.module;p[P.id]={can_read:!!((q=i.permissions)!=null&&q.can_read),can_create:!!((J=i.permissions)!=null&&J.can_create),can_update:!!((K=i.permissions)!=null&&K.can_update),can_delete:!!((Q=i.permissions)!=null&&Q.can_delete)}}),r.forEach(i=>{p[i.id]||(p[i.id]={can_read:!!i.default_read,can_create:!!i.default_create,can_update:!!i.default_update,can_delete:!!i.default_delete})}),u(p)}catch{h("Failed to load user permissions."),u({})}finally{R(!1)}}})()},[a,r.length]);const H=d.useMemo(()=>r.map(o=>({module:o,perms:f[o.id]||{can_read:!!o.default_read,can_create:!!o.default_create,can_update:!!o.default_update,can_delete:!!o.default_delete}})),[r,f]),U=async(o,n)=>{if(!a){h("Please select a user first.");return}const p=f[o]||{},i={...p,[n]:!p[n]};u(P=>({...P,[o]:i})),M(o);try{await xe(a,o,i),C("Permissions updated.")}catch{u(q=>({...q,[o]:p})),h("Failed to update permissions.")}finally{M(null)}},I=async o=>{if(!a){h("Please select a user first.");return}const n={can_read:o,can_create:o,can_update:o,can_delete:o},p=f,i={...f};r.forEach(P=>{i[P.id]=n}),u(i);try{await Promise.all(r.map(P=>xe(a,P.id,n))),C(o?"All permissions granted.":"All permissions revoked.")}catch{u(p),h("Bulk update failed.")}},D=()=>$(!1),g=o=>{const{name:n,value:p}=o.target;N(i=>({...i,[n]:p}))},k=o=>{N(n=>({...n,[o]:!n[o]}))},B=async()=>{if(!m.name||!m.slug){h("Name and slug are required.");return}y(!0);try{await we(m),C("Module created."),D();const o=await he();l(o||[]),u(n=>({...n}))}catch{h("Failed to create module.")}finally{y(!1)}};return e.jsxs(ae,{children:[e.jsx(Ce,{sx:{p:2,mb:2},children:e.jsxs(_,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(_,{item:!0,xs:12,md:8,children:e.jsxs(De,{fullWidth:!0,size:"small",sx:{minWidth:{md:480}},children:[e.jsx(Le,{id:"user-select-label",children:"Select User"}),e.jsxs(qe,{labelId:"user-select-label",label:"Select User",value:a,onChange:o=>x(o.target.value),children:[e.jsx(ve,{value:"",children:"Select User"})," ",t.map(o=>e.jsxs(ve,{value:o.user_id,children:[o.user_id," - ",o.full_name||o.email||o.mobile_number]},o.user_id))]})]})}),e.jsx(_,{item:!0,xs:12,md:4,children:e.jsxs(ae,{display:"flex",gap:1,justifyContent:{xs:"flex-start",md:"flex-end"},children:[e.jsx(X,{variant:"outlined",onClick:()=>I(!0),disabled:!a||b||v,children:"Select All"}),e.jsx(X,{variant:"outlined",color:"warning",onClick:()=>I(!1),disabled:!a||b||v,children:"Revoke All"})]})})]})}),e.jsxs(Ce,{sx:{p:2},children:[e.jsxs(_,{container:!0,alignItems:"center",justifyContent:"space-between",sx:{mb:2},children:[e.jsx(_,{item:!0,children:e.jsx(ee,{variant:"h6",sx:{color:"#7267ef"},children:"Module Permissions"})}),e.jsx(_,{item:!0,children:(b||v)&&e.jsx(fe,{size:20})})]}),b?e.jsx(ae,{display:"flex",justifyContent:"center",alignItems:"center",sx:{minHeight:200},children:e.jsx(fe,{})}):e.jsx(Ae,{children:e.jsxs(Re,{size:"small",children:[e.jsx(Ie,{children:e.jsxs(je,{children:[e.jsx(A,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Module"})}),e.jsx(A,{align:"center",sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Read"})}),e.jsx(A,{align:"center",sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Create"})}),e.jsx(A,{align:"center",sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Update"})}),e.jsx(A,{align:"center",sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Delete"})})]})}),e.jsx(Me,{children:H.map(({module:o,perms:n})=>e.jsxs(je,{hover:!0,children:[e.jsx(A,{children:o.name}),["can_read","can_create","can_update","can_delete"].map(p=>e.jsx(A,{align:"center",children:e.jsx(W,{checked:!!n[p],onChange:()=>U(o.id,p),disabled:!a||E===o.id,color:"primary",inputProps:{"aria-label":`${o.name} ${p}`}})},p))]},o.id))})]})})]}),e.jsxs(ze,{open:T,onClose:D,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(Te,{sx:{backgroundColor:"#f7f7fb",color:"#2f2a8d",display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Create Module",e.jsx($e,{onClick:D,sx:{color:"#7267ef"},"aria-label":"Close dialog",children:e.jsx(_e,{})})]}),e.jsx(Ue,{dividers:!0,children:e.jsxs(_,{container:!0,spacing:2,children:[e.jsx(_,{item:!0,xs:12,sm:6,children:e.jsx(ne,{fullWidth:!0,label:"Name",name:"name",value:m.name,onChange:g,required:!0})}),e.jsx(_,{item:!0,xs:12,sm:6,children:e.jsx(ne,{fullWidth:!0,label:"Slug",name:"slug",value:m.slug,onChange:g,required:!0})}),e.jsx(_,{item:!0,xs:12,children:e.jsx(ne,{fullWidth:!0,multiline:!0,minRows:2,label:"Description",name:"description",value:m.description,onChange:g})}),e.jsxs(_,{item:!0,xs:12,children:[e.jsx(ee,{variant:"subtitle2",sx:{mb:1},children:"Default Permissions"}),e.jsxs(ut,{row:!0,children:[e.jsx(Y,{control:e.jsx(W,{checked:m.default_read,onChange:()=>k("default_read")}),label:"Read"}),e.jsx(Y,{control:e.jsx(W,{checked:m.default_create,onChange:()=>k("default_create")}),label:"Create"}),e.jsx(Y,{control:e.jsx(W,{checked:m.default_update,onChange:()=>k("default_update")}),label:"Update"}),e.jsx(Y,{control:e.jsx(W,{checked:m.default_delete,onChange:()=>k("default_delete")}),label:"Delete"})]})]})]})}),e.jsxs(Oe,{sx:{pr:3,pb:2},children:[e.jsx(X,{onClick:D,color:"inherit",children:"Cancel"}),e.jsx(X,{variant:"contained",onClick:B,disabled:j,sx:{backgroundColor:"#7267ef"},children:j?"Creating...":"Create"})]})]}),e.jsx(be,{open:!!z,autoHideDuration:4e3,onClose:()=>h(""),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(ge,{onClose:()=>h(""),severity:"error",variant:"filled",children:z})}),e.jsx(be,{open:!!F,autoHideDuration:2e3,onClose:()=>C(""),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(ge,{onClose:()=>C(""),severity:"success",variant:"filled",children:F})})]})};export{Pt as default};
