import{r as c,j as e,S as D,I as v,K as N,J as W,T as G}from"./main-Skim5IJC.js";import{E as q,a as z}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{C as Q}from"./Close-BKZ7QrSY.js";import{D as U}from"./Download-C4sxsXoP.js";import{b as H,u as J,c as K,d as V}from"./account-CQ2dqr_G.js";import{f as S}from"./date-DdrLtg20.js";import{B as j,D as X,a as Z,b as ee,c as te}from"./DialogTitle-CvDFHAwp.js";import{G as o}from"./Grid-fY_ATwTx.js";import{T as ne,a as ae,b as L,c as n,d as re}from"./TableRow-B6k_bSOs.js";import{E as se}from"./Edit-6vcT2Cu4.js";import{D as oe}from"./Delete-Be1vvbhC.js";import{T as ce}from"./TablePagination-_dHW1U1A.js";import"./index-Pp9EW3wT.js";import"./KeyboardArrowRight-BzCb_W4p.js";import"./Select-BThNtn2k.js";import"./useSlotProps-CCL6Y0ZK.js";import"./useFormControl-C6hS7-Rn.js";import"./useControlled-CHkDrNg3.js";import"./MenuItem-Cm5ZuES4.js";import"./Toolbar-Dufg8Txv.js";const Le=()=>{const d="account_ledger",[u,T]=c.useState([]),[w,A]=c.useState(!1),[C,I]=c.useState(""),[E,g]=c.useState(!1),[p,b]=c.useState(null),[f,_]=c.useState(0),[m,P]=c.useState(5),[a,x]=c.useState({ledgerId:"",transactionDate:"",accountName:"",accountType:"",debitAmount:"",creditAmount:"",balance:0,description:"",referenceNumber:"",approvalStatus:""}),y=async()=>{try{const t=await H();T(t)}catch(t){console.error("❌ Failed to fetch ledgers",t)}};c.useEffect(()=>{y()},[]);const R=()=>{const t=new Date().getFullYear(),i=(u.length+1).toString().padStart(3,"0");x({ledgerId:`LED-${t}-${i}`,transactionDate:"",accountName:"",accountType:"",debitAmount:"",creditAmount:"",balance:0,description:"",referenceNumber:"",approvalStatus:"Pending"}),A(!1),b(null),g(!0)},h=()=>g(!1),k=t=>{x({ledgerId:t.ledger_id||"",transactionDate:t.transaction_date||"",accountName:t.account_name||"",accountType:t.account_type||"",debitAmount:t.debit_amount||"",creditAmount:t.credit_amount||"",balance:t.balance||0,description:t.description||"",referenceNumber:t.reference_number||"",approvalStatus:t.approval_status||"Pending"}),b(t.ledger_id),A(!0),g(!0)},l=t=>{const{name:r,value:i}=t.target;x(s=>({...s,[r]:i,balance:r==="debitAmount"||r==="creditAmount"?Number(s.debitAmount||0)-Number(s.creditAmount||0)+(r==="debitAmount"?Number(i):0)-(r==="creditAmount"?Number(i):0):s.balance}))},F=async()=>{try{const t={transaction_date:a.transactionDate,account_name:a.accountName,account_type:a.accountType,debit_amount:parseFloat(a.debitAmount)||0,credit_amount:parseFloat(a.creditAmount)||0,description:a.description,reference_number:a.referenceNumber,approval_status:a.approvalStatus};p?(await J(p,t),alert(`✅ Ledger ${p} updated successfully!`)):(await K(t),alert("✅ Ledger entry created successfully!")),x({transactionDate:"",accountName:"",accountType:"",debitAmount:"",creditAmount:"",balance:0,description:"",referenceNumber:"",approvalStatus:"Pending"}),b(null),h(),y()}catch(t){console.error("❌ Error saving ledger:",t),alert("❌ Failed to save ledger entry")}},B=async t=>{if(window.confirm(`Are you sure you want to delete Ledger ID: ${t}?`))try{await V(t),alert(`✅ Ledger ${t} deleted`),y()}catch{alert(`❌ Failed to delete Ledger ${t}`)}},Y=u.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(C.toLowerCase()))),O=(t,r)=>_(r),$=t=>{P(parseInt(t.target.value,10)),_(0)},M=()=>{const t=new q("l","mm","a4");t.setFontSize(16),t.text("All Account Ledger Report",14,15);const r=["Ledger ID","Transaction Date","Account Name","Account Type","Debit Amount","Credit Amount","Balance","Reference Number","Approval Status"],i=Y.map(s=>[s.ledger_id,S(s.transaction_date),s.account_name,s.account_type,s.debit_amount,s.credit_amount,s.balance,s.reference_number,s.approval_status]);z(t,{head:[r],body:i,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),t.save("all_account_ledger_report.pdf")};return e.jsxs("div",{children:[e.jsx(D,{slug:d,action:"can_create",children:e.jsx(j,{variant:"contained",sx:{mt:4,mb:2,backgroundColor:"#7267ef"},onClick:R,children:"Add Ledger Entry"})}),e.jsxs(X,{open:E,onClose:h,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(Z,{sx:{backgroundColor:"#f3f3f3",color:"#7267ef",display:"flex",justifyContent:"space-between"},children:[w?"Edit Ledger Entry":"Add Ledger Entry",e.jsx(v,{onClick:h,sx:{color:"#7267ef"},children:e.jsx(Q,{})})]}),e.jsx(ee,{children:e.jsxs(o,{container:!0,spacing:2,direction:"column",sx:{mt:1},children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"ledgerId",children:"Ledger ID"}),e.jsx("input",{id:"ledgerId",name:"ledgerId",className:"input",value:a.ledgerId||"",readOnly:!0})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Transaction Date"}),e.jsx("input",{className:"input",type:"date",name:"transactionDate",value:a.transactionDate,onChange:l})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Account Name"}),e.jsx("input",{className:"input",name:"accountName",value:a.accountName,onChange:l,placeholder:"e.g., Revenue"})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Account Type"}),e.jsxs("select",{className:"input",name:"accountType",value:a.accountType,onChange:l,children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"Assets",children:"Assets"}),e.jsx("option",{value:"Liabilities",children:"Liabilities"}),e.jsx("option",{value:"Equity",children:"Equity"}),e.jsx("option",{value:"Revenue",children:"Revenue"}),e.jsx("option",{value:"Expenses",children:"Expenses"})]})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Debit Amount"}),e.jsx("input",{className:"input",name:"debitAmount",type:"number",value:a.debitAmount,onChange:l})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Credit Amount"}),e.jsx("input",{className:"input",name:"creditAmount",type:"number",value:a.creditAmount,onChange:l})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Description"}),e.jsx("input",{className:"input",name:"description",value:a.description,onChange:l,placeholder:"Transaction details..."})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Reference Number"}),e.jsx("input",{className:"input",name:"referenceNumber",value:a.referenceNumber,onChange:l})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("label",{children:"Approval Status"}),e.jsxs("select",{className:"input",name:"approvalStatus",value:a.approvalStatus,onChange:l,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]})]})}),e.jsxs(te,{sx:{pr:3,pb:2},children:[e.jsx(j,{onClick:h,sx:{outline:"2px solid #800000",color:"#800000"},children:"Cancel"}),e.jsx(N,{slug:d,action:p?"can_update":"can_create",children:e.jsx(j,{variant:"outlined",onClick:F,sx:{borderColor:"#7267ef",color:"#7267ef"},children:"Submit"})})]})]}),e.jsxs(W,{sx:{mt:4,p:2,border:"1px solid #ccc"},children:[e.jsxs(o,{container:!0,justifyContent:"space-between",alignItems:"center",children:[e.jsx(o,{item:!0,children:e.jsx(G,{variant:"h6",gutterBottom:!0,sx:{color:"#7267ef"},children:"Account Ledger Report"})}),e.jsx(o,{item:!0,children:e.jsx(j,{startIcon:e.jsx(U,{}),onClick:M,sx:{backgroundColor:"#7267ef",color:"#fff",mt:2,mb:2},children:"Export PDF"})})]}),e.jsx("input",{type:"text",placeholder:"Search Ledger Entries...",value:C,onChange:t=>I(t.target.value),className:"input"}),e.jsxs(ne,{children:[e.jsx(ae,{children:e.jsxs(L,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:"Ledger ID"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Date"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Account"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Type"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Debit"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Credit"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Balance"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Ref No"}),e.jsx(n,{sx:{color:"#7267ef"},children:"Status"}),e.jsx(n,{sx:{color:"#660000"},children:"Actions"})]})}),e.jsx(re,{children:u.slice(f*m,f*m+m).map((t,r)=>e.jsxs(L,{children:[e.jsx(n,{children:t.ledger_id}),e.jsx(n,{children:S(t.transaction_date)}),e.jsx(n,{children:t.account_name}),e.jsx(n,{children:t.account_type}),e.jsx(n,{children:t.debit_amount}),e.jsx(n,{children:t.credit_amount}),e.jsx(n,{children:t.balance}),e.jsx(n,{children:t.reference_number}),e.jsx(n,{children:t.approval_status}),e.jsxs(n,{children:[e.jsx(N,{slug:d,action:"can_update",children:e.jsx(v,{onClick:()=>k(t),children:e.jsx(se,{sx:{color:"orange"}})})}),e.jsx(D,{slug:d,action:"can_delete",children:e.jsx(v,{onClick:()=>B(t.ledger_id),children:e.jsx(oe,{sx:{color:"red"}})})})]})]},r))})]}),e.jsx(ce,{rowsPerPageOptions:[5,10,25],component:"div",count:u.length,rowsPerPage:m,page:f,onPageChange:O,onRowsPerPageChange:$})]})]})};export{Le as default};
