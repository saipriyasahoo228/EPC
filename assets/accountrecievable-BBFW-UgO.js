import{r as i,j as e,T as D,J as w,S as E,I as p,K as M}from"./main-Skim5IJC.js";import{C as J}from"./Close-BKZ7QrSY.js";import{D as K}from"./Download-C4sxsXoP.js";import{E as V,a as q}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{g as Q,i as X,j as Z,k as ee,l as te}from"./account-CQ2dqr_G.js";import{f as j}from"./date-DdrLtg20.js";import{G as o}from"./Grid-fY_ATwTx.js";import{T as F,a as G,b as v,c as a,d as T}from"./TableRow-B6k_bSOs.js";import{A as ae}from"./AddCircle-CJp4DZj3.js";import{B as _,D as se,a as ne,b as oe,c as ie}from"./DialogTitle-CvDFHAwp.js";import{E as le}from"./Edit-6vcT2Cu4.js";import{D as ce}from"./Delete-Be1vvbhC.js";const be=()=>{const x="account_ledger",[N,h]=i.useState(!1),[b,f]=i.useState(""),[g,S]=i.useState([]),[I,P]=i.useState(!1),[de,re]=i.useState(null),[k,B]=i.useState([]),[m,C]=i.useState(!1),[O,A]=i.useState(null),[n,r]=i.useState({invoiceId:"",invoiceDate:"",dueDate:"",totalAmount:"",amountPaid:"",paymentStatus:"Pending",paymentMethod:"",approvalStatus:"Pending"});i.useEffect(()=>{(async()=>{try{const s=await X();B(s)}catch(s){console.error("Error fetching guests:",s)}})()},[]),i.useEffect(()=>{R()},[]);const R=async()=>{try{const t=await Q();S(t)}catch(t){console.error("Error fetching receivables:",t)}},Y=t=>{const s=`INV-${new Date().getFullYear()}-${(g.length+1).toString().padStart(3,"0")}`;f(t),r({invoiceId:s,guestId:t,invoiceDate:"",dueDate:"",totalAmount:"",amountPaid:"",paymentStatus:"Pending",paymentMethod:"",approvalStatus:"Pending"}),P(!1),h(!0)},y=()=>{r({}),h(!1),P(!1)},d=t=>{const{name:s,value:l}=t.target;r(u=>({...u,[s]:l}))},$=(parseFloat(n.totalAmount)||0)-(parseFloat(n.amountPaid)||0),L=async()=>{try{const t={guest:b,invoice_id:n.invoiceId,invoice_date:n.invoiceDate,due_date:n.dueDate,total_amount:parseFloat(n.totalAmount),amount_received:parseFloat(n.amountPaid),payment_status:n.paymentStatus,payment_method:n.paymentMethod,approval_status:n.approvalStatus};let s;m?(s=await ee(O,t),alert("Receivable updated successfully ✅")):(s=await te(t),alert("Receivable added successfully ✅")),await R(),h(!1),U()}catch(t){console.error(t),alert(`❌ Failed to ${m?"update":"add"} receivable`)}},U=()=>{C(!1),A(null),r({invoiceId:"",invoiceDate:"",dueDate:"",totalAmount:"",amountPaid:"",paymentStatus:"Pending",paymentMethod:"",approvalStatus:"Pending"}),f(null)},W=t=>{var s,l;C(!0),A(t.invoice_id),r({invoiceId:t.invoice_id||"",invoiceDate:t.invoice_date||"",dueDate:t.due_date||"",totalAmount:((s=t.total_amount)==null?void 0:s.toString())||"",amountPaid:((l=t.amount_received)==null?void 0:l.toString())||"",paymentStatus:t.payment_status||"Pending",paymentMethod:t.payment_method||"",approvalStatus:t.approval_status||"Pending"}),f(t.guest||null),h(!0)},z=async t=>{if(window.confirm(`Are you sure you want to delete invoice ${t}?`))try{await Z(t),S(l=>l.filter(u=>u.invoice_id!==t)),alert("Record deleted successfully!")}catch(l){console.error("Delete failed:",l),alert("Failed to delete record.")}},H=t=>{const s=new V("l","mm","a4");s.setFontSize(16),s.text("All Accounts Receivable Report",14,15);const l=["Invoice ID","Guest ID","Invoice Date","Due Date","Total Amount","Amount Received","Outstanding Balance","Payment Status","Payment Method","Approval Status"],u=t.map(c=>[c.invoice_id,c.guest_id,j(c.invoice_date),j(c.due_date),c.total_amount,c.amount_received,c.outstanding_balance,c.payment_status,c.payment_method,c.approval_status]);q(s,{head:[l],body:u,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),s.save("all_accounts_receivable_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(D,{variant:"h5",sx:{mt:4},children:"Accounts Receivable"}),e.jsxs(o,{container:!0,spacing:2,sx:{mt:2},direction:"column",children:[e.jsx(o,{item:!0,xs:12,children:e.jsxs(w,{sx:{p:2},children:[e.jsx(D,{variant:"h6",children:"Guest List"}),e.jsxs(F,{children:[e.jsx(G,{children:e.jsxs(v,{children:[e.jsx(a,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Guest ID"})}),e.jsx(a,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Guest Name"})}),e.jsx(a,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(T,{children:k.map((t,s)=>e.jsxs(v,{children:[e.jsx(a,{children:t.guest_id}),e.jsx(a,{children:t.name}),e.jsx(a,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{slug:x,action:"can_create",children:e.jsx(p,{onClick:()=>Y(t.guest_id),children:e.jsx(ae,{sx:{color:"#7267ef"}})})})})]},s))})]})]})}),e.jsx(o,{item:!0,xs:12,children:e.jsxs(w,{sx:{p:2},children:[e.jsx(_,{startIcon:e.jsx(K,{}),onClick:()=>H(g),children:"Download PDF"}),e.jsx(D,{variant:"h6",children:"Receivable Records"}),e.jsxs(F,{children:[e.jsx(G,{children:e.jsxs(v,{children:[e.jsx(a,{sx:{color:"#7267ef"},children:"Invoice ID"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Guest ID"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Invoice Date"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Due Date"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Total"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Paid"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Outstanding"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Payment Status"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Payment Method"}),e.jsx(a,{sx:{color:"#7267ef"},children:"Approval Status"}),e.jsx(a,{sx:{color:"#660000"},children:"Actions"})]})}),e.jsx(T,{children:g.map((t,s)=>e.jsxs(v,{children:[e.jsx(a,{children:t.invoice_id}),e.jsx(a,{children:t.guest_id}),e.jsx(a,{children:j(t.invoice_date)}),e.jsx(a,{children:j(t.due_date)}),e.jsx(a,{children:t.total_amount}),e.jsx(a,{children:t.amount_received}),e.jsx(a,{children:t.outstanding_balance}),e.jsx(a,{children:t.payment_status}),e.jsx(a,{children:t.payment_method}),e.jsx(a,{children:t.approval_status}),e.jsxs(a,{children:[e.jsx(M,{slug:x,action:"can_update",children:e.jsx(p,{onClick:()=>W(t),children:e.jsx(le,{sx:{color:"orange"}})})}),e.jsx(E,{slug:x,action:"can_delete",children:e.jsx(p,{onClick:()=>z(t.invoiceId),children:e.jsx(ce,{sx:{color:"red"}})})})]})]},s))})]})]})})]}),e.jsxs(se,{open:N,onClose:y,fullWidth:!0,children:[e.jsxs(ne,{children:[I?"Edit Receivable":"Add Receivable",e.jsx(p,{onClick:y,sx:{position:"absolute",right:8,top:8},children:e.jsx(J,{})})]}),e.jsx(oe,{children:e.jsxs(o,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Guest ID"}),e.jsx("input",{className:"input",value:b,disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Invoice ID"}),e.jsx("input",{className:"input",value:n.invoiceId||"",disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Invoice Date"}),e.jsx("input",{type:"date",name:"invoiceDate",className:"input",value:n.invoiceDate||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",name:"dueDate",className:"input",value:n.dueDate||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Total Amount"}),e.jsx("input",{type:"number",name:"totalAmount",className:"input",value:n.totalAmount||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Amount Paid"}),e.jsx("input",{type:"number",name:"amountPaid",className:"input",value:n.amountPaid||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Outstanding Balance"}),e.jsx("input",{type:"number",className:"input",value:$,disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Payment Status"}),e.jsxs("select",{name:"paymentStatus",className:"input",value:n.paymentStatus||"Pending",onChange:d,disabled:m,children:[e.jsx("option",{children:"Pending"}),e.jsx("option",{children:"Paid"}),e.jsx("option",{children:"Overdue"})]})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Payment Method"}),e.jsx("input",{name:"paymentMethod",className:"input",value:n.paymentMethod||"",onChange:d})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{children:"Approval Status"}),e.jsxs("select",{name:"approvalStatus",className:"input",value:n.approvalStatus||"Pending",onChange:d,children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]})]})}),e.jsxs(ie,{children:[e.jsx(_,{onClick:y,sx:{outline:"2px solid #800000",color:"#800000"},children:"Cancel"}),e.jsx(M,{slug:x,action:I?"can_update":"can_create",children:e.jsx(_,{variant:"outlined",onClick:L,sx:{color:"#7267ef",borderColor:"#7267ef"},children:m?"Update Receivable":"Add Receivable"})})]})]})]})};export{be as default};
