import{r as n,j as e,T as b,z as T}from"./main-IxGEKZMA.js";import{C as Q}from"./Close-DoqWsXz3.js";import{g as z,a as W,h as J,i as K,j as X,k as Y}from"./procurement-DNGl8bgG.js";import{G as a}from"./Grid-C72N-tAO.js";import{t as F,T as E,h as w,i as j,j as t,k as V,I as m,D as Z,f as ee,g as re,e as N}from"./TableRow-CRAT5KT_.js";import{A as te}from"./AddCircle-DWIRGPUh.js";import{T as se}from"./TableContainer-BaU58JEj.js";import{E as oe}from"./Edit-g2hjeeYC.js";import{D as ae}from"./Delete-cHl_EB0l.js";import{D as ne}from"./DialogActions-D5wP0Mt-.js";import"./Transition-C29ZPDdz.js";const ge=()=>{const[A,k]=n.useState(""),[C,R]=n.useState(""),[p,P]=n.useState(null),[f,x]=n.useState(!1),[B,M]=n.useState([]),[O,v]=n.useState(!1),[_,S]=n.useState([]),[s,i]=n.useState({projectId:"",purchaseOrderId:"",vendorId:"",procurementId:"",orderDate:"",deliveryDate:"",totalOrderValue:"",paymentTerms:"",taxDetails:"",orderStatus:"",invoiceId:""}),[y,$]=n.useState([]),[le,de]=n.useState(0);n.useEffect(()=>{(async()=>{try{const o=await W();$(o)}catch(o){console.error("Failed to fetch procurements:",o)}})()},[]),n.useEffect(()=>{z().then(r=>{console.log("Full API response:",r);const o=r.data||r;console.log("Vendors data to set:",o),Array.isArray(o)?S(o):(console.error("Received data is not an array:",o),S([]))}).catch(r=>console.error("Error fetching vendors:",r))},[]);const H=r=>{P(r),v(!1),x(!0)};n.useEffect(()=>{if(f&&p!==null){const r=y[p];i({projectId:r.project,procurementId:r.procurement_id,purchaseOrderId:r.purchase_order})}},[f,p]);const g=()=>{x(!1),P(null)},l=r=>{const{name:o,value:u}=r.target;i(h=>{const d={...h,[o]:u};if(o==="quantity"||o==="unitPrice"){const c=parseFloat(d.quantity)||0,D=parseFloat(d.unitPrice)||0,L=(c*D).toFixed(2);d.totalCost=L}return d})},I=async()=>{try{const r=await J();M(r)}catch(r){console.error("❌ Failed to fetch PO data:",r)}};n.useEffect(()=>{I()},[]);const U=async r=>{var u,h,d;r.preventDefault();const o={vendor:s.vendorId,procurement:s.procurementId,po_number:s.purchaseOrderId,order_date:s.orderDate,delivery_date:s.deliveryDate,total_order_value:s.totalOrderValue,payment_terms:s.paymentTerms,tax_details:s.taxDetails,order_status:s.orderStatus,invoice_id:s.invoiceId||null};try{if(O)await X(s.po_id,o),alert(`✅ Purchase Order Updated: ${s.po_id}`);else{const c=await Y(o);alert(`✅ Purchase Order Created: ${c.po_number}`)}i({}),x(!1),v(!1),I()}catch(c){const D=((d=(h=(u=c.response)==null?void 0:u.data)==null?void 0:h.po_number)==null?void 0:d[0])||"Operation failed";alert(`❌ ${D}`)}},q=r=>{i({po_id:r.po_number,vendorId:r.vendor,procurementId:r.procurement,purchaseOrderId:r.po_number,orderDate:r.order_date,deliveryDate:r.delivery_date,totalOrderValue:r.total_order_value,paymentTerms:r.payment_terms,taxDetails:r.tax_details,orderStatus:r.order_status,invoiceId:r.invoice_id||""}),v(!0),x(!0)},G=async r=>{if(window.confirm(`Are you sure you want to delete Purchase Order ${r}?`))try{await K(r),console.log(`✅ Purchase Order ${r} deleted successfully.`),I()}catch(o){console.error(`❌ Failed to delete Purchase Order ${r}:`,o)}};return y.filter(r=>Object.values(r).some(o=>o&&o.toString().toLowerCase().includes(C.toLowerCase()))),e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Purchase Order"}),e.jsx(a,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(F,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:"PURCHASE ORDERS"}),e.jsx(T,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Purchase Orders",value:A,onChange:r=>k(r.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(E,{children:[e.jsx(w,{children:e.jsxs(j,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Procurement ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Purchase Order ID"})}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(V,{children:y.map((r,o)=>e.jsxs(j,{children:[e.jsx(t,{children:r.project}),e.jsx(t,{children:r.procurement_id}),e.jsx(t,{children:r.purchase_order}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(m,{onClick:()=>H(o),color:"primary",children:e.jsx(te,{sx:{color:"#7267ef"}})})})]},r.id))})]})]})})}),e.jsx(a,{container:!0,spacing:2,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(F,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:"SUBMITTED PURCHASE RECORDS"}),e.jsx("input",{type:"text",placeholder:"Search Purchase Order Details",value:C,onChange:r=>R(r.target.value),className:"input"}),e.jsx(se,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(E,{stickyHeader:!0,children:[e.jsx(w,{children:e.jsxs(j,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"PO Number"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Vendor"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Procurement"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Order Date"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Delivery Date"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Total Value"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Payment Terms"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Tax Details"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Order Status"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Invoice ID"})}),e.jsx(t,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(V,{children:B.map((r,o)=>e.jsxs(j,{children:[e.jsx(t,{children:r.po_number}),e.jsx(t,{children:r.vendor}),e.jsx(t,{children:r.procurement}),e.jsx(t,{children:r.order_date}),e.jsx(t,{children:r.delivery_date}),e.jsx(t,{children:r.total_order_value}),e.jsx(t,{children:r.payment_terms}),e.jsx(t,{children:r.tax_details}),e.jsx(t,{children:r.order_status}),e.jsx(t,{children:r.invoice_id}),e.jsxs(t,{children:[e.jsx(m,{color:"warning",onClick:()=>q(r),children:e.jsx(oe,{sx:{color:"orange"}})}),e.jsx(m,{color:"error",onClick:()=>G(r.po_number),children:e.jsx(ae,{sx:{color:"red"}})})]})]},r.id||o))})]})})]})})}),e.jsxs(Z,{open:f,onClose:g,fullWidth:!0,children:[e.jsx(ee,{children:"Enter Purchase Order Details"}),e.jsxs(re,{sx:{position:"relative"},children:[e.jsx(m,{"aria-label":"close",onClick:g,sx:{position:"absolute",right:8,top:8,color:r=>r.palette.grey[500]},children:e.jsx(Q,{})}),e.jsx(T,{component:"form",sx:{mt:2},children:e.jsxs(a,{container:!0,spacing:3,direction:"column",children:[e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Purchase Order & Vendor info.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"purchaseOrderId",children:"Purchase Order ID"}),e.jsx("input",{id:"purchaseOrderId",name:"purchaseOrderId",className:"input",value:s.purchaseOrderId||"",disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",name:"projectId",className:"input",value:s.projectId||"",disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"vendorId",children:"Vendor ID"}),e.jsxs("select",{id:"vendorId",name:"vendorId",className:"input",value:s.vendorId||"",onChange:r=>i({...s,vendorId:r.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Vendor --"}),Array.isArray(_)&&_.map(r=>e.jsxs("option",{value:r.vendor_id,children:[r.vendor_id," - ",r.vendor_name]},r.id))]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"procurementId",children:"Procurement ID"}),e.jsx("input",{id:"procurementId",name:"procurementId",className:"input",value:s.procurementId||"",disabled:!0})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Material Information & Payment.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"orderDate",children:"Order Date "}),e.jsx("input",{type:"date",id:"orderDate",name:"orderDate",className:"input",value:s.orderDate||"",onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"deliveryDate",children:"Dalivery Date "}),e.jsx("input",{type:"date",id:"deliveryDate",name:"deliveryDate",className:"input",value:s.deliveryDate||"",onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"totalOrderValue",children:"Total Order Value"}),e.jsx("input",{type:"number",id:"totalOrderValue",name:"totalOrderValue",className:"input",value:s.totalOrderValue||"",onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"paymentTerms",children:"Payment Terms"}),e.jsx("input",{id:"paymentTerms",name:"paymentTerms",className:"input",value:s.paymentTerms||"",onChange:l})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Tax & Order Status.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"taxDetails",children:"Tax Details"}),e.jsx("input",{id:"taxDetails",name:"taxDetails",className:"input",value:s.taxDetails||"",onChange:l})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"orderStatus",children:"Order Status"}),e.jsxs("select",{id:"orderStatus",name:"orderStatus",className:"input",value:s.orderStatus||"",onChange:l,children:[e.jsx("option",{value:"",children:"Select Status"})," ",e.jsx("option",{value:"Issued",children:"Issued"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Delivered",children:"Delivered"}),e.jsx("option",{value:"Canceled",children:"Canceled"})]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"requestDate",children:"Invoice Id"}),e.jsx("input",{id:"invoiceId",name:"invoiceId",className:"input",value:s.invoiceId||"",onChange:l})]})]})]})]})})]}),e.jsxs(ne,{children:[e.jsx(N,{onClick:g,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(N,{variant:"outlined",onClick:U,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:O?"Update":"Submit"})]})]})]})};export{ge as default};
