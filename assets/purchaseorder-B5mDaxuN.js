import{r as a,j as e}from"./main-DTv03d8r.js";import{C as G}from"./Close-BAEP8ymL.js";import{a as L,h as Q,i as z,j as W,k as J}from"./procurement-DdbtAVRG.js";import{T as D,H as C,v as P,w as O,x as u,y as t,z as S,I as h,D as K,r as X,t as Y,q as _}from"./TableRow-DyRCyY9b.js";import{G as o}from"./Grid-C5mdLuvI.js";import{B as T}from"./Box-CyTnG5kx.js";import{A as Z}from"./AddCircle-Br8tjFgv.js";import{T as ee}from"./TableContainer-DOhr4ZW5.js";import{E as re,D as te}from"./Edit-DGVU-IuU.js";import{D as se}from"./DialogActions-CMm5oWDU.js";import"./api-Dv6wi5j0.js";import"./auth-4s9nFscl.js";import"./Transition-ChWAEdMD.js";const ye=()=>{const[F,w]=a.useState(""),[I,E]=a.useState(""),[j,g]=a.useState(null),[m,i]=a.useState(!1),[N,V]=a.useState([]),[b,p]=a.useState(!1),[s,c]=a.useState({projectId:"",purchaseOrderId:"",vendorId:"",procurementId:"",orderDate:"",deliveryDate:"",totalOrderValue:"",paymentTerms:"",taxDetails:"",orderStatus:"",invoiceId:""}),[f,k]=a.useState([]),[oe,ne]=a.useState(0);a.useEffect(()=>{(async()=>{try{const n=await L();k(n)}catch(n){console.error("Failed to fetch procurements:",n)}})()},[]);const B=r=>{g(r),p(!1),i(!0)};a.useEffect(()=>{if(m&&j!==null){const r=f[j];c({projectId:r.project,procurementId:r.procurement_id,purchaseOrderId:r.purchase_order})}},[m,j]);const v=()=>{i(!1),g(null)},l=r=>{const{name:n,value:d}=r.target;c(q=>{const x={...q,[n]:d};if(n==="quantity"||n==="unitPrice"){const M=parseFloat(x.quantity)||0,U=parseFloat(x.unitPrice)||0,$=(M*U).toFixed(2);x.totalCost=$}return x})},y=async()=>{try{const r=await Q();V(r)}catch(r){console.error("❌ Failed to fetch PO data:",r)}};a.useEffect(()=>{y()},[]);const R=async r=>{r.preventDefault();const n={vendor:s.vendorId,procurement:s.procurementId,order_date:s.orderDate,delivery_date:s.deliveryDate,total_order_value:s.totalOrderValue,payment_terms:s.paymentTerms,tax_details:s.taxDetails,order_status:s.orderStatus,invoice_id:s.invoiceId||null};try{if(b)await W(s.po_id,n),alert(`✅ Purchase Order Updated: ${s.po_id}`);else{const d=await J(n);alert(`✅ Purchase Order Created: ${d.po_number}`)}c({}),i(!1),p(!1),y()}catch(d){console.error("❌ Submission failed:",d),alert("❌ Submission failed")}},A=r=>{c({po_id:r.po_number,vendorId:r.vendor,procurementId:r.procurement,orderDate:r.order_date,deliveryDate:r.delivery_date,totalOrderValue:r.total_order_value,paymentTerms:r.payment_terms,taxDetails:r.tax_details,orderStatus:r.order_status,invoiceId:r.invoice_id||""}),p(!0),i(!0)},H=async r=>{if(window.confirm(`Are you sure you want to delete Purchase Order ${r}?`))try{await z(r),console.log(`✅ Purchase Order ${r} deleted successfully.`),y()}catch(n){console.error(`❌ Failed to delete Purchase Order ${r}:`,n)}};return f.filter(r=>Object.values(r).some(n=>n&&n.toString().toLowerCase().includes(I.toLowerCase()))),e.jsxs(e.Fragment,{children:[e.jsx(D,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Purchase Order"}),e.jsx(o,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(o,{item:!0,xs:12,children:e.jsxs(C,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(D,{variant:"h6",gutterBottom:!0,children:"PURCHASE ORDERS"}),e.jsx(T,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Purchase Orders",value:F,onChange:r=>w(r.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(P,{children:[e.jsx(O,{children:e.jsxs(u,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Procurement ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Purchase Order ID"})}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(S,{children:f.map((r,n)=>e.jsxs(u,{children:[e.jsx(t,{children:r.project}),e.jsx(t,{children:r.procurement_id}),e.jsx(t,{children:r.purchase_order}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(h,{onClick:()=>B(n),color:"primary",children:e.jsx(Z,{sx:{color:"#7267ef"}})})})]},r.id))})]})]})})}),e.jsx(o,{container:!0,spacing:2,children:e.jsx(o,{item:!0,xs:12,children:e.jsxs(C,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(D,{variant:"h6",gutterBottom:!0,children:"SUBMITTED PURCHASE RECORDS"}),e.jsx("input",{type:"text",placeholder:"Search Purchase Order Details",value:I,onChange:r=>E(r.target.value),className:"input"}),e.jsx(ee,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(P,{stickyHeader:!0,children:[e.jsx(O,{children:e.jsxs(u,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"PO Number"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Vendor"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Procurement"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Order Date"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Delivery Date"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Total Value"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Payment Terms"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Tax Details"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Order Status"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Invoice ID"})}),e.jsx(t,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(S,{children:N.map((r,n)=>e.jsxs(u,{children:[e.jsx(t,{children:r.po_number}),e.jsx(t,{children:r.vendor}),e.jsx(t,{children:r.procurement}),e.jsx(t,{children:r.order_date}),e.jsx(t,{children:r.delivery_date}),e.jsx(t,{children:r.total_order_value}),e.jsx(t,{children:r.payment_terms}),e.jsx(t,{children:r.tax_details}),e.jsx(t,{children:r.order_status}),e.jsx(t,{children:r.invoice_id}),e.jsxs(t,{children:[e.jsx(h,{color:"warning",onClick:()=>A(r),children:e.jsx(re,{sx:{color:"orange"}})}),e.jsx(h,{color:"error",onClick:()=>H(r.po_number),children:e.jsx(te,{sx:{color:"red"}})})]})]},r.id||n))})]})})]})})}),e.jsxs(K,{open:m,onClose:v,fullWidth:!0,children:[e.jsx(X,{children:"Enter Purchase Order Details"}),e.jsxs(Y,{sx:{position:"relative"},children:[e.jsx(h,{"aria-label":"close",onClick:v,sx:{position:"absolute",right:8,top:8,color:r=>r.palette.grey[500]},children:e.jsx(G,{})}),e.jsx(T,{component:"form",sx:{mt:2},children:e.jsxs(o,{container:!0,spacing:3,direction:"column",children:[e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Purchase Order & Vendor info.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"purchaseOrderId",children:"Purchase Order ID"}),e.jsx("input",{id:"purchaseOrderId",name:"purchaseOrderId",className:"input",value:s.purchaseOrderId||"",disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",name:"projectId",className:"input",value:s.projectId||"",disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"vendorId",children:"Vendor ID"}),e.jsx("input",{id:"vendorId",name:"vendorId",className:"input",value:s.vendorId||"",onChange:l})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"procurementId",children:"Procurement ID"}),e.jsx("input",{id:"procurementId",name:"procurementId",className:"input",value:s.procurementId||"",disabled:!0})]})]})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Material Information & Payment.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"orderDate",children:"Order Date "}),e.jsx("input",{type:"date",id:"orderDate",name:"orderDate",className:"input",value:s.orderDate||"",onChange:l})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"deliveryDate",children:"Dalivery Date "}),e.jsx("input",{type:"date",id:"deliveryDate",name:"deliveryDate",className:"input",value:s.deliveryDate||"",onChange:l})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"totalOrderValue",children:"Total Order Value"}),e.jsx("input",{type:"number",id:"totalOrderValue",name:"totalOrderValue",className:"input",value:s.totalOrderValue||"",onChange:l})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"paymentTerms",children:"Payment Terms"}),e.jsx("input",{id:"paymentTerms",name:"paymentTerms",className:"input",value:s.paymentTerms||"",onChange:l})]})]})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Tax & Order Status.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"taxDetails",children:"Tax Details"}),e.jsx("input",{id:"taxDetails",name:"taxDetails",className:"input",value:s.taxDetails||"",onChange:l})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"orderStatus",children:"Order Status"}),e.jsxs("select",{id:"orderStatus",name:"orderStatus",className:"input",value:s.orderStatus||"",onChange:l,children:[e.jsx("option",{value:"",children:"Select Status"})," ",e.jsx("option",{value:"Issued",children:"Issued"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Delivered",children:"Delivered"}),e.jsx("option",{value:"Canceled",children:"Canceled"})]})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"requestDate",children:"Invoice Id"}),e.jsx("input",{id:"invoiceId",name:"invoiceId",className:"input",value:s.invoiceId||"",onChange:l})]})]})]})]})})]}),e.jsxs(se,{children:[e.jsx(_,{onClick:v,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(_,{variant:"outlined",onClick:R,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:b?"Update":"Submit"})]})]})]})};export{ye as default};
