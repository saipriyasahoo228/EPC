import{r as l,j as e,T as u,x as C,S as z,D as L}from"./main-BIxdd69i.js";import{C as ce}from"./Close-D340Gps3.js";import{g as de}from"./engineering-4VzvUWDc.js";import{g as pe,d as xe,u as me,c as he}from"./procurement-Dxzq-DH5.js";import{D as ue}from"./Download-D_b47uoU.js";import{E as je,a as ge}from"./jspdf.plugin.autotable-y_YJgUzU.js";import{G as n}from"./Grid-BnZNKmae.js";import{P as Y,I as p,e as I,D as fe,f as ye,g as be,h as Ce}from"./DialogTitle-D59uELMl.js";import{T as $,a as U,b as j,c as t,d as W}from"./TableRow-D8X36zJO.js";import{A as Se}from"./AddCircle-Bn9h5MaP.js";import{A as G,a as H}from"./ArrowForwardIos-DapvvZ-0.js";import{T as ve}from"./TableContainer-1Xqyy-f8.js";import{E as Pe}from"./Edit-BJV-h6Li.js";import{D as _e}from"./Delete-BHKbKfZ2.js";import{M as Ne,a as De}from"./minimize-2-Dl_U24Qm.js";const Ue=()=>{const g="procurement",[T,J]=l.useState(""),[E,Q]=l.useState(""),[q,f]=l.useState(!1),[V,S]=l.useState(""),[v,K]=l.useState([]),[X,Z]=l.useState([]),[y,F]=l.useState(null),[we,ee]=l.useState("create"),P=4,[m,_]=l.useState(1),[N,re]=l.useState(!1),[h,R]=l.useState(1),D=5,[o,b]=l.useState({vendorId:"",vendorName:"",contactPerson:"",phoneNumber:"",email:"",address:"",vendorRating:"",complianceStatus:"",approvedSupplier:"",paymentTerms:"",contractExpiryDate:""}),te=()=>{re(!N)},A=X.filter(r=>r.project_id.toLowerCase().includes(T.toLowerCase())),k=Math.ceil(A.length/P),M=A.slice((m-1)*P,m*P),se=r=>{S(r);const s=new Date().getFullYear(),i=(v.length+1).toString().padStart(3,"0"),a=`${s}-VND-${i}`;b({vendorId:a}),f(!0)},w=()=>f(!1),c=r=>{const{name:s,value:d}=r.target;b(i=>({...i,[s]:d}))};l.useEffect(()=>{(async()=>{try{const s=await de();console.log("Fetched projects:",s),Z(s)}catch(s){console.error("Failed to fetch accepted projects:",s)}})()},[]);const ne=async()=>{var s,d;const r=new FormData;r.append("project",V),r.append("vendor_name",o.vendorName),r.append("contact_person",o.contactPerson),r.append("phone_number",o.phoneNumber),r.append("email",o.email),r.append("address",o.address),r.append("vendor_rating",o.vendorRating),r.append("compliance_status",o.complianceStatus),o.approvedSupplier!==""&&r.append("approved_supplier",o.approvedSupplier==="true"),r.append("payment_terms",o.paymentTerms),r.append("contract_expiry_date",o.contractExpiryDate);try{y?(await me(y,r),alert("✅ Vendor updated successfully!")):(await he(r),alert("✅ Vendor submitted successfully!")),b({vendorId:"",vendorName:"",contactPerson:"",phoneNumber:"",email:"",address:"",vendorRating:"",complianceStatus:"",approvedSupplier:"",paymentTerms:"",contractExpiryDate:""}),S(null),F(null),f(!1),await(x==null?void 0:x())}catch(i){console.error("❌ Submission failed:",((s=i.response)==null?void 0:s.data)||i.message),alert(`❌ Submission failed:
${JSON.stringify(((d=i.response)==null?void 0:d.data)||{},null,2)}`)}},oe=async r=>{var d;if(!r){alert("❌ Vendor ID is missing.");return}if(window.confirm(`Are you sure you want to delete ${r}?`))try{await xe(r),alert(`✅ Vendor ${r} deleted successfully!`),await(x==null?void 0:x())}catch(i){const a=((d=i.response)==null?void 0:d.data)||i.message;alert(`❌ Failed to delete vendor: ${JSON.stringify(a)}`)}},x=async()=>{try{const r=await pe();K(r)}catch(r){console.error("Failed to fetch vendors:",r)}};l.useEffect(()=>{x()},[]);const ae=r=>{if(!r||!r.vendor_id){console.error("Invalid vendor data:",r);return}F(r.vendor_id),S(r.project),b({vendorId:r.vendor_id,vendorName:r.vendor_name||"",contactPerson:r.contact_person||"",phoneNumber:r.phone_number||"",email:r.email||"",address:r.address||"",vendorRating:r.vendor_rating||"",complianceStatus:r.compliance_status||"",approvedSupplier:r.approved_supplier!==void 0?r.approved_supplier.toString():"",paymentTerms:r.payment_terms||"",contractExpiryDate:r.contract_expiry_date||""}),ee("edit"),f(!0)},O=v.filter(r=>Object.values(r).some(s=>s&&s.toString().toLowerCase().includes(E.toLowerCase()))),B=Math.ceil(O.length/D),le=O.slice((h-1)*D,h*D),ie=r=>{const s=new je("l","mm","a4");s.setFontSize(16),s.text("All Feasibility Report",14,15);const d=["Project","Vendor ID","Vendor Name","Contact Person","Phone Number","Email","Address","Rating","Compliance Status","Approved Supplier","Payment Terms","Contract Expiry Date"],i=r.map(a=>[a.project,a.vendor_id,a.vendor_name,a.contact_person,a.phone_number,a.email,a.address,a.vendor_rating,a.compliance_status,a.approvedSupplier?"Yes":"No",a.payment_terms,a.contract_expiry_date]);ge(s,{head:[d],body:i,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),s.save("vendor report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Vendor Management"}),e.jsx(n,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(Y,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(u,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(C,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:T,onChange:r=>{J(r.target.value),_(1)},className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs($,{children:[e.jsx(U,{children:e.jsxs(j,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(W,{children:M.length>0?M.map((r,s)=>e.jsxs(j,{children:[e.jsx(t,{children:r.project_id}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(z,{slug:g,action:"can_create",children:e.jsx(p,{onClick:()=>se(r.project_id),color:"primary",children:e.jsx(Se,{sx:{color:"#7267ef"}})})})})]},s)):e.jsx(j,{children:e.jsx(t,{colSpan:2,align:"center",children:"No records found"})})})]}),e.jsxs(C,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(p,{disabled:m===1,onClick:()=>_(r=>r-1),children:e.jsx(G,{})}),e.jsxs(u,{variant:"body2",sx:{mx:2},children:["Page ",m," of ",k||1]}),e.jsx(p,{disabled:m>=k,onClick:()=>_(r=>r+1),children:e.jsx(H,{})})]})]})})}),e.jsx(n,{container:!0,spacing:2,children:e.jsx(n,{item:!0,xs:12,children:e.jsxs(Y,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(I,{startIcon:e.jsx(ue,{}),onClick:()=>ie(v)}),e.jsx(u,{variant:"h6",gutterBottom:!0,children:"SUBMITTED VENDOR RECORDS"}),e.jsx("input",{type:"text",placeholder:"Search Vendors",value:E,onChange:r=>Q(r.target.value),className:"input"}),e.jsx(ve,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs($,{stickyHeader:!0,children:[e.jsx(U,{children:e.jsxs(j,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Vendor ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Vendor Name"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Contact Person"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Phone Number"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Email Address"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Address"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Rating"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance Status"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approved"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Payment Terms"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Contract Expiry"})}),e.jsx(t,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(W,{children:le.map((r,s)=>e.jsxs(j,{children:[e.jsx(t,{children:r.project}),e.jsx(t,{children:r.vendor_id}),e.jsx(t,{children:r.vendor_name}),e.jsx(t,{children:r.contact_person}),e.jsx(t,{children:r.phone_number}),e.jsx(t,{children:r.email}),e.jsx(t,{children:r.address}),e.jsx(t,{children:r.vendor_rating}),e.jsx(t,{children:r.compliance_status}),e.jsx(t,{children:r.approvedSupplier?"Yes":"No"}),e.jsx(t,{children:r.payment_terms}),e.jsx(t,{children:r.contract_expiry_date}),e.jsxs(t,{children:[e.jsx(L,{slug:g,action:"can_update",children:e.jsx(p,{color:"warning",onClick:()=>ae(r),children:e.jsx(Pe,{sx:{color:"orange"}})})}),e.jsx(z,{slug:g,action:"can_delete",children:e.jsx(p,{color:"error",onClick:()=>oe(r.vendor_id),children:e.jsx(_e,{sx:{color:"red"}})})})]})]},s))})]})}),e.jsxs(C,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(p,{disabled:h===1,onClick:()=>R(r=>r-1),children:e.jsx(G,{})}),e.jsxs(u,{variant:"body2",sx:{mx:2},children:["Page ",h," of ",B||1]}),e.jsx(p,{disabled:h>=B,onClick:()=>R(r=>r+1),children:e.jsx(H,{})})]})]})})}),e.jsxs(fe,{open:q,onClose:w,fullWidth:!0,maxWidth:"xl",PaperProps:{style:N?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(ye,{children:"Enter Vendor Details"}),e.jsxs(be,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(p,{"aria-label":"toggle-size",onClick:te,sx:{position:"absolute",right:40,top:8,color:r=>r.palette.grey[600]},children:N?e.jsx(Ne,{}):e.jsx(De,{})}),e.jsx(p,{"aria-label":"close",onClick:w,sx:{position:"absolute",right:8,top:8,color:r=>r.palette.grey[500]},children:e.jsx(ce,{})}),e.jsx(C,{component:"form",sx:{mt:2},children:e.jsxs(n,{container:!0,spacing:3,direction:"column",children:[e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Vendor Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"vendorId",children:"Vendor ID"}),e.jsx("input",{id:"vendorId",name:"vendorId",className:"input",value:o.vendorId||"",onChange:c,disabled:!0})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:V,disabled:!0})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"vendorName",children:"Vendor Name"}),e.jsx("input",{id:"vendorName",name:"vendorName",className:"input",value:o.vendorName||"",onChange:c})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"contactPerson",children:"Contact Person"}),e.jsx("input",{id:"contactPerson",name:"contactPerson",className:"input",value:o.contactPerson||"",onChange:c})]})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Compliance & Status"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"email",children:"Email Address"}),e.jsx("input",{id:"email",name:"email",type:"email",className:"input",value:o.email||"",onChange:c})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsx("input",{id:"phoneNumber",name:"phoneNumber",className:"input",value:o.phoneNumber||"",onChange:c})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"address",children:"Address"}),e.jsx("textarea",{id:"address",name:"address",className:"input",rows:3,value:o.address||"",onChange:c})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"vendorRating",children:"Vendor Rating"}),e.jsx("input",{type:"number",id:"vendorRating",name:"vendorRating",className:"input",value:o.vendorRating||"",onChange:c,min:0,max:5})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"complianceStatus",children:"Compliance Status"}),e.jsxs("select",{id:"complianceStatus",name:"complianceStatus",className:"input",value:o.complianceStatus,onChange:c,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Compliant",children:"Compliant"}),e.jsx("option",{value:"Non-Compliant",children:"Non-Compliant"})]})]})]})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Approval & Payment"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvedSupplier",children:"Approved Supplier"}),e.jsxs("select",{id:"approvedSupplier",name:"approvedSupplier",className:"input",value:o.approvedSupplier||"",onChange:c,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"true",children:"Yes"}),e.jsx("option",{value:"false",children:"No"})]})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"paymentTerms",children:"Payment Terms"}),e.jsx("input",{id:"paymentTerms",name:"paymentTerms",className:"input",value:o.paymentTerms||"",onChange:c})]}),e.jsxs(n,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"contractExpiryDate",children:"Contract Expiry Date"}),e.jsx("input",{type:"date",id:"contractExpiryDate",name:"contractExpiryDate",className:"input",value:o.contractExpiryDate||"",onChange:c})]})]})]})]})})]}),e.jsxs(Ce,{children:[e.jsx(I,{onClick:w,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(L,{slug:g,action:y?"can_update":"can_create",children:e.jsx(I,{variant:"outlined",onClick:ne,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:y?"Update Vendor":"Submit Vendor"})})]})]})]})};export{Ue as default};
