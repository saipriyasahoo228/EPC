import{r,j as e,T as f,x as w,S as M,D as T}from"./main-BIxdd69i.js";import{C as V}from"./Close-D340Gps3.js";import{g as X,a as E,b as Z,e as ee}from"./maintenance-B4U_mUx1.js";import{G as i}from"./Grid-BnZNKmae.js";import{P as k,I as h,D as se,f as te,g as ne,h as ae,e as A}from"./DialogTitle-D59uELMl.js";import{T as F,a as P,b as p,c as t,d as N}from"./TableRow-D8X36zJO.js";import{A as ie}from"./AddCircle-Bn9h5MaP.js";import{T as re}from"./TableContainer-1Xqyy-f8.js";import{E as le}from"./Edit-BJV-h6Li.js";import{D as ce}from"./Delete-BHKbKfZ2.js";import{M as oe,a as de}from"./minimize-2-Dl_U24Qm.js";const Ce=()=>{const u="maintenance",[y,q]=r.useState(""),[D,B]=r.useState(""),[m,R]=r.useState(!1),[O,j]=r.useState(!1),[he,$]=r.useState(""),[n,d]=r.useState({}),[v,S]=r.useState([]),[z,b]=r.useState(!1),[ue,C]=r.useState(null),[L,G]=r.useState([]),[_,Q]=r.useState(null),W=()=>{R(!m)};r.useEffect(()=>{(async()=>{try{const a=await X();G(a)}catch(a){console.error("❌ Failed to fetch assets:",a)}})()},[]);const I=async()=>{try{const s=await E();S(s),console.log(s)}catch(s){console.error("❌ Error loading schedules:",s)}};r.useEffect(()=>{I()},[]);const H=s=>{$(s);const a=new Date().getFullYear(),o=(v.length+1).toString().padStart(3,"0");d({maintenanceID:`MNT-${a}-${o}`,assetId:s}),b(!1),C(null),j(!0)},U=s=>{d({assetId:s.asset||"",maintenanceID:s.maintenance_id||"",maintenanceType:s.maintenance_type||"",scheduledDate:s.scheduled_date||"",frequency:s.frequency||"",technicianId:s.assigned_technician_id||"",taskDescription:s.task_description||"",sparePart:s.spare_parts_required||"",EstimatedDowntime:s.estimated_downtime||"",approvalStatus:s.approval_status||"Pending"}),Q(s.maintenance_id),j(!0)},Y=async s=>{var a;if(window.confirm(`Are you sure you want to delete schedule ${s}?`))try{await Z(s),alert(`✅ Schedule ${s} deleted successfully!`);const c=await E();S(c)}catch(c){alert(`❌ Failed to delete schedule:
${JSON.stringify(((a=c.response)==null?void 0:a.data)||c.message,null,2)}`),console.error("❌ Delete error:",c)}},x=()=>{j(!1),d({}),b(!1),C(null)},l=s=>{const{name:a,value:c}=s.target;d(o=>({...o,[a]:c}))},J=async()=>{var s,a,c;try{const o={asset_id:n.assetId||"",maintenance_type:n.maintenanceType||"",scheduled_date:n.scheduledDate||"",frequency:n.frequency||"",assigned_technician_id:n.technicianId||"",task_description:n.taskDescription||"",spare_parts_required:n.sparePart||"",estimated_downtime:n.EstimatedDowntime||null,approval_status:n.approvalStatus||"Pending"},g=await ee(o);alert(`✅ Maintenance Schedule created!
Generated ID: ${g.data.maintenance_id}`),I(),d({}),x()}catch(o){const g=((a=(s=o.response)==null?void 0:s.data)==null?void 0:a.detail)||((c=o.response)==null?void 0:c.data)||o.message;alert(`❌ Failed to create schedule:
${JSON.stringify(g,null,2)}`)}},K=v.filter(s=>Object.values(s).some(a=>a&&a.toString().toLowerCase().includes(D.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Maintenance Scheduling Details"}),e.jsx(i,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(k,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(f,{variant:"h6",gutterBottom:!0,children:"ASSETS RECORDS"}),e.jsx(w,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Asset ID",value:y,onChange:s=>q(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(F,{children:[e.jsx(P,{children:e.jsxs(p,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(N,{children:L.filter(s=>s.asset_id.toLowerCase().includes(y.toLowerCase())).map((s,a)=>e.jsxs(p,{children:[e.jsx(t,{children:s.asset_id}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(M,{slug:u,action:"can_create",children:e.jsx(h,{onClick:()=>H(s.asset_id),color:"primary",children:e.jsx(ie,{sx:{color:"#7267ef"}})})})})]},a))})]})]})})}),e.jsx(i,{container:!0,spacing:2,children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(k,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(f,{variant:"h6",gutterBottom:!0,children:"Maintenance Scheduling Details"}),e.jsx("input",{type:"text",placeholder:"Search Maintenance Scheduling Details",value:D,onChange:s=>B(s.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(re,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(F,{stickyHeader:!0,children:[e.jsx(P,{children:e.jsxs(p,{children:[e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Maintenance ID"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Maintenance Type"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Scheduled Date"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Frequency"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Assigned TechnicianId"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Task Description"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Spare Parts Required"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Estimated Downtime"})}),e.jsx(t,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Status"})}),e.jsx(t,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(N,{children:K.map((s,a)=>e.jsxs(p,{children:[e.jsx(t,{children:s.asset_id}),e.jsx(t,{children:s.maintenance_id}),e.jsx(t,{children:s.maintenance_type}),e.jsx(t,{children:s.scheduled_date}),e.jsx(t,{children:s.frequency}),e.jsx(t,{children:s.assigned_technician_id}),e.jsx(t,{children:s.task_description}),e.jsx(t,{children:s.spare_parts_required}),e.jsx(t,{children:s.estimated_downtime}),e.jsx(t,{children:s.approval_status}),e.jsxs(t,{children:[e.jsx(T,{slug:u,action:"can_update",children:e.jsx(h,{onClick:()=>U(s),color:"warning",children:e.jsx(le,{sx:{color:"orange"}})})}),e.jsx(M,{slug:u,action:"can_delete",children:e.jsx(h,{onClick:()=>Y(s.maintenance_id),color:"error",children:e.jsx(ce,{sx:{color:"red"}})})})]})]},a))})]})})]})})}),e.jsxs(se,{open:O,onClose:x,fullWidth:!0,maxWidth:"xl",PaperProps:{style:m?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(te,{children:z?"Edit Maintenance Scheduling Details":"Enter Maintenance Scheduling Details"}),e.jsxs(ne,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(h,{"aria-label":"toggle-size",onClick:W,sx:{position:"absolute",right:40,top:8,color:s=>s.palette.grey[600]},children:m?e.jsx(oe,{}):e.jsx(de,{})}),e.jsx(h,{"aria-label":"close",onClick:x,sx:{position:"absolute",right:8,top:8,color:s=>s.palette.grey[500]},children:e.jsx(V,{})}),e.jsx(w,{component:"form",sx:{mt:2},children:e.jsx(i,{container:!0,spacing:3,direction:"column",children:e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Maintenance Scheduling Info.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"assetId",children:"Asset ID"}),e.jsx("input",{id:"assetId",name:"assetId",className:"input",value:n.assetId||"",onChange:l,disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"maintenanceID",children:"Maintenance ID"}),e.jsx("input",{id:"maintenanceID",name:"maintenanceID",className:"input",value:n.maintenanceID||"",onChange:l,disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"maintenanceType",children:"Maintenance Type"}),e.jsxs("select",{id:"maintenanceType",name:"maintenanceType",className:"input",value:n.maintenanceType||"",onChange:l,children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"Preventive",children:"Preventive"}),e.jsx("option",{value:"Predictive",children:"Predictive"}),e.jsx("option",{value:"Corrective",children:"Corrective"}),e.jsx("option",{value:"Breakdown",children:"Breakdown"})]})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"scheduledDate",children:"Scheduled Date"}),e.jsx("input",{type:"date",id:"scheduledDate",name:"scheduledDate",className:"input",value:n.scheduledDate||"",onChange:l})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"frequency",children:"Frequency"}),e.jsxs("select",{id:"frequency",name:"frequency",className:"input",value:n.frequency||"",onChange:l,children:[e.jsx("option",{value:"",children:"-- Select Frequency --"}),e.jsx("option",{value:"Daily",children:"Daily"}),e.jsx("option",{value:"Weekly",children:"Weekly"}),e.jsx("option",{value:"Monthly",children:"Monthly"}),e.jsx("option",{value:"Quarterly",children:"Quarterly"}),e.jsx("option",{value:"Annually",children:"Annually"})]})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"technicianId",children:"Technician ID"}),e.jsx("input",{id:"technicianId",name:"technicianId",className:"input",value:n.technicianId||"",onChange:l})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"taskDescription",children:"Task Description"}),e.jsx("input",{id:"taskDescription",name:"taskDescription",className:"input",value:n.taskDescription||"",onChange:l})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"purchaseDate",children:"Purchase Date"}),e.jsx("input",{type:"date",id:"purchaseDate",name:"purchaseDate",className:"input",value:n.purchaseDate||"",onChange:l})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"sparePart",children:"Spare Parts Required"}),e.jsx("input",{id:"sparePart",name:"sparePart",className:"input",value:n.sparePart||"",onChange:l})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"EstimatedDowntime",children:"Estimated Downtime"}),e.jsx("input",{type:"number",id:"EstimatedDowntime",name:"EstimatedDowntime",className:"input",value:n.EstimatedDowntime||"",onChange:l})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:n.approvalStatus||"",onChange:l,children:[e.jsx("option",{value:"",children:"-- Select Status --"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Completed",children:"Completed"})]})]})]})]})})})]}),e.jsxs(ae,{children:[e.jsx(A,{onClick:x,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(T,{slug:u,action:_?"can_update":"can_create",children:e.jsx(A,{variant:"outlined",onClick:J,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:_?"Update":"Submit"})})]})]})]})};export{Ce as default};
