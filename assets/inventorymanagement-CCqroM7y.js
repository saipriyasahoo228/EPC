import{r as i,j as e,T as g,J as T,E as P,S as L,I as x,K as U}from"./main-Skim5IJC.js";import{C as se}from"./Close-BKZ7QrSY.js";import{D as ae}from"./Download-C4sxsXoP.js";import{E as le,a as ie}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{g as ne}from"./engineering-BJ3wTiKO.js";import{g as oe}from"./inventory-BCILrqmV.js";import{Q as ce,R as de,S as xe,n as he}from"./construction-CMO2W9OH.js";import{g as ue}from"./procurement-BWIn9uW6.js";import{f as F}from"./date-DdrLtg20.js";import{G as l}from"./Grid-fY_ATwTx.js";import{T as R,a as k,b as j,c as s,d as q}from"./TableRow-B6k_bSOs.js";import{A as me}from"./AddCircle-CJp4DZj3.js";import{B as v,D as pe,a as je,b as fe,c as ye}from"./DialogTitle-CvDFHAwp.js";import{T as ge}from"./TableContainer-gCCy6yK7.js";import{E as ve}from"./Edit-6vcT2Cu4.js";import{D as Ie}from"./Delete-Be1vvbhC.js";import{M as De,a as be}from"./minimize-2-RCuvNn0X.js";const Qe=()=>{const h="construction",[f,A]=i.useState(!1),[Ce,I]=i.useState(null),[D,O]=i.useState(""),[b,B]=i.useState(""),[z,y]=i.useState(!1),[C,S]=i.useState(""),[Q,Se]=i.useState([]),[Y,V]=i.useState([]),[_,J]=i.useState([]),[W,G]=i.useState([]),[H,M]=i.useState([]),[u,w]=i.useState(null),[n,c]=i.useState({materialID:"",materialName:"",quantityUsed:"",reorderLevel:"",supplierID:"",deliveryDate:""}),$=()=>{A(!f)};i.useEffect(()=>{(async()=>{try{const r=await ne();V(r)}catch(r){console.error("❌ Error fetching projects:",r)}})()},[]),i.useEffect(()=>{(async()=>{try{const r=await oe();J(r)}catch(r){console.error("❌ Error loading inventory items:",r)}})()},[]),i.useEffect(()=>{(async()=>{try{const r=await ue();G(r)}catch(r){console.error("❌ Error fetching vendors:",r)}})()},[]);const E=async()=>{try{const t=await ce();M(t)}catch(t){console.error("❌ Error loading inventory:",t)}};i.useEffect(()=>{E()},[]);const K=t=>{const r=t.target.value,a=_.find(o=>o.item_id===r);a&&c(o=>({...o,materialID:a.item_id,materialName:a.item_name}))},X=(t,r=null)=>{S(t),I(r),c(r!==null?Q[r]:{}),y(!0)},m=()=>{y(!1),I(null),c({})},p=t=>{const{name:r,value:a}=t.target;c(o=>({...o,[r]:a}))},Z=async()=>{var t;try{const r={material:n.materialID,project:C,material_name:n.materialName,quantity_used:n.quantityUsed,reorder_level:n.reorderLevel,supplier:n.supplierID,delivery_date:n.deliveryDate};let a;u?(a=await xe(u,r),alert("✏️ Updated successfully!")):(a=await he(r),alert("✅ Material inventory created!")),m(),c({materialID:"",materialName:"",quantityUsed:"",reorderLevel:"",supplierID:"",deliveryDate:""}),w(null),E()}catch(r){const a=(t=r.response)!=null&&t.data?JSON.stringify(r.response.data,null,2):r.message;alert(`❌ Failed to save:
${a}`)}},ee=async t=>{var r;if(window.confirm("Are you sure you want to delete this record?"))try{await de(t),alert("🗑️ Record deleted successfully!"),M(a=>a.filter(o=>o.id!==t))}catch(a){const o=(r=a.response)!=null&&r.data?JSON.stringify(a.response.data,null,2):a.message;alert(`❌ Failed to delete:
${o}`)}},te=t=>{S(t.project),c({materialID:t.material,materialName:t.material_name,quantityUsed:t.quantity_used,reorderLevel:t.reorder_level,supplierID:t.supplier,deliveryDate:t.delivery_date}),w(t.id),y(!0)},N=H.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(b.toLowerCase()))),re=t=>{const r=new le("l","mm","a4");r.setFontSize(16),r.text("All Material & Inventory Report",14,15);const a=["Project ID","Material ID","Material Name","Quantity Used","Reorder Level","Supplier ID","Delivery Date"],o=(t||[]).map(d=>[d.project,d.material,d.material_name,d.quantity_used,d.reorder_level,d.supplier,F(d.delivery_date)]);ie(r,{head:[a],body:o,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),r.save("all_inventory_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Material & InventoryManagement"}),e.jsx(l,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(l,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(g,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(P,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:D,onChange:t=>O(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(R,{children:[e.jsx(k,{children:e.jsxs(j,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(q,{children:Y.filter(t=>{var r;return(r=t.project_id)==null?void 0:r.toLowerCase().includes(D.toLowerCase())}).map((t,r)=>e.jsxs(j,{children:[e.jsx(s,{children:t.project_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(L,{slug:h,action:"can_create",children:e.jsx(x,{onClick:()=>X(t.project_id),color:"primary",children:e.jsx(me,{sx:{color:"#7267ef"}})})})})]},r))})]})]})})}),e.jsx(l,{container:!0,spacing:2,children:e.jsx(l,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(v,{startIcon:e.jsx(ae,{}),onClick:()=>re(N),children:"Download PDF"}),e.jsx(g,{variant:"h6",gutterBottom:!0,children:"SUBMITTED MATERIALS & INVENTORIES"}),e.jsx("input",{type:"text",placeholder:"Search Projects",value:b,onChange:t=>B(t.target.value),className:"input"}),e.jsx(ge,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(R,{stickyHeader:!0,children:[e.jsx(k,{children:e.jsxs(j,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Material ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Material Name"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Quantity Used"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Reorder Level"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Supplier ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Delivery Date"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(q,{children:N.map((t,r)=>e.jsxs(j,{children:[e.jsx(s,{children:t.project}),e.jsx(s,{children:t.material}),e.jsx(s,{children:t.material_name}),e.jsx(s,{children:t.quantity_used}),e.jsx(s,{children:t.reorder_level}),e.jsx(s,{children:t.supplier}),e.jsx(s,{children:F(t.delivery_date)}),e.jsxs(s,{children:[e.jsx(U,{slug:h,action:"can_update",children:e.jsx(x,{color:"warning",onClick:()=>te(t),children:e.jsx(ve,{sx:{color:"orange"}})})}),e.jsx(L,{slug:h,action:"can_delete",children:e.jsx(x,{color:"error",onClick:()=>ee(t.id),children:e.jsx(Ie,{sx:{color:"red"}})})})]})]},t.id))})]})})]})})}),e.jsxs(pe,{open:z,onClose:m,fullWidth:!0,maxWidth:"xl",PaperProps:{style:f?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(je,{children:"Enter Project Details"}),e.jsxs(fe,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(x,{"aria-label":"toggle-size",onClick:$,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:f?e.jsx(De,{}):e.jsx(be,{})}),e.jsx(x,{"aria-label":"close",onClick:m,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(se,{})}),e.jsx(P,{component:"form",sx:{mt:2},children:e.jsxs(l,{container:!0,spacing:3,direction:"column",children:[e.jsxs(l,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project ID "}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsx(l,{container:!0,spacing:2,children:e.jsxs(l,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:C,disabled:!0})]})})]}),e.jsxs(l,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Material Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsxs(l,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"materialID",children:"Material ID"}),e.jsxs("select",{id:"materialID",name:"materialID",className:"input",value:n.materialID||"",onChange:K,children:[e.jsx("option",{value:"",children:"-- Select Material ID --"}),_.map(t=>e.jsx("option",{value:t.item_id,children:t.item_id},t.id))]})]}),e.jsxs(l,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"materialName",children:"Material Name"}),e.jsx("input",{id:"materialName",name:"materialName",className:"input",value:n.materialName||"",onChange:p,disabled:!0})]}),e.jsxs(l,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"quantityUsed",children:"Quantity Used"}),e.jsx("input",{id:"quantityUsed",name:"quantityUsed",className:"input",value:n.quantityUsed||"",onChange:p})]})]})]}),e.jsxs(l,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Order Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsxs(l,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"reorderLevel",children:"Reorder Level"}),e.jsx("input",{id:"reorderLevel",name:"reorderLevel",className:"input",value:n.reorderLevel||"",onChange:p})]}),e.jsxs(l,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"supplierID",children:"Supplier"}),e.jsxs("select",{id:"supplierID",name:"supplierID",className:"input",value:n.supplierID||"",onChange:t=>c(r=>({...r,supplierID:t.target.value})),children:[e.jsx("option",{value:"",children:"-- Select Supplier --"}),W.map(t=>e.jsxs("option",{value:t.vendor_id,children:[t.vendor_id," - ",t.vendor_name]},t.id))]})]}),e.jsxs(l,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"deliveryDate",children:"Delivery Date"}),e.jsx("input",{type:"date",id:"deliveryDate",name:"deliveryDate",className:"input",value:n.deliveryDate||"",onChange:p})]})]})]})]})})]}),e.jsxs(ye,{children:[e.jsx(v,{onClick:m,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(U,{slug:h,action:u?"can_update":"can_create",children:e.jsx(v,{variant:"outlined",onClick:Z,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:u?"Update":"Submit"})})]})]})]})};export{Qe as default};
