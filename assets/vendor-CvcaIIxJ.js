import{r as l,j as e,T as u,J as z,E as S,S as L,I as p,K as $}from"./main-Skim5IJC.js";import{C as ce}from"./Close-BKZ7QrSY.js";import{g as de}from"./engineering-BJ3wTiKO.js";import{g as pe,d as xe,u as me,c as he}from"./procurement-BWIn9uW6.js";import{f as ue}from"./date-DdrLtg20.js";import{D as je}from"./Download-C4sxsXoP.js";import{E as ge,a as fe}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{G as o}from"./Grid-fY_ATwTx.js";import{T as J,a as U,b as j,c as s,d as W}from"./TableRow-B6k_bSOs.js";import{A as ye}from"./AddCircle-CJp4DZj3.js";import{A as G,a as H}from"./ArrowForwardIos-D05tyAMF.js";import{B as I,D as be,a as Se,b as Ce,c as ve}from"./DialogTitle-CvDFHAwp.js";import{T as Pe}from"./TableContainer-gCCy6yK7.js";import{E as _e}from"./Edit-6vcT2Cu4.js";import{D as Ne}from"./Delete-Be1vvbhC.js";import{M as De,a as we}from"./minimize-2-RCuvNn0X.js";const We=()=>{const g="procurement",[T,Q]=l.useState(""),[E,K]=l.useState(""),[q,f]=l.useState(!1),[V,C]=l.useState(""),[v,X]=l.useState([]),[Z,ee]=l.useState([]),[y,F]=l.useState(null),[Ie,R]=l.useState("create"),P=4,[m,_]=l.useState(1),[N,re]=l.useState(!1),[h,A]=l.useState(1),D=5,[n,b]=l.useState({vendorId:"",vendorName:"",contactPerson:"",phoneNumber:"",email:"",address:"",vendorRating:"",complianceStatus:"",approvedSupplier:"",paymentTerms:"",contractExpiryDate:""}),te=()=>{re(!N)},k=Z.filter(r=>r.project_id.toLowerCase().includes(T.toLowerCase())),M=Math.ceil(k.length/P),O=k.slice((m-1)*P,m*P),se=r=>{R("create"),C(r);const t=new Date().getFullYear(),c=(v.length+1).toString().padStart(3,"0"),a=`${t}-VND-${c}`;b({vendorId:a,vendorName:"",contactPerson:"",phoneNumber:"",email:"",address:"",vendorRating:"",complianceStatus:"",approvedSupplier:"",paymentTerms:"",contractExpiryDate:""}),f(!0)},w=()=>f(!1),i=r=>{const{name:t,value:d}=r.target;b(c=>({...c,[t]:d}))};l.useEffect(()=>{(async()=>{try{const t=await de();console.log("Fetched projects:",t),ee(t)}catch(t){console.error("Failed to fetch accepted projects:",t)}})()},[]);const ne=async()=>{var d,c;if(!n.complianceStatus){alert("Please select a compliance status before submitting.");return}const r=Number(n.vendorRating);if(!r||r<1||r>5){alert("Vendor rating must be a number between 1 and 5.");return}if(!n.contractExpiryDate){alert("Please select a contract expiry date.");return}if(!n.paymentTerms||!n.paymentTerms.trim()){alert("Please enter payment terms.");return}const t=new FormData;t.append("project",V),t.append("vendor_name",n.vendorName),t.append("contact_person",n.contactPerson),t.append("phone_number",n.phoneNumber),t.append("email",n.email),t.append("address",n.address),t.append("vendor_rating",n.vendorRating),t.append("compliance_status",n.complianceStatus),n.approvedSupplier!==""&&t.append("approved_supplier",n.approvedSupplier==="true"),t.append("payment_terms",n.paymentTerms),t.append("contract_expiry_date",n.contractExpiryDate);try{y?(await me(y,t),alert("✅ Vendor updated successfully!")):(await he(t),alert("✅ Vendor submitted successfully!")),b({vendorId:"",vendorName:"",contactPerson:"",phoneNumber:"",email:"",address:"",vendorRating:"",complianceStatus:"",approvedSupplier:"",paymentTerms:"",contractExpiryDate:""}),C(null),F(null),f(!1),await(x==null?void 0:x())}catch(a){console.error("❌ Submission failed:",((d=a.response)==null?void 0:d.data)||a.message),alert(`❌ Submission failed:
${JSON.stringify(((c=a.response)==null?void 0:c.data)||{},null,2)}`)}},oe=async r=>{var d;if(!r){alert("❌ Vendor ID is missing.");return}if(window.confirm(`Are you sure you want to delete ${r}?`))try{await xe(r),alert(`✅ Vendor ${r} deleted successfully!`),await(x==null?void 0:x())}catch(c){const a=((d=c.response)==null?void 0:d.data)||c.message;alert(`❌ Failed to delete vendor: ${JSON.stringify(a)}`)}},x=async()=>{try{const r=await pe();X(r)}catch(r){console.error("Failed to fetch vendors:",r)}};l.useEffect(()=>{x()},[]);const ae=r=>{if(!r||!r.vendor_id){console.error("Invalid vendor data:",r);return}F(r.vendor_id),C(r.project),b({vendorId:r.vendor_id,vendorName:r.vendor_name||"",contactPerson:r.contact_person||"",phoneNumber:r.phone_number||"",email:r.email||"",address:r.address||"",vendorRating:r.vendor_rating!==void 0&&r.vendor_rating!==null?r.vendor_rating.toString():"",complianceStatus:r.compliance_status||"",approvedSupplier:r.approved_supplier!==void 0?r.approved_supplier.toString():"",paymentTerms:r.payment_terms||"",contractExpiryDate:r.contract_expiry_date?new Date(r.contract_expiry_date).toISOString().slice(0,10):""}),R("edit"),f(!0)},B=v.filter(r=>Object.values(r).some(t=>t&&t.toString().toLowerCase().includes(E.toLowerCase()))),Y=Math.ceil(B.length/D),le=B.slice((h-1)*D,h*D),ie=r=>{const t=new ge("l","mm","a4");t.setFontSize(16),t.text("All Feasibility Report",14,15);const d=["Project","Vendor ID","Vendor Name","Contact Person","Phone Number","Email","Address","Rating","Compliance Status","Approved Supplier","Payment Terms","Contract Expiry Date"],c=r.map(a=>[a.project,a.vendor_id,a.vendor_name,a.contact_person,a.phone_number,a.email,a.address,a.vendor_rating,a.compliance_status,a.approvedSupplier?"Yes":"No",a.payment_terms,a.contract_expiry_date]);fe(t,{head:[d],body:c,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),t.save("vendor report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Vendor Management"}),e.jsx(o,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(o,{item:!0,xs:12,children:e.jsxs(z,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(u,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(S,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:T,onChange:r=>{Q(r.target.value),_(1)},className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(J,{children:[e.jsx(U,{children:e.jsxs(j,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(W,{children:O.length>0?O.map((r,t)=>e.jsxs(j,{children:[e.jsx(s,{children:r.project_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(L,{slug:g,action:"can_create",children:e.jsx(p,{onClick:()=>se(r.project_id),color:"primary",children:e.jsx(ye,{sx:{color:"#7267ef"}})})})})]},t)):e.jsx(j,{children:e.jsx(s,{colSpan:2,align:"center",children:"No records found"})})})]}),e.jsxs(S,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(p,{disabled:m===1,onClick:()=>_(r=>r-1),children:e.jsx(G,{})}),e.jsxs(u,{variant:"body2",sx:{mx:2},children:["Page ",m," of ",M||1]}),e.jsx(p,{disabled:m>=M,onClick:()=>_(r=>r+1),children:e.jsx(H,{})})]})]})})}),e.jsx(o,{container:!0,spacing:2,children:e.jsx(o,{item:!0,xs:12,children:e.jsxs(z,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(I,{startIcon:e.jsx(je,{}),onClick:()=>ie(v)}),e.jsx(u,{variant:"h6",gutterBottom:!0,children:"SUBMITTED VENDOR RECORDS"}),e.jsx("input",{type:"text",placeholder:"Search Vendors",value:E,onChange:r=>K(r.target.value),className:"input"}),e.jsx(Pe,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(J,{stickyHeader:!0,children:[e.jsx(U,{children:e.jsxs(j,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Vendor ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Vendor Name"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Contact Person"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Phone Number"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Email Address"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Address"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Rating"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance Status"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approved"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Payment Terms"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Contract Expiry"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(W,{children:le.map((r,t)=>e.jsxs(j,{children:[e.jsx(s,{children:r.project}),e.jsx(s,{children:r.vendor_id}),e.jsx(s,{children:r.vendor_name}),e.jsx(s,{children:r.contact_person}),e.jsx(s,{children:r.phone_number}),e.jsx(s,{children:r.email}),e.jsx(s,{children:r.address}),e.jsx(s,{children:r.vendor_rating}),e.jsx(s,{children:r.compliance_status}),e.jsx(s,{children:r.approvedSupplier?"Yes":"No"}),e.jsx(s,{children:r.payment_terms}),e.jsx(s,{children:ue(r.contract_expiry_date)}),e.jsxs(s,{children:[e.jsx($,{slug:g,action:"can_update",children:e.jsx(p,{color:"warning",onClick:()=>ae(r),children:e.jsx(_e,{sx:{color:"orange"}})})}),e.jsx(L,{slug:g,action:"can_delete",children:e.jsx(p,{color:"error",onClick:()=>oe(r.vendor_id),children:e.jsx(Ne,{sx:{color:"red"}})})})]})]},t))})]})}),e.jsxs(S,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(p,{disabled:h===1,onClick:()=>A(r=>r-1),children:e.jsx(G,{})}),e.jsxs(u,{variant:"body2",sx:{mx:2},children:["Page ",h," of ",Y||1]}),e.jsx(p,{disabled:h>=Y,onClick:()=>A(r=>r+1),children:e.jsx(H,{})})]})]})})}),e.jsxs(be,{open:q,onClose:w,fullWidth:!0,maxWidth:"xl",PaperProps:{style:N?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(Se,{children:"Enter Vendor Details"}),e.jsxs(Ce,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(p,{"aria-label":"toggle-size",onClick:te,sx:{position:"absolute",right:40,top:8,color:r=>r.palette.grey[600]},children:N?e.jsx(De,{}):e.jsx(we,{})}),e.jsx(p,{"aria-label":"close",onClick:w,sx:{position:"absolute",right:8,top:8,color:r=>r.palette.grey[500]},children:e.jsx(ce,{})}),e.jsx(S,{component:"form",sx:{mt:2},children:e.jsxs(o,{container:!0,spacing:3,direction:"column",children:[e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Vendor Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"vendorId",children:"Vendor ID"}),e.jsx("input",{id:"vendorId",name:"vendorId",className:"input",value:n.vendorId||"",onChange:i,disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:V,disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"vendorName",children:["Vendor Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"vendorName",name:"vendorName",className:"input",value:n.vendorName||"",onChange:i})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"contactPerson",children:["Contact Person ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"contactPerson",name:"contactPerson",className:"input",value:n.contactPerson||"",onChange:i})]})]})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Compliance & Status"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"email",children:["Email Address ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"email",name:"email",type:"email",className:"input",value:n.email||"",onChange:i})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"phoneNumber",children:["Phone Number ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"phoneNumber",name:"phoneNumber",className:"input",value:n.phoneNumber||"",onChange:i})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"address",children:["Address ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("textarea",{id:"address",name:"address",className:"input",rows:3,value:n.address||"",onChange:i})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"vendorRating",children:["Vendor Rating ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"number",id:"vendorRating",name:"vendorRating",className:"input",value:n.vendorRating||"",onChange:i,min:0,max:5})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"complianceStatus",children:["Compliance Status ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{id:"complianceStatus",name:"complianceStatus",className:"input",value:n.complianceStatus,onChange:i,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Compliant",children:"Compliant"}),e.jsx("option",{value:"Non-Compliant",children:"Non-Compliant"})]})]})]})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Approval & Payment"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvedSupplier",children:"Approved Supplier"}),e.jsxs("select",{id:"approvedSupplier",name:"approvedSupplier",className:"input",value:n.approvedSupplier||"",onChange:i,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"true",children:"Yes"}),e.jsx("option",{value:"false",children:"No"})]})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"paymentTerms",children:["Payment Terms ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"paymentTerms",name:"paymentTerms",className:"input",value:n.paymentTerms||"",onChange:i})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"contractExpiryDate",children:["Contract Expiry Date ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"date",id:"contractExpiryDate",name:"contractExpiryDate",className:"input",value:n.contractExpiryDate||"",onChange:i})]})]})]})]})})]}),e.jsxs(ve,{children:[e.jsx(I,{onClick:w,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx($,{slug:g,action:y?"can_update":"can_create",children:e.jsx(I,{variant:"outlined",onClick:ne,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:y?"Update Vendor":"Submit Vendor"})})]})]})]})};export{We as default};
