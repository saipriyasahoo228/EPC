import{r as i,j as e,T as b,J as F,E as N,S as L,I as x,K as A}from"./main-Skim5IJC.js";import{C as Z}from"./Close-BKZ7QrSY.js";import{D as ee}from"./Download-C4sxsXoP.js";import{E as te,a as re}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{g as ne}from"./engineering-BJ3wTiKO.js";import{a as se,b as oe,e as ie,f as ae}from"./commision-Dp7iUYLu.js";import{f as R}from"./date-DdrLtg20.js";import{G as s}from"./Grid-fY_ATwTx.js";import{T as k,a as M,b as v,c as n,d as O}from"./TableRow-B6k_bSOs.js";import{A as le}from"./AddCircle-CJp4DZj3.js";import{B as S,D as de,a as ce,b as ue,c as xe}from"./DialogTitle-CvDFHAwp.js";import{T as pe}from"./TableContainer-gCCy6yK7.js";import{E as he}from"./Edit-6vcT2Cu4.js";import{D as me}from"./Delete-Be1vvbhC.js";import{M as je,a as ve}from"./minimize-2-RCuvNn0X.js";const Le=()=>{const p="commissioning",[g,Y]=i.useState(!1),[y,B]=i.useState(""),[C,z]=i.useState(""),[$,f]=i.useState(!1),[I,P]=i.useState(""),[o,u]=i.useState({}),[D,H]=i.useState([]),[h,m]=i.useState(!1),[ge,w]=i.useState(null),[W,G]=i.useState([]),[_,E]=i.useState(null),U=()=>{Y(!g)},J=t=>{P(t);const r=new Date().getFullYear(),c=(D.length+1).toString().padStart(3,"0");u({handoverprocessID:`HND-${r}-${c}`,projectId:t}),m(!1),w(null),f(!0)};i.useEffect(()=>{(async()=>{try{const r=await ne();G(r)}catch(r){console.error("❌ Error fetching projects:",r)}})()},[]);const T=async()=>{try{const t=await se();H(t)}catch(t){console.error("❌ Error fetching handovers:",t)}};i.useEffect(()=>{T()},[]);const Q=t=>{u({handoverprocessID:t.handover_id,handoverDate:t.handover_date,receivingDepartment:t.receiving_department,handoverDocID:t.handover_document_id,componentList:t.system_component_list,trainingprovided:t.training_provided?"true":"false",document:t.training_documentation,issues:t.pending_issues,approvalStatus:t.final_approval_status}),E(t.handover_id),P(t.project_id),m(!0),f(!0)},q=async t=>{if(window.confirm(`Are you sure you want to delete Handover ID: ${t}?`))try{await oe(t),H(a=>a.filter(c=>c.handover_id!==t)),alert(`✅ Handover ID ${t} deleted successfully!`)}catch(a){console.error("❌ Error deleting handover:",a),alert("⚠️ Failed to delete handover. Please try again.")}},j=()=>{f(!1),u({}),m(!1),w(null)},d=t=>{const{name:r,value:a}=t.target;u(c=>({...c,[r]:a}))},K=async t=>{t.preventDefault();try{if(!o.handoverDocID||!o.componentList||!o.approvalStatus){alert("⚠️ Please fill in all required fields!");return}const r={project_id:I,handover_date:o.handoverDate,receiving_department:o.receivingDepartment,handover_document_id:o.handoverDocID,system_component_list:o.componentList,training_provided:o.trainingprovided==="true",training_documentation:o.document,pending_issues:o.issues,final_approval_status:o.approvalStatus};if(h&&_){const a=await ie(_,r);alert(`✏️ Handover updated successfully! Handover ID: ${a.data.handover_id}`)}else{const a=await ae(r);alert(`✅ Handover submitted successfully! Handover ID: ${a.data.handover_id}`)}T(),u({handoverprocessID:"",handoverDate:"",receivingDepartment:"",handoverDocID:"",componentList:"",trainingprovided:"",document:"",issues:"",approvalStatus:""}),m(!1),E(null),j()}catch(r){console.error("❌ Submission error:",r),alert("⚠️ Submission failed! Please check your input.")}},V=D.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(C.toLowerCase()))),X=t=>{const r=new te("l","mm","a4");r.setFontSize(16),r.text("All Handover Process Report",14,15);const a=["Project ID","Handover ID","Handover Date","Receiving Department","Document ID","Component List","Training Provided","Training Documentation","Pending Issues","Final Approval"],c=t.map(l=>[l.project_id,l.handover_id,R(l.handover_date),l.receiving_department,l.handover_document_id,l.system_component_list,l.training_provided===!0?"YES":l.training_provided===!1?"NO":"-",l.training_documentation,l.pending_issues,l.final_approval_status]);re(r,{head:[a],body:c,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),r.save("all_handover_process_report.pdf")};return e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Handover Process"}),e.jsx(s,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(s,{item:!0,xs:12,children:e.jsxs(F,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(N,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:y,onChange:t=>B(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(k,{children:[e.jsx(M,{children:e.jsxs(v,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(O,{children:W.filter(t=>{var r;return(r=t.id)==null?void 0:r.toString().toLowerCase().includes(y.toLowerCase())}).map((t,r)=>e.jsxs(v,{children:[e.jsx(n,{children:t.project_id}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(L,{slug:p,action:"can_create",children:e.jsx(x,{onClick:()=>J(t.project_id),color:"primary",children:e.jsx(le,{sx:{color:"#7267ef"}})})})})]},r))})]})]})})}),e.jsx(s,{container:!0,spacing:2,children:e.jsx(s,{item:!0,xs:12,children:e.jsxs(F,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(S,{startIcon:e.jsx(ee,{}),onClick:()=>X(D),children:"Download PDF"}),e.jsx(b,{variant:"h6",gutterBottom:!0,children:"HANDOVER PROCESS DETAILS"}),e.jsx("input",{type:"text",placeholder:"Search Handover Process",value:C,onChange:t=>z(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(pe,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(k,{stickyHeader:!0,children:[e.jsx(M,{children:e.jsxs(v,{children:[e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Handover ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Handover Date"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Receiving Department"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Handover Document ID"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"System/Component List"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Training Provided"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Training Documentation"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Pending Issues"})}),e.jsx(n,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Final Approval"})}),e.jsx(n,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(O,{children:V.map((t,r)=>e.jsxs(v,{children:[e.jsx(n,{children:t.project_id}),e.jsx(n,{children:t.handover_id}),e.jsx(n,{children:R(t.handover_date)}),e.jsx(n,{children:t.receiving_department}),e.jsx(n,{children:t.handover_document_id}),e.jsx(n,{children:t.system_component_list}),e.jsx(n,{children:t.training_provided===!0?"YES":t.training_provided===!1?"NO":"-"}),e.jsx(n,{children:t.training_documentation}),e.jsx(n,{children:t.pending_issues}),e.jsx(n,{children:t.final_approval_status}),e.jsxs(n,{children:[e.jsx(A,{slug:p,action:"can_update",children:e.jsx(x,{onClick:()=>Q(t),color:"warning",children:e.jsx(he,{sx:{color:"orange"}})})}),e.jsx(L,{slug:p,action:"can_delete",children:e.jsx(x,{onClick:()=>q(t.handover_id),color:"error",children:e.jsx(me,{sx:{color:"red"}})})})]})]},r))})]})})]})})}),e.jsxs(de,{open:$,onClose:j,fullWidth:!0,maxWidth:"xl",PaperProps:{style:g?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(ce,{children:h?"Edit Handover Process":"Enter Handover Process Details"}),e.jsxs(ue,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(x,{"aria-label":"toggle-size",onClick:U,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:g?e.jsx(je,{}):e.jsx(ve,{})}),e.jsx(x,{"aria-label":"close",onClick:j,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(Z,{})}),e.jsx(N,{component:"form",sx:{mt:2},children:e.jsxs(s,{container:!0,spacing:3,direction:"column",children:[e.jsxs(s,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:I||"",disabled:!0})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"handoverprocessID",children:"Handover ID"}),e.jsx("input",{id:"handoverprocessID",className:"input",value:o.handoverprocessID||"",disabled:!0})]})]})]}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Handover Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"handoverDate",children:"Handover Date"}),e.jsx("input",{type:"date",id:"handoverDate",name:"handoverDate",className:"input",value:o.handoverDate||"",onChange:d})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"receivingDepartment",children:"Recieving Department"}),e.jsx("input",{id:"receivingDepartment",name:"receivingDepartment",className:"input",value:o.receivingDepartment||"",onChange:d})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"handoverDocID",children:"Handover DocumentID"}),e.jsx("input",{id:"handoverDocID",name:"handoverDocID",className:"input",value:o.handoverDocID||"",onChange:d})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"componentList",children:"System/Component List"}),e.jsx("input",{id:"componentList",name:"componentList",className:"input",value:o.componentList||"",onChange:d})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"trainingprovided",children:"Training Provided"}),e.jsxs("select",{id:"trainingprovided",name:"trainingprovided",className:"input",value:o.trainingprovided||"",onChange:d,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"true",children:"YES"}),e.jsx("option",{value:"false",children:"NO"})]})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"document",children:"Training Documentation"}),e.jsx("input",{id:"document",name:"document",className:"input",value:o.document||"",onChange:d})]})]}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Pending Issues & Final Status"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"issues",children:"Pending Issues"}),e.jsx("input",{id:"issues",name:"issues",className:"input",value:o.issues||"",onChange:d})]}),e.jsxs(s,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:o.approvalStatus||"",onChange:d,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Conditional",children:"Conditional"}),e.jsx("option",{value:"Pending",children:"Pending"})]})]})]})]})]})]})})]}),e.jsxs(xe,{children:[e.jsx(S,{onClick:j,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(A,{slug:p,action:h&&_?"can_update":"can_create",children:e.jsx(S,{variant:"outlined",onClick:K,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:h?"Update":"Submit"})})]})]})]})};export{Le as default};
