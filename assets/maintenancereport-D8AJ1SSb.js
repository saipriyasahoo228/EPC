import{r as i,j as e,T as f,z as I}from"./main-IxGEKZMA.js";import{C as G}from"./Close-DoqWsXz3.js";import{g as Q,f as k,h as Y,i as z,j as U}from"./maintenance-CWRDLbWQ.js";import{G as o}from"./Grid-C72N-tAO.js";import{t as w,T as R,h as S,i as x,j as s,k as v,I as p,D as q,f as J,g as K,e as F}from"./TableRow-CRAT5KT_.js";import{A as V}from"./AddCircle-DWIRGPUh.js";import{T as X}from"./TableContainer-BaU58JEj.js";import{E as Z}from"./Edit-g2hjeeYC.js";import{D as ee}from"./Delete-cHl_EB0l.js";import{D as te}from"./DialogActions-D5wP0Mt-.js";import"./Transition-C29ZPDdz.js";const je=()=>{const[g,M]=i.useState(""),[D,T]=i.useState(""),[W,h]=i.useState(!1),[se,E]=i.useState(""),[n,c]=i.useState({}),[_,u]=i.useState([]),[j,C]=i.useState(null),[re,y]=i.useState(null),[N,A]=i.useState([]),[B,b]=i.useState(!1);i.useEffect(()=>{(async()=>{try{const r=await Q();A(r)}catch(r){console.error("❌ Error loading assets:",r)}})()},[]),i.useEffect(()=>{(async()=>{try{const r=await k();u(r)}catch(r){console.error("❌ Failed to load work orders:",r)}})()},[]);const O=t=>{E(t);const r=new Date().getFullYear(),m=(_.length+1).toString().padStart(4,"0");c({workOrderID:`WO-${r}-${m}`,assetId:t}),b(!1),y(null),h(!0)},P=t=>{c({workOrderID:t.work_order_id,assetId:t.asset,reportedIssue:t.reported_issue,issueReportedBy:t.issue_reported_by,reportDate:t.report_date,inspectionDate:t.inspection_date,technicianId:t.technician_id,repairWorkDone:t.repair_work_done,partsReplaced:t.parts_replaced,totalMaintenanceCost:t.total_maintenance_cost,completionDate:t.completion_date,finalStatus:t.final_status}),C(t.work_order_id),h(!0)},$=async t=>{if(window.confirm(`Are you sure you want to delete this work order?  ${t}`))try{await Y(t),alert(`🗑️ Work order ${t} deleted successfully`),u(r=>r.filter(l=>l.work_order_id!==t))}catch(r){alert("❌ Failed to delete work order"),console.error(r)}},d=()=>{h(!1),c({}),b(!1),y(null)},a=t=>{const{name:r,value:l}=t.target;c(m=>({...m,[r]:l}))},L=async()=>{try{const t={asset:n.assetId,reported_issue:n.reportedIssue,issue_reported_by:n.issueReportedBy,report_date:n.reportDate,inspection_date:n.inspectionDate||null,technician_id:n.technicianId,repair_work_done:n.repairWorkDone,parts_replaced:n.partsReplaced||null,total_maintenance_cost:parseFloat(n.totalMaintenanceCost||0),completion_date:n.completionDate||null,final_status:n.finalStatus};if(j){const l=await z(j,t);alert(`✏️ Work order updated: ${l.work_order_id}`)}else{const l=await U(t);alert(`✅ Work order created: ${l.work_order_id}`)}const r=await k();u(r),d(),C(null),c({})}catch(t){alert("❌ Failed to save work order"),console.error(t)}},H=_.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(D.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Maintenance Management Report"}),e.jsx(o,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(o,{item:!0,xs:12,children:e.jsxs(w,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(f,{variant:"h6",gutterBottom:!0,children:"ASSETS RECORDS"}),e.jsx(I,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Asset ID",value:g,onChange:t=>M(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(R,{children:[e.jsx(S,{children:e.jsxs(x,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(v,{children:N.filter(t=>t.asset_id.toLowerCase().includes(g.toLowerCase())).map((t,r)=>e.jsxs(x,{children:[e.jsx(s,{children:t.asset_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(p,{onClick:()=>O(t.asset_id),color:"primary",children:e.jsx(V,{sx:{color:"#7267ef"}})})})]},r))})]})]})})}),e.jsx(o,{container:!0,spacing:2,children:e.jsx(o,{item:!0,xs:12,children:e.jsxs(w,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(f,{variant:"h6",gutterBottom:!0,children:"Maintenance Management Report"}),e.jsx("input",{type:"text",placeholder:"Search Maintenance Details",value:D,onChange:t=>T(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(X,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(R,{stickyHeader:!0,children:[e.jsx(S,{children:e.jsxs(x,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Asset ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"WorkOrder ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Reported Issuees"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Issuees ReportedBy"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Report Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Technician ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Repair WorkDone"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Parts Replaced"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Total Maintenance Cost"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Completion Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Final Status"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(v,{children:H.map((t,r)=>e.jsxs(x,{children:[e.jsx(s,{children:t.asset}),e.jsx(s,{children:t.work_order_id}),e.jsx(s,{children:t.reported_issue}),e.jsx(s,{children:t.issue_reported_by}),e.jsx(s,{children:t.report_date}),e.jsx(s,{children:t.inspection_date}),e.jsx(s,{children:t.technician_id}),e.jsx(s,{children:t.repair_work_done}),e.jsx(s,{children:t.parts_replaced}),e.jsx(s,{children:t.total_maintenance_cost}),e.jsx(s,{children:t.completion_date}),e.jsx(s,{children:t.final_status}),e.jsxs(s,{children:[e.jsx(p,{onClick:()=>P(t),color:"warning",children:e.jsx(Z,{sx:{color:"orange"}})}),e.jsx(p,{onClick:()=>$(t.work_order_id),color:"error",children:e.jsx(ee,{sx:{color:"red"}})})]})]},r))})]})})]})})}),e.jsxs(q,{open:W,onClose:d,fullWidth:!0,children:[e.jsx(J,{children:B?"Edit Maintenance Report":"Enter Maintenance Report"}),e.jsxs(K,{sx:{position:"relative"},children:[e.jsx(p,{"aria-label":"close",onClick:d,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(G,{})}),e.jsx(I,{component:"form",sx:{mt:2},children:e.jsx(o,{container:!0,spacing:3,direction:"column",children:e.jsxs(o,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Maintenance Report"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Asset ID"}),e.jsx("input",{id:"projectId",name:"projectId",className:"input",value:n.assetId||"",onChange:a,disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"workOrderID",children:"Work Order ID"}),e.jsx("input",{id:"workOrderID",name:"workOrderID",className:"input",value:n.workOrderID||"",onChange:a,disabled:!0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"reportedIssue",children:"Reported Issue"}),e.jsx("textarea",{id:"reportedIssue",name:"reportedIssue",className:"input",rows:"3",value:n.reportedIssue||"",onChange:a})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"issueReportedBy",children:"Issue Reported By"}),e.jsx("input",{id:"issueReportedBy",name:"issueReportedBy",className:"input",value:n.issueReportedBy||"",onChange:a})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"reportDate",children:"Report Date"}),e.jsx("input",{type:"date",id:"reportDate",name:"reportDate",className:"input",value:n.reportDate||"",onChange:a})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionDate",children:"Inspection Date"}),e.jsx("input",{type:"date",id:"inspectionDate",name:"inspectionDate",className:"input",value:n.inspectionDate||"",onChange:a})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"technicianId",children:"Technician ID"}),e.jsx("input",{id:"technicianId",name:"technicianId",className:"input",value:n.technicianId||"",onChange:a})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"repairWorkDone",children:"Repair Work Done"}),e.jsx("textarea",{id:"repairWorkDone",name:"repairWorkDone",className:"input",rows:"3",value:n.repairWorkDone||"",onChange:a})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"partsReplaced",children:"Parts Replaced"}),e.jsx("textarea",{id:"partsReplaced",name:"partsReplaced",className:"input",rows:"2",value:n.partsReplaced||"",onChange:a})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"totalMaintenanceCost",children:"Total Maintenance Cost"}),e.jsx("input",{type:"number",step:"0.01",id:"totalMaintenanceCost",name:"totalMaintenanceCost",className:"input",value:n.totalMaintenanceCost||"",onChange:a})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"completionDate",children:"Completion Date"}),e.jsx("input",{type:"date",id:"completionDate",name:"completionDate",className:"input",value:n.completionDate||"",onChange:a})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"finalStatus",children:"Final Status"}),e.jsxs("select",{id:"finalStatus",name:"finalStatus",className:"input",value:n.finalStatus||"",onChange:a,children:[e.jsx("option",{value:"",children:"-- Select Status --"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Pending",children:"Pending Approval"})]})]})]})]})})})]}),e.jsxs(te,{children:[e.jsx(F,{onClick:d,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(F,{variant:"outlined",onClick:L,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:j?"Update":"Create"})]})]})]})};export{je as default};
