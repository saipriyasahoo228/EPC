import{r as o,j as e,T as y,z as T}from"./main-IxGEKZMA.js";import{C as M}from"./Close-DoqWsXz3.js";import{g as z}from"./engineering-BuN6Pdrr.js";import{h as J,i as W,j as K,k as V}from"./construction-Ca90qLEO.js";import{G as r}from"./Grid-C72N-tAO.js";import{t as A,T as Q,h as w,i as p,j as s,k as R,I as x,D as X,f as Z,g as q,e as F}from"./TableRow-CRAT5KT_.js";import{A as ee}from"./AddCircle-DWIRGPUh.js";import{T as te}from"./TableContainer-BaU58JEj.js";import{E as se}from"./Edit-g2hjeeYC.js";import{D as re}from"./Delete-cHl_EB0l.js";import{D as ne}from"./DialogActions-D5wP0Mt-.js";import"./Transition-C29ZPDdz.js";const ye=()=>{const[g,E]=o.useState(""),[u,N]=o.useState(""),[P,h]=o.useState(!1),[C,I]=o.useState(""),[j,k]=o.useState([]),[D,v]=o.useState(!1),[ie,S]=o.useState(null),[B,L]=o.useState([]),[O,$]=o.useState([]),[b,_]=o.useState(null),[i,a]=o.useState({qcId:"",projectId:"",inspectionDate:"",inspectionType:"",inspectorID:"",testResult:"",complianceStandards:"",defectIdentified:"",correctiveAction:"",approvalStatus:"",nextInspectionDate:""});o.useEffect(()=>{(async()=>{try{const n=await z();L(n)}catch(n){console.error("Error fetching accepted projects:",n)}})()},[]);const m=async()=>{try{const t=await J();k(t),console.log("✅ Quality Control records:",t)}catch(t){console.error("❌ Failed to fetch quality control records:",t)}};o.useEffect(()=>{m()},[]);const H=t=>{I(t);const n=new Date().getFullYear(),f=(j.length+1).toString().padStart(4,"0");a({qualitycontrolID:`QC-${n}-${f}`,projectId:t}),v(!1),S(null),h(!0)},U=t=>{a({qualitycontrolID:t.qc_id,projectId:t.project,inspectionDate:t.inspection_date,inspectionType:t.inspection_type,inspectorID:t.inspector_id,testResult:t.test_results,complianceStandards:t.compliance_standard,defectIdentified:t.defects_identified,correctiveAction:t.corrective_actions,approvalStatus:t.approval_status,nextInspectionDate:t.next_inspection_date}),I(t.project),_(t.qc_id),h(!0)},Y=async t=>{if(window.confirm("Are you sure you want to delete this record?"))try{await W(t),alert("✅ Record deleted successfully"),await m()}catch(l){console.error("❌ Failed to delete record:",l),alert("❌ Failed to delete record")}},d=()=>{h(!1),a({}),v(!1),S(null)},c=t=>{const{name:n,value:l}=t.target;a(f=>({...f,[n]:l}))},G=async()=>{var t;try{const n={project:C,inspection_date:i.inspectionDate,inspection_type:i.inspectionType,inspector_id:i.inspectorID,test_results:i.testResult,compliance_standard:i.complianceStandards,defects_identified:i.defectIdentified||"",corrective_actions:i.correctiveAction||"",approval_status:i.approvalStatus||"pending",next_inspection_date:i.nextInspectionDate||null};let l;b?(l=await K(b,n),alert(`✏️ Quality Control updated!
QC ID: ${l.qc_id}`)):(l=await V(n),alert(`✅ Quality Control saved!
QC ID: ${l.qc_id}`)),a({}),_(null),d(),m()}catch(n){console.error("❌ Failed to submit Quality Control:",n),alert(`❌ Failed to submit. ${((t=n.response)==null?void 0:t.data)||n.message}`)}};return o.useEffect(()=>{const t=j.filter(n=>Object.values(n).some(l=>l&&l.toString().toLowerCase().includes(u.toLowerCase())));$(t)},[u,j]),e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Quality Control & Assurance"}),e.jsx(r,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(r,{item:!0,xs:12,children:e.jsxs(A,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(y,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(T,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:g,onChange:t=>E(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(Q,{children:[e.jsx(w,{children:e.jsxs(p,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(R,{children:B.filter(t=>t.id.toString().toLowerCase().includes(g.toLowerCase())).map((t,n)=>e.jsxs(p,{children:[e.jsx(s,{children:t.project_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(x,{onClick:()=>H(t.project_id),color:"primary",children:e.jsx(ee,{sx:{color:"#7267ef"}})})})]},n))})]})]})})}),e.jsx(r,{container:!0,spacing:2,children:e.jsx(r,{item:!0,xs:12,children:e.jsxs(A,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(y,{variant:"h6",gutterBottom:!0,children:"QUALITY CONTROL & ASSUARANCE DETAILS"}),e.jsx("input",{type:"text",placeholder:"Search Quality Control",value:u,onChange:t=>N(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4,marginBottom:"16px"}}),e.jsx(te,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(Q,{stickyHeader:!0,children:[e.jsx(w,{children:e.jsxs(p,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Quality Control ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspection Type"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Inspector ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Test Results"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Compliance Standards"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Defects Identified"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Corrective Actions"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Status"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Next Inspection Date"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(R,{children:O.map((t,n)=>e.jsxs(p,{children:[e.jsx(s,{children:t.project}),e.jsx(s,{children:t.qc_id}),e.jsx(s,{children:t.inspection_date}),e.jsx(s,{children:t.inspection_type}),e.jsx(s,{children:t.inspector_id}),e.jsx(s,{children:t.test_results}),e.jsx(s,{children:t.compliance_standard}),e.jsx(s,{children:t.defects_identified}),e.jsx(s,{children:t.corrective_actions}),e.jsx(s,{children:t.approval_status}),e.jsx(s,{children:t.next_inspection_date}),e.jsxs(s,{children:[e.jsx(x,{onClick:()=>U(t),color:"warning",children:e.jsx(se,{sx:{color:"orange"}})}),e.jsx(x,{onClick:()=>Y(t.qc_id),color:"error",children:e.jsx(re,{sx:{color:"red"}})})]})]},n))})]})})]})})}),e.jsxs(X,{open:P,onClose:d,fullWidth:!0,children:[e.jsx(Z,{children:D?"Edit Quality Control & Assurance Details":"Enter Quality Control & Assurance Details"}),e.jsxs(q,{sx:{position:"relative"},children:[e.jsx(x,{"aria-label":"close",onClick:d,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(M,{})}),e.jsx(T,{component:"form",sx:{mt:2},children:e.jsxs(r,{container:!0,spacing:3,direction:"column",children:[e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:C,disabled:!0})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"qualitycontrolID",children:"Quality Assurance ID"}),e.jsx("input",{id:"qualitycontrolID",className:"input",value:i.qualitycontrolID||"",disabled:!0})]})]})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Inspection Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionDate",children:"Inspection Date"}),e.jsx("input",{type:"date",id:"inspectionDate",name:"inspectionDate",className:"input",value:i.inspectionDate||"",onChange:c})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectionType",children:"Inspection Type"}),e.jsx("input",{id:"inspectionType",name:"inspectionType",className:"input",value:i.inspectionType||"",onChange:c})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"inspectorID",children:"Inspector ID"}),e.jsx("input",{id:"inspectorID",name:"inspectorID",className:"input",value:i.inspectorID||"",onChange:c})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"testResult",children:"Test Results"}),e.jsx("input",{id:"testResult",name:"testResult",className:"input",value:i.testResult||"",onChange:c})]})]})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Compliance Standards & Approval Status"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"complianceStandards",children:"Compliance Standards"}),e.jsx("input",{id:"complianceStandards",name:"complianceStandards",className:"input",value:i.complianceStandards||"",onChange:c})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"defectIdentified",children:"Defects Identified"}),e.jsx("input",{id:"defectIdentified",name:"defectIdentified",className:"input",value:i.defectIdentified||"",onChange:c})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"correctiveAction",children:"Corrective Actions"}),e.jsx("input",{id:"correctiveAction",name:"correctiveAction",className:"input",value:i.correctiveAction||"",onChange:c})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:i.approvalStatus||"",onChange:c,children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"rework required",children:"Rework Required"})]})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"nextInspectionDate",children:"Next Inspection Date"}),e.jsx("input",{type:"date",id:"nextInspectionDate",name:"nextInspectionDate",className:"input",value:i.nextInspectionDate||"",onChange:c})]})]})]})]})})]}),e.jsxs(ne,{children:[e.jsx(F,{onClick:d,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(F,{variant:"outlined",onClick:G,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:D?"Update":"Submit"})]})]})]})};export{ye as default};
