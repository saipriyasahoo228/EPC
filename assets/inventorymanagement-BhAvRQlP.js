import{r as l,j as e,T as y,x as w,S as N,D as E}from"./main-BIxdd69i.js";import{C as ee}from"./Close-D340Gps3.js";import{g as te}from"./engineering-4VzvUWDc.js";import{g as re}from"./inventory-Bcy74QM6.js";import{w as se,x as ae,y as le,m as ie}from"./construction-TCh-rxln.js";import{g as ne}from"./procurement-Dxzq-DH5.js";import{G as a}from"./Grid-BnZNKmae.js";import{P as T,I as d,D as oe,f as ce,g as de,h as xe,e as P}from"./DialogTitle-D59uELMl.js";import{T as L,a as U,b as j,c as s,d as F}from"./TableRow-D8X36zJO.js";import{A as he}from"./AddCircle-Bn9h5MaP.js";import{T as ue}from"./TableContainer-1Xqyy-f8.js";import{E as me}from"./Edit-BJV-h6Li.js";import{D as je}from"./Delete-BHKbKfZ2.js";import{M as pe,a as fe}from"./minimize-2-Dl_U24Qm.js";const Ue=()=>{const x="construction",[p,q]=l.useState(!1),[ye,g]=l.useState(null),[v,R]=l.useState(""),[I,k]=l.useState(""),[O,f]=l.useState(!1),[D,b]=l.useState(""),[A,ge]=l.useState([]),[B,z]=l.useState([]),[C,V]=l.useState([]),[Q,G]=l.useState([]),[H,S]=l.useState([]),[h,_]=l.useState(null),[n,c]=l.useState({materialID:"",materialName:"",quantityUsed:"",reorderLevel:"",supplierID:"",deliveryDate:""}),J=()=>{q(!p)};l.useEffect(()=>{(async()=>{try{const r=await te();z(r)}catch(r){console.error("❌ Error fetching projects:",r)}})()},[]),l.useEffect(()=>{(async()=>{try{const r=await re();V(r)}catch(r){console.error("❌ Error loading inventory items:",r)}})()},[]),l.useEffect(()=>{(async()=>{try{const r=await ne();G(r)}catch(r){console.error("❌ Error fetching vendors:",r)}})()},[]);const M=async()=>{try{const t=await se();S(t)}catch(t){console.error("❌ Error loading inventory:",t)}};l.useEffect(()=>{M()},[]);const W=t=>{const r=t.target.value,i=C.find(o=>o.item_id===r);i&&c(o=>({...o,materialID:i.item_id,materialName:i.item_name}))},$=(t,r=null)=>{b(t),g(r),c(r!==null?A[r]:{}),f(!0)},u=()=>{f(!1),g(null),c({})},m=t=>{const{name:r,value:i}=t.target;c(o=>({...o,[r]:i}))},Y=async()=>{var t;try{const r={material:n.materialID,project:D,material_name:n.materialName,quantity_used:n.quantityUsed,reorder_level:n.reorderLevel,supplier:n.supplierID,delivery_date:n.deliveryDate};let i;h?(i=await le(h,r),alert("✏️ Updated successfully!")):(i=await ie(r),alert("✅ Material inventory created!")),u(),c({materialID:"",materialName:"",quantityUsed:"",reorderLevel:"",supplierID:"",deliveryDate:""}),_(null),M()}catch(r){const i=(t=r.response)!=null&&t.data?JSON.stringify(r.response.data,null,2):r.message;alert(`❌ Failed to save:
${i}`)}},K=async t=>{var r;if(window.confirm("Are you sure you want to delete this record?"))try{await ae(t),alert("🗑️ Record deleted successfully!"),S(i=>i.filter(o=>o.id!==t))}catch(i){const o=(r=i.response)!=null&&r.data?JSON.stringify(i.response.data,null,2):i.message;alert(`❌ Failed to delete:
${o}`)}},X=t=>{b(t.project),c({materialID:t.material,materialName:t.material_name,quantityUsed:t.quantity_used,reorderLevel:t.reorder_level,supplierID:t.supplier,deliveryDate:t.delivery_date}),_(t.id),f(!0)},Z=H.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(I.toLowerCase())));return e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Material & InventoryManagement"}),e.jsx(a,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(y,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(w,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:v,onChange:t=>R(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(L,{children:[e.jsx(U,{children:e.jsxs(j,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(F,{children:B.filter(t=>{var r;return(r=t.project_id)==null?void 0:r.toLowerCase().includes(v.toLowerCase())}).map((t,r)=>e.jsxs(j,{children:[e.jsx(s,{children:t.project_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(N,{slug:x,action:"can_create",children:e.jsx(d,{onClick:()=>$(t.project_id),color:"primary",children:e.jsx(he,{sx:{color:"#7267ef"}})})})})]},r))})]})]})})}),e.jsx(a,{container:!0,spacing:2,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(y,{variant:"h6",gutterBottom:!0,children:"SUBMITTED MATERIALS & INVENTORIES"}),e.jsx("input",{type:"text",placeholder:"Search Projects",value:I,onChange:t=>k(t.target.value),className:"input"}),e.jsx(ue,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(L,{stickyHeader:!0,children:[e.jsx(U,{children:e.jsxs(j,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Material ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Material Name"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Quantity Used"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Reorder Level"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Supplier ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Dalivery Date"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(F,{children:Z.map((t,r)=>e.jsxs(j,{children:[e.jsx(s,{children:t.project}),e.jsx(s,{children:t.material}),e.jsx(s,{children:t.material_name}),e.jsx(s,{children:t.quantity_used}),e.jsx(s,{children:t.reorder_level}),e.jsx(s,{children:t.supplier}),e.jsx(s,{children:t.delivery_date}),e.jsxs(s,{children:[e.jsx(E,{slug:x,action:"can_update",children:e.jsx(d,{color:"warning",onClick:()=>X(t),children:e.jsx(me,{sx:{color:"orange"}})})}),e.jsx(N,{slug:x,action:"can_delete",children:e.jsx(d,{color:"error",onClick:()=>K(t.id),children:e.jsx(je,{sx:{color:"red"}})})})]})]},t.id))})]})})]})})}),e.jsxs(oe,{open:O,onClose:u,fullWidth:!0,maxWidth:"xl",PaperProps:{style:p?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(ce,{children:"Enter Project Details"}),e.jsxs(de,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(d,{"aria-label":"toggle-size",onClick:J,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:p?e.jsx(pe,{}):e.jsx(fe,{})}),e.jsx(d,{"aria-label":"close",onClick:u,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(ee,{})}),e.jsx(w,{component:"form",sx:{mt:2},children:e.jsxs(a,{container:!0,spacing:3,direction:"column",children:[e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Project ID "}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsx(a,{container:!0,spacing:2,children:e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",className:"input",value:D,disabled:!0})]})})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Material Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"materialID",children:"Material ID"}),e.jsxs("select",{id:"materialID",name:"materialID",className:"input",value:n.materialID||"",onChange:W,children:[e.jsx("option",{value:"",children:"-- Select Material ID --"}),C.map(t=>e.jsx("option",{value:t.item_id,children:t.item_id},t.id))]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"materialName",children:"Material Name"}),e.jsx("input",{id:"materialName",name:"materialName",className:"input",value:n.materialName||"",onChange:m,disabled:!0})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"quantityUsed",children:"Quantity Used"}),e.jsx("input",{id:"quantityUsed",name:"quantityUsed",className:"input",value:n.quantityUsed||"",onChange:m})]})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Order Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"reorderLevel",children:"Reorder Level"}),e.jsx("input",{id:"reorderLevel",name:"reorderLevel",className:"input",value:n.reorderLevel||"",onChange:m})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"supplierID",children:"Supplier"}),e.jsxs("select",{id:"supplierID",name:"supplierID",className:"input",value:n.supplierID||"",onChange:t=>c(r=>({...r,supplierID:t.target.value})),children:[e.jsx("option",{value:"",children:"-- Select Supplier --"}),Q.map(t=>e.jsxs("option",{value:t.vendor_id,children:[t.vendor_id," - ",t.vendor_name]},t.id))]})]}),e.jsxs(a,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"deliveryDate",children:"Delivery Date"}),e.jsx("input",{type:"date",id:"deliveryDate",name:"deliveryDate",className:"input",value:n.deliveryDate||"",onChange:m})]})]})]})]})})]}),e.jsxs(xe,{children:[e.jsx(P,{onClick:u,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(E,{slug:x,action:h?"can_update":"can_create",children:e.jsx(P,{variant:"outlined",onClick:Y,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:h?"Update":"Submit"})})]})]})]})};export{Ue as default};
