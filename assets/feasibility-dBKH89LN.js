import{r as l,j as e,T as h,J as U,E as g,S as L,I as c,K as W}from"./main-Skim5IJC.js";import{C as ce}from"./Close-BKZ7QrSY.js";import{g as de,f as pe,b as xe,p as me,e as he}from"./engineering-BJ3wTiKO.js";import{D as ue}from"./Download-C4sxsXoP.js";import{E as je,a as ye}from"./jspdf.plugin.autotable-Aj3tGQhx.js";import{f as fe}from"./date-DdrLtg20.js";import{G as i}from"./Grid-fY_ATwTx.js";import{T as $,a as G,b as u,c as s,d as H}from"./TableRow-B6k_bSOs.js";import{A as ge}from"./AddCircle-CJp4DZj3.js";import{A as V,a as q}from"./ArrowForwardIos-D05tyAMF.js";import{B as b,D as be,a as Se,b as ve,c as Ce}from"./DialogTitle-CvDFHAwp.js";import{T as Te}from"./TableContainer-gCCy6yK7.js";import{V as _e}from"./Visibility-CWvGRW87.js";import{E as De}from"./Edit-6vcT2Cu4.js";import{D as Ie}from"./Delete-Be1vvbhC.js";import{M as Fe,a as we}from"./minimize-2-RCuvNn0X.js";const He=()=>{const j="engineering",[J,Q]=l.useState([]),[R,K]=l.useState(""),[k,X]=l.useState(""),[Z,y]=l.useState(!1),[A,B]=l.useState(""),[S,ee]=l.useState(!1),[v,te]=l.useState([]),[f,C]=l.useState("create"),T=4,[p,_]=l.useState(1),D=l.useRef(null),[x,E]=l.useState(1),I=5,[r,m]=l.useState({feasibilityStudyId:null,studyTitle:"",preparedBy:"",studyType:"",reports:null,riskAssessment:"",regulatoryCompliance:"",projectedROI:"",estimatedCompletionTime:"",recommendations:"",approvalStatus:"Pending",approvalDate:"",status:"Draft"}),O=J.filter(t=>t.project_id.toLowerCase().includes(R.toLowerCase())),M=Math.ceil(O.length/T),N=O.slice((p-1)*T,p*T);l.useEffect(()=>{(async()=>{try{const a=await de();Q(a)}catch(a){console.error("Error fetching projects:",a)}})()},[]);const F=async()=>{try{const t=await pe();te(t)}catch(t){console.error("Fetch failed:",t)}};l.useEffect(()=>{F()},[]);const se=t=>{C("edit"),B(t.project),m({feasibilityStudyId:t.feasibility_study_id,studyTitle:t.study_title,preparedBy:t.prepared_by,studyType:t.study_type,reports:null,riskAssessment:t.risk_assessment,regulatoryCompliance:t.regulatory_compliance,projectedROI:t.projected_roi,estimatedCompletionTime:t.estimated_completion_time,recommendations:t.recommendations,approvalStatus:t.approval_status,approvalDate:t.approval_date?new Date(t.approval_date).toISOString().slice(0,10):"",status:t.status||"Draft"}),y(!0)},re=async()=>{const t=new FormData;t.append("project",A),t.append("study_title",r.studyTitle),t.append("prepared_by",r.preparedBy),t.append("study_type",r.studyType),r.reports&&t.append("reports",r.reports),t.append("risk_assessment",r.riskAssessment),t.append("regulatory_compliance",r.regulatoryCompliance),t.append("projected_roi",r.projectedROI),t.append("estimated_completion_time",r.estimatedCompletionTime),t.append("recommendations",r.recommendations),t.append("approval_status",r.approvalStatus);const a=r.approvalDate?new Date(r.approvalDate).toISOString().slice(0,10):"";a&&t.append("approval_date",a),t.append("status",r.status||"Draft");try{f==="edit"?(await me(r.feasibilityStudyId,t),alert("Feasibility study updated successfully!")):(await he(t),alert("Feasibility study submitted successfully!")),await F(),y(!1),C("create"),m({studyTitle:"",preparedBy:"",studyType:"",reports:null,riskAssessment:"",regulatoryCompliance:"",projectedROI:"",estimatedCompletionTime:"",recommendations:"",approvalStatus:"Pending",approvalDate:"",status:"Draft"}),D.current&&(D.current.value=null)}catch(d){console.error("Submission failed:",d),alert("Failed to submit/update feasibility study.")}},ie=t=>{B(t);const a=new Date().getFullYear(),d=String(v.length+1).padStart(4,"0");C("create"),m({feasibilityStudyId:`FS-${a}-${d}`,studyTitle:"",preparedBy:"",studyType:"",reports:null,riskAssessment:"",regulatoryCompliance:"",projectedROI:"",estimatedCompletionTime:"",recommendations:"",approvalStatus:"Pending",approvalDate:"",status:"Draft"}),y(!0)},ae=async t=>{if(window.confirm(`Are you sure you want to delete ${t}?`))try{await xe(t),alert(`✅ Feasibility study ${t} deleted successfully!`),await F()}catch{alert("❌ Failed to delete. See console for details.")}},w=()=>y(!1),n=t=>{const{name:a,value:d}=t.target;m(P=>({...P,[a]:d}))},le=t=>{const a=new je("l","mm","a4");a.setFontSize(16),a.text("All Feasibility Report",14,15);const d=["Project ID","Feasibility Study ID","Study Title","Study Type","Prepared By","Risk Assessment","Regulatory Compliance","Projected ROI (%)","Est. Completion Time","Recommendations","Approval Status","Approval Date","Status","Actions"],P=t.map(o=>[o.project,o.feasibility_study_id,o.study_title,o.study_type,o.prepared_by,o.risk_assessment,o.regulatory_compliance,o.projected_roi,o.estimated_completion_time,o.recommendations,o.approval_status,o.approval_date,o.status]);ye(a,{head:[d],body:P,startY:25,styles:{fontSize:6,cellPadding:2,cellWidth:"auto",overflow:"linebreak"},headStyles:{fillColor:[114,103,239]},tableWidth:"auto"}),a.save("feasibility report.pdf")},Y=v.filter(t=>Object.values(t).some(a=>a&&a.toString().toLowerCase().includes(k.toLowerCase()))),z=Math.ceil(Y.length/I),oe=Y.slice((x-1)*I,x*I),ne=()=>{ee(!S)};return e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Feasibility Study Management"}),e.jsx(i,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(U,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"PROJECT RECORDS"}),e.jsx(g,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Project ID",value:R,onChange:t=>{K(t.target.value),_(1)},className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs($,{children:[e.jsx(G,{children:e.jsxs(u,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(H,{children:N.length>0?N.map((t,a)=>e.jsxs(u,{children:[e.jsx(s,{children:t.project_id}),e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(L,{slug:j,action:"can_create",children:e.jsx(c,{onClick:()=>ie(t.project_id),color:"primary",children:e.jsx(ge,{sx:{color:"#7267ef"}})})})})]},a)):e.jsx(u,{children:e.jsx(s,{colSpan:2,align:"center",children:"No records found"})})})]}),e.jsxs(g,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(c,{disabled:p===1,onClick:()=>_(t=>t-1),children:e.jsx(V,{})}),e.jsxs(h,{variant:"body2",sx:{mx:2},children:["Page ",p," of ",M||1]}),e.jsx(c,{disabled:p>=M,onClick:()=>_(t=>t+1),children:e.jsx(q,{})})]})]})})}),e.jsx(i,{container:!0,spacing:2,children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(U,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(b,{startIcon:e.jsx(ue,{}),onClick:()=>le(v)}),e.jsx(h,{variant:"h6",gutterBottom:!0,children:"SUBMITTED FEASIBILITY STUDIES"}),e.jsx("input",{type:"text",placeholder:"Search Feasibility Studies",value:k,onChange:t=>X(t.target.value),className:"input"}),e.jsx(Te,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs($,{stickyHeader:!0,children:[e.jsx(G,{children:e.jsxs(u,{children:[e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Feasibility Study ID"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Study Title"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Study Type"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Prepared By"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Risk Assessment"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Regulatory Compliance"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Projected ROI (%)"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Est. Completion Time"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Recommendations"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Status"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Approval Date"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Status"})}),e.jsx(s,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Report"})}),e.jsx(s,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(H,{children:oe.map((t,a)=>e.jsxs(u,{children:[e.jsx(s,{children:t.project}),e.jsx(s,{children:t.feasibility_study_id}),e.jsx(s,{children:t.study_title}),e.jsx(s,{children:t.study_type}),e.jsx(s,{children:t.prepared_by}),e.jsx(s,{children:t.risk_assessment}),e.jsx(s,{children:t.regulatory_compliance}),e.jsx(s,{children:t.projected_roi}),e.jsx(s,{children:t.estimated_completion_time}),e.jsx(s,{children:t.recommendations}),e.jsx(s,{children:t.approval_status}),e.jsx(s,{children:fe(t.approval_date)}),e.jsx(s,{children:t.status}),e.jsx(s,{children:t.reports?e.jsx(c,{component:"a",href:t.reports,target:"_blank",rel:"noopener noreferrer",title:"View",children:e.jsx(_e,{})}):"-"}),e.jsxs(s,{children:[e.jsx(W,{slug:j,action:"can_update",children:e.jsx(c,{color:"warning",onClick:()=>se(t),children:e.jsx(De,{sx:{color:"orange"}})})}),e.jsx(L,{slug:j,action:"can_delete",children:e.jsx(c,{color:"error",onClick:()=>ae(t.feasibility_study_id),children:e.jsx(Ie,{sx:{color:"red"}})})})]})]},a))})]})}),e.jsxs(g,{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2,pr:2,children:[e.jsx(c,{disabled:x===1,onClick:()=>E(t=>t-1),children:e.jsx(V,{})}),e.jsxs(h,{variant:"body2",sx:{mx:2},children:["Page ",x," of ",z||1]}),e.jsx(c,{disabled:x>=z,onClick:()=>E(t=>t+1),children:e.jsx(q,{})})]})]})})}),e.jsxs(be,{open:Z,onClose:w,fullWidth:!0,maxWidth:"xl",PaperProps:{style:S?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(Se,{children:"Enter Feasibility Study Details"}),e.jsxs(ve,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(c,{"aria-label":"toggle-size",onClick:ne,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:S?e.jsx(Fe,{}):e.jsx(we,{})}),e.jsx(c,{"aria-label":"close",onClick:w,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(ce,{})}),e.jsx(g,{component:"form",sx:{mt:2},children:e.jsxs(i,{container:!0,spacing:3,direction:"column",children:[e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Feasibility Study Information & Documents"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",name:"projectId",className:"input",value:A,disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"feasibilityStudyId",children:"Feasibility Study ID"}),e.jsx("input",{id:"feasibilityStudyId",name:"feasibilityStudyId",className:"input",value:r.feasibilityStudyId||"",disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"studyTitle",children:["Study Title ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"studyTitle",name:"studyTitle",className:"input",value:r.studyTitle||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"preparedBy",children:["Prepared By ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"preparedBy",name:"preparedBy",className:"input",value:r.preparedBy||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"studyType",children:["Study Type ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{id:"studyType",name:"studyType",className:"input",value:r.studyType||"",onChange:n,children:[e.jsx("option",{value:"",children:"Select Type"}),["Technical","Financial","Environmental","Operational"].map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsxs("label",{children:["Upload Reports/Documents ",f!=="edit"&&e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(b,{variant:"contained",component:"label",children:["Choose File",e.jsx("input",{type:"file",hidden:!0,ref:D,onChange:t=>{m(a=>({...a,reports:t.target.files[0]}))}})]})]})]})]}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Risk and Compliance"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"riskAssessment",children:["Risk Assessment ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("textarea",{id:"riskAssessment",name:"riskAssessment",className:"input",rows:3,value:r.riskAssessment||"",onChange:n,required:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"regulatoryCompliance",children:["Regulatory Compliance ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"regulatoryCompliance",name:"regulatoryCompliance",className:"input",value:r.regulatoryCompliance||"",onChange:n,required:!0})]})]})]}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Financial Information"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"projectedROI",children:["Projected ROI (%) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"number",id:"projectedROI",name:"projectedROI",className:"input",value:r.projectedROI||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"estimatedCompletionTime",children:["Estimated Completion Time (Months/Years) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"number",id:"estimatedCompletionTime",name:"estimatedCompletionTime",className:"input",value:r.estimatedCompletionTime||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"recommendations",children:["Recommendations ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("textarea",{id:"recommendations",name:"recommendations",className:"input",rows:3,value:r.recommendations||"",onChange:n})]})]})]}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Approval Information & Study Status"}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"100%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalStatus",children:"Approval Status"}),e.jsxs("select",{id:"approvalStatus",name:"approvalStatus",className:"input",value:r.approvalStatus||"",onChange:n,children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"approvalDate",children:"Approval Date"}),e.jsx("input",{type:"date",id:"approvalDate",name:"approvalDate",className:"input",value:r.approvalDate||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",className:"input",value:r.status||"",onChange:n,children:[e.jsx("option",{value:"Draft",children:"Draft"}),e.jsx("option",{value:"Under Review",children:"Under Review"}),e.jsx("option",{value:"Completed",children:"Completed"})]})]})]})]})]})})]}),e.jsxs(Ce,{children:[e.jsx(b,{onClick:w,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(W,{slug:j,action:f==="edit"?"can_update":"can_create",children:e.jsx(b,{variant:"outlined",onClick:re,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:f==="edit"?"Update":"Submit"})})]})]})]})};export{He as default};
