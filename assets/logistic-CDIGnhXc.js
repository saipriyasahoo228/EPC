import{r as o,j as e,T as b,J as w,E as P,S as O,I as p,K as E}from"./main-Skim5IJC.js";import{C as ee}from"./Close-BKZ7QrSY.js";import{h as te,m as re,n as se,o as ae,p as ie}from"./procurement-BWIn9uW6.js";import{D as le}from"./Download-C4sxsXoP.js";import"./jspdf.plugin.autotable-Aj3tGQhx.js";import{f as S}from"./date-DdrLtg20.js";import{G as i}from"./Grid-fY_ATwTx.js";import{T as R,a as M,b as D,c as a,d as k}from"./TableRow-B6k_bSOs.js";import{A as oe}from"./AddCircle-CJp4DZj3.js";import{B as C,D as ce,a as ne,b as de,c as he}from"./DialogTitle-CvDFHAwp.js";import{T as pe}from"./TableContainer-gCCy6yK7.js";import{E as xe}from"./Edit-6vcT2Cu4.js";import{D as ue}from"./Delete-Be1vvbhC.js";import{M as me,a as je}from"./minimize-2-RCuvNn0X.js";const Pe=()=>{const x="procurement",[L,B]=o.useState(""),[A,$]=o.useState(""),[d,N]=o.useState([]),[Y,z]=o.useState([]),[u,G]=o.useState([]),[f,T]=o.useState(!1),[ge,F]=o.useState(null),[H,m]=o.useState(!1),[U,ve]=o.useState([]),[I,q]=o.useState(!1),[s,j]=o.useState({projectId:"",purchaseOrderId:"",logisticId:"",transportId:"",vehicleDetails:"",driverName:"",dispatchDate:"",expectedArrivalDate:"",actualArrivalDate:"",deliveryLocation:"",shippingStatus:"",damageReport:""}),V=()=>{q(!I)};o.useEffect(()=>{(async()=>{try{const r=await te();G(r),console.log("✅ Material procurements:",r)}catch(r){console.error("❌ Failed to fetch material procurements:",r)}})()},[]);const y=async()=>{try{const t=await re();N(t);const r=t.map(l=>({logisticId:l.logistics_id,transportId:l.transport_provider_id,vehicleDetails:l.vehicle_details,driverName:l.driver_name,dispatchDate:l.dispatch_date,expectedArrivalDate:l.expected_arrival_date,actualArrivalDate:l.actual_arrival_date,deliveryLocation:l.delivery_location,shippingStatus:l.shipping_status,damageReport:l.damage_report}));z(r)}catch(t){console.error("Failed to load logistics:",t)}};o.useEffect(()=>{y()},[]);const W=()=>{const t=new Date().getFullYear(),r=(d==null?void 0:d.reduce((c,h)=>{var g;if((g=h.logistics_id)!=null&&g.startsWith(`LOG-${t}-`)){const v=parseInt(h.logistics_id.split("-")[2],10);return v>c?v:c}return c},0))||0,l=String(r+1).padStart(3,"0");return`LOG-${t}-${l}`},Q=t=>{const r=u==null?void 0:u[t];r&&(F(t),j({projectId:r.project,procurementId:r.procurement_id,purchaseOrderId:r.purchase_order,logisticId:W(),transportId:"",vehicleDetails:"",driverName:"",dispatchDate:"",expectedArrivalDate:"",actualArrivalDate:"",deliveryLocation:"",shippingStatus:"",damageReport:""}),m(!0))},_=()=>{m(!1)},n=t=>{const{name:r,value:l}=t.target;j(c=>{const h={...c,[r]:l};if(r==="quantity"||r==="unitPrice"){const g=parseFloat(h.quantity)||0,v=parseFloat(h.unitPrice)||0,Z=(g*v).toFixed(2);h.totalCost=Z}return h})},J=async()=>{if(!s.transportId||!s.transportId.trim()){alert("Please provide the transport provider ID.");return}if(!s.vehicleDetails||!s.vehicleDetails.trim()){alert("Please enter the vehicle details.");return}if(!s.driverName||!s.driverName.trim()){alert("Please enter the driver name.");return}if(!s.dispatchDate){alert("Please select the dispatch date.");return}if(!s.expectedArrivalDate){alert("Please select the expected delivery date.");return}if(!s.actualArrivalDate){alert("Please select the actual delivery date.");return}if(!s.deliveryLocation||!s.deliveryLocation.trim()){alert("Please enter the delivery location.");return}try{const t={po_number:s.purchaseOrderId,transport_provider_id:s.transportId,vehicle_details:s.vehicleDetails,driver_name:s.driverName,dispatch_date:s.dispatchDate,expected_arrival_date:s.expectedArrivalDate,actual_arrival_date:s.actualArrivalDate||null,delivery_location:s.deliveryLocation,shipping_status:s.shippingStatus||"In Transit",damage_report:s.damageReport||""};f?(await ae(s.logisticId,t),alert("Logistics details updated successfully!")):(await ie({...t,logistics_id:s.logisticId}),alert("Logistics details submitted successfully!")),j({projectId:"",procurementId:"",purchaseOrderId:"",logisticId:"",transportId:"",vehicleDetails:"",driverName:"",dispatchDate:"",expectedArrivalDate:"",actualArrivalDate:"",deliveryLocation:"",shippingStatus:"In Transit",damageReport:""}),T(!1),m(!1),y()}catch(t){console.error("❌ Error submitting logistics:",t),alert(`Error: ${t.message}`)}},K=async(t,r)=>{if(window.confirm(`Are you sure you want to delete logistics ID: ${t}?`))try{await se(t);const c=[...d];c.splice(r,1),N(c),alert("✅ Logistics deleted successfully!"),y()}catch(c){console.error("❌ Error deleting logistics:",c),alert("❌ Failed to delete logistics.")}},X=t=>{const r=d==null?void 0:d[t];r&&(F(t),T(!0),j({purchaseOrderId:r.po_number||"",logisticId:r.logistics_id||"",transportId:r.transport_provider_id||"",vehicleDetails:r.vehicle_details||"",driverName:r.driver_name||"",dispatchDate:r.dispatch_date||"",expectedArrivalDate:r.expected_arrival_date||"",actualArrivalDate:r.actual_arrival_date||"",deliveryLocation:r.delivery_location||"",shippingStatus:r.shipping_status||"In Transit",damageReport:r.damage_report||""}),m(!0))};return U.filter(t=>Object.values(t).some(r=>r&&r.toString().toLowerCase().includes(A.toLowerCase()))),e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"h5",gutterBottom:!0,sx:{mt:5},children:"Logistic Management"}),e.jsx(i,{container:!0,spacing:2,direction:"column",sx:{mb:2},children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(w,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:"PURCHASE ORDERS"}),e.jsx(P,{sx:{my:2,mx:1},children:e.jsx("input",{type:"text",placeholder:"Search Purchase Orders",value:L,onChange:t=>B(t.target.value),className:"input",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:4}})}),e.jsxs(R,{children:[e.jsx(M,{children:e.jsxs(D,{children:[e.jsx(a,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Project ID"})}),e.jsx(a,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Procurement ID"})}),e.jsx(a,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Purchase Order ID"})}),e.jsx(a,{sx:{display:"flex",justifyContent:"flex-end",color:"#660000"},children:e.jsx("strong",{children:"Action"})})]})}),e.jsx(k,{children:u.filter(t=>`${t.project_id} ${t.procurement_id} ${t.purchase_order_id}`.toLowerCase().includes(L.toLowerCase())).map((t,r)=>e.jsxs(D,{children:[e.jsx(a,{children:t.project}),e.jsx(a,{children:t.procurement_id}),e.jsx(a,{children:t.purchase_order}),e.jsx(a,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(O,{slug:x,action:"can_create",children:e.jsx(p,{onClick:()=>Q(r),color:"primary",children:e.jsx(oe,{sx:{color:"#7267ef"}})})})})]},r))})]})]})})}),e.jsx(i,{container:!0,spacing:2,children:e.jsx(i,{item:!0,xs:12,children:e.jsxs(w,{sx:{p:2,backgroundColor:"#fff",border:"1px solid #ccc"},children:[e.jsx(C,{startIcon:e.jsx(le,{})}),e.jsx(b,{variant:"h6",gutterBottom:!0,children:"SUBMITTED LOGISTIC RECORDS"}),e.jsx("input",{type:"text",placeholder:"Search Logistic Management Here..",value:A,onChange:t=>$(t.target.value),className:"input"}),e.jsx(pe,{sx:{maxHeight:400,overflow:"auto",border:"1px solid #ddd"},children:e.jsxs(R,{stickyHeader:!0,children:[e.jsx(M,{children:e.jsxs(D,{children:[e.jsx(a,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Logistic ID "})}),e.jsx(a,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Transport Provider Id "})}),e.jsx(a,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Vehicle Details"})}),e.jsx(a,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Driver Name"})}),e.jsx(a,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Dispatch Date"})}),e.jsx(a,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Expected Arrival Date"})}),e.jsx(a,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Actual Arrival Date"})}),e.jsx(a,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Delivery Location"})}),e.jsx(a,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Shipping Status"})}),e.jsx(a,{sx:{color:"#7267ef"},children:e.jsx("strong",{children:"Damage Report"})}),e.jsx(a,{sx:{color:"#660000"},children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(k,{children:Y.map((t,r)=>e.jsxs(D,{children:[e.jsx(a,{children:t.logisticId}),e.jsx(a,{children:t.transportId}),e.jsx(a,{children:t.vehicleDetails}),e.jsx(a,{children:t.driverName}),e.jsx(a,{children:S(t.dispatchDate)}),e.jsx(a,{children:S(t.expectedArrivalDate)}),e.jsx(a,{children:S(t.actualArrivalDate)}),e.jsx(a,{children:t.deliveryLocation}),e.jsx(a,{children:t.shippingStatus}),e.jsx(a,{children:t.damageReport}),e.jsxs(a,{children:[e.jsx(E,{slug:x,action:"can_update",children:e.jsx(p,{color:"warning",onClick:()=>X(r),children:e.jsx(xe,{sx:{color:"orange"}})})}),e.jsx(O,{slug:x,action:"can_delete",children:e.jsx(p,{color:"error",onClick:()=>K(t.logisticId,r),children:e.jsx(ue,{sx:{color:"red"}})})})]})]},r))})]})})]})})}),e.jsxs(ce,{open:H,onClose:_,fullWidth:!0,maxWidth:"xl",PaperProps:{style:I?{width:"100%",height:"100vh",margin:0}:{width:"70%",height:"97vh"}},children:[e.jsx(ne,{children:"Enter Logistic Details"}),e.jsxs(de,{sx:{position:"relative",overflowY:"auto"},children:[e.jsx(p,{"aria-label":"toggle-size",onClick:V,sx:{position:"absolute",right:40,top:8,color:t=>t.palette.grey[600]},children:I?e.jsx(me,{}):e.jsx(je,{})}),e.jsx(p,{"aria-label":"close",onClick:_,sx:{position:"absolute",right:8,top:8,color:t=>t.palette.grey[500]},children:e.jsx(ee,{})}),e.jsx(P,{component:"form",sx:{mt:2},children:e.jsxs(i,{container:!0,spacing:3,direction:"column",children:[e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Purchase Order & Vendor info.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"purchaseOrderId",children:"Purchase Order ID"}),e.jsx("input",{id:"purchaseOrderId",name:"purchaseOrderId",className:"input",value:s.purchaseOrderId||"",disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"projectId",children:"Project ID"}),e.jsx("input",{id:"projectId",name:"projectId",className:"input",value:s.projectId||"",disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"procurementId",children:"Procurement ID"}),e.jsx("input",{id:"procurementId",name:"procurementId",className:"input",value:s.procurementId||"",disabled:!0})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"logisticId",children:"Logistic ID"}),e.jsx("input",{id:"logisticId",name:"logisticId",className:"input",value:s.logisticId||"",disabled:!0})]})]})]}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Transport Information.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"transportId",children:["Transport Provider ID ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"transportId",name:"transportId",className:"input",value:s.transportId||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"vehicleDetails",children:["Vehicle Details ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"vehicleDetails",name:"vehicleDetails",className:"input",value:s.vehicleDetails||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"driverName",children:["Driver Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"driverName",name:"driverName",className:"input",value:s.driverName||"",onChange:n})]})]})]}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx("h3",{style:{color:"#7267ef"},children:"Shipping Status.."}),e.jsx("hr",{style:{borderTop:"2px solid #7267ef",width:"80%"}}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"dispatchDate",children:["Dispatch Date ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"date",id:"dispatchDate",name:"dispatchDate",className:"input",value:s.dispatchDate||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"expectedArrivalDate",children:["Expected Arrival Date ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"date",id:"expectedArrivalDate",name:"expectedArrivalDate",className:"input",value:s.expectedArrivalDate||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"actualArrivalDate",children:["Actual Arrival Date ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"date",id:"actualArrivalDate",name:"actualArrivalDate",className:"input",value:s.actualArrivalDate||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsxs("label",{htmlFor:"deliveryLocation",children:["Delivery Location ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"deliveryLocation",name:"deliveryLocation",className:"input",value:s.deliveryLocation||"",onChange:n})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"shippingStatus",children:"Shipping Status"}),e.jsxs("select",{id:"shippingStatus",name:"shippingStatus",className:"input",value:s.shippingStatus||"",onChange:n,children:[e.jsx("option",{value:"",children:"Select Status"})," ",e.jsx("option",{value:"In Transit",children:"In Transit"}),e.jsx("option",{value:"Delivered",children:"Delivered "}),e.jsx("option",{value:"Delayed",children:"Delayed"}),e.jsx("option",{value:"Canceled",children:"Canceled"})]})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx("label",{htmlFor:"damageReport",children:"Damage Report"}),e.jsx("input",{id:"damageReport",name:"damageReport",className:"input",value:s.damageReport||"",onChange:n})]})]})]})]})})]}),e.jsxs(he,{children:[e.jsx(C,{onClick:_,sx:{outline:"2px solid #800000",color:"#800000","&:hover":{outline:"2px solid #b30000",color:"#b30000"}},children:"Cancel"}),e.jsx(E,{slug:x,action:f?"can_update":"can_create",children:e.jsx(C,{variant:"outlined",onClick:J,sx:{borderColor:"#7267ef",color:"#7267ef","&:hover":{borderColor:"#9e8df2",color:"#9e8df2"}},children:f?"Update Logistic Details":"Submit Logistic Details"})})]})]})]})};export{Pe as default};
